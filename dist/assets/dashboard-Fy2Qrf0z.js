const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/budget-tracker-Cw-BTWnF.js","assets/notifications-UIywheBc.js","assets/notifications-C8Kv7lRi.css"])))=>i.map(i=>d[i]);
import{a as e,N as t,d as a,A as n}from"./notifications-UIywheBc.js";import{doc as r,setDoc as i,getDoc as o,updateDoc as s,onSnapshot as l,deleteDoc as d,collection as c,query as u,where as p,getDocs as g,arrayUnion as m,addDoc as y,serverTimestamp as h,orderBy as b,limit as v}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";import{getToken as x,getMessaging as f,onMessage as k}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging.js";import"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";import"https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";const w={},S=function(e,t,a){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),a=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));n=Promise.allSettled(t.map(e=>{if((e=function(e){return"/"+e}(e))in w)return;w[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script"),r.crossOrigin="",r.href=e,a&&r.setAttribute("nonce",a),document.head.appendChild(r),t?new Promise((t,a)=>{r.addEventListener("load",t),r.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function r(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then(t=>{for(const e of t||[])"rejected"===e.status&&r(e.reason);return e().catch(r)})};function T(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}const I={renderModals(){const e=document.getElementById("modalsContainer");e&&(e.innerHTML=`\n            ${this.getActivityModal()}\n            ${this.getAuthModal()}\n            ${this.getEmergencyModal()}\n            ${this.getBudgetModal()}\n            ${this.getPhrasesModal()}\n            ${this.getNotesModal()}\n            ${this.getPackingListModal()}\n            ${this.getFavoritesModal()}\n            ${this.getCreateTripModal()}\n            ${this.getTripsListModal()}\n        `,this.setupNotesModal())},setupNotesModal(){setTimeout(()=>{const e=document.getElementById("saveNotesBtn");e&&e.addEventListener("click",e=>{e.preventDefault(),window.AppCore&&window.AppCore.saveNotes()})},100)},getActivityModal:()=>'\n            <div id="activityModal" class="fixed inset-0 bg-black bg-opacity-50 items-center justify-center p-4 hidden animate__animated animate__fadeIn" style="z-index: 10001;">\n                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-lg p-6 animate__animated animate__slideInUp">\n                    <div class="flex justify-between items-center mb-4">\n                        <h2 id="activityModalTitle" class="text-2xl font-bold dark:text-white">A√±adir Actividad</h2>\n                        <button onclick="ItineraryHandler.closeActivityModal()" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition">\n                            <svg class="w-6 h-6 text-gray-600 dark:text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>\n                        </button>\n                    </div>\n                    <form id="activityForm">\n                        <input type="hidden" id="activityId">\n                        <input type="hidden" id="activityDay">\n                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">\n                            <div>\n                                <label for="activityIcon" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Icono</label>\n                                <input type="text" id="activityIcon" placeholder="‚úàÔ∏è" class="w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">\n                            </div>\n                            <div>\n                                <label for="activityTime" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Hora</label>\n                                <input type="text" id="activityTime" placeholder="8:00 AM" class="w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">\n                            </div>\n                        </div>\n                        <div class="mt-4 relative">\n                            <label for="activityTitle" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">T√≠tulo</label>\n                            <input type="text" id="activityTitle" required placeholder="Narita Express ‚Üí Shinjuku" class="w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white" autocomplete="off">\n                            \x3c!-- Autocomplete Dropdown --\x3e\n                            <div id="activityTitleAutocomplete" class="hidden absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-xl max-h-80 overflow-y-auto"></div>\n                        </div>\n                        <div class="mt-4">\n                            <label for="activityDesc" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Descripci√≥n</label>\n                            <textarea id="activityDesc" rows="3" placeholder="Tren cubierto por JR Pass." class="w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"></textarea>\n                        </div>\n                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">\n                            <div>\n                                <label for="activityCost" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Costo (JPY)</label>\n                                <input type="number" id="activityCost" placeholder="3200" class="w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">\n                            </div>\n                            <div>\n                                <label for="activityStation" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Estaci√≥n</label>\n                                <input type="text" id="activityStation" placeholder="Shinjuku Station" class="w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">\n                            </div>\n                        </div>\n                        <div class="mt-6 flex justify-end gap-4">\n                            <button type="button" onclick="ItineraryHandler.closeActivityModal()" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg transition">Cancelar</button>\n                            <button type="submit" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition">Guardar</button>\n                        </div>\n                    </form>\n                </div>\n            </div>\n        ',getAuthModal:()=>'\n            <div id="modal-auth" class="modal">\n                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-md w-full">\n                    <div class="p-6">\n                        <div class="flex justify-between items-center mb-6">\n                            <h2 class="text-2xl font-bold dark:text-white">üîê Iniciar Sesi√≥n</h2>\n                            <button class="modal-close text-3xl hover:text-red-600 transition" data-modal-close="auth" aria-label="Cerrar">&times;</button>\n                        </div>\n\n                        \x3c!-- Tabs --\x3e\n                        <div class="flex gap-2 mb-6 border-b border-gray-200 dark:border-gray-700">\n                            <button \n                                id="loginTab" \n                                class="auth-tab px-4 py-2 font-semibold border-b-2 border-blue-500 text-blue-600 dark:text-blue-400"\n                            >\n                                Iniciar Sesi√≥n\n                            </button>\n                            <button \n                                id="registerTab" \n                                class="auth-tab px-4 py-2 font-semibold border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"\n                            >\n                                Registrarse\n                            </button>\n                        </div>\n\n                        \x3c!-- Login Form --\x3e\n                        <form id="loginForm" class="space-y-4">\n                            <div>\n                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n                                    Email\n                                </label>\n                                <input \n                                    id="loginEmail" \n                                    type="email" \n                                    required\n                                    class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                                    placeholder="tu@email.com"\n                                >\n                            </div>\n                            <div>\n                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n                                    Contrase√±a\n                                </label>\n                                <input \n                                    id="loginPassword" \n                                    type="password" \n                                    required\n                                    class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"\n                                >\n                            </div>\n                            <div class="text-right mb-3">\n                                <a \n                                    href="#" \n                                    id="forgotPasswordLink"\n                                    class="text-sm text-blue-600 dark:text-blue-400 hover:underline"\n                                >\n                                    ¬øOlvidaste tu contrase√±a?\n                                </a>\n                            </div>\n                            <button \n                                type="submit" \n                                class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition font-semibold"\n                            >\n                                Iniciar Sesi√≥n\n                            </button>\n                        </form>\n\n                        \x3c!-- Register Form (Hidden by default) --\x3e\n                        <form id="registerForm" class="space-y-4 hidden">\n                            <div>\n                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n                                    Email\n                                </label>\n                                <input \n                                    id="registerEmail" \n                                    type="email" \n                                    required\n                                    class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                                    placeholder="tu@email.com"\n                                >\n                            </div>\n                            <div>\n                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n                                    Contrase√±a (m√≠nimo 6 caracteres)\n                                </label>\n                                <input \n                                    id="registerPassword" \n                                    type="password" \n                                    required\n                                    minlength="6"\n                                    class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"\n                                >\n                            </div>\n                            <div>\n                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n                                    Confirmar Contrase√±a\n                                </label>\n                                <input \n                                    id="registerConfirmPassword" \n                                    type="password" \n                                    required\n                                    minlength="6"\n                                    class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"\n                                >\n                            </div>\n                            <div class="p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg mb-3">\n                                <p class="text-xs text-gray-700 dark:text-gray-300">\n                                    ‚ö†Ô∏è <strong>Seguridad:</strong> Usa una contrase√±a √∫nica que no uses en otros sitios. \n                                    M√≠nimo 6 caracteres, recomendado 8+.\n                                </p>\n                            </div>\n                            <button \n                                type="submit" \n                                class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition font-semibold"\n                            >\n                                Crear Cuenta\n                            </button>\n                        </form>\n\n                        \x3c!-- Divider --\x3e\n                        <div class="flex items-center gap-4 my-6">\n                            <div class="flex-1 h-px bg-gray-300 dark:bg-gray-600"></div>\n                            <span class="text-sm text-gray-500 dark:text-gray-400">o</span>\n                            <div class="flex-1 h-px bg-gray-300 dark:bg-gray-600"></div>\n                        </div>\n\n                        \x3c!-- Google Login --\x3e\n                        <button \n                            onclick="AuthHandler.loginWithGoogle()" \n                            class="w-full flex items-center justify-center gap-3 bg-white dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-white py-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition font-semibold"\n                        >\n                            <svg width="20" height="20" viewBox="0 0 20 20">\n                                <path fill="#4285F4" d="M19.6 10.23c0-.82-.1-1.42-.25-2.05H10v3.72h5.5c-.15.96-.74 2.31-2.04 3.22v2.45h3.16c1.89-1.73 2.98-4.3 2.98-7.34z"/>\n                                <path fill="#34A853" d="M13.46 15.13c-.83.59-1.96 1-3.46 1-2.64 0-4.88-1.74-5.68-4.15H1.07v2.52C2.72 17.75 6.09 20 10 20c2.7 0 4.96-.89 6.62-2.42l-3.16-2.45z"/>\n                                <path fill="#FBBC05" d="M3.99 10c0-.69.12-1.35.32-1.97V5.51H1.07A9.973 9.973 0 000 10c0 1.61.39 3.14 1.07 4.49l3.24-2.52c-.2-.62-.32-1.28-.32-1.97z"/>\n                                <path fill="#EA4335" d="M10 3.88c1.88 0 3.13.81 3.85 1.48l2.84-2.76C14.96.99 12.7 0 10 0 6.09 0 2.72 2.25 1.07 5.51l3.24 2.52C5.12 5.62 7.36 3.88 10 3.88z"/>\n                            </svg>\n                            Continuar con Google\n                        </button>\n\n                        \x3c!-- Info --\x3e\n                        <div class="mt-6 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">\n                            <p class="text-xs text-gray-600 dark:text-gray-400">\n                                üí° <strong>¬øPor qu√© registrarse?</strong> Para sincronizar tu presupuesto, \n                                checklist y fotos en todos tus dispositivos y compartir con tu hermano.\n                            </p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        ',getEmergencyModal:()=>'\n            <div id="modal-emergency" class="modal">\n                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">\n                    <div class="p-6">\n                        <div class="flex justify-between items-center mb-6">\n                            <h2 class="text-2xl font-bold text-red-600 dark:text-red-400">üö® Emergencias</h2>\n                            <button class="modal-close text-3xl hover:text-red-600 transition" data-modal-close="emergency" aria-label="Cerrar">&times;</button>\n                        </div>\n                        <div class="space-y-4">\n                            <div class="p-4 bg-red-50 dark:bg-red-900/30 rounded-lg border-l-4 border-red-500">\n                                <h3 class="font-bold text-lg mb-3 dark:text-white">Jap√≥n</h3>\n                                <div class="space-y-3">\n                                    <div class="flex justify-between items-center">\n                                        <span class="dark:text-gray-300">üöì Polic√≠a:</span>\n                                        <a href="tel:110" class="text-2xl font-bold text-red-600 dark:text-red-400 hover:underline">110</a>\n                                    </div>\n                                    <div class="flex justify-between items-center">\n                                        <span class="dark:text-gray-300">üöë Ambulancia/Bomberos:</span>\n                                        <a href="tel:119" class="text-2xl font-bold text-red-600 dark:text-red-400 hover:underline">119</a>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="p-4 bg-blue-50 dark:bg-blue-900/30 rounded-lg">\n                                <h3 class="font-bold mb-2 dark:text-white">üá®üá∑ Embajada Costa Rica</h3>\n                                <p class="text-sm dark:text-gray-300">üìû <a href="tel:+81-3-3486-1812" class="font-semibold hover:underline">+81-3-3486-1812</a></p>\n                                <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">Shibuya-ku, Tokyo</p>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        ',getBudgetModal:()=>'\n            <div id="modal-budget" class="modal">\n                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">\n                    <div class="p-6">\n                        <div class="flex justify-between items-center mb-6">\n                            <h2 class="text-2xl font-bold dark:text-white">üí∞ Budget Tracker</h2>\n                            <button class="modal-close text-3xl hover:text-red-600 transition" data-modal-close="budget" aria-label="Cerrar">&times;</button>\n                        </div>\n                        <div class="sync-badge mb-4"></div>\n                        <div id="budgetModalContent"></div>\n                    </div>\n                </div>\n            </div>\n        ',getPhrasesModal:()=>`\n            <div id="modal-phrases" class="modal">\n                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">\n                    <div class="p-6">\n                        <div class="flex justify-between items-center mb-6">\n                            <h2 class="text-2xl font-bold dark:text-white">üó£Ô∏è Frases √ötiles</h2>\n                            <button class="modal-close text-3xl hover:text-red-600 transition" data-modal-close="phrases" aria-label="Cerrar">&times;</button>\n                        </div>\n                        <div class="space-y-3 max-h-96 overflow-y-auto">\n                            ${[{jp:"„Åì„Çì„Å´„Å°„ÅØ (Konnichiwa)",es:"Hola (d√≠a)"},{jp:"„Åä„ÅØ„Çà„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô (Ohayou gozaimasu)",es:"Buenos d√≠as"},{jp:"„Åì„Çì„Å∞„Çì„ÅØ (Konbanwa)",es:"Buenas noches"},{jp:"„ÅÇ„Çä„Åå„Å®„ÅÜ (Arigatou)",es:"Gracias"},{jp:"„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô (Arigatou gozaimasu)",es:"Muchas gracias (formal)"},{jp:"„Åô„Åø„Åæ„Åõ„Çì (Sumimasen)",es:"Disculpe / Perd√≥n"},{jp:"„Åî„ÇÅ„Çì„Å™„Åï„ÅÑ (Gomen nasai)",es:"Lo siento"},{jp:"„ÅØ„ÅÑ (Hai)",es:"S√≠"},{jp:"„ÅÑ„ÅÑ„Åà (Iie)",es:"No"},{jp:"„Éà„Ç§„É¨„ÅØ„Å©„Åì„Åß„Åô„ÅãÔºü (Toire wa doko desu ka?)",es:"¬øD√≥nde est√° el ba√±o?"},{jp:"„ÅÑ„Åè„Çâ„Åß„Åô„ÅãÔºü (Ikura desu ka?)",es:"¬øCu√°nto cuesta?"},{jp:"Ëã±Ë™û„ÇíË©±„Åõ„Åæ„Åô„ÅãÔºü (Eigo wo hanasemasu ka?)",es:"¬øHabla ingl√©s?"},{jp:"„Åä„ÅÑ„Åó„ÅÑ (Oishii)",es:"Delicioso"},{jp:"„ÅäÊ∞¥„Çí„Åè„Å†„Åï„ÅÑ (Omizu wo kudasai)",es:"Agua por favor"},{jp:"„Åä‰ºöË®à„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô (Okaikei onegaishimasu)",es:"La cuenta por favor"}].map(e=>`\n                                <div class="p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/40 transition cursor-pointer">\n                                    <p class="font-semibold dark:text-white">${T(e.jp)}</p>\n                                    <p class="text-sm text-gray-600 dark:text-gray-400">${T(e.es)}</p>\n                                </div>\n                            `).join("")}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `,getCreateTripModal:()=>'\n            <div id="modal-create-trip" class="modal">\n                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-y-auto">\n                    <div class="p-8">\n                        <div class="flex justify-between items-center mb-6">\n                            <h2 class="text-3xl font-bold dark:text-white flex items-center gap-3">\n                                <span class="text-4xl">‚úàÔ∏è</span>\n                                Crear Nuevo Viaje\n                            </h2>\n                            <button onclick="TripsManager.closeCreateTripModal()" class="text-4xl hover:text-red-600 transition" aria-label="Cerrar">&times;</button>\n                        </div>\n\n                        \x3c!-- Selecci√≥n de Tipo de Viaje --\x3e\n                        <div id="tripTypeSelection">\n                            <p class="text-center text-lg text-gray-600 dark:text-gray-400 mb-8">\n                                ¬øC√≥mo quieres crear tu viaje?\n                            </p>\n\n                            <div class="grid md:grid-cols-2 gap-6">\n                                \x3c!-- Opci√≥n 1: Viaje Simple --\x3e\n                                <button \n                                    onclick="TripsManager.showSimpleTripForm()"\n                                    class="group p-8 bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/30 rounded-2xl border-3 border-blue-300 dark:border-blue-600 hover:border-blue-500 hover:shadow-2xl transition-all duration-300 transform hover:scale-105 text-left"\n                                >\n                                    <div class="text-center mb-4">\n                                        <div class="text-7xl mb-3">üìã</div>\n                                        <h3 class="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-2">\n                                            Viaje Simple\n                                        </h3>\n                                        <span class="inline-block bg-green-500 text-white text-xs px-3 py-1 rounded-full font-bold">\n                                            R√ÅPIDO\n                                        </span>\n                                    </div>\n                                    <div class="space-y-3 text-sm text-gray-700 dark:text-gray-300">\n                                        <p class="flex items-start gap-2">\n                                            <span class="text-green-500 text-lg">‚úì</span>\n                                            <span>Solo nombre y fechas del viaje</span>\n                                        </p>\n                                        <p class="flex items-start gap-2">\n                                            <span class="text-green-500 text-lg">‚úì</span>\n                                            <span>Creas el itinerario despu√©s paso a paso</span>\n                                        </p>\n                                        <p class="flex items-start gap-2">\n                                            <span class="text-green-500 text-lg">‚úì</span>\n                                            <span>M√°xima flexibilidad y personalizaci√≥n</span>\n                                        </p>\n                                        <p class="flex items-start gap-2">\n                                            <span class="text-green-500 text-lg">‚úì</span>\n                                            <span>Ideal si a√∫n no tienes todo definido</span>\n                                        </p>\n                                    </div>\n                                    <div class="mt-6 text-center">\n                                        <span class="text-xs text-gray-500 dark:text-gray-400">‚è±Ô∏è Toma 30 segundos</span>\n                                    </div>\n                                </button>\n\n                                \x3c!-- Opci√≥n 2: Wizard Completo --\x3e\n                                <button \n                                    onclick="TripsManager.showFullTripWizard()"\n                                    class="group p-8 bg-gradient-to-br from-purple-50 to-pink-100 dark:from-purple-900/30 dark:to-pink-800/30 rounded-2xl border-3 border-purple-300 dark:border-purple-600 hover:border-purple-500 hover:shadow-2xl transition-all duration-300 transform hover:scale-105 text-left"\n                                >\n                                    <div class="text-center mb-4">\n                                        <div class="text-7xl mb-3">‚ú®</div>\n                                        <h3 class="text-2xl font-bold text-purple-600 dark:text-purple-400 mb-2">\n                                            Wizard Completo\n                                        </h3>\n                                        <span class="inline-block bg-yellow-500 text-white text-xs px-3 py-1 rounded-full font-bold">\n                                            POPULAR\n                                        </span>\n                                    </div>\n                                    <div class="space-y-3 text-sm text-gray-700 dark:text-gray-300">\n                                        <p class="flex items-start gap-2">\n                                            <span class="text-purple-500 text-lg">‚úì</span>\n                                            <span>Elige ciudades, vuelos y conexiones</span>\n                                        </p>\n                                        <p class="flex items-start gap-2">\n                                            <span class="text-purple-500 text-lg">‚úì</span>\n                                            <span>Selecciona tus intereses y categor√≠as</span>\n                                        </p>\n                                        <p class="flex items-start gap-2">\n                                            <span class="text-purple-500 text-lg">‚úì</span>\n                                            <span>Usa plantillas predefinidas (8 opciones)</span>\n                                        </p>\n                                        <p class="flex items-start gap-2">\n                                            <span class="text-purple-500 text-lg">‚úì</span>\n                                            <span>Itinerario completo generado autom√°ticamente</span>\n                                        </p>\n                                    </div>\n                                    <div class="mt-6 text-center">\n                                        <span class="text-xs text-gray-500 dark:text-gray-400">‚è±Ô∏è Toma 2-3 minutos</span>\n                                    </div>\n                                </button>\n                            </div>\n\n                            <div class="mt-8 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-center">\n                                <p class="text-sm text-gray-700 dark:text-gray-300">\n                                    üí° <strong>Tip:</strong> Puedes empezar con el <strong>Viaje Simple</strong> y agregar detalles despu√©s,\n                                    o usar el <strong>Wizard Completo</strong> para tener todo listo de inmediato.\n                                </p>\n                            </div>\n                        </div>\n\n                        \x3c!-- Formulario Simple (Hidden) --\x3e\n                        <div id="simpleTripForm" class="hidden">\n                            <button \n                                onclick="document.getElementById(\'tripTypeSelection\').classList.remove(\'hidden\'); document.getElementById(\'simpleTripForm\').classList.add(\'hidden\');"\n                                class="mb-4 text-blue-600 dark:text-blue-400 hover:underline flex items-center gap-2"\n                            >\n                                ‚Üê Volver a opciones\n                            </button>\n\n                            <form id="createTripFormSimple" class="space-y-6">\n                                <div class="bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-lg p-6">\n                                    <h3 class="font-bold text-xl mb-4 dark:text-white flex items-center gap-2">\n                                        üìù Informaci√≥n B√°sica\n                                    </h3>\n                                    <div class="space-y-4">\n                                        <div>\n                                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n                                                Nombre del Viaje *\n                                            </label>\n                                            <input\n                                                id="simpleTripName"\n                                                type="text"\n                                                required\n                                                class="w-full p-3 border-2 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:border-blue-500 focus:outline-none"\n                                                placeholder="Ej: Aventura en Jap√≥n 2026"\n                                            >\n                                        </div>\n                                        <div class="grid md:grid-cols-2 gap-4">\n                                            <div>\n                                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n                                                    Fecha de Inicio *\n                                                </label>\n                                                <input\n                                                    id="simpleTripDateStart"\n                                                    type="date"\n                                                    required\n                                                    class="w-full p-3 border-2 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:border-blue-500 focus:outline-none"\n                                                >\n                                            </div>\n                                            <div>\n                                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n                                                    Fecha de Fin *\n                                                </label>\n                                                <input\n                                                    id="simpleTripDateEnd"\n                                                    type="date"\n                                                    required\n                                                    class="w-full p-3 border-2 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:border-blue-500 focus:outline-none"\n                                                >\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div class="flex gap-4">\n                                    <button\n                                        type="button"\n                                        onclick="TripsManager.closeCreateTripModal()"\n                                        class="flex-1 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-white py-3 rounded-lg hover:bg-gray-400 dark:hover:bg-gray-500 transition font-semibold"\n                                    >\n                                        Cancelar\n                                    </button>\n                                    <button\n                                        type="submit"\n                                        class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition font-semibold text-lg"\n                                    >\n                                        ‚ú® Crear Viaje\n                                    </button>\n                                </div>\n                            </form>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        ',getTripsListModal:()=>'\n            <div id="modal-trips-list" class="modal">\n                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">\n                    <div class="p-6">\n                        <div class="flex justify-between items-center mb-6">\n                            <h2 class="text-2xl font-bold dark:text-white">üóÇÔ∏è Mis Viajes</h2>\n                            <button onclick="TripsManager.closeTripsListModal()" class="text-3xl hover:text-red-600 transition" aria-label="Cerrar">&times;</button>\n                        </div>\n                        <div id="tripsListContainer"></div>\n                    </div>\n                </div>\n            </div>\n        ',getNotesModal:()=>'\n            <div id="modal-notes" class="modal">\n                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full">\n                    <div class="p-6">\n                        <div class="flex justify-between items-center mb-6">\n                            <h2 class="text-2xl font-bold dark:text-white">üìù Mis Notas</h2>\n                            <button class="modal-close text-3xl hover:text-red-600 transition cursor-pointer" data-modal-close="notes" aria-label="Cerrar">&times;</button>\n                        </div>\n                        <div class="sync-badge mb-4"></div>\n                        <textarea\n                            id="notesTextarea"\n                            class="w-full h-64 p-4 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white resize-none focus:outline-none focus:ring-2 focus:ring-red-500"\n                            placeholder="Escribe tus notas del viaje aqu√≠..."\n                        ></textarea>\n                        <button\n                            id="saveNotesBtn"\n                            class="mt-4 w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 font-semibold transition"\n                        >\n                            üíæ Guardar Notas\n                        </button>\n                    </div>\n                </div>\n            </div>\n        ',getPackingListModal:()=>'\n            <div id="modal-packing" class="modal">\n                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">\n                    <div class="p-6">\n                        <div class="flex justify-between items-center mb-6">\n                            <h2 class="text-2xl font-bold dark:text-white">üéí Checklist de Equipaje</h2>\n                            <button class="modal-close text-3xl hover:text-red-600 transition" data-modal-close="packing" aria-label="Cerrar">&times;</button>\n                        </div>\n                        <div id="packingListContainer"></div>\n                    </div>\n                </div>\n            </div>\n        ',getFavoritesModal:()=>'\n            <div id="modal-favorites" class="modal">\n                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">\n                    <div class="p-6">\n                        <div class="flex justify-between items-center mb-6">\n                            <h2 class="text-2xl font-bold dark:text-white">‚≠ê Mis Favoritos</h2>\n                            <button class="modal-close text-3xl hover:text-red-600 transition" data-modal-close="favorites" aria-label="Cerrar">&times;</button>\n                        </div>\n                        <div id="favoritesListContainer"></div>\n                    </div>\n                </div>\n            </div>\n        '},E={ramenRestaurants:{category:"Ramen Restaurants",icon:"üçú",color:"orange",items:[{name:"Ichiran Ramen",city:"Tokyo - Multiple locations",price:980,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"30-45 min",rating:4.6,description:"Cadena famosa con cabinas individuales. Tonkotsu ramen personalizable. 24hrs en Shibuya.",tips:"Sistema de tickets. Llena formulario antes de ordenar. Mejor temprano para evitar fila."},{name:"Afuri Ramen",city:"Tokyo - Harajuku",price:1100,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"30-40 min",rating:4.7,description:"Yuzu shio ramen (caldo de sal con c√≠trico). Ligero y refrescante. Muy popular.",tips:"Prueba el tsukemen. Siempre hay fila pero se mueve r√°pido."},{name:"Ippudo Ramen",city:"Tokyo - Multiple",price:1050,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"30-45 min",rating:4.5,description:"Tonkotsu cl√°sico de Hakata. Shiromaru es su especialidad.",tips:"Cadena internacional pero de calidad. Roppongi y Shinjuku."},{name:"Mutekiya",city:"Tokyo - Ikebukuro",price:850,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"20-30 min",rating:4.8,description:"Tonkotsu s√∫per cremoso. Local peque√±o, siempre lleno de japoneses.",tips:"Efectivo solamente. Fila larga pero vale la pena."},{name:"Tsuta (Michelin Star)",city:"Tokyo - Sugamo",price:1200,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"30-40 min",rating:4.9,description:"Primer ramen con estrella Michelin. Shoyu ramen con trufa.",tips:"Llegar 30-60 min antes de abrir para conseguir lugar."},{name:"Nakiryu (Michelin Star)",city:"Tokyo - Minami-Otsuka",price:1e3,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"25-35 min",rating:4.9,description:"Tantanmen (ramen picante) con estrella Michelin. Incre√≠ble.",tips:"Solo efectivo. M√°quina de tickets. Fila desde temprano."}]},sushiRestaurants:{category:"Sushi Restaurants",icon:"üç£",color:"blue",items:[{name:"Sushi Zanmai Tsukiji",city:"Tokyo - Tsukiji",price:3e3,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60 min",rating:4.7,description:"24 horas. Sushi fresco al lado del antiguo mercado. Set omakase accesible.",tips:"Abierto 24/7. Mejor horario: 5-7 AM despu√©s del mercado."},{name:"Uobei Shibuya Dogenzaka",city:"Tokyo - Shibuya",price:2e3,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"45-60 min",rating:4.5,description:"Sushi en cinta transportadora con tablets t√°ctiles. Moderno y econ√≥mico.",tips:"¬•100-500 por plato. Experiencia divertida y barata."},{name:"Sushi Dai (Tsukiji)",city:"Tokyo - Toyosu Market",price:4e3,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"30 min",rating:4.9,description:"¬°El mejor sushi del mercado! Fila de 2-3 horas pero INCRE√çBLE.",tips:"Ir a las 5 AM. La espera vale completamente la pena."},{name:"Genki Sushi",city:"Tokyo - Multiple",price:1500,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"45 min",rating:4.4,description:"Kaiten-zushi (cinta transportadora). Barato y bueno. Cadena.",tips:"Sistema de pedido digital. Divertido para ni√±os."},{name:"Kurazushi",city:"Tokyo/Osaka - Multiple",price:1200,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"40-50 min",rating:4.3,description:"Sushi econ√≥mico. Gacha system: cada 5 platos vac√≠os = premio.",tips:"Super barato. ¬•100-300 por plato. Gamificado."}]},yakinikuRestaurants:{category:"Yakiniku & Wagyu",icon:"ü•©",color:"red",items:[{name:"Yakiniku Jumbo Shirokane",city:"Tokyo - Shirokane",price:8e3,currency:"JPY",reservationUrl:"https://yakiniku-jumbo.com/",reserveDays:14,duration:"90-120 min",rating:4.9,description:"A5 Wagyu omakase. INCRE√çBLE. Experiencia de lujo.",tips:"Reserva con 2 semanas. Caro pero es el mejor wagyu que probar√°s."},{name:"Gyu-Kaku",city:"Tokyo - Multiple",price:3500,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"90 min",rating:4.4,description:"Cadena de yakiniku. All-you-can-eat disponible. Buena relaci√≥n calidad-precio.",tips:"Tabehoudai (buffet) por ¬•3000-4000. Ubicaciones en todos lados."},{name:"Yoroniku",city:"Tokyo - Minami-Aoyama",price:15e3,currency:"JPY",reservationUrl:"https://yoroniku.com/",reserveDays:60,duration:"120 min",rating:5,description:"EL MEJOR yakiniku de Tokyo. Imposible de reservar pero vale cada yen.",tips:"Reservas 2 meses antes. Se agotan en segundos. Muy caro pero legendary."}]},cafesAndDesserts:{category:"Cafes & Desserts",icon:"üç∞",color:"pink",items:[{name:"% Arabica Kyoto",city:"Kyoto - Arashiyama",price:600,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"20-30 min",rating:4.8,description:"Caf√© minimalista con vista al r√≠o. Instagram-famous. Latte art perfecto.",tips:"Vista incre√≠ble desde Higashiyama. Siempre hay fila pero r√°pida."},{name:"Blue Bottle Coffee",city:"Tokyo - Multiple",price:700,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"20-30 min",rating:4.6,description:"Cadena americana pero calidad top. Ubicaciones trendy.",tips:"Shinjuku, Roppongi, Kiyosumi. Menos tur√≠stico que Starbucks."},{name:"Harbs Cake",city:"Tokyo - Multiple",price:900,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"45-60 min",rating:4.7,description:"Rebanadas GIGANTES de pastel. Famosos por mille crepe cake.",tips:"Porciones enormes. Compartir recomendado. Set de lunch con pastel incluido."},{name:"Pablo Cheese Tart",city:"Osaka - Dotonbori",price:450,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"15 min",rating:4.6,description:"Cheese tart derretido por dentro. ADICTIVO. Para llevar.",tips:"Comer inmediatamente mientras est√° caliente. Ubicaciones en todo Jap√≥n."},{name:"Shibuya Hikarie Cafes",city:"Tokyo - Shibuya",price:800,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"45 min",rating:4.5,description:"Edificio con 30+ caf√©s. Matcha everything, pasteles japoneses, etc.",tips:"Explora pisos 6-7. Bills (pancakes australianos) es popular."},{name:"Tsujiri Matcha Cafe",city:"Kyoto - Multiple",price:850,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"30-40 min",rating:4.7,description:"Matcha parfait legendario. Desde 1860. Aut√©ntico matcha de Uji.",tips:"El parfait m√°s famoso: ¬•1200. Verde intenso y cremoso."}]},izakayas:{category:"Izakayas (Pub-style)",icon:"üçª",color:"orange",items:[{name:"Torikizoku",city:"Tokyo/Osaka - Multiple",price:2e3,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"90-120 min",rating:4.5,description:"TODO a ¬•350 (yakitori, cerveza, etc). S√öPER barato. Experiencia local.",tips:"Cash only. Sistema de men√∫ amarillo (todo mismo precio). Llega temprano, se llena."},{name:"Gonpachi Nishi-Azabu",city:"Tokyo - Nishi-Azabu",price:4e3,currency:"JPY",reservationUrl:"https://gonpachi.jp/",reserveDays:7,duration:"90-120 min",rating:4.6,description:"Inspir√≥ escena de Kill Bill. Yakitori y robata. Ambiente incre√≠ble.",tips:"Reserva recomendada. Prueba el kushiyaki (brochetas)."},{name:"Omoide Yokocho",city:"Tokyo - Shinjuku",price:3e3,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60-90 min",rating:4.7,description:"Callej√≥n con 60+ tiny izakayas. Post-war vibes. Piss Alley (nombre antiguo).",tips:"Explora y elige uno. Yakitori en todos. Cash only. Experiencia aut√©ntica."}]},freeAttractions:{category:"FREE Attractions",icon:"üÜì",color:"green",items:[{name:"Tokyo Metropolitan Government Building",city:"Tokyo - Shinjuku",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"30-45 min",rating:4.7,description:"Observatorio gratis en piso 45. Vista de 360¬∞ de Tokyo. Ver Mt. Fuji en d√≠a claro.",tips:"Abierto hasta 11 PM. Mejor al atardecer. NO necesita reserva."},{name:"Nara Deer Park",city:"Nara",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2-3 horas",rating:4.9,description:"1200+ venados semi-salvajes. Se inclinan pidiendo galletas (¬•200). IMPERDIBLE.",tips:"Compra shika senbei (galletas) por ¬•200. Venados son agresivos si tienes comida."},{name:"Shibuya Crossing",city:"Tokyo - Shibuya",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"20-30 min",rating:4.6,description:"Cruce peatonal m√°s famoso del mundo. 3000 personas cruzan a la vez.",tips:"Mejor vista desde Starbucks 2do piso o Shibuya Sky (gratis si solo ves el cruce)."},{name:"Takeshita Street",city:"Tokyo - Harajuku",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"45-60 min",rating:4.5,description:"Calle kawaii culture. Tiendas coloridas, crepes, cotton candy arco√≠ris.",tips:"Mejor entre semana. Fines de semana est√° ATASCADO. Instagram heaven."},{name:"Nakamise Shopping Street",city:"Tokyo - Asakusa",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"30-45 min",rating:4.6,description:"250m de tiendas tradicionales. Souvenirs, snacks, kimonos. Camino a Senso-ji.",tips:"Prueba ningyo-yaki (pastel relleno). Buen lugar para souvenirs."},{name:"Philosopher's Path",city:"Kyoto",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60-90 min",rating:4.8,description:"Caminata de 2km junto a canal. 500 cerezos. Conecta templos.",tips:"Mejor en sakura season. Conecta Ginkaku-ji con Nanzen-ji."},{name:"Dotonbori",city:"Osaka",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60-90 min",rating:4.7,description:"Distrito de neones y comida. Glico Running Man sign ic√≥nico. Nightlife.",tips:"Mejor de noche con luces. Street food everywhere. Takoyaki y okonomiyaki."},{name:"Arashiyama Bamboo Grove",city:"Kyoto - Arashiyama",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"30-45 min",rating:4.8,description:"Bosque de bamb√∫ gigante. Camino de 500m. Surreal y hermoso.",tips:"IR TEMPRANO (6-7 AM). Despu√©s de 9 AM est√° lleno de turistas. Gratis."},{name:"Yoyogi Park",city:"Tokyo - Harajuku",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60-120 min",rating:4.5,description:"Parque enorme. Picnics, performers, rockabilly dancers domingos.",tips:"Domingo en la ma√±ana = performers y m√∫sicos. Conecta con Meiji Shrine."},{name:"Odaiba Beach & Statue of Liberty",city:"Tokyo - Odaiba",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"90-120 min",rating:4.4,description:"Playa artificial, r√©plica de Estatua de Libertad, Rainbow Bridge view.",tips:"Mejor al atardecer. teamLab est√° cerca. DiverCity Tokyo Plaza tiene Gundam gigante."},{name:"Harajuku Takeshita Street",city:"Tokyo - Harajuku",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60 min",rating:4.6,description:"Epicentro kawaii culture. Tiendas coloridas, crepes gigantes, fashion statements.",tips:"Mejor entre semana (fines de semana est√° ATASCADO). Instagram heaven."},{name:"Shibuya Sky (Rooftop gratis)",city:"Tokyo - Shibuya",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"30 min",rating:4.5,description:"Rooftop del Shibuya Scramble Square. Vista del cruce sin pagar.",tips:"El observatorio cuesta, pero el rooftop del centro comercial es gratis."},{name:"Tokyo Station (Arquitectura)",city:"Tokyo",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"30-45 min",rating:4.5,description:"Estaci√≥n hist√≥rica restaurada. Fachada de ladrillo rojo hermosa.",tips:"Toma fotos desde Marunouchi South Exit. Character Street dentro."},{name:"Ueno Park",city:"Tokyo - Ueno",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2-3 horas",rating:4.7,description:"Parque enorme. Santuarios, estanques, artistas callejeros. 1000 cerezos.",tips:"Sakura season es espectacular. Zoo est√° dentro (ese s√≠ cuesta)."},{name:"Yasukuni Shrine",city:"Tokyo - Chiyoda",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"45-60 min",rating:4.3,description:"Santuario shintoista con jardines japoneses hermosos.",tips:"Pol√©mico por historia. Respeta el espacio. Cherry blossoms en primavera."},{name:"Hama-Rikyu Gardens (Exteriores)",city:"Tokyo - Chuo",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"30 min",rating:4.4,description:"Jard√≠n tradicional con vista de Skytree. Entrada cuesta, pero alrededores gratis.",tips:"Camina por el per√≠metro. Vista hermosa del puente."},{name:"Tokyo International Forum",city:"Tokyo - Yurakucho",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"45 min",rating:4.5,description:"Arquitectura moderna espectacular. Techo de vidrio masivo.",tips:"Entra a ver la estructura. Eventos gratis a veces. Cafeter√≠as dentro."},{name:"Shimokitazawa District",city:"Tokyo",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2-3 horas",rating:4.7,description:"Barrio hipster. Vintage shops, teatros, cafeter√≠as indie. Bohemio.",tips:"Explora callejones. Thrift stores incre√≠bles. Ambiente relajado."},{name:"Kappabashi Street (Kitchen Town)",city:"Tokyo - Asakusa",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60-90 min",rating:4.5,description:"Calle de utensilios de cocina. Plastic food displays famosos.",tips:"Compra souvenirs √∫nicos. Mejores cuchillos japoneses. Caminar es gratis."},{name:"Nezu Shrine",city:"Tokyo - Bunkyo",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"45 min",rating:4.6,description:"Santuario con t√∫nel de torii rojos. Menos turistas que Fushimi Inari.",tips:"Festival de azaleas en abril-mayo. Muy fotog√©nico."},{name:"Kagurazaka District",city:"Tokyo - Shinjuku",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"90 min",rating:4.5,description:"Barrio con vibe franc√©s-japon√©s. Calles empedradas, tiendas artesanales.",tips:"Mejor para caminar de noche. Restaurantes rom√°nticos (esos s√≠ cuestan)."},{name:"Sumida River Walk",city:"Tokyo - Sumida",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60-90 min",rating:4.4,description:"Paseo junto al r√≠o. Vista de Skytree, puentes, barcos.",tips:"Desde Asakusa hasta Skytree. Sakura trees a lo largo del camino."},{name:"Nakano Broadway",city:"Tokyo - Nakano",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"90-120 min",rating:4.6,description:"Centro comercial otaku. Manga, anime, figures, vintage toys.",tips:"Menos tur√≠stico que Akihabara. Mejores precios. 4 pisos de tesoros."},{name:"Kyu-Shiba-rikyu Gardens",city:"Tokyo - Minato",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"45 min",rating:4.3,description:"Jard√≠n tradicional con estanque. Oasis en medio de rascacielos.",tips:"Menos conocido que otros jardines. M√°s tranquilo."},{name:"Ginza Sony Park",city:"Tokyo - Ginza",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"30-45 min",rating:4.2,description:"Parque urbano subterr√°neo. Instalaciones temporales, eventos.",tips:"Cambia regularmente. Revisa qu√© hay antes de ir."},{name:"Toden Arakawa Line (Sakura Tram)",city:"Tokyo",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"Ride completo",rating:4.5,description:"Tranv√≠a retro. √önico streetcar en Tokyo. Atraviesa barrios locales.",tips:"Cuesta ¬•170 por ride pero vale la pena. Sakura season es m√°gico."},{name:"Kamakura Beach",city:"Kamakura (1hr desde Tokyo)",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2-4 horas",rating:4.6,description:"Playa bonita con vista del Monte Fuji en d√≠as claros.",tips:"Combina con templos de Kamakura. Surfistas en verano."},{name:"Sanja Matsuri Festival (Mayo)",city:"Tokyo - Asakusa",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"Evento de 3 d√≠as",rating:5,description:"UNO DE LOS FESTIVALES M√ÅS GRANDES. 2 millones de personas. Mikoshi parade.",tips:"Tercer fin de semana de mayo. GRATIS. Llega temprano."},{name:"Kyoto Imperial Palace",city:"Kyoto",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"90 min",rating:4.7,description:"Palacio imperial con jardines hermosos. Tours guiados gratis.",tips:"Reserva online. Tours en ingl√©s disponibles. Jardines abiertos sin reserva."},{name:"Fushimi Inari Night Walk",city:"Kyoto",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2-3 horas",rating:5,description:"Caminar Fushimi Inari de NOCHE. Menos gente, m√°gico, iluminado.",tips:"Abierto 24/7. Ir despu√©s de 6 PM. Lleva linterna. EXPERIENCIA √önica."},{name:"Kamogawa River Walk",city:"Kyoto",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60-90 min",rating:4.6,description:"Paseo rom√°ntico junto al r√≠o. Parejas everywhere. Cherry blossoms.",tips:"De d√≠a o noche. Restaurantes kawayuka en verano (esos s√≠ cuestan)."},{name:"Pontocho Alley",city:"Kyoto",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"30 min",rating:4.7,description:"Callej√≥n estrecho con casas tradicionales. Distrito geisha.",tips:"Caminar es gratis. Restaurantes caros pero la atm√≥sfera es incre√≠ble."},{name:"Yasaka Shrine",city:"Kyoto",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"30 min",rating:4.5,description:"Santuario colorido. Puerta de entrada a Gion. Iluminado de noche.",tips:"Conecta Gion con Maruyama Park. Night lighting espectacular."},{name:"Nijo Castle (Exteriores)",city:"Kyoto",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"30 min",rating:4.3,description:"Castillo con murallas impresionantes. Entrada cuesta pero exteriores gratis.",tips:"Camina alrededor. Moat con koi fish. Arquitectura hermosa."},{name:"Osaka Castle Park",city:"Osaka",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"90-120 min",rating:4.7,description:"Parque enorme alrededor del castillo. Entrar al castillo cuesta, parque gratis.",tips:"3000 cerezos en primavera. Vista del castillo gratis. Picnic spot."},{name:"Shinsekai District",city:"Osaka",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60-90 min",rating:4.5,description:"Barrio retro con Torre Tsutenkaku. Old-school Osaka vibes.",tips:"Caminar es gratis. Kushikatsu restaurants (esos s√≠ cuestan). Fotos incre√≠bles."},{name:"Amerikamura (American Village)",city:"Osaka",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60 min",rating:4.4,description:"Distrito juvenil. Street art, vintage shops, hip hop culture.",tips:"Estatua de Libertad peque√±a. Tatuaje shops. Youth fashion."},{name:"Tenjinbashisuji Shopping Street",city:"Osaka",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"90 min",rating:4.6,description:"Calle comercial M√ÅS LARGA de Jap√≥n. 2.6 km cubierto.",tips:"Atmosphere local. Menos tur√≠stico. Precios razonables."},{name:"Todaiji Temple Night Walk",city:"Nara",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"30 min",rating:4.7,description:"Caminar por Nara Park de noche. Venados durmiendo, templo iluminado.",tips:"Entrada al templo cuesta de d√≠a. Exteriores gratis siempre. M√°gico de noche."}]},observatories:{category:"Observatories & Sky Views",icon:"üåÉ",color:"indigo",items:[{name:"Tokyo Skytree",city:"Tokyo - Sumida",price:3100,currency:"JPY",reservationUrl:"https://www.tokyo-skytree.jp/en/",reserveDays:14,duration:"60-90 min",rating:4.7,description:"Torre m√°s alta de Jap√≥n (634m). Vista incre√≠ble 360¬∞. Tembo Galleria extra.",tips:"Compra fast pass skip-the-line. Mejor al atardecer para ver d√≠a y noche."},{name:"Shibuya Sky",city:"Tokyo - Shibuya",price:2200,currency:"JPY",reservationUrl:"https://www.shibuya-scramble-square.com/sky/",reserveDays:7,duration:"45-60 min",rating:4.8,description:"Rooftop abierto piso 47. Hamaca en el cielo. Vista de Shibuya Crossing.",tips:"Reserva online con descuento. Sunset es m√°gico. Menos tur√≠stico que Skytree."},{name:"Tokyo Tower",city:"Tokyo - Minato",price:1200,currency:"JPY",reservationUrl:"https://www.tokyotower.co.jp/en/",reserveDays:0,duration:"45-60 min",rating:4.5,description:"Torre ic√≥nica inspirada en Eiffel. 150m o 250m deck. Iluminada de noche.",tips:"M√°s barato que Skytree. Retro vibes. De noche es hermosa iluminada."},{name:"Umeda Sky Building",city:"Osaka",price:1500,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"45 min",rating:4.6,description:"Rooftop 360¬∞ en edificio futurista. Floating Garden Observatory.",tips:"Escalera mec√°nica atraviesa el vac√≠o (scary cool). Sunset recomendado."},{name:"Kyoto Tower",city:"Kyoto",price:800,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"30-45 min",rating:4.3,description:"Vista de Kyoto desde 100m. Frente a Kyoto Station.",tips:"M√°s bajo que otras torres pero √∫nica estructura alta en Kyoto."}]},districts:{category:"Districts & Neighborhoods",icon:"üèôÔ∏è",color:"purple",items:[{name:"Akihabara Electric Town",city:"Tokyo",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2-4 horas",rating:4.8,description:"Distrito otaku. Anime, manga, arcades, electr√≥nicos, maid cafes. Para√≠so geek.",tips:"Visita Mandarake (8 pisos manga/anime), arcades Sega, Radio Kaikan."},{name:"Shimokitazawa",city:"Tokyo",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2-3 horas",rating:4.7,description:"Barrio hipster. Vintage shops, teatros, caf√©s indie, m√∫sica en vivo.",tips:"Explora callejones. Thrift stores incre√≠bles. Ambiente bohemio."},{name:"Gion District",city:"Kyoto",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"1-2 horas",rating:4.9,description:"Distrito geisha. Calles tradicionales, casas de t√©, posible ver geishas al atardecer.",tips:"Mejor 5-7 PM para ver geishas yendo a trabajo. Respeta: no fotos directas."},{name:"Yanaka Ginza",city:"Tokyo",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"90 min",rating:4.6,description:"Barrio old-Tokyo. Shitamachi vibes. Tiendas locales, templos, gatos everywhere.",tips:"Sube Yuyake Dandan stairs al atardecer. √Årea sobrevivi√≥ WW2."},{name:"Denden Town",city:"Osaka",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2-3 horas",rating:4.5,description:"Akihabara de Osaka. Electr√≥nicos, anime, maid cafes, arcades.",tips:"Menos tur√≠stico que Akihabara. Precios similares."}]},uniqueExperiences:{category:"Unique Experiences",icon:"üé≠",color:"pink",items:[{name:"Mario Kart Street Racing",city:"Tokyo - Shibuya/Akihabara",price:8e3,currency:"JPY",reservationUrl:"https://maricar.com/",reserveDays:7,duration:"60-90 min",rating:4.8,description:"¬°Conduce go-karts disfrazado por calles de Tokyo! Cruzas Shibuya, Rainbow Bridge.",tips:"Licencia internacional requerida. Super divertido. Reserva anticipada."},{name:"Robot Restaurant",city:"Tokyo - Shinjuku",price:8e3,currency:"JPY",reservationUrl:"https://www.shinjuku-robot.com/",reserveDays:14,duration:"90 min",rating:4.5,description:"Show de robots, neones, y m√∫sica. Experiencia LOCA. Muy japones-weird.",tips:"Caro pero √∫nico. No es sobre comida, es el show. Sensory overload."},{name:"Samurai & Ninja Experience",city:"Tokyo/Kyoto - Multiple",price:5e3,currency:"JPY",reservationUrl:null,reserveDays:3,duration:"60-90 min",rating:4.6,description:"Aprende t√©cnicas de samurai o ninja. Fotos con armadura. Interactivo.",tips:"Varias compa√±√≠as. Kyoto Samurai & Ninja Museum es popular."},{name:"Onsen (Hot Springs)",city:"Hakone/Kinosaki/Multiple",price:1500,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60-120 min",rating:4.9,description:"Ba√±os termales japoneses. Separados por g√©nero. Desnudos. Experiencia cultural.",tips:"Oedo Onsen Tokyo (tem√°tico), Hakone (tradicional). NO tatuajes visibles."},{name:"Kimono Rental",city:"Kyoto/Tokyo - Multiple",price:3500,currency:"JPY",reservationUrl:null,reserveDays:1,duration:"D√≠a completo",rating:4.7,description:"Renta kimono/yukata todo el d√≠a. Incluye vestido y accesorios. Fotos en templos.",tips:"Kyoto es THE place. Yumeyakata y Okamoto populares. ¬•3000-5000."},{name:"Karaoke (Private Room)",city:"Tokyo/Osaka - Multiple",price:1500,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"90-120 min",rating:4.8,description:"Karaoke en cuarto privado. All-you-can-drink disponible. Experiencia must.",tips:"Chains: Karaoke Kan, Big Echo, Shidax. Nomihoudai (bebidas ilimitadas) +¬•1000."}]},arcadesEntertainment:{category:"Arcades & Entertainment",icon:"üéÆ",color:"blue",items:[{name:"Round1 Stadium",city:"Tokyo - Multiple",price:2e3,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2-4 horas",rating:4.7,description:"Mega arcade: bowling, karaoke, crane games, arcade games, batting cages, basketball.",tips:"M√∫ltiples pisos. Shibuya, Ikebukuro. All-in-one entretenimiento."},{name:"Taito Station",city:"Tokyo - Multiple",price:1e3,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"1-2 horas",rating:4.6,description:"Cadena de arcades. Crane games (UFO catcher), rhythm games, fighting games.",tips:"Akihabara tiene el m√°s grande. Crane games: ¬•100-200 por intento."},{name:"VR Zone Shinjuku",city:"Tokyo - Shinjuku",price:4400,currency:"JPY",reservationUrl:"https://vrzone-pic.com/",reserveDays:3,duration:"120 min",rating:4.5,description:"VR experiences: Dragon Ball, Mario Kart, Horror, etc. High-tech.",tips:"Precio incluye m√∫ltiples experiencias. Reserva online."},{name:"Joypolis (Sega)",city:"Tokyo - Odaiba",price:4500,currency:"JPY",reservationUrl:"https://tokyo-joypolis.com/",reserveDays:0,duration:"3-4 horas",rating:4.4,description:"Indoor theme park de Sega. Coasters, VR, simuladores, arcade.",tips:"Pass de 1 d√≠a con atracciones ilimitadas. Menos crowded que Disney."}]},markets:{category:"Markets & Food Halls",icon:"üè™",color:"orange",items:[{name:"Toyosu Fish Market",city:"Tokyo",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2-3 horas",rating:4.6,description:"Nuevo mercado de pescado (reemplaz√≥ Tsukiji). Tuna auction viewing 5:30 AM.",tips:"Galer√≠a de observaci√≥n gratis. Tuna auction requiere reserva online. Cerrado domingos."},{name:"Nishiki Market",city:"Kyoto",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"90-120 min",rating:4.7,description:"400m de callej√≥n con 100+ tiendas de comida. 'Cocina de Kyoto'. Samples everywhere.",tips:"Mejor 10 AM-4 PM. Prueba tsukemono (pickles), tofu, matcha. No comer mientras caminas."},{name:"Kuromon Market",city:"Osaka",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"90-120 min",rating:4.6,description:"170 puestos. Mariscos frescos, carne Kobe, frutas, street food. 'Cocina de Osaka'.",tips:"Desayuna aqu√≠. Scallops a la parrilla, uni, fugu. Precios razonables."},{name:"Ameya-Yokocho Market",city:"Tokyo - Ueno",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60-90 min",rating:4.5,description:"Mercado callejero post-WW2. Ropa, snacks, mariscos, cosm√©ticos. Ca√≥tico.",tips:"Regateo aceptado. Ambiente local. Paralelo a la v√≠a del tren."}]},maidAndThemedCafes:{category:"Maid & Themed Cafes",icon:"‚òï",color:"pink",items:[{name:"@home cafe",city:"Tokyo - Akihabara",price:1500,currency:"JPY",reservationUrl:"https://www.cafe-athome.com/",reserveDays:0,duration:"60-90 min",rating:4.5,description:"El maid cafe m√°s famoso. Shows, juegos, men√∫ kawaii.",tips:"No reserva necesaria. Mejor entre semana. Fotos con maids +¬•500."},{name:"Maidreamin",city:"Tokyo - Multiple",price:1800,currency:"JPY",reservationUrl:"https://maidreamin.com/",reserveDays:0,duration:"60 min",rating:4.3,description:"Cadena grande. Performances y men√∫ tem√°tico.",tips:"Akihabara, Shibuya, Ikebukuro. Concepto similar a @home."},{name:"Butler Cafe Swallowtail",city:"Tokyo - Ikebukuro",price:2e3,currency:"JPY",reservationUrl:"https://butlers-cafe.jp/",reserveDays:7,duration:"90 min",rating:4.7,description:"Butler cafe (versi√≥n masculina). Para audiencia femenina principalmente.",tips:"Reserva recomendada. Ambiente victoriano. Servicio impecable."},{name:"Vampire Cafe",city:"Tokyo - Ginza",price:3500,currency:"JPY",reservationUrl:null,reserveDays:3,duration:"90 min",rating:4.4,description:"Themed cafe g√≥tico. Decoraci√≥n de castillo, comida en platos de sangre.",tips:"Experiencia √∫nica. Caro pero atm√≥sfera incre√≠ble. Reserva recomendada."},{name:"Kawaii Monster Cafe",city:"Tokyo - Harajuku",price:2e3,currency:"JPY",reservationUrl:"https://kawaiimonster.jp/",reserveDays:0,duration:"90 min",rating:4.6,description:"Cafe psychedelic kawaii. Colores ne√≥n, shows de dancers, comida arco√≠ris.",tips:"Producido por Sebastian Masuda (dise√±ador de Kyary Pamyu Pamyu)."}]},animalCafes:{category:"Animal Cafes",icon:"üê±",color:"orange",items:[{name:"Hedgehog Cafe HARRY",city:"Tokyo - Roppongi",price:1500,currency:"JPY",reservationUrl:"https://www.harinezumi-cafe.com/",reserveDays:7,duration:"30 min",rating:4.8,description:"Erizos adorables. Puedes cargarlos. Muy popular.",tips:"RESERVA 1 SEMANA ANTES. Se agota r√°pido. Experiencia √∫nica."},{name:"Owl Cafe Akiba Fukurou",city:"Tokyo - Akihabara",price:2e3,currency:"JPY",reservationUrl:"https://akiba2960.com/",reserveDays:14,duration:"60 min",rating:4.7,description:"B√∫hos de diferentes especies. Relajante y √∫nico.",tips:"Solo efectivo. Reserva 2 semanas antes. No flash en fotos."},{name:"Cat Cafe Mocha",city:"Tokyo - Multiple",price:1200,currency:"JPY",reservationUrl:"https://catmocha.jp/",reserveDays:0,duration:"Ilimitado",rating:4.4,description:"Cadena limpia con muchos gatos. Precio por hora.",tips:"Shibuya, Harajuku, Akihabara. Bebidas gratis incluidas."},{name:"Rabbit Cafe Mimi",city:"Tokyo - Harajuku",price:1800,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"45 min",rating:4.6,description:"Conejos que puedes cargar y alimentar.",tips:"Walk-in. Mejor temprano. Conejos m√°s activos en ma√±ana."},{name:"Capybara Cafe",city:"Tokyo - Kichijoji",price:1500,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"40 min",rating:4.5,description:"¬°Capibaras! El roedor m√°s grande y amigable.",tips:"Peque√±o caf√©. M√°ximo 6 personas. Ir temprano o reservar por tel√©fono."},{name:"Otter Cafe Harry",city:"Tokyo - Harajuku",price:2500,currency:"JPY",reservationUrl:null,reserveDays:14,duration:"30 min",rating:4.9,description:"Nutrias juguetonas. SUPER raro y adorable.",tips:"Caro pero vale la pena. Reserva MUY anticipada. Interacci√≥n estrecha."}]},themeParks:{category:"Theme Parks",icon:"üé¢",color:"purple",items:[{name:"Tokyo Disneyland",city:"Tokyo - Urayasu",price:8900,currency:"JPY",reservationUrl:"https://www.tokyodisneyresort.jp/en/",reserveDays:60,duration:"Todo el d√≠a",rating:4.9,description:"Parque Disney m√°s visitado del mundo. √önico con √°rea Frozen.",tips:"Compra online 2 meses antes. App para FastPass digital. Mejor entre semana."},{name:"Tokyo DisneySea",city:"Tokyo - Urayasu",price:8900,currency:"JPY",reservationUrl:"https://www.tokyodisneyresort.jp/en/",reserveDays:60,duration:"Todo el d√≠a",rating:5,description:"√öNICO EN EL MUNDO. Parque tem√°tico del mar. Fantasy Springs nuevo 2024.",tips:"Mejor que Disneyland seg√∫n fans. Tower of Terror, Journey to Center of Earth."},{name:"Universal Studios Japan",city:"Osaka",price:8600,currency:"JPY",reservationUrl:"https://www.usj.co.jp/web/en/us",reserveDays:30,duration:"Todo el d√≠a",rating:4.8,description:"Super Nintendo World, Harry Potter, Minions. INCRE√çBLE.",tips:"Express Pass RECOMENDADO (¬•7000-12000). Nintendo World necesita timed entry."},{name:"Sanrio Puroland",city:"Tokyo - Tama",price:3600,currency:"JPY",reservationUrl:"https://en.puroland.jp/",reserveDays:7,duration:"4-5 horas",rating:4.5,description:"Hello Kitty theme park INDOOR. Shows musicales kawaii.",tips:"Mayormente para ni√±os pero fans adultos van. Weekdays menos crowded."},{name:"Fuji-Q Highland",city:"Yamanashi (near Mt. Fuji)",price:6400,currency:"JPY",reservationUrl:"https://www.fujiq.jp/en/",reserveDays:7,duration:"Todo el d√≠a",rating:4.7,description:"Roller coasters EXTREMOS. R√©cords mundiales. Vista de Mt. Fuji.",tips:"Fujiyama, Takabisha (121¬∞ drop), Eejanaika. Para amantes de adrenalina."}]},templesAndShrines:{category:"Temples & Shrines",icon:"‚õ©Ô∏è",color:"red",items:[{name:"Senso-ji Temple",city:"Tokyo - Asakusa",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60-90 min",rating:4.8,description:"Templo m√°s antiguo de Tokyo (628 AD). Puerta Kaminarimon ic√≥nica con farol gigante.",tips:"Ir temprano (6-7 AM) sin turistas. Omikuji (fortuna) por ¬•100."},{name:"Meiji Shrine",city:"Tokyo - Harajuku",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60-90 min",rating:4.9,description:"Santuario shintoista en bosque de 70 hect√°reas. Dedicado al Emperador Meiji.",tips:"Gratis. Ver bodas shintoistas fines de semana. Barrels de sake donados."},{name:"Fushimi Inari Shrine",city:"Kyoto",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2-3 horas",rating:5,description:"¬°10,000 torii rojos! Caminata de 2-4 hrs a la cima. IMPERDIBLE.",tips:"Abierto 24/7. Ir temprano (6 AM) o tarde (despu√©s 6 PM) para evitar multitudes."},{name:"Kinkaku-ji (Golden Pavilion)",city:"Kyoto",price:500,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"45-60 min",rating:4.9,description:"Pabell√≥n cubierto en oro. Reflejo en estanque es ic√≥nico. UNESCO.",tips:"Mejor con sol (brilla m√°s). No se puede entrar, solo ver. Jard√≠n hermoso."},{name:"Kiyomizu-dera",city:"Kyoto",price:400,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"90 min",rating:4.8,description:"Templo en colina con terraza de madera sin clavos. Vista espectacular de Kyoto.",tips:"Sube temprano. √Årea Higashiyama muy fotog√©nica. Santuario de amor Jishu."},{name:"Todai-ji Temple",city:"Nara",price:600,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60-90 min",rating:4.9,description:"Gran Buda de bronce de 15m. Edificio de madera m√°s grande del mundo. UNESCO.",tips:"Combina con Nara Deer Park (gratis). Pilar con agujero = buena suerte."},{name:"Itsukushima Shrine",city:"Miyajima Island",price:300,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2-3 horas",rating:5,description:"Torii flotante en el mar. Patrimonio UNESCO. Uno de los 3 paisajes m√°s bellos de Jap√≥n.",tips:"Visita con marea alta (torii flota) Y baja (puedes caminar). Isla tiene venados tambi√©n."},{name:"Ginkaku-ji (Silver Pavilion)",city:"Kyoto",price:500,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60 min",rating:4.7,description:"Jard√≠n zen con arena rastrillada. Philosopher's Path comienza aqu√≠.",tips:"Nunca fue plateado. Jard√≠n de musgo hermoso. Menos tur√≠stico que Kinkaku-ji."},{name:"Hase-dera Temple",city:"Kamakura",price:400,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60 min",rating:4.6,description:"Kannon dorado de 9m. Vista al mar. 2500 hydrangeas en junio.",tips:"Combina con Great Buddha. Vista desde terraza espectacular."},{name:"Zenko-ji Temple",city:"Nagano",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"90 min",rating:4.7,description:"Templo budista del siglo VII. Ceremonia matutina √∫nica (6:30 AM).",tips:"T√∫nel oscuro debajo del altar (¬•500). Busca la 'llave de para√≠so'."},{name:"Tsurugaoka Hachimangu",city:"Kamakura",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"45 min",rating:4.5,description:"Santuario shintoista principal de Kamakura. Escaleras con vista al mar.",tips:"Centro de Kamakura. Buena base para explorar la ciudad."},{name:"Nikko Toshogu Shrine",city:"Nikko",price:1300,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2-3 horas",rating:4.9,description:"Mausoleo elaborado del shogun Tokugawa. Oro y colores vibrantes. UNESCO.",tips:"Day trip desde Tokyo (2hrs). Ver los 3 monos sabios. Compra combo ticket."},{name:"Atsuta Shrine",city:"Nagoya",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60 min",rating:4.6,description:"Segundo santuario m√°s importante. Guarda una de las 3 insignias imperiales.",tips:"Prueba kishimen (fideos planos) en el restaurante. Bosque sagrado hermoso."},{name:"Byodo-in Temple",city:"Uji (cerca Kyoto)",price:600,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60-90 min",rating:4.8,description:"Aparece en moneda de ¬•10. Phoenix Hall sobre estanque. UNESCO.",tips:"Combina con t√© matcha en Uji. Mejor en oto√±o o primavera."},{name:"Horyu-ji Temple",city:"Nara Prefecture",price:1500,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"90 min",rating:4.7,description:"Estructuras de madera m√°s antiguas del mundo (607 AD). UNESCO.",tips:"Lejos de Nara city pero vale la pena. Tesoros budistas incre√≠bles."}]},museums:{category:"Museums & Art",icon:"üèõÔ∏è",color:"blue",items:[{name:"teamLab Borderless",city:"Tokyo - Azabudai Hills",price:4800,currency:"JPY",reservationUrl:"https://www.teamlab.art/",reserveDays:30,duration:"2-3 horas",rating:5,description:"Arte digital interactivo ALUCINANTE. Instalaciones que se mueven entre salas.",tips:"RESERVA CON ANTICIPACI√ìN. Mejor en d√≠as de semana. Lleva calcetines."},{name:"teamLab Planets",city:"Tokyo - Toyosu",price:3800,currency:"JPY",reservationUrl:"https://www.teamlab.art/",reserveDays:14,duration:"90 min",rating:4.9,description:"Caminas por agua. Flores digitales. Experiencia inmersiva.",tips:"Diferente a Borderless. Shorts o falda (te mojas). Cierra 2025."},{name:"Ghibli Museum",city:"Tokyo - Mitaka",price:1e3,currency:"JPY",reservationUrl:"https://www.ghibli-museum.jp/en/",reserveDays:90,duration:"2 horas (slot asignado)",rating:5,description:"Museo de Studio Ghibli. Totoro, Spirited Away, etc. M√ÅGICO.",tips:"Tickets se agotan en SEGUNDOS. Venta 3 meses antes. Lawson o sitio oficial."},{name:"Tokyo National Museum",city:"Tokyo - Ueno",price:1e3,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2-3 horas",rating:4.7,description:"Museo m√°s grande de Jap√≥n. Arte japon√©s, samurai armor, cer√°mica.",tips:"En Ueno Park. Combina con zoo o otros museos. Audiogu√≠a gratis."},{name:"Mori Art Museum",city:"Tokyo - Roppongi Hills",price:2e3,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"90 min",rating:4.6,description:"Arte contempor√°neo en piso 53. Incluye Tokyo City View observation deck.",tips:"Combina museo + observatorio. Abierto hasta 10 PM. Vista nocturna incre√≠ble."},{name:"Cup Noodles Museum",city:"Yokohama",price:500,currency:"JPY",reservationUrl:"https://www.cupnoodles-museum.jp/en/",reserveDays:0,duration:"90 min",rating:4.7,description:"Historia del ramen instant√°neo. ¬°Crea tu propia cup noodle!",tips:"My Cup Noodles Factory ¬•500 extra. Divertido para todas las edades."},{name:"Samurai Museum",city:"Tokyo - Shinjuku",price:1900,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60 min",rating:4.5,description:"Armaduras, espadas, shows de samurai. Puedes probarte armadura y fotos.",tips:"Tours guiados en ingl√©s incluidos. Show de espadas 4 veces al d√≠a."},{name:"Tokyo Trick Art Museum",city:"Tokyo - Odaiba",price:1e3,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60-90 min",rating:4.4,description:"Ilusiones √≥pticas 3D. Instagram paradise. Interactivo.",tips:"Lleva c√°mara. Combina con Odaiba. Divertido para grupos."},{name:"Kyoto International Manga Museum",city:"Kyoto",price:900,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"90-120 min",rating:4.6,description:"50,000 mangas para leer. Historia del manga. Wall of Manga.",tips:"Puedes leer gratis en el c√©sped. Algunos en ingl√©s."},{name:"Osaka Aquarium Kaiyukan",city:"Osaka",price:2700,currency:"JPY",reservationUrl:"https://www.kaiyukan.com/language/eng/",reserveDays:0,duration:"2 horas",rating:4.8,description:"Uno de los acuarios m√°s grandes del mundo. Tibur√≥n ballena gigante.",tips:"Tanque de 9m profundidad. Mejor en d√≠as de lluvia. Compra online con descuento."},{name:"Edo-Tokyo Museum",city:"Tokyo - Ryogoku",price:600,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2 horas",rating:4.5,description:"Historia de Tokyo desde era Edo. Recreaciones a escala real.",tips:"Cerrado por renovaci√≥n hasta 2025. Cerca del Sumo Stadium."},{name:"Hakone Open-Air Museum",city:"Hakone",price:1600,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2 horas",rating:4.7,description:"Esculturas al aire libre con vista de monta√±as. Picasso gallery.",tips:"Combina con onsen en Hakone. Kids area con estructuras escalables."}]},nightlife:{category:"Nightlife & Bars",icon:"üç∫",color:"purple",items:[{name:"Golden Gai",city:"Tokyo - Shinjuku",price:2e3,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2-3 horas",rating:4.8,description:"200+ tiny bars (4-8 personas). Cada uno √∫nico. Atmosphere √∫nico.",tips:"Cover charge ¬•500-1000. Algunos solo regulares. Mejor despu√©s 8 PM."},{name:"Nonbei Yokocho",city:"Tokyo - Shibuya",price:2500,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2 horas",rating:4.6,description:"Callej√≥n estrecho con 40 small bars. Old-school Tokyo vibes.",tips:"Menos tur√≠stico que Golden Gai. Cash only. Probar varios bars."},{name:"Kabukicho Entertainment District",city:"Tokyo - Shinjuku",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2-3 horas",rating:4.3,description:"Red light district. Neones, karaoke, host/hostess clubs. Tokyo nightlife central.",tips:"Seguro pero evita calles laterales. Robot Restaurant est√° aqu√≠."},{name:"Roppongi Hills Nightlife",city:"Tokyo - Roppongi",price:3e3,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"Toda la noche",rating:4.4,description:"Clubs internacionales. Expatriates everywhere. Dress code.",tips:"V2, Muse popular. Caro. Entrada ¬•3000-5000. Hasta 5 AM."},{name:"Hub British Pub",city:"Tokyo - Multiple",price:2e3,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2 horas",rating:4.2,description:"Cadena de pubs brit√°nicos. Internacional crowd. Sports on TV.",tips:"Happy hour 5-8 PM. Ingl√©s hablado. Comida brit√°nica."},{name:"Pontocho Jazz Club",city:"Kyoto",price:2500,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2 horas",rating:4.7,description:"Jazz en vivo en callej√≥n tradicional. Intimate atmosphere.",tips:"Cover + drink ¬•2500-3000. Reserva recomendada. M√∫sica en vivo nightly."},{name:"Osaka Dotonbori Nightlife",city:"Osaka",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2-4 horas",rating:4.7,description:"Neones, street food, karaoke bars. Energ√≠a 24/7.",tips:"Mejor de noche. Drunk salarymen everywhere. Seguro y divertido."},{name:"Bar Benfiddich",city:"Tokyo - Shinjuku",price:2e3,currency:"JPY",reservationUrl:null,reserveDays:7,duration:"90 min",rating:4.9,description:"Cocktail bar artesanal. Hierbas frescas, mortero. Top 50 bars del mundo.",tips:"Reserva recomendada. √çntimo. Bartender es un artista."},{name:"Womb Shibuya",city:"Tokyo - Shibuya",price:3e3,currency:"JPY",reservationUrl:"https://www.womb.co.jp/",reserveDays:0,duration:"Hasta 5 AM",rating:4.6,description:"Mega club techno/house. DJs internacionales. 4 pisos.",tips:"Viernes-s√°bado hasta 5 AM. Dress code semi-formal. Ladies free a veces."}]},natureOutdoors:{category:"Nature & Outdoors",icon:"üèîÔ∏è",color:"green",items:[{name:"Mount Fuji Hiking",city:"Yamanashi/Shizuoka",price:2e3,currency:"JPY",reservationUrl:null,reserveDays:30,duration:"2 d√≠as (con overnight)",rating:5,description:"Escalar Monte Fuji (3776m). Ver sunrise desde la cima. Bucket list.",tips:"Solo julio-septiembre. Reserva hut en advance. Bring warm clothes."},{name:"Hakone Ropeway",city:"Hakone",price:1550,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"30 min ride",rating:4.7,description:"Telef√©rico sobre valle volc√°nico Owakudani. Vista de Mt. Fuji y azufre.",tips:"Parte del Hakone Free Pass. Compra huevos negros (hervidos en azufre)."},{name:"Jigokudani Monkey Park",city:"Nagano",price:800,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60-90 min",rating:4.9,description:"¬°Monos de nieve en onsen! √önico en el mundo. ADORABLES.",tips:"Mejor en invierno con nieve. Caminata de 30 min desde parking. Bring snacks."},{name:"Shirakawa-go Village",city:"Gifu Prefecture",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"3-4 horas",rating:4.9,description:"Pueblo hist√≥rico con casas gassho-zukuri (techo de paja). UNESCO. Como cuento de hadas.",tips:"Mejor en invierno con nieve. Stay overnight en farmhouse. Illumination en febrero."},{name:"Takachiho Gorge",city:"Miyazaki Prefecture",price:4100,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"90 min",rating:4.8,description:"Ca√±√≥n con acantilados volc√°nicos. Remar en bote bajo cascada. Surreal.",tips:"Alquiler de bote ¬•4100 (30 min). Ir temprano para evitar fila."},{name:"Kumano Kodo Pilgrimage",city:"Wakayama/Mie",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"1-7 d√≠as",rating:4.9,description:"Antigua ruta de peregrinaje por monta√±as. Bosques sagrados, santuarios. UNESCO.",tips:"Nakahechi route popular (2-3 d√≠as). Stay en minshuku. Sello en cada templo."},{name:"Aogashima Island",city:"Tokyo Islands",price:0,currency:"JPY",reservationUrl:null,reserveDays:7,duration:"2-3 d√≠as",rating:4.7,description:"Isla volc√°nica remota. Poblaci√≥n 170. Estrellas incre√≠bles. Off the beaten path.",tips:"Solo ferry o helic√≥ptero. Reservar acomodo antes. Adventure travel."},{name:"Kawachi Fuji Gardens",city:"Fukuoka",price:1e3,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"90 min",rating:4.9,description:"T√∫neles de wisteria moradas. Como Avatar. Solo finales abril-mayo.",tips:"SOLO en wisteria season. Advance ticket online. Fotograf√≠a espectacular."},{name:"Hitachi Seaside Park",city:"Ibaraki",price:450,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2-3 horas",rating:4.8,description:"Flores todo el a√±o. Nemophila azules (mayo), kokia rojos (octubre).",tips:"Diferentes flores cada temporada. Alquila bici. Instagram famous."},{name:"Matsumoto Castle",city:"Nagano - Matsumoto",price:700,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"90 min",rating:4.7,description:"Castillo negro original (1590s). Uno de los 12 castillos originales. Con foso.",tips:"Subir es steep. Vista desde arriba hermosa. Cherry blossoms en primavera."}]},shopping:{category:"Shopping Districts",icon:"üõçÔ∏è",color:"pink",items:[{name:"Don Quijote (Donki)",city:"Tokyo/Osaka - Multiple",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"90 min",rating:4.7,description:"Mega tienda discount. TODO: snacks, electr√≥nicos, cosm√©ticos, disfraces. Chaotic.",tips:"Abierto 24/7 muchas ubicaciones. Tax-free. M√∫sica loud. Experiencia √∫nica."},{name:"Shibuya 109",city:"Tokyo - Shibuya",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2 horas",rating:4.5,description:"Centro comercial de moda femenina. Gyaru fashion. Tendencias japonesas.",tips:"8 pisos. Marcas japonesas √∫nicas. Purikura booths en piso superior."},{name:"Tokyu Hands",city:"Tokyo - Multiple",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"90-120 min",rating:4.6,description:"Todo para hobbies y crafts. Stationery, gadgets, DIY. Tesoro para nerds.",tips:"Shibuya tiene 7 pisos. Tax-free. Mejores souvenirs √∫nicos."},{name:"Uniqlo Flagship Ginza",city:"Tokyo - Ginza",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60 min",rating:4.4,description:"Tienda flagship de 12 pisos. Todas las l√≠neas. Precios mejores que en occidente.",tips:"Heat tech y ultra light down populares. Tax-free. Collaborations exclusivas."},{name:"Daiso (¬•100 Shop)",city:"Tokyo/Osaka - Multiple",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60 min",rating:4.3,description:"TODO a ¬•100 (+ tax). Gadgets, stationery, snacks, skincare. Tesoro.",tips:"Harajuku store tiene 4 pisos. Souvenirs baratos. Calidad sorprendentemente buena."},{name:"Pok√©mon Center Mega Tokyo",city:"Tokyo - Ikebukuro",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60 min",rating:4.8,description:"Tienda oficial Pok√©mon m√°s grande. Merchandise exclusivo de Jap√≥n.",tips:"Fila en fines de semana. Productos limitados se agotan r√°pido."},{name:"Nintendo Tokyo",city:"Tokyo - Shibuya Parco",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"45 min",rating:4.7,description:"Primera tienda oficial Nintendo. Merchandise √∫nico. Play areas.",tips:"En piso 6 de Shibuya Parco. Productos limitados exclusive a Jap√≥n."},{name:"Nakamise Shopping Street",city:"Tokyo - Asakusa",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"30-45 min",rating:4.6,description:"250m de tiendas tradicionales. Souvenirs, kimonos, snacks. Camino a Senso-ji.",tips:"Regateo NO com√∫n. Prueba ningyo-yaki. Souvenirs tur√≠sticos pero bonitos."},{name:"Namba Parks",city:"Osaka",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2 horas",rating:4.5,description:"Centro comercial con rooftop garden de 8 pisos. Arquitectura √∫nica.",tips:"Jard√≠n escalonado hermoso. Buenas vistas. Combina compras y naturaleza."},{name:"Ginza Six",city:"Tokyo - Ginza",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2 horas",rating:4.6,description:"Centro comercial de lujo. Marcas premium. Rooftop garden gratis.",tips:"Tax-free. Art installations rotan. Tsutaya bookstore en piso 6."}]},moreRestaurants:{category:"More Restaurants",icon:"üç±",color:"orange",items:[{name:"Butagumi Tonkatsu",city:"Tokyo - Nishi-Azabu",price:2e3,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60 min",rating:4.8,description:"MEJOR tonkatsu de Tokyo. Cerdo grueso premium, s√∫per jugoso.",tips:"Usa aceite vegetal. Menos grasoso que otros. Fila larga pero r√°pida."},{name:"Maisen Tonkatsu",city:"Tokyo - Aoyama",price:1800,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60 min",rating:4.7,description:"Tonkatsu famoso en casa hist√≥rica. Crispy perfecto. Salsa especial.",tips:"Ba√±os p√∫blicos hist√≥ricos convertidos en restaurant. Rebanadas gruesas."},{name:"Tonki Tonkatsu",city:"Tokyo - Meguro",price:1600,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"45 min",rating:4.6,description:"Tonkatsu old-school desde 1939. Counter seating. Aceite de lardo.",tips:"Cash only. Tradicional atmosphere. Llega temprano."},{name:"Tsukiji Outer Market",city:"Tokyo",price:2e3,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2 horas",rating:4.8,description:"Aunque Tsukiji se movi√≥, outer market sigue. Desayuno de sushi fresco.",tips:"Ir temprano (6-8 AM). Street food everywhere. Prueba uni, toro, tamago."},{name:"Okonomiyaki Mizuno",city:"Osaka - Dotonbori",price:1300,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60 min",rating:4.7,description:"Okonomiyaki legendario. Desde 1945. Mix perfecto. Fila siempre.",tips:"Yam okonomiyaki es especial. Fila de 30-60 min. Cash only."},{name:"Kushikatsu Daruma",city:"Osaka - Shinsekai",price:2e3,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60 min",rating:4.6,description:"Kushikatsu (brochetas fritas). Regla: NO double dipping en salsa.",tips:"Cada brocheta ¬•100-200. Orden m√≠nimo. Ambiente local."},{name:"Gyukatsu Motomura",city:"Tokyo - Multiple",price:1500,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"30-45 min",rating:4.7,description:"Katsu de CARNE (no cerdo). Rare por dentro, crujiente afuera. T√∫ lo cocinas extra.",tips:"Shibuya y Shinjuku. Fila corta. Parrilla en mesa para cocinar m√°s."},{name:"Coco Ichibanya Curry",city:"Tokyo/Osaka - Multiple",price:800,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"30 min",rating:4.4,description:"Curry japon√©s customizable. Elige nivel de picante y toppings.",tips:"Cadena pero delicioso. Level 10 spicy = very spicy. Porciones grandes."},{name:"Kichi Kichi Omurice",city:"Kyoto",price:2500,currency:"JPY",reservationUrl:null,reserveDays:30,duration:"30 min",rating:4.9,description:"¬°Omurice viral de YouTube! Chef Motokichi. Show cooking.",tips:"RESERVA 1 MES ANTES. Solo 1 chef, 1 mesa. Experiencia √∫nica."}]},specialGardens:{category:"Special Gardens & Parks",icon:"üå∏",color:"green",items:[{name:"Shinjuku Gyoen National Garden",city:"Tokyo - Shinjuku",price:500,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2-3 horas",rating:4.9,description:"58 hect√°reas. Jard√≠n franc√©s, ingl√©s y japon√©s. 1000+ cerezos. Oasis urbano.",tips:"IMPERDIBLE en sakura season. No alcohol permitido. Cierra lunes."},{name:"Gotokuji Temple (Cat Temple)",city:"Tokyo - Setagaya",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"45-60 min",rating:4.8,description:"¬°Templo con 1000+ maneki-neko (gatos de la suerte)! Origen del lucky cat.",tips:"GRATIS. Compra tu propio maneki-neko. Instagram heaven. Tranquilo."},{name:"KITTE Rooftop Garden",city:"Tokyo - Marunouchi",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"30 min",rating:4.5,description:"Jard√≠n en rooftop de KITTE. Vista perfecta de Tokyo Station. Gratis.",tips:"Acceso desde 6to piso. Mejor al atardecer. Centro comercial abajo."}]},hakoneExperiences:{category:"Hakone Experiences",icon:"üóª",color:"blue",items:[{name:"Hakone Pirate Ship",city:"Hakone - Lake Ashi",price:1200,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"30 min",rating:4.7,description:"Barco pirata por Lake Ashi. Vista de Mt. Fuji. Parte del Hakone Free Pass.",tips:"Mejor en d√≠a claro para ver Fuji-san. 3 barcos diferentes (todos piratas)."},{name:"Owakudani Black Eggs",city:"Hakone",price:500,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60 min",rating:4.6,description:"Valle volc√°nico activo. Huevos hervidos en azufre (negros). Se dice que a√±aden 7 a√±os de vida.",tips:"Compra 5 huevos por ¬•500. Huelen a azufre. Vista incre√≠ble desde ropeway."},{name:"Hakone Shrine Torii on Water",city:"Hakone",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"45 min",rating:4.8,description:"Torii rojo en Lake Ashi. Backdrop de monta√±as. Muy fotog√©nico.",tips:"Gratis. Camina desde el muelle del pirate ship. Temprano para fotos sin gente."}]},veganVegetarian:{category:"Vegan & Vegetarian",icon:"ü•ó",color:"green",items:[{name:"Ain Soph Journey",city:"Tokyo - Shinjuku",price:1800,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60 min",rating:4.7,description:"Vegan burgers gigantes. Pancakes masivos. Instagram-worthy.",tips:"Cadena con varias locaciones. Ripley en Shinjuku muy popular."},{name:"Saido (Shojin Ryori)",city:"Tokyo - Minato",price:3500,currency:"JPY",reservationUrl:null,reserveDays:3,duration:"90 min",rating:4.8,description:"Comida budista vegana tradicional. Multi-course kaiseki vegetariano.",tips:"Reserva recomendada. Experiencia de lujo. Set courses hermosos."},{name:"Nagi Shokudo",city:"Tokyo - Shibuya",price:1200,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"45 min",rating:4.6,description:"Vegan ramen y comfort food. Barato y delicioso.",tips:"100% vegano. Soy meat options. Peque√±o pero acogedor."},{name:"T's TanTan (Tokyo Station)",city:"Tokyo Station",price:900,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"30 min",rating:4.5,description:"¬°Vegan ramen DENTRO de Tokyo Station! Tantanmen vegano delicioso.",tips:"Perfecto si tienes shinkansen. Peque√±o. Dentro de la estaci√≥n."},{name:"Paprika Shokudo Vegan",city:"Kyoto",price:1400,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60 min",rating:4.7,description:"Buffet vegetariano/vegano. All-you-can-eat por tiempo limitado.",tips:"Opciones org√°nicas. Popular con locales. Llega temprano."}]},craneGamesArcades:{category:"Crane Games & UFO Catchers",icon:"üé™",color:"pink",items:[{name:"GiGO Akihabara",city:"Tokyo - Akihabara",price:500,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60-90 min",rating:4.7,description:"7 pisos de crane games y arcades. Prizes de anime, figuras, plushies.",tips:"Piso 1-2 = crane games. Staff ayuda si est√°s cerca. ¬•100-200 por intento."},{name:"Taito Station Shibuya",city:"Tokyo - Shibuya",price:500,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60 min",rating:4.6,description:"Crane games con prizes exclusivos. Purikura booths en piso superior.",tips:"Mejores chances en m√°quinas nuevas. Staff puede posicionar prizes."},{name:"Round1 Ikebukuro",city:"Tokyo - Ikebukuro",price:1e3,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"2-3 horas",rating:4.7,description:"Mega centro de entretenimiento. Bowling, karaoke, crane games, batting cages.",tips:"Discount passes disponibles. Pisos enteros de UFO catchers."},{name:"namco Sunshine City",city:"Tokyo - Ikebukuro",price:500,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"90 min",rating:4.5,description:"Arcade con themed games. Pok√©mon, One Piece, Demon Slayer prizes.",tips:"Dentro de Sunshine City mall. Combina con shopping."}]},specialStores:{category:"Specialty Stores",icon:"üè¨",color:"indigo",items:[{name:"Nintendo Store Kyoto",city:"Kyoto",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60 min",rating:4.8,description:"Segunda tienda oficial Nintendo. Merchandise exclusivo de Kyoto.",tips:"En downtown Kyoto. Productos regionales √∫nicos. Menos crowded que Tokyo."},{name:"Pok√©mon Center Shibuya",city:"Tokyo - Shibuya",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"45 min",rating:4.7,description:"Pok√©mon Center con dise√±o √∫nico de Shibuya. Productos exclusivos.",tips:"Menos grande que Ikebukuro pero productos exclusivos de la regi√≥n."},{name:"Pok√©mon Center DX Tokyo",city:"Tokyo - Nihonbashi",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60 min",rating:4.9,description:"Flagship Pok√©mon Center. El M√ÅS grande. Pok√©mon Cafe en mismo edificio.",tips:"Reserva para el caf√© con anticipaci√≥n. Merchandise m√°s amplio."},{name:"Jump Shop Shibuya",city:"Tokyo - Shibuya",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"45 min",rating:4.6,description:"Tienda oficial Shonen Jump. One Piece, Naruto, Dragon Ball, MHA merchandise.",tips:"Dentro de Shibuya. Productos limitados rotan. Colaboraciones especiales."},{name:"Jump Shop Tokyo Station",city:"Tokyo Station",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"30 min",rating:4.5,description:"Jump Shop dentro de Character Street en Tokyo Station.",tips:"Combina con otros character shops (Ghibli, Pok√©mon, etc) en mismo pasillo."}]},uniqueVenues:{category:"Unique Venues & Experiences",icon:"‚ú®",color:"purple",items:[{name:"Art Aquarium Museum",city:"Tokyo - Nihonbashi",price:2400,currency:"JPY",reservationUrl:"https://artaquarium.jp/",reserveDays:0,duration:"90 min",rating:4.8,description:"Goldfish en acuarios art√≠sticos con luces y proyecciones. Arte + acuario.",tips:"Mejor de noche. Instalaci√≥n permanente. Bar dentro. Muy instagrameable."},{name:"Tokyo Character Street",city:"Tokyo Station",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"60-90 min",rating:4.7,description:"Pasillo subterr√°neo con 30+ character shops. Ghibli, Pok√©mon, Snoopy, Rilakkuma, etc.",tips:"Dentro de Tokyo Station. Perfecto antes/despu√©s de shinkansen. Tax-free."},{name:"Mega Web Toyota City Showcase",city:"Tokyo - Odaiba",price:0,currency:"JPY",reservationUrl:null,reserveDays:0,duration:"90 min",rating:4.5,description:"Showroom de Toyota. Historia de carros, exhibits interactivos. Gratis.",tips:"Test drives disponibles (con licencia). Exhibits de carros cl√°sicos."}]}},C={suggestions:[],currentIndex:-1,init(){const e=document.getElementById("activityTitle");e&&(this.buildSuggestionsDatabase(),e.addEventListener("input",e=>this.handleInput(e)),e.addEventListener("keydown",e=>this.handleKeydown(e)),document.addEventListener("click",e=>{e.target.closest("#activityTitle")||e.target.closest("#activityTitleAutocomplete")||this.hideDropdown()}),console.log("‚úÖ Activity Autocomplete initialized with",this.suggestions.length,"suggestions"))},buildSuggestionsDatabase(){this.suggestions=[],Object.values(E).forEach(e=>{e.items.forEach(t=>{this.suggestions.push({name:t.name,city:t.city,category:e.category,icon:t.icon||"üéØ",description:t.description,price:t.price,rating:t.rating})})});this.suggestions.push({name:"Narita Express ‚Üí Shinjuku",city:"Tokyo",category:"Transporte",icon:"üöÑ",description:"Tren del aeropuerto a Shinjuku",price:3200,rating:null},{name:"Shinkansen Tokyo ‚Üí Kyoto",city:"Tokyo ‚Üí Kyoto",category:"Transporte",icon:"üöÖ",description:"Bullet train cubierto por JR Pass",price:13320,rating:null},{name:"JR Yamanote Line",city:"Tokyo",category:"Transporte",icon:"üöá",description:"L√≠nea circular de Tokyo",price:0,rating:null},{name:"Limousine Bus al Hotel",city:"Tokyo",category:"Transporte",icon:"üöå",description:"Bus del aeropuerto",price:3200,rating:null});this.suggestions.push({name:"Desayuno en hotel",city:"Hotel",category:"Comida",icon:"üç≥",description:"Incluido en reserva",price:0,rating:null},{name:"Almuerzo",city:"",category:"Comida",icon:"üçΩÔ∏è",description:"Por definir",price:1500,rating:null},{name:"Cena",city:"",category:"Comida",icon:"üçú",description:"Por definir",price:2e3,rating:null},{name:"Ramen",city:"",category:"Comida",icon:"üçú",description:"Ramen aut√©ntico japon√©s",price:1200,rating:null},{name:"Sushi",city:"",category:"Comida",icon:"üç£",description:"Sushi fresco",price:3e3,rating:null},{name:"Izakaya",city:"",category:"Comida",icon:"üçª",description:"Bar japon√©s tradicional",price:3500,rating:null});this.suggestions.push({name:"Check-in Hotel",city:"Hotel",category:"Log√≠stica",icon:"üè®",description:"Registro en el hotel",price:0,rating:null},{name:"Check-out Hotel",city:"Hotel",category:"Log√≠stica",icon:"üß≥",description:"Salida del hotel",price:0,rating:null},{name:"Tiempo libre",city:"",category:"Tiempo Libre",icon:"üö∂",description:"Exploraci√≥n libre",price:0,rating:null},{name:"Descanso en hotel",city:"Hotel",category:"Descanso",icon:"üò¥",description:"Tiempo de recuperaci√≥n",price:0,rating:null},{name:"Compras",city:"",category:"Shopping",icon:"üõçÔ∏è",description:"Shopping",price:5e3,rating:null})},handleInput(e){const t=e.target.value.trim().toLowerCase();if(t.length<2)return void this.hideDropdown();const a=this.suggestions.filter(e=>e.name.toLowerCase().includes(t)||e.city.toLowerCase().includes(t)||e.category.toLowerCase().includes(t)).slice(0,8);a.length>0?this.showDropdown(a):this.hideDropdown()},handleKeydown(e){const t=document.getElementById("activityTitleAutocomplete");if(!t||t.classList.contains("hidden"))return;const a=t.querySelectorAll(".autocomplete-item");switch(e.key){case"ArrowDown":e.preventDefault(),this.currentIndex=(this.currentIndex+1)%a.length,this.highlightItem(a);break;case"ArrowUp":e.preventDefault(),this.currentIndex=this.currentIndex<=0?a.length-1:this.currentIndex-1,this.highlightItem(a);break;case"Enter":e.preventDefault(),this.currentIndex>=0&&a[this.currentIndex]&&a[this.currentIndex].click();break;case"Escape":this.hideDropdown()}},highlightItem(e){e.forEach((e,t)=>{t===this.currentIndex?e.classList.add("bg-purple-100","dark:bg-purple-900/50"):e.classList.remove("bg-purple-100","dark:bg-purple-900/50")})},showDropdown(e){const t=document.getElementById("activityTitleAutocomplete");t&&(t.innerHTML=e.map((e,t)=>`\n            <div\n                class="autocomplete-item p-3 hover:bg-purple-50 dark:hover:bg-purple-900/30 cursor-pointer border-b border-gray-200 dark:border-gray-700 last:border-b-0"\n                data-index="${t}"\n                onclick="ActivityAutocomplete.selectSuggestion(${t}, ${JSON.stringify(e).replace(/"/g,"&quot;")})"\n            >\n                <div class="flex items-start gap-3">\n                    <span class="text-2xl">${e.icon}</span>\n                    <div class="flex-1">\n                        <div class="font-semibold dark:text-white">${e.name}</div>\n                        <div class="text-xs text-gray-600 dark:text-gray-400 mt-1">\n                            ${e.city?`üìç ${e.city}`:""}\n                            ${e.category?`‚Ä¢ ${e.category}`:""}\n                            ${e.price?`‚Ä¢ ¬•${e.price.toLocaleString()}`:""}\n                            ${e.rating?`‚Ä¢ ‚≠ê ${e.rating}/5`:""}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `).join(""),t.classList.remove("hidden"),this.currentIndex=-1)},hideDropdown(){const e=document.getElementById("activityTitleAutocomplete");e&&(e.classList.add("hidden"),this.currentIndex=-1)},selectSuggestion(e,t){const a=document.getElementById("activityTitle"),n=document.getElementById("activityDesc"),r=document.getElementById("activityCost"),i=document.getElementById("activityStation"),o=document.getElementById("activityIcon");a&&(a.value=t.name),n&&t.description&&(n.value=t.description),r&&t.price&&(r.value=t.price),i&&t.city&&(i.value=t.city),o&&t.icon&&(o.value=t.icon),this.hideDropdown();const s=document.getElementById("activityTime");s&&s.focus()}};window.ActivityAutocomplete=C;let A={},D=1,M=null,$=null,P=null,j=!1;function B(){return window.TripsManager&&window.TripsManager.currentTrip?window.TripsManager.currentTrip.id:localStorage.getItem("currentTripId")}async function N(){!function(t="Firestore operation"){if(!a){const e=new Error(`‚ùå ${t} failed: Firestore (db) is not initialized`);throw console.error(e.message),e}if(!e||!e.currentUser){const e=new Error(`‚ùå ${t} failed: User is not authenticated`);throw console.error(e.message),e}}("Save itinerary");const t=B();if(!t||!$)throw new Error("‚ùå No trip or itinerary to save");try{const e=r(a,`trips/${t}/data`,"itinerary");return await i(e,$),console.log("‚úÖ Itinerary saved to Firebase"),!0}catch(n){if("permission-denied"===n.code)throw new Error("‚ùå Permission denied: You do not have access to save this itinerary");if("unavailable"===n.code)throw new Error("‚ùå Firestore unavailable: Check your internet connection");throw n}}async function O(){var n,i,s;const l=B(),d=async()=>{try{const e=await fetch("/data/attractions.json"),t=await e.json();return $={days:t.suggestedItinerary},$}catch(e){return console.error("‚ùå Error loading fallback template:",e),null}};if(!l)return console.log("‚ö†Ô∏è No trip selected, loading default template"),await d();if(!a||!e||!e.currentUser)return console.log("‚ö†Ô∏è User not authenticated or Firestore not initialized, loading default template"),await d();try{const e=r(a,`trips/${l}/data`,"itinerary"),t=await o(e);return t.exists()?($=t.data(),console.log("‚úÖ Itinerary loaded from Firebase"),$):(console.log("‚ö†Ô∏è No itinerary exists in Firebase, loading fallback"),await d())}catch(c){return"unavailable"===c.code||(null==(n=c.message)?void 0:n.includes("client is offline"))?(console.log("‚ö†Ô∏è Firestore offline, loading fallback template"),await d()):(console.error("‚ùå Error loading itinerary from Firebase:",c),"permission-denied"===c.code&&(console.error("‚ùå Permission denied: You do not have access to this itinerary"),null==(s=null==(i=t)?void 0:i.show)||s.call(i,"No tienes permiso para acceder a este itinerario","error")),await d())}}async function U(){if(M&&(M(),console.log("[Itinerary] üõë Antiguo listener de itinerario detenido."),M=null),!a||!e||!e.currentUser)return console.log("‚ö†Ô∏è Not authenticated, using local storage only"),A=JSON.parse(localStorage.getItem("checkedActivities")||"{}"),void F();const n=B();if(!n)return console.log("‚ö†Ô∏è No trip selected"),void R();console.log("ü§ù Collaborative mode activated for trip:",n);try{const e=r(a,`trips/${n}/data`,"itinerary");M=function(e,t,a,n=3){let r=0,i=null,o=null;const s=()=>{console.log(`üîÑ Attempting onSnapshot subscription (attempt ${r+1}/${n+1})`),o=l(e,e=>{r=0,i&&(clearTimeout(i),i=null),t(e)},e=>{if(console.error(`‚ùå onSnapshot error (attempt ${r+1}):`,e),"permission-denied"===e.code)return console.error("‚ùå Permission denied - not retrying"),void a(e);if("unavailable"===e.code||"deadline-exceeded"===e.code||"internal"===e.code||"unknown"===e.code)if(r<n){const e=1e3*Math.pow(2,r);r++,console.warn(`‚è≥ Retrying onSnapshot in ${e}ms (attempt ${r}/${n})`),i=setTimeout(()=>{s()},e)}else console.error("‚ùå Max retries reached for onSnapshot"),a(e);else console.error("‚ùå Unknown error - not retrying"),a(e)})};return s(),()=>{o&&(o(),o=null),i&&(clearTimeout(i),i=null)}}(e,e=>{e.exists()?($=e.data(),A=$.checklist||{},console.log("‚úÖ Itinerario y checklist sincronizados en tiempo real.")):($=null,A={},console.log("‚ö†Ô∏è No hay itinerario en Firebase para este viaje.")),localStorage.setItem("checkedActivities",JSON.stringify(A)),F()},e=>{var a,n;console.error("‚ùå Error in realtime sync (all retries failed):",e),"permission-denied"===e.code&&(null==(n=null==(a=t)?void 0:a.show)||n.call(a,"No tienes permiso para acceder a este itinerario","error")),A=JSON.parse(localStorage.getItem("checkedActivities")||"{}"),F()})}catch(i){console.error("‚ùå Error setting up realtime sync:",i),A=JSON.parse(localStorage.getItem("checkedActivities")||"{}"),F()}}function H(){const e=document.getElementById("content-itinerary");e&&(e.innerHTML='\n  <div class="max-w-4xl mx-auto p-8 text-center">\n    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-12">\n      <div class="text-6xl mb-6">‚úàÔ∏è</div>\n      <h2 class="text-3xl font-bold text-gray-800 dark:text-white mb-4">¬°Crea tu Itinerario!</h2>\n      <p class="text-gray-600 dark:text-gray-400 mb-8 text-lg">Planifica tu viaje perfecto. Elige entre plantillas o crea uno desde cero.</p>\n      <button onclick="ItineraryBuilder.showCreateItineraryWizard()" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-8 py-4 rounded-lg hover:from-purple-600 hover:to-pink-600 transition font-bold text-lg shadow-lg">‚ú® Crear Itinerario</button>\n    </div>\n  </div>')}function R(){const e=document.getElementById("content-itinerary");e&&(e.innerHTML='\n    <div class="max-w-4xl mx-auto p-8 text-center">\n      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-12">\n        <div class="text-6xl mb-4">üó∫Ô∏è</div>\n        <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">No hay viaje seleccionado</h2>\n        <p class="text-gray-600 dark:text-gray-400 mb-6">Para crear un itinerario, primero debes crear o seleccionar un viaje.</p>\n        <div class="flex gap-3 justify-center flex-wrap">\n          <button onclick="TripsManager.showCreateTripModal()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition font-semibold">‚ûï Crear Viaje</button>\n          <button onclick="TripsManager.showTripsListModal()" class="bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition font-semibold">üìÇ Ver Mis Viajes</button>\n        </div>\n      </div>\n    </div>')}async function F(){const t=$;if(!t||!t.days)return void H();const a=t.days.find(e=>e.day===D);if(!a)return;!function(){var e,t;const a=document.getElementById("tripSelectorHeader");if(!a)return;const n=null==(e=window.TripsManager)?void 0:e.currentTrip;if(!n)return void(a.innerHTML="");const r=(null==(t=window.TripsManager)?void 0:t.userTrips)||[];a.innerHTML=`\n    <div class="bg-gradient-to-r from-blue-500 to-purple-500 text-white p-4 rounded-lg mb-4">\n      <div class="flex items-center justify-between flex-wrap gap-3">\n        <div class="flex items-center gap-3 flex-1">\n          <div class="text-2xl">üó∫Ô∏è</div>\n          <div>\n            <h3 class="font-bold text-lg">${n.info.name}</h3>\n            <p class="text-xs text-white/80">${new Date(n.info.dateStart).toLocaleDateString("es")} - ${new Date(n.info.dateEnd).toLocaleDateString("es")}</p>\n          </div>\n        </div>\n        <div class="flex gap-2">\n          ${r.length>1?'<button onclick="TripsManager.showTripsListModal()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition text-sm font-semibold backdrop-blur-sm">üîÑ Cambiar Viaje</button>':""}\n          <button onclick="TripsManager.showShareCode()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition text-sm font-semibold backdrop-blur-sm">üîó Compartir</button>\n          ${$?"":'<button onclick="ItineraryBuilder.showCreateItineraryWizard()" class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded-lg transition text-sm font-bold shadow-md">‚ú® Crear Itinerario</button>'}\n        </div>\n      </div>\n    </div>`}(),function(){const e=document.getElementById("daySelector");if(!e)return;const t=$;if(!t||!t.days)return void(e.innerHTML="");const a=t.days||[];e.innerHTML=a.map(e=>`\n    <button data-day="${e.day}" class="day-btn px-4 py-2 rounded-lg whitespace-nowrap font-medium transition-all ${D===e.day?"bg-red-600 text-white shadow-md":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}">D√≠a ${e.day}</button>\n  `).join("")}(),function(t){const a=document.getElementById("dayOverview");if(!a)return;const n=t.activities.filter(e=>A[e.id]).length,r=t.activities.length>0?n/t.activities.length*100:0,i=B();let o;o=e.currentUser?i?'<span class="text-xs text-green-600 dark:text-green-400">ü§ù Modo Colaborativo</span>':'<span class="text-xs text-blue-600 dark:text-blue-400">‚òÅÔ∏è Sincronizado</span>':'<span class="text-xs text-yellow-600 dark:text-yellow-400">üì± Solo local</span>';console.log("üìä Day data for day",t.day,":",{city:t.city,location:t.location,title:t.title,date:t.date});let s="";const l=t.city||t.location||t.title||"";if(console.log("üîç City source:",l),l){const e=l.toLowerCase().trim();console.log("üîç City raw:",e);const t=e.includes("tokyo")?"tokyo":e.includes("kyoto")?"kyoto":e.includes("osaka")?"osaka":e.includes("nara")?"nara":e.includes("hiroshima")?"hiroshima":e.includes("nikko")?"nikko":e;if(console.log("üèôÔ∏è Detected city:",t),window.ImageService&&window.ImageService.getCityImage)s=window.ImageService.getCityImage(t),console.log("üñºÔ∏è Image from ImageService:",s);else{const e={tokyo:"https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?auto=format&fit=crop&w=800&q=80",kyoto:"https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?auto=format&fit=crop&w=800&q=80",osaka:"https://unsplash.com/photos/OwbvX2iahvw/download?force=true&w=800",nara:"https://unsplash.com/photos/OugwfKxatME/download?force=true&w=800",hiroshima:"https://images.unsplash.com/photo-1617878223826-5a93d60fe046?auto=format&fit=crop&w=800&q=80",nikko:"https://images.unsplash.com/photo-1528164344705-47542687000d?auto=format&fit=crop&w=800&q=80"};s=e[t]||e.tokyo,console.log("üñºÔ∏è Image from fallback:",s)}}console.log("‚úÖ Final cityImage:",s),a.innerHTML=`\n    ${s?`\n      <div class="relative h-48 w-full overflow-hidden rounded-t-xl -mx-6 -mt-6 mb-4">\n        <img src="${s}" alt="${t.city||t.location||"Japan"}" class="w-full h-full object-cover" loading="lazy">\n        <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>\n        <div class="absolute bottom-0 left-0 right-0 p-4">\n          <div class="flex items-center gap-2 text-white">\n            <span class="text-3xl">üìÖ</span>\n            <div>\n              <h2 class="text-2xl font-bold text-white drop-shadow-lg">D√≠a ${t.day}</h2>\n              <p class="text-sm text-white/90">${t.city||t.location||""}</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    `:`\n      <div class="flex items-center gap-2 mb-4">\n        <span class="text-2xl">üìÖ</span>\n        <h2 class="text-2xl font-bold dark:text-white">D√≠a ${t.day}</h2>\n      </div>\n    `}\n    <div class="mb-4">\n      <div class="flex justify-between text-sm mb-1 dark:text-gray-300"><span>Progreso</span><span>${n}/${t.activities.length}</span></div>\n      <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2"><div class="bg-red-600 h-2 rounded-full transition-all duration-500" style="width:${r}%"></div></div>\n      <div class="mt-2 text-right">${o}</div>\n    </div>\n    <div class="space-y-3 text-sm">\n      <p class="font-semibold text-base dark:text-gray-300">${t.date}</p>\n      <p class="font-bold text-lg text-red-600 dark:text-red-400">${t.title||""}</p>\n      ${t.hotel?`\n        <div class="bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg border-l-2 border-blue-500">\n          <p class="text-xs font-semibold text-blue-700 dark:text-blue-300 mb-1">üè® Hotel Recomendado</p>\n          <p class="text-sm text-gray-700 dark:text-gray-300">${t.hotel}</p>\n        </div>\n      `:""}\n      ${t.location?`<p class="text-xs text-gray-500 dark:text-gray-400">üìç ${t.location}</p>`:""}\n    </div>\n    <div class="mt-6">\n      <button type="button" id="addActivityBtn_${t.day}" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition">+ A√±adir Actividad</button>\n    </div>`}(a),function(t){var a;const n=document.getElementById("activitiesTimeline");if(!n)return;const r=null==(a=e.currentUser)?void 0:a.uid;if(P){try{P.destroy()}catch(i){}P=null}n.innerHTML=(t.activities||[]).map((e,a)=>{const n=e.votes||{},i=Object.keys(n).length,o=r&&n[r];return`\n    <div class="activity-card bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden fade-in transition-all hover:shadow-xl border-l-4 border-red-500 ${A[e.id]?"opacity-60":""}" style="animation-delay:${.05*a}s">\n      <div class="p-5 flex items-start gap-4">\n        <div class="flex flex-col gap-2 items-center">\n          <div class="drag-handle text-gray-400 dark:text-gray-600 text-xs cursor-grab active:cursor-grabbing" title="Arrastra para reordenar">‚ãÆ‚ãÆ</div>\n          <input type="checkbox" data-id="${e.id}" ${A[e.id]?"checked":""} class="activity-checkbox w-5 h-5 cursor-pointer accent-red-600 flex-shrink-0" />\n        </div>\n        <div class="bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 p-3 rounded-lg text-2xl flex-shrink-0">${e.icon||"üìç"}</div>\n        <div class="flex-1 min-w-0">\n          <div class="flex justify-between items-start">\n            <div>\n              <div class="flex items-center gap-2 mb-1 flex-wrap">\n                <span class="text-xs font-semibold text-gray-500 dark:text-gray-400">${e.time||""}</span>\n                ${e.cost>0?`<span class="text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 px-2 py-1 rounded">¬•${Number(e.cost).toLocaleString()}</span>`:""}\n              </div>\n              <h3 class="text-lg font-bold dark:text-white mb-1">${e.title}</h3>\n            </div>\n            <div class="flex gap-2 flex-shrink-0">\n              <button \n                type="button" \n                data-action="vote" \n                data-activity-id="${e.id}" \n                data-day="${t.day}" \n                class="activity-vote-btn p-2 rounded-full hover:bg-red-100 dark:hover:bg-red-900/30 transition flex items-center gap-1 ${o?"text-red-500":"text-gray-400"}"\n                title="Votar por esta actividad"\n              >\n                <i class="fas fa-heart"></i>\n                <span class="text-xs font-bold">${i>0?i:""}</span>\n              </button>\n              <button type="button" data-action="edit" data-activity-id="${e.id}" data-day="${t.day}" class="activity-edit-btn p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition">‚úèÔ∏è</button>\n              <button type="button" data-action="delete" data-activity-id="${e.id}" data-day="${t.day}" class="activity-delete-btn p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition">üóëÔ∏è</button>\n            </div>\n          </div>\n          <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">${e.desc||""}</p>\n          ${e.station?`<p class="text-xs text-gray-500 dark:text-gray-500 mt-2">üöâ ${e.station}</p>`:""}\n          ${e.train?`\n            <div class="mt-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border-l-2 border-blue-500">\n              <p class="text-xs font-semibold text-blue-700 dark:text-blue-300 mb-1">üöÑ ${e.train.line}</p>\n              <p class="text-xs text-gray-600 dark:text-gray-400">${e.train.from} ‚Üí ${e.train.to}</p>\n              <p class="text-xs text-gray-500 dark:text-gray-500">‚è±Ô∏è ${e.train.duration}</p>\n            </div>`:""}\n        </div>\n      </div>\n    </div>`}).join("")}(a),console.log("‚è∞ Attempting to initialize drag & drop after render...");const n=document.getElementById("activitiesTimeline");console.log("üìç Timeline element:",n),n?q(n):console.error("‚ùå Timeline element not found!")}function q(e){if(e)if(window.Sortable){console.log("üéØ Initializing drag & drop on container:",e),console.log("üì¶ Activity cards found:",e.querySelectorAll(".activity-card").length),console.log("üëÜ Drag handles found:",e.querySelectorAll(".drag-handle").length);try{P=new Sortable(e,{animation:200,easing:"cubic-bezier(0.4, 0, 0.2, 1)",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",draggable:".activity-card",handle:".drag-handle",onStart:function(e){console.log("üöÄ Drag started:",e.oldIndex)},onMove:function(e){console.log("üîÑ Moving from",e.dragged,"to",e.related)},onEnd:async function(t){console.log("‚úÖ Drag ended. Old index:",t.oldIndex,"New index:",t.newIndex);const a=Array.from(e.querySelectorAll(".activity-card")),n=$.days.find(e=>e.day===D);if(!n)return;const r=a.map(e=>{var t;const a=e.querySelector(".activity-checkbox"),r=null==(t=null==a?void 0:a.dataset)?void 0:t.id;return n.activities.find(e=>e.id===r)}).filter(Boolean);n.activities=r;try{await N(),console.log("‚úÖ Activity order saved"),window.Notifications&&window.Notifications.show("Orden actualizado","success")}catch(i){console.error("‚ùå Error saving activity order:",i),window.Notifications&&window.Notifications.show("Error al guardar el orden","error"),F()}}}),console.log("‚úÖ Drag & Drop initialized")}catch(t){console.error("‚ùå Error initializing drag & drop:",t)}}else console.error("‚ùå Drag & Drop: Sortable library not loaded");else console.error("‚ùå Drag & Drop: container is null or undefined")}const z={get currentItinerary(){return $},loadItinerary:async e=>(await O(),$),async init(){const t=document.getElementById("content-itinerary");if(!t)return;if(!B())return void R();if(await O(),!$)return void H();t.innerHTML='\n      <div class="max-w-6xl mx-auto px-4 pt-4"><div id="tripSelectorHeader"></div></div>\n      <div class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 sticky top-[72px] z-30 shadow-sm">\n        <div class="max-w-6xl mx-auto p-4"><div class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide" id="daySelector"></div></div>\n      </div>\n      <div class="max-w-6xl mx-auto p-4 md:p-6">\n        <div class="grid md:grid-cols-3 gap-6">\n          <div class="md:col-span-1"><div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 sticky top-36 fade-in" id="dayOverview"></div></div>\n          <div class="md:col-span-2"><div class="space-y-4" id="activitiesTimeline"></div></div>\n        </div>\n      </div>',await U(),j||(t.addEventListener("click",e=>{const t=e.target.closest('[id^="addActivityBtn_"]'),a=e.target.closest(".activity-edit-btn"),n=e.target.closest(".activity-delete-btn"),r=e.target.closest(".activity-vote-btn"),i=e.target.closest(".day-btn");if(t){const e=parseInt(t.id.split("_")[1]);z.showActivityModal(null,e)}else if(a){const e=a.dataset.activityId,t=parseInt(a.dataset.day);z.showActivityModal(e,t)}else if(n){const e=n.dataset.activityId,t=parseInt(n.dataset.day);z.deleteActivity(e,t)}else if(r){const e=r.dataset.activityId,t=parseInt(r.dataset.day);z.toggleVote(t,e)}else i&&(o=parseInt(i.dataset.day),D=o,F());var o}),t.addEventListener("change",t=>{const n=t.target.closest(".activity-checkbox");n&&async function(t){const n=A[t];A[t]=!n;try{if(!a||!e||!e.currentUser)return localStorage.setItem("checkedActivities",JSON.stringify(A)),void F();const i=B();if(!i)return alert("‚ö†Ô∏è Debes seleccionar un viaje primero"),A[t]=n,void F();const o=r(a,`trips/${i}/data`,"itinerary");await s(o,{"checklist.checked":A,lastUpdated:(new Date).toISOString(),updatedBy:e.currentUser.email}),console.log("‚úÖ Activity synced by:",e.currentUser.email)}catch(i){console.error("‚ùå Error saving activity:",i),"permission-denied"===i.code?alert("‚ö†Ô∏è No tienes permiso para modificar este checklist"):"unavailable"===i.code?alert("‚ö†Ô∏è No se pudo conectar. Verifica tu conexi√≥n a internet."):alert("‚ö†Ô∏è Error al sincronizar. Intenta de nuevo."),A[t]=n,F()}}(n.dataset.id)}),j=!0);const n=document.getElementById("activitiesTimeline");n&&q(n)},async reinitialize(){B()?(await O(),$?(await U(),await this.init()):H()):R()},showActivityModal(e,t){const a=document.getElementById("activityModal"),n=document.getElementById("activityForm"),r=document.getElementById("activityModalTitle");if(a&&n){if(n.reset(),document.getElementById("activityId").value=e||"",document.getElementById("activityDay").value=t,e){r.textContent="Editar Actividad";const a=$.days.find(e=>e.day===t),n=null==a?void 0:a.activities.find(t=>t.id===e);n&&(document.getElementById("activityIcon").value=n.icon||"",document.getElementById("activityTime").value=n.time||"",document.getElementById("activityTitle").value=n.title||"",document.getElementById("activityDesc").value=n.desc||"",document.getElementById("activityCost").value=n.cost||"",document.getElementById("activityStation").value=n.station||"")}else r.textContent="A√±adir Actividad";a.classList.remove("hidden"),a.classList.add("flex"),setTimeout(()=>{window.ActivityAutocomplete&&window.ActivityAutocomplete.init&&window.ActivityAutocomplete.init()},100),n.dataset.handlerAttached||(n.addEventListener("submit",e=>{e.preventDefault(),this.saveActivity()}),n.dataset.handlerAttached="true")}},closeActivityModal(){const e=document.getElementById("activityModal");e&&(e.classList.add("hidden"),e.classList.remove("flex"),window.ActivityAutocomplete&&window.ActivityAutocomplete.hideDropdown&&window.ActivityAutocomplete.hideDropdown())},async saveActivity(){const e=document.getElementById("activityId").value,a=parseInt(document.getElementById("activityDay").value),n=document.getElementById("activityIcon").value||"üìç",r=document.getElementById("activityTime").value,i=document.getElementById("activityTitle").value,o=document.getElementById("activityDesc").value,s=parseFloat(document.getElementById("activityCost").value)||0,l=document.getElementById("activityStation").value;if(!i)return void alert("‚ö†Ô∏è El t√≠tulo es obligatorio");const d=$.days.find(e=>e.day===a);if(!d)return void alert("‚ö†Ô∏è No se encontr√≥ el d√≠a");const c={id:e||`activity_${Date.now()}`,icon:n,time:r,title:i,desc:o,cost:s,station:l};if(e){const t=d.activities.findIndex(t=>t.id===e);t>=0&&(d.activities[t]=c)}else d.activities.push(c);try{await N(),this.closeActivityModal(),t.show(e?"Actividad actualizada":"Actividad a√±adida","success")}catch(u){console.error("‚ùå Error guardando actividad:",u),alert("‚ö†Ô∏è Error al guardar la actividad")}},async deleteActivity(e,a){if(!(await window.Dialogs.confirm({title:"üóëÔ∏è ¬øEliminar Actividad?",message:"¬øEst√°s seguro de que deseas eliminar esta actividad del itinerario?",okText:"S√≠, eliminar",isDestructive:!0})))return;const n=$.days.find(e=>e.day===a);if(n){n.activities=n.activities.filter(t=>t.id!==e);try{await N(),t.show("Actividad eliminada","success")}catch(r){console.error("‚ùå Error eliminando actividad:",r),alert("‚ö†Ô∏è Error al eliminar la actividad")}}},async toggleVote(a,n){if(!e.currentUser)return void t.warning("Debes iniciar sesi√≥n para votar");const r=$.days.find(e=>e.day===a);if(!r)return;const i=r.activities.find(e=>e.id===n);if(!i)return;const o=e.currentUser.uid;i.votes||(i.votes={}),i.votes[o]?delete i.votes[o]:i.votes[o]=!0,await N()}};window.addEventListener("auth:initialized",e=>{console.log("[ItineraryHandler] ‚ú® Evento auth:initialized recibido. Inicializando sync..."),z.reinitialize()}),window.addEventListener("auth:loggedOut",()=>{console.log("[ItineraryHandler] üö´ Evento auth:loggedOut recibido. Limpiando..."),M&&(M(),M=null),$=null,R()}),window.ItineraryHandler=z;const J=Object.freeze(Object.defineProperty({__proto__:null,ItineraryHandler:z},Symbol.toStringTag,{value:"Module"})),Y={apiKey:null,isLoaded:!1,async init(){var e,t,a,n;return this.apiKey=(null==(t=null==(e=window.RUNTIME_API_KEYS)?void 0:e.googlePlaces)?void 0:t.apiKey)||"",this.apiKey?((null==(n=null==(a=window.google)?void 0:a.maps)?void 0:n.places)||await this.loadGoogleMapsScript(),this.isLoaded=!0,console.log("‚úÖ Google Places API inicializado"),!0):(console.warn("‚ö†Ô∏è Google Places API key no configurado"),!1)},async loadGoogleMapsScript(){return new Promise((e,t)=>{var a;if(null==(a=window.google)?void 0:a.maps)return void e();const n=document.createElement("script");n.src=`https://maps.googleapis.com/maps/api/js?key=${this.apiKey}&libraries=places&language=en`,n.async=!0,n.defer=!0,n.onload=()=>e(),n.onerror=()=>t(new Error("Failed to load Google Maps script")),document.head.appendChild(n)})},async searchNearby(e){const{lat:t,lng:a,radius:n=1e3,type:r=null,keyword:i=null}=e;if(!this.apiKey)throw new Error("Google Places API key no configurado");try{const e=new URL("https://maps.googleapis.com/maps/api/place/nearbysearch/json");e.searchParams.append("key",this.apiKey),e.searchParams.append("location",`${t},${a}`),e.searchParams.append("radius",n),r&&e.searchParams.append("type",r),i&&e.searchParams.append("keyword",i);const o=await fetch(e.toString());if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const s=await o.json();return"OK"===s.status||"ZERO_RESULTS"===s.status?{success:!0,places:s.results.map(e=>{var t,a,n;return{id:e.place_id,name:e.name,address:e.vicinity,lat:e.geometry.location.lat,lng:e.geometry.location.lng,rating:e.rating,userRatingsTotal:e.user_ratings_total,types:e.types,photoReference:null==(a=null==(t=e.photos)?void 0:t[0])?void 0:a.photo_reference,priceLevel:e.price_level,openNow:null==(n=e.opening_hours)?void 0:n.open_now}})}:{success:!1,error:s.status,message:s.error_message||"Error en b√∫squeda"}}catch(o){return console.error("‚ùå Error en Google Places API:",o),{success:!1,error:o.message}}},async getPlaceDetails(e){var t;if(!this.apiKey)throw new Error("Google Places API key no configurado");try{const a=new URL("https://maps.googleapis.com/maps/api/place/details/json");a.searchParams.append("key",this.apiKey),a.searchParams.append("place_id",e),a.searchParams.append("fields","name,rating,formatted_address,geometry,opening_hours,photos,price_level,reviews,website,formatted_phone_number");const n=await fetch(a.toString()),r=await n.json();if("OK"===r.status){const a=r.result;return{success:!0,place:{id:e,name:a.name,address:a.formatted_address,lat:a.geometry.location.lat,lng:a.geometry.location.lng,rating:a.rating,website:a.website,phone:a.formatted_phone_number,priceLevel:a.price_level,openingHours:a.opening_hours,photos:null==(t=a.photos)?void 0:t.map(e=>e.photo_reference),reviews:a.reviews}}}return{success:!1,error:r.status}}catch(a){return console.error("‚ùå Error obteniendo detalles:",a),{success:!1,error:a.message}}},getPhotoUrl(e,t=400){return this.apiKey&&e?`https://maps.googleapis.com/maps/api/place/photo?maxwidth=${t}&photo_reference=${e}&key=${this.apiKey}`:null},async autocomplete(e,t={}){if(!this.apiKey)throw new Error("Google Places API key no configurado");try{const a=new URL("https://maps.googleapis.com/maps/api/place/autocomplete/json");a.searchParams.append("key",this.apiKey),a.searchParams.append("input",e),t.lat&&t.lng&&(a.searchParams.append("location",`${t.lat},${t.lng}`),a.searchParams.append("radius",t.radius||5e4)),t.types&&a.searchParams.append("types",t.types),a.searchParams.append("components","country:jp");const n=await fetch(a.toString()),r=await n.json();return"OK"===r.status||"ZERO_RESULTS"===r.status?{success:!0,predictions:r.predictions.map(e=>({placeId:e.place_id,description:e.description,mainText:e.structured_formatting.main_text,secondaryText:e.structured_formatting.secondary_text}))}:{success:!1,error:r.status}}catch(a){return console.error("‚ùå Error en autocomplete:",a),{success:!1,error:a.message}}},async findNearbyRestaurants(e,t,a=1e3){return this.searchNearby({lat:e,lng:t,radius:a,type:"restaurant"})},async findNearbyCafes(e,t,a=1e3){return this.searchNearby({lat:e,lng:t,radius:a,type:"cafe"})},async findNearbyAttractions(e,t,a=5e3){return this.searchNearby({lat:e,lng:t,radius:a,type:"tourist_attraction"})},isConfigured(){return!!this.apiKey}};window.GooglePlacesAPI=Y;let K=null,V=null,_=null;const G=[{name:"APA Hotel Shinjuku Gyoemmae",coords:[35.6893,139.7108],city:"Tokyo",dates:"Feb 16-19, 2026 (D√≠as 1-3)",icon:"üè®"},{name:"Hotel Kyoto Tune Stay",coords:[34.9858,135.7583],city:"Kyoto",dates:"Feb 19-21, 2026 (D√≠as 4-5)",icon:"üè®"},{name:"Toyoko Inn Osaka Namba",coords:[34.6651,135.5012],city:"Osaka",dates:"Feb 21-24, 2026 (D√≠as 6-8)",icon:"üè®"},{name:"APA Hotel Yamanote Otsuka Eki Mae",coords:[35.7308,139.7286],city:"Tokyo",dates:"Feb 24 - Mar 2, 2026 (D√≠as 8-15)",icon:"üè®"}],W=[{name:"Shibuya Crossing",coords:[35.6595,139.7005],city:"Tokyo",icon:"üö∂",category:"landmark"},{name:"Tokyo Skytree",coords:[35.7101,139.8107],city:"Tokyo",icon:"üèØ",category:"landmark"},{name:"Sensoji Temple",coords:[35.7148,139.7967],city:"Tokyo",icon:"üèÆ",category:"temple"},{name:"Fushimi Inari Shrine",coords:[34.9671,135.7727],city:"Kyoto",icon:"‚õ©Ô∏è",category:"temple"},{name:"Kiyomizu-dera",coords:[34.9949,135.785],city:"Kyoto",icon:"‚õ©Ô∏è",category:"temple"},{name:"Arashiyama Bamboo",coords:[35.017,135.6731],city:"Kyoto",icon:"üéã",category:"nature"},{name:"Dotonbori",coords:[34.6686,135.5014],city:"Osaka",icon:"üåÉ",category:"nightlife"},{name:"Osaka Aquarium",coords:[34.6546,135.4291],city:"Osaka",icon:"üêã",category:"entertainment"},{name:"Nara Park",coords:[34.6851,135.8428],city:"Nara",icon:"ü¶å",category:"nature"},{name:"Todai-ji Temple",coords:[34.689,135.8398],city:"Nara",icon:"üèØ",category:"temple"},{name:"Great Buddha Kamakura",coords:[35.3167,139.5363],city:"Kamakura",icon:"üóø",category:"temple"}],Q=(e,t="#dc2626")=>L.divIcon({html:`\n            <div style="\n                background: ${t};\n                width: 36px;\n                height: 36px;\n                border-radius: 50% 50% 50% 0;\n                border: 3px solid white;\n                transform: rotate(-45deg);\n                box-shadow: 0 4px 6px rgba(0,0,0,0.3);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            ">\n                <span style="\n                    transform: rotate(45deg);\n                    font-size: 18px;\n                    filter: drop-shadow(0 1px 2px rgba(0,0,0,0.5));\n                ">${e}</span>\n            </div>\n        `,className:"custom-marker",iconSize:[36,42],iconAnchor:[18,42],popupAnchor:[0,-42]}),X={mapInitialized:!1,renderMap(){const e=document.getElementById("content-map");e&&(e.innerHTML=`\n            <div class="max-w-7xl mx-auto p-4 md:p-6">\n                \x3c!-- Header --\x3e\n                <div class="bg-gradient-to-r from-red-500 to-pink-500 text-white rounded-xl p-6 mb-6 shadow-lg">\n                    <h1 class="text-3xl font-bold mb-2">üó∫Ô∏è Mapa Interactivo del Viaje</h1>\n                    <p class="text-white/90">Explora todas las ubicaciones de tu aventura por Jap√≥n</p>\n                </div>\n\n                \x3c!-- Map Container --\x3e\n                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl overflow-hidden mb-6">\n                    <div id="interactive-map" style="height: 600px; width: 100%;"></div>\n                </div>\n\n                \x3c!-- Leyenda y Filtros --\x3e\n                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">\n                    <h3 class="text-xl font-bold mb-4 dark:text-white">Leyenda del Mapa</h3>\n                    <div class="grid md:grid-cols-3 gap-4">\n                        <button onclick="MapHandler.filterMarkers('all')" class="map-filter-btn active" data-filter="all">\n                            üó∫Ô∏è Ver Todo\n                        </button>\n                        <button onclick="MapHandler.filterMarkers('hotels')" class="map-filter-btn" data-filter="hotels">\n                            üè® Hoteles\n                        </button>\n                        <button onclick="MapHandler.filterMarkers('attractions')" class="map-filter-btn" data-filter="attractions">\n                            ‚≠ê Atracciones\n                        </button>\n                        <button onclick="MapHandler.filterMarkers('temple')" class="map-filter-btn" data-filter="temple">\n                            ‚õ©Ô∏è Templos\n                        </button>\n                        <button onclick="MapHandler.filterMarkers('nature')" class="map-filter-btn" data-filter="nature">\n                            üåø Naturaleza\n                        </button>\n                        <button onclick="MapHandler.filterMarkers('nightlife')" class="map-filter-btn" data-filter="nightlife">\n                            üåÉ Vida Nocturna\n                        </button>\n                    </div>\n                </div>\n\n                \x3c!-- Info Tips --\x3e\n                <div class="mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border-l-4 border-blue-500">\n                    <p class="text-sm dark:text-gray-300">\n                        üí° <strong>Tips:</strong> Haz clic en los marcadores para ver m√°s informaci√≥n.\n                        Usa los filtros para ver solo ciertos tipos de lugares.\n                    </p>\n                </div>\n\n                \x3c!-- üî• B√∫squeda de Lugares Cercanos con Google Places --\x3e\n                ${Y.isConfigured()?'\n                <div class="mt-6 bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">\n                    <h3 class="text-xl font-bold mb-4 dark:text-white flex items-center gap-2">\n                        üîç Buscar Lugares Cercanos\n                        <span class="text-xs font-normal text-green-600 dark:text-green-400 bg-green-100 dark:bg-green-900/30 px-2 py-1 rounded-full">\n                            Powered by Google Places\n                        </span>\n                    </h3>\n\n                    <div class="grid md:grid-cols-2 gap-4 mb-4">\n                        <div>\n                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n                                Buscar cerca de:\n                            </label>\n                            <select\n                                id="nearbySearchCity"\n                                class="w-full p-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-purple-500"\n                            >\n                                <option value="35.6762,139.6503">Tokyo</option>\n                                <option value="35.0116,135.7681">Kyoto</option>\n                                <option value="34.6937,135.5023">Osaka</option>\n                                <option value="34.6851,135.8048">Nara</option>\n                                <option value="35.3192,139.5466">Kamakura</option>\n                            </select>\n                        </div>\n\n                        <div>\n                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n                                Tipo de lugar:\n                            </label>\n                            <select\n                                id="nearbySearchType"\n                                class="w-full p-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-purple-500"\n                            >\n                                <option value="restaurant">üçΩÔ∏è Restaurantes</option>\n                                <option value="cafe">‚òï Caf√©s</option>\n                                <option value="tourist_attraction">üéØ Atracciones</option>\n                                <option value="shopping_mall">üõçÔ∏è Centros Comerciales</option>\n                                <option value="park">üå≥ Parques</option>\n                                <option value="museum">üèõÔ∏è Museos</option>\n                            </select>\n                        </div>\n                    </div>\n\n                    <button\n                        onclick="MapHandler.searchNearbyPlaces()"\n                        class="w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-3 px-6 rounded-lg transition"\n                    >\n                        üîç Buscar Lugares\n                    </button>\n\n                    <div id="nearbySearchResults" class="mt-4">\n                        \x3c!-- Results will appear here --\x3e\n                    </div>\n                </div>\n                ':'\n                <div class="mt-6 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border-l-4 border-yellow-500">\n                    <p class="text-sm dark:text-gray-300">\n                        üí° <strong>Tip:</strong> Configura Google Places API key en config.js para buscar restaurantes, caf√©s y m√°s lugares cercanos.\n                    </p>\n                </div>\n                '}\n            </div>\n        `)},initializeMap(){if(document.getElementById("interactive-map")){if(K&&this.mapInitialized)return K.invalidateSize(),void console.log("‚úÖ Map size recalculated");K&&(K.remove(),K=null),K=L.map("interactive-map").setView([36.2048,138.2529],6),L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd",maxZoom:20}).addTo(K),V=L.layerGroup().addTo(K),this.addAllMarkers(),this.mapInitialized=!0,setTimeout(()=>{K&&(K.invalidateSize(),console.log("‚úÖ Map initialized and size calculated"))},100),console.log("‚úÖ Interactive map created")}else console.error("‚ùå Map element not found")},fixMapSize(){document.getElementById("interactive-map")&&(this.mapInitialized?K&&(K.invalidateSize(),console.log("‚úÖ Map size fixed after tab switch")):this.initializeMap())},addAllMarkers(){V&&(V.clearLayers(),G.forEach(e=>{const t=L.marker(e.coords,{icon:Q("üè®","#3b82f6"),type:"hotels"}).addTo(V);t.bindPopup(`\n                <div class="p-3 min-w-[200px]">\n                    <h3 class="font-bold text-lg mb-2">${e.icon} ${e.name}</h3>\n                    <p class="text-sm text-gray-600 mb-1">üìç ${e.city}</p>\n                    <p class="text-sm text-gray-600 mb-2">üìÖ ${e.dates}</p>\n                    <a href="https://www.google.com/maps/search/${encodeURIComponent(e.name)}"\n                       target="_blank"\n                       class="text-blue-600 hover:text-blue-800 text-sm font-semibold">\n                        Ver en Google Maps ‚Üí\n                    </a>\n                </div>\n            `),t.markerType="hotels"}),W.forEach(e=>{const t=L.marker(e.coords,{icon:Q(e.icon,"#dc2626"),type:"attractions"}).addTo(V);t.bindPopup(`\n                <div class="p-3 min-w-[220px]">\n                    <h3 class="font-bold text-lg mb-2">${e.icon} ${e.name}</h3>\n                    <p class="text-sm text-gray-600 mb-2">üìç ${e.city}</p>\n                    <div class="flex flex-col gap-2 mt-3">\n                        <button\n                            onclick="MapHandler.addToItinerary('${e.name.replace(/'/g,"\\'")}', '${e.city}', '${e.icon}')"\n                            class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white text-sm font-bold py-2 px-4 rounded-lg transition transform hover:scale-105"\n                        >\n                            ‚ûï Agregar al Itinerario\n                        </button>\n                        <a href="https://www.google.com/maps/search/${encodeURIComponent(e.name+" "+e.city)}"\n                           target="_blank"\n                           class="text-center text-blue-600 hover:text-blue-800 text-sm font-semibold">\n                            Ver en Google Maps ‚Üí\n                        </a>\n                    </div>\n                </div>\n            `),t.markerType="attractions",t.markerCategory=e.category}))},filterMarkers(e){V&&(document.querySelectorAll(".map-filter-btn").forEach(t=>{t.classList.remove("active"),t.dataset.filter===e&&t.classList.add("active")}),V.eachLayer(t=>{"all"===e?t.setOpacity(1):"hotels"===e||"attractions"===e?t.setOpacity(t.markerType===e?1:.2):t.setOpacity(t.markerCategory===e?1:.2)}))},async searchNearbyPlaces(){const e=document.getElementById("nearbySearchCity"),t=document.getElementById("nearbySearchType"),a=document.getElementById("nearbySearchResults");if(!e||!t)return;const[n,r]=e.value.split(",").map(Number),i=t.value;a.innerHTML='\n            <div class="p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg text-center">\n                <p class="text-sm font-semibold dark:text-white">üîÑ Buscando lugares...</p>\n            </div>\n        ';try{const e=await Y.searchNearby({lat:n,lng:r,radius:2e3,type:i});e.success&&e.places.length>0?(_?_.clearLayers():_=L.layerGroup().addTo(K),e.places.slice(0,10).forEach(e=>{L.marker([e.lat,e.lng],{icon:Q("üìç","#10b981")}).addTo(_).bindPopup(`\n                        <div class="p-3 min-w-[220px]">\n                            <h3 class="font-bold text-lg mb-2">üìç ${e.name}</h3>\n                            <p class="text-sm text-gray-600 mb-2">${e.address}</p>\n                            ${e.rating?`<p class="text-sm mb-2">‚≠ê ${e.rating} (${e.userRatingsTotal||0} reviews)</p>`:""}\n                            ${void 0!==e.openNow?`\n                                <p class="text-xs ${e.openNow?"text-green-600":"text-red-600"} font-semibold mb-2">\n                                    ${e.openNow?"‚úÖ Abierto ahora":"üî¥ Cerrado"}\n                                </p>\n                            `:""}\n                            <div class="flex flex-col gap-2 mt-3">\n                                <button\n                                    onclick="MapHandler.addToItinerary('${e.name.replace(/'/g,"\\'")}', '${t.options[t.selectedIndex].text}', 'üìç')"\n                                    class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white text-sm font-bold py-2 px-4 rounded-lg transition transform hover:scale-105"\n                                >\n                                    ‚ûï Agregar al Itinerario\n                                </button>\n                                <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e.name+" "+e.address)}"\n                                   target="_blank"\n                                   class="text-center text-blue-600 hover:text-blue-800 text-sm font-semibold">\n                                    Ver en Google Maps ‚Üí\n                                </a>\n                            </div>\n                        </div>\n                    `)}),K.setView([n,r],14),a.innerHTML=`\n                    <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-4 mb-4">\n                        <p class="text-sm font-semibold text-green-700 dark:text-green-400">\n                            ‚úÖ ${e.places.length} lugares encontrados (mostrando 10)\n                        </p>\n                    </div>\n                    <div class="grid md:grid-cols-2 gap-3 max-h-96 overflow-y-auto">\n                        ${e.places.slice(0,10).map(e=>`\n                            <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg border-l-4 border-green-500">\n                                <h4 class="font-bold text-sm dark:text-white mb-1">${e.name}</h4>\n                                <p class="text-xs text-gray-600 dark:text-gray-400 mb-2">${e.address}</p>\n                                ${e.rating?`<p class="text-xs mb-1">‚≠ê ${e.rating}/5</p>`:""}\n                                <button\n                                    onclick="MapHandler.centerOnPlace(${e.lat}, ${e.lng})"\n                                    class="text-xs bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600"\n                                >\n                                    üìç Ver en mapa\n                                </button>\n                            </div>\n                        `).join("")}\n                    </div>\n                `):a.innerHTML='\n                    <div class="p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg text-center">\n                        <p class="text-sm font-semibold dark:text-white">‚ö†Ô∏è No se encontraron lugares</p>\n                    </div>\n                '}catch(o){console.error("Error buscando lugares:",o),a.innerHTML=`\n                <div class="p-4 bg-red-50 dark:bg-red-900/20 rounded-lg text-center">\n                    <p class="text-sm font-semibold text-red-700 dark:text-red-400">\n                        ‚ùå Error: ${o.message}\n                    </p>\n                    <p class="text-xs text-gray-600 dark:text-gray-400 mt-2">\n                        Nota: Google Places API requiere un proxy o configuraci√≥n de backend\n                    </p>\n                </div>\n            `}},centerOnPlace(e,t){K&&(K.setView([e,t],16),_.eachLayer(a=>{const n=a.getLatLng();Math.abs(n.lat-e)<1e-4&&Math.abs(n.lng-t)<1e-4&&a.openPopup()}))},async addToItinerary(e,t,a){var n;try{const{ItineraryHandler:r}=await S(async()=>{const{ItineraryHandler:e}=await Promise.resolve().then(()=>J);return{ItineraryHandler:e}},void 0);if(!(null==(n=window.TripsManager)?void 0:n.currentTripId))return void(window.Notifications&&window.Notifications.error("‚ö†Ô∏è Por favor selecciona un viaje primero"));const i={time:"10:00",activity:`Visitar ${e}`,location:e,notes:`${a} ${t}`,addedFromMap:!0};r&&"function"==typeof r.showQuickAddForm?(r.showQuickAddForm(i),window.Notifications&&window.Notifications.success(`‚úÖ "${e}" listo para agregar al itinerario`)):window.Notifications&&window.Notifications.info(`üìç Ve al Itinerario y agrega: ${e}`),K&&K.closePopup()}catch(r){console.error("Error agregando al itinerario:",r),window.Notifications&&window.Notifications.error("‚ùå Error al agregar al itinerario")}}};window.MapHandler=X;const Z={EXCHANGE_RATE_API_KEY:"a9b02159c01b0c7c132f1a65",OPENWEATHER_API_KEY:"8afa1bdee4ba3fb17c86c1edc3345148",exchangeRate:143,clockInterval:null,weatherCache:{},rateCache:null,rateCacheTime:null,async fetchExchangeRate(){if(this.rateCache&&this.rateCacheTime&&Date.now()-this.rateCacheTime<36e5)return this.rateCache;try{const e=await fetch(`https://v6.exchangerate-api.com/v6/${this.EXCHANGE_RATE_API_KEY}/latest/USD`),t=await e.json();if("success"===t.result){this.exchangeRate=t.conversion_rates.JPY,this.rateCache=this.exchangeRate,this.rateCacheTime=Date.now();const e=document.querySelector(".exchange-rate-text");return e&&(e.textContent=`1 USD = ${this.exchangeRate.toFixed(2)} JPY (actualizado)`,e.classList.add("text-green-600","dark:text-green-400")),this.exchangeRate}}catch(e){console.warn("Error fetching exchange rate, using fallback:",e)}return this.exchangeRate},async fetchWeather(e){const t=e.toLowerCase(),a=Date.now();if(this.weatherCache[t]&&a-this.weatherCache[t].timestamp<18e5)return this.weatherCache[t].data;try{const n=await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${e},JP&appid=${this.OPENWEATHER_API_KEY}&units=metric&lang=es`),r=await n.json();if(200===r.cod){const e={temp:Math.round(r.main.temp),feels_like:Math.round(r.main.feels_like),description:r.weather[0].description,icon:r.weather[0].icon,humidity:r.main.humidity,wind:r.wind.speed};return this.weatherCache[t]={data:e,timestamp:a},e}}catch(n){console.warn(`Error fetching weather for ${e}:`,n)}return null},getWeatherEmoji:e=>({"01d":"‚òÄÔ∏è","01n":"üåô","02d":"‚õÖ","02n":"‚òÅÔ∏è","03d":"‚òÅÔ∏è","03n":"‚òÅÔ∏è","04d":"‚òÅÔ∏è","04n":"‚òÅÔ∏è","09d":"üåßÔ∏è","09n":"üåßÔ∏è","10d":"üå¶Ô∏è","10n":"üåßÔ∏è","11d":"‚õàÔ∏è","11n":"‚õàÔ∏è","13d":"üå®Ô∏è","13n":"üå®Ô∏è","50d":"üå´Ô∏è","50n":"üå´Ô∏è"}[e]||"üå§Ô∏è"),setupCurrencyConverter(){const e=document.getElementById("usdInput"),t=document.getElementById("jpyInput");if(!e||!t)return;let a;this.fetchExchangeRate().then(e=>{this.exchangeRate=e}),e.addEventListener("input",e=>{clearTimeout(a),a=setTimeout(()=>{const a=parseFloat(e.target.value)||0;t.value=Math.round(a*this.exchangeRate)},300)}),t.addEventListener("input",t=>{clearTimeout(a),a=setTimeout(()=>{const a=parseFloat(t.target.value)||0;e.value=(a/this.exchangeRate).toFixed(2)},300)}),document.querySelectorAll(".quick-convert").forEach(a=>{a.addEventListener("click",a=>{const n=parseFloat(a.currentTarget.dataset.amount);e.value=n,t.value=Math.round(n*this.exchangeRate)})})},async loadWeatherData(){const e=["Tokyo","Kyoto","Osaka"],t={Tokyo:document.getElementById("weather-tokyo"),Kyoto:document.getElementById("weather-kyoto"),Osaka:document.getElementById("weather-osaka")};for(const a of e){const e=t[a];if(!e)continue;e.innerHTML='\n                <div class="animate-pulse">\n                    <div class="h-4 bg-gray-300 dark:bg-gray-600 rounded w-20 mb-2"></div>\n                    <div class="h-6 bg-gray-300 dark:bg-gray-600 rounded w-32"></div>\n                </div>\n            ';const n=await this.fetchWeather(a);if(n){const t=this.getWeatherEmoji(n.icon);e.innerHTML=`\n                    <div class="flex justify-between items-center">\n                        <div>\n                            <p class="font-semibold dark:text-white">${a}</p>\n                            <p class="text-sm text-gray-600 dark:text-gray-400">\n                                ${n.temp}¬∞C (sensaci√≥n: ${n.feels_like}¬∞C)\n                            </p>\n                            <p class="text-xs text-gray-500 dark:text-gray-500 capitalize">\n                                ${n.description}\n                            </p>\n                        </div>\n                        <span class="text-3xl">${t}</span>\n                    </div>\n                    <div class="mt-2 flex gap-3 text-xs text-gray-500 dark:text-gray-400">\n                        <span>üíß ${n.humidity}%</span>\n                        <span>üí® ${n.wind.toFixed(1)} m/s</span>\n                    </div>\n                `}else{const t={Tokyo:"5-12¬∞C",Kyoto:"4-10¬∞C",Osaka:"5-11¬∞C"},n={Tokyo:"üå§Ô∏è",Kyoto:"‚õÖ",Osaka:"üå•Ô∏è"};e.innerHTML=`\n                    <div class="flex justify-between items-center">\n                        <div>\n                            <p class="font-semibold dark:text-white">${a}</p>\n                            <p class="text-sm text-gray-600 dark:text-gray-400">${t[a]} (Febrero promedio)</p>\n                        </div>\n                        <span class="text-3xl">${n[a]}</span>\n                    </div>\n                `}}},startClocks(){this.updateClocks(),this.clockInterval&&clearInterval(this.clockInterval),this.clockInterval=setInterval(()=>this.updateClocks(),1e3)},updateClocks(){const e=new Date,t=new Date(e.toLocaleString("en-US",{timeZone:"America/Costa_Rica"})).toLocaleTimeString("es-CR",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),a=new Date(e.toLocaleString("en-US",{timeZone:"Asia/Tokyo"})).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),n=document.getElementById("crTime"),r=document.getElementById("jpTime");n&&(n.textContent=t),r&&(r.textContent=a)}},ee={renderAllTabs(){this.renderUtilsTab(),X.renderMap()},renderFlightsTab_OLD(){const e=document.getElementById("content-flights");e&&(e.innerHTML='\n            <div class="max-w-6xl mx-auto p-4 md:p-6">\n                <h2 class="text-3xl font-bold mb-6 text-gray-800 dark:text-white">‚úàÔ∏è Informaci√≥n de Vuelos</h2>\n                \n                <div class="space-y-6">\n                    \x3c!-- Vuelo de Ida --\x3e\n                    <div class="bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-xl p-6 border-l-4 border-blue-500">\n                        <div class="flex items-center gap-3 mb-4">\n                            <span class="text-3xl">üõ´</span>\n                            <div>\n                                <h3 class="text-xl font-bold text-gray-800 dark:text-white">Ida: Costa Rica ‚Üí Jap√≥n</h3>\n                                <p class="text-sm text-gray-600 dark:text-gray-300">Domingo, 16 de Febrero 2026</p>\n                            </div>\n                        </div>\n                        <div class="bg-white dark:bg-gray-700 p-4 rounded-lg">\n                            <div class="flex items-center justify-between mb-3">\n                                <span class="font-bold text-gray-800 dark:text-white">Vuelo AM58</span>\n                                <span class="bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 px-3 py-1 rounded-full text-sm font-semibold">Aerom√©xico</span>\n                            </div>\n                            <div class="grid grid-cols-3 gap-4 text-sm dark:text-gray-300 mb-4">\n                                <div>\n                                    <p class="text-gray-500 dark:text-gray-400 text-xs mb-1">Salida</p>\n                                    <p class="font-semibold">MTY - Monterrey</p>\n                                </div>\n                                <div class="text-center flex items-center justify-center">\n                                    <p class="text-2xl text-gray-400">‚Üí</p>\n                                </div>\n                                <div class="text-right">\n                                    <p class="text-gray-500 dark:text-gray-400 text-xs mb-1">Llegada</p>\n                                    <p class="font-semibold text-green-600 dark:text-green-400">NRT 6:30 AM</p>\n                                </div>\n                            </div>\n                            <div class="flex gap-2">\n                                <a href="https://www.flightradar24.com/data/flights/am58" target="_blank" class="text-xs bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 transition font-semibold">\n                                    üì° Track Live (FlightRadar24)\n                                </a>\n                                <a href="https://flightaware.com/live/flight/AMX58" target="_blank" class="text-xs bg-green-600 text-white px-3 py-2 rounded-lg hover:bg-green-700 transition font-semibold">\n                                    üìä FlightAware\n                                </a>\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- Vuelo de Regreso --\x3e\n                    <div class="bg-gradient-to-r from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 rounded-xl p-6 border-l-4 border-orange-500">\n                        <div class="flex items-center gap-3 mb-4">\n                            <span class="text-3xl">üõ¨</span>\n                            <div>\n                                <h3 class="text-xl font-bold text-gray-800 dark:text-white">Regreso: Jap√≥n ‚Üí Costa Rica</h3>\n                                <p class="text-sm text-gray-600 dark:text-gray-300">Domingo, 2 de Marzo 2026</p>\n                            </div>\n                        </div>\n                        <div class="bg-white dark:bg-gray-700 p-4 rounded-lg">\n                            <div class="flex items-center justify-between mb-3">\n                                <span class="font-bold text-gray-800 dark:text-white">Vuelo AM58</span>\n                                <span class="bg-orange-100 dark:bg-orange-900 text-orange-700 dark:text-orange-300 px-3 py-1 rounded-full text-sm font-semibold">Aerom√©xico</span>\n                            </div>\n                            <div class="grid grid-cols-3 gap-4 text-sm dark:text-gray-300 mb-3">\n                                <div>\n                                    <p class="text-gray-500 dark:text-gray-400 text-xs mb-1">Salida</p>\n                                    <p class="font-semibold text-red-600 dark:text-red-400">‚ö†Ô∏è 9:30 AM</p>\n                                    <p class="text-xs text-gray-600 dark:text-gray-400">Narita Airport</p>\n                                </div>\n                                <div class="text-center flex items-center justify-center">\n                                    <p class="text-2xl text-gray-400">‚Üí</p>\n                                </div>\n                                <div class="text-right">\n                                    <p class="text-gray-500 dark:text-gray-400 text-xs mb-1">Llegada</p>\n                                    <p class="font-semibold">SJO</p>\n                                    <p class="text-xs text-gray-600 dark:text-gray-400">Costa Rica (v√≠a MTY)</p>\n                                </div>\n                            </div>\n                            <div class="mt-3 p-4 bg-red-50 dark:bg-red-900/30 rounded-lg border-l-4 border-red-500">\n                                <p class="text-sm font-semibold text-red-700 dark:text-red-300 mb-2">‚ö†Ô∏è ¬°IMPORTANTE! D√≠a de salida</p>\n                                <div class="space-y-1 text-xs text-red-600 dark:text-red-400">\n                                    <p>‚è∞ <strong>Wake up:</strong> 4:30 AM</p>\n                                    <p>üö™ <strong>Salida del hotel:</strong> 5:30 AM</p>\n                                    <p>‚úàÔ∏è <strong>Vuelo:</strong> 9:30 AM desde Narita</p>\n                                </div>\n                            </div>\n                            <div class="flex gap-2 mt-3">\n                                <a href="https://www.flightradar24.com/data/flights/am58" target="_blank" class="text-xs bg-orange-600 text-white px-3 py-2 rounded-lg hover:bg-orange-700 transition font-semibold">\n                                    üì° Track Live\n                                </a>\n                                <a href="https://flightaware.com/live/flight/AMX58" target="_blank" class="text-xs bg-red-600 text-white px-3 py-2 rounded-lg hover:bg-red-700 transition font-semibold">\n                                    üìä Status\n                                </a>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        ')},renderUtilsTab(){const e=document.getElementById("content-utils");e&&(e.innerHTML='\n            <div class="max-w-6xl mx-auto p-4 md:p-6">\n                <h2 class="text-3xl font-bold mb-6 text-gray-800 dark:text-white">üõ†Ô∏è Utilidades</h2>\n                \n                <div class="grid md:grid-cols-2 gap-6">\n                    \x3c!-- Conversor de Moneda --\x3e\n                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">\n                        <h3 class="text-xl font-bold mb-4 text-gray-800 dark:text-white flex items-center gap-2">\n                            üí∏ Conversor de Moneda\n                        </h3>\n                        <div class="space-y-3">\n                            <div class="flex gap-2">\n                                <div class="flex-1">\n                                    <label class="text-xs text-gray-500 dark:text-gray-400 block mb-1">USD (D√≥lares)</label>\n                                    <input \n                                        id="usdInput" \n                                        type="number" \n                                        class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:outline-none focus:ring-2 focus:ring-red-500" \n                                        placeholder="0.00" \n                                        step="0.01"\n                                    >\n                                </div>\n                                <div class="flex-1">\n                                    <label class="text-xs text-gray-500 dark:text-gray-400 block mb-1">JPY (Yenes)</label>\n                                    <input \n                                        id="jpyInput" \n                                        type="number" \n                                        class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:outline-none focus:ring-2 focus:ring-red-500" \n                                        placeholder="0" \n                                        step="1"\n                                    >\n                                </div>\n                            </div>\n                            <div class="flex items-center justify-center gap-2">\n                                <p class="text-xs text-gray-500 dark:text-gray-400 exchange-rate-text">\n                                    Cargando tasa de cambio...\n                                </p>\n                                <button \n                                    onclick="AppUtils.fetchExchangeRate().then(() => location.reload())" \n                                    class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded hover:bg-gray-200 dark:hover:bg-gray-600 transition"\n                                    title="Actualizar tasa"\n                                >\n                                    üîÑ\n                                </button>\n                            </div>\n                            <div class="grid grid-cols-3 gap-2">\n                                <button class="quick-convert bg-gray-100 dark:bg-gray-700 p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition text-sm font-semibold" data-amount="10">\n                                    10 USD\n                                </button>\n                                <button class="quick-convert bg-gray-100 dark:bg-gray-700 p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition text-sm font-semibold" data-amount="50">\n                                    50 USD\n                                </button>\n                                <button class="quick-convert bg-gray-100 dark:bg-gray-700 p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition text-sm font-semibold" data-amount="100">\n                                    100 USD\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- Clima en Jap√≥n --\x3e\n                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">\n                        <h3 class="text-xl font-bold mb-4 text-gray-800 dark:text-white flex items-center gap-2">\n                            üå§Ô∏è Clima en Tiempo Real\n                        </h3>\n                        <div class="space-y-3">\n                            <div id="weather-tokyo" class="p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg">\n                                <div class="animate-pulse">\n                                    <div class="h-4 bg-gray-300 dark:bg-gray-600 rounded w-20 mb-2"></div>\n                                    <div class="h-6 bg-gray-300 dark:bg-gray-600 rounded w-32"></div>\n                                </div>\n                            </div>\n                            <div id="weather-kyoto" class="p-3 bg-purple-50 dark:bg-purple-900/30 rounded-lg">\n                                <div class="animate-pulse">\n                                    <div class="h-4 bg-gray-300 dark:bg-gray-600 rounded w-20 mb-2"></div>\n                                    <div class="h-6 bg-gray-300 dark:bg-gray-600 rounded w-32"></div>\n                                </div>\n                            </div>\n                            <div id="weather-osaka" class="p-3 bg-orange-50 dark:bg-orange-900/30 rounded-lg">\n                                <div class="animate-pulse">\n                                    <div class="h-4 bg-gray-300 dark:bg-gray-600 rounded w-20 mb-2"></div>\n                                    <div class="h-6 bg-gray-300 dark:bg-gray-600 rounded w-32"></div>\n                                </div>\n                            </div>\n                            <div class="mt-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg text-sm">\n                                <p class="font-semibold mb-2 dark:text-white">üëï Qu√© llevar:</p>\n                                <ul class="space-y-1 text-gray-600 dark:text-gray-300 text-xs">\n                                    <li>‚Ä¢ Abrigo o chamarra</li>\n                                    <li>‚Ä¢ Su√©teres y capas</li>\n                                    <li>‚Ä¢ Pantalones largos</li>\n                                    <li>‚Ä¢ Paraguas (puede llover)</li>\n                                </ul>\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- Zona Horaria --\x3e\n                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">\n                        <h3 class="text-xl font-bold mb-4 text-gray-800 dark:text-white flex items-center gap-2">\n                            üïê Zona Horaria\n                        </h3>\n                        <div class="space-y-4">\n                            <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">\n                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">Costa Rica (GMT-6)</p>\n                                <p id="crTime" class="text-2xl font-bold dark:text-white font-mono">--:--:--</p>\n                            </div>\n                            <div class="p-4 bg-red-50 dark:bg-red-900/20 rounded-lg">\n                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">Jap√≥n (GMT+9)</p>\n                                <p id="jpTime" class="text-2xl font-bold dark:text-white font-mono">--:--:--</p>\n                            </div>\n                            <p class="text-xs text-center text-gray-500 dark:text-gray-400">\n                                üìç Diferencia: <strong>15 horas</strong> adelante\n                            </p>\n                        </div>\n                    </div>\n\n                    \x3c!-- Acciones R√°pidas --\x3e\n                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">\n                        <h3 class="text-xl font-bold mb-4 text-gray-800 dark:text-white flex items-center gap-2">\n                            ‚ö° Acciones R√°pidas\n                        </h3>\n                        <div class="grid grid-cols-2 gap-3">\n                            <button data-modal="phrases" class="p-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 transition">\n                                <div class="text-2xl mb-1">üó£Ô∏è</div>\n                                <div class="text-sm font-semibold">Frases</div>\n                            </button>\n                            <button data-modal="emergency" class="p-4 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition">\n                                <div class="text-2xl mb-1">üö®</div>\n                                <div class="text-sm font-semibold">SOS</div>\n                            </button>\n                            <button data-modal="budget" class="p-4 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg hover:from-green-600 hover:to-green-700 transition">\n                                <div class="text-2xl mb-1">üí∞</div>\n                                <div class="text-sm font-semibold">Budget</div>\n                            </button>\n                            <button data-modal="notes" class="p-4 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-lg hover:from-purple-600 hover:to-purple-700 transition">\n                                <div class="text-2xl mb-1">üìù</div>\n                                <div class="text-sm font-semibold">Notas</div>\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        ',Z.setupCurrencyConverter(),Z.startClocks(),Z.loadWeatherData())}},te={notes:"",notesUnsubscribe:null,init(){if("true"===localStorage.getItem("darkMode")){document.documentElement.classList.add("dark");const e=document.getElementById("darkModeIcon");e&&(e.classList.remove("fa-moon"),e.classList.add("fa-sun"))}this.setupEventListeners(),this.updateCountdown(),setInterval(()=>this.updateCountdown(),6e4),this.initNotesSync()},getCurrentTripId:()=>window.TripsManager&&window.TripsManager.currentTrip?window.TripsManager.currentTrip.id:localStorage.getItem("currentTripId"),async initNotesSync(){if(this.notesUnsubscribe&&this.notesUnsubscribe(),!e.currentUser)return void(this.notes=localStorage.getItem("travelNotes")||"");const t=this.getCurrentTripId(),n=e.currentUser.uid;if(!t){console.log("‚ö†Ô∏è Notes: No hay trip seleccionado, usando modo individual");const e=r(a,`users/${n}/notes`,"travel");return void(this.notesUnsubscribe=l(e,e=>{e.exists()?this.notes=e.data().content||"":this.notes="",localStorage.setItem("travelNotes",this.notes);const t=document.getElementById("notesTextarea");t&&document.getElementById("modal-notes").classList.contains("active")&&(t.value=this.notes),console.log("‚úÖ Notas (individual) sincronizadas")},e=>{console.error("‚ùå Error en sync de notas:",e),this.notes=localStorage.getItem("travelNotes")||""}))}console.log("ü§ù Notes: Modo colaborativo activado para trip:",t);const i=r(a,`trips/${t}/data`,"notes");this.notesUnsubscribe=l(i,e=>{e.exists()?this.notes=e.data().content||"":this.notes="",localStorage.setItem("travelNotes",this.notes);const t=document.getElementById("notesTextarea");t&&document.getElementById("modal-notes").classList.contains("active")&&(t.value=this.notes),console.log("‚úÖ Notas COMPARTIDAS sincronizadas")},e=>{console.error("‚ùå Error en sync de notas compartidas:",e),this.notes=localStorage.getItem("travelNotes")||""})},setupEventListeners(){const e=document.getElementById("themeToggle");e&&e.addEventListener("click",()=>this.toggleDarkMode());const t=document.getElementById("tabSelector");t&&t.addEventListener("click",e=>{const t=e.target.closest(".tab-btn");t&&this.switchTab(t.dataset.tab)}),document.body.addEventListener("click",e=>{const t=e.target.closest("[data-modal]");t&&(e.preventDefault(),this.openModal(t.dataset.modal))});const a=document.getElementById("modalsContainer");a&&a.addEventListener("click",e=>{const t=e.target.closest(".modal-close");if(t){e.preventDefault(),e.stopPropagation();const a=t.dataset.modalClose;return void this.closeModal(a)}if(e.target.classList.contains("modal")){const t=e.target.id.replace("modal-","");this.closeModal(t)}}),document.addEventListener("keydown",e=>{"Escape"===e.key&&document.querySelectorAll(".modal.active").forEach(e=>{const t=e.id.replace("modal-","");this.closeModal(t)})})},toggleDarkMode(){document.documentElement.classList.toggle("dark");const e=document.documentElement.classList.contains("dark");localStorage.setItem("darkMode",e);const t=document.getElementById("darkModeIcon");t&&(e?(t.classList.remove("fa-moon"),t.classList.add("fa-sun")):(t.classList.remove("fa-sun"),t.classList.add("fa-moon")))},switchTab(e){document.querySelectorAll(".tab-content").forEach(e=>{e.classList.add("hidden"),e.classList.remove("animate__animated","animate__fadeIn")}),document.querySelectorAll(".tab-btn").forEach(e=>{e.classList.remove("active")});const t=document.getElementById(`content-${e}`);t&&(t.classList.remove("hidden"),t.classList.add("animate__animated","animate__fadeIn"));const a=document.querySelector(`.tab-btn[data-tab="${e}"]`);a&&a.classList.add("active"),"map"===e&&window.MapHandler&&setTimeout(()=>{window.MapHandler.fixMapSize&&window.MapHandler.fixMapSize()},150)},updateCountdown(){const e=new Date("2026-02-16T00:00:00"),t=new Date,a=e.getTime()-t.getTime(),n=Math.ceil(a/864e5),r=document.getElementById("countdown");r&&(r.textContent=n>0?`Faltan ${n} d√≠as`:0===n?"¬°HOY ES EL D√çA! üéâ":"Viaje completado ‚úì")},openModal(e){const t=document.getElementById(`modal-${e}`);if(t){if(t.classList.add("active"),document.body.style.overflow="hidden","notes"===e){const e=document.getElementById("notesTextarea");e&&(e.value=this.notes||localStorage.getItem("travelNotes")||""),this.updateNotesSyncIndicator()}"budget"===e&&S(()=>import("./budget-tracker-Cw-BTWnF.js"),__vite__mapDeps([0,1,2])).then(e=>{e.BudgetTracker.updateModal()}),"packing"===e&&window.PackingList&&window.PackingList.renderList(),"favorites"===e&&window.FavoritesManager&&window.FavoritesManager.renderFavoritesList()}},closeModal(e){const t=document.getElementById(`modal-${e}`);t&&(t.classList.remove("active"),document.body.style.overflow="")},updateNotesSyncIndicator(){const t=document.querySelector("#modal-notes .sync-badge");if(!t)return;const a=this.getCurrentTripId();let n;n=e.currentUser?a?'<span class="text-sm text-green-600 dark:text-green-400">ü§ù Modo Colaborativo - Cambios se sincronizan en tiempo real</span>':'<span class="text-sm text-blue-600 dark:text-blue-400">‚òÅÔ∏è Sincronizado con tu cuenta</span>':'<span class="text-sm text-yellow-600 dark:text-yellow-400">üì± Solo local</span>',t.innerHTML=n},async saveNotes(){const t=document.getElementById("notesTextarea");if(t){this.notes=t.value;try{if(!e.currentUser)return localStorage.setItem("travelNotes",this.notes),window.Notifications.success("‚úÖ Notas guardadas localmente"),void this.closeModal("notes");const t=this.getCurrentTripId();if(t){const n=r(a,`trips/${t}/data`,"notes");await i(n,{content:this.notes,lastUpdated:(new Date).toISOString(),updatedBy:e.currentUser.email}),console.log("‚úÖ Notas sincronizadas (COMPARTIDAS) por:",e.currentUser.email),window.Notifications.success("‚úÖ Notas guardadas y compartidas con el equipo")}else{const t=e.currentUser.uid,n=r(a,`users/${t}/notes`,"travel");await i(n,{content:this.notes,lastUpdated:(new Date).toISOString(),updatedBy:e.currentUser.email}),console.log("‚úÖ Notas sincronizadas (individual)"),window.Notifications.success("‚úÖ Notas guardadas y sincronizadas")}this.closeModal("notes")}catch(n){console.error("‚ùå Error guardando notas:",n),window.Notifications.error("Error al guardar. Intenta de nuevo.")}}},reinitialize(){this.initNotesSync()},escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}};window.AppCore=te,window.addEventListener("auth:initialized",e=>{console.log("[AppCore] ‚ú® Evento auth:initialized recibido. Inicializando sync de notas..."),te.initNotesSync()}),window.addEventListener("auth:loggedOut",()=>{console.log("[AppCore] üö´ Evento auth:loggedOut recibido. Limpiando notas..."),te.notesUnsubscribe&&te.notesUnsubscribe(),te.notes="",localStorage.removeItem("travelNotes")});const ae={isMobile:()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isIOS:()=>/iPhone|iPad|iPod/i.test(navigator.userAgent),isAndroid:()=>/Android/i.test(navigator.userAgent),init(){console.log("üì± Inicializando mejoras m√≥viles..."),this.isMobile()&&(document.body.classList.add("is-mobile"),this.isIOS()&&document.body.classList.add("is-ios"),this.isAndroid()&&document.body.classList.add("is-android")),this.optimizeScrolling(),this.enhanceTouchExperience(),this.handleOrientation(),this.preventUnwantedZoom(),this.addSwipeGestures(),this.fixIOSInputFocus(),this.optimizeViewport(),this.handlePWAInstall(),console.log("‚úÖ Mejoras m√≥viles activadas")},optimizeScrolling(){this.checkPassiveSupport()&&(window.addEventListener("scroll",()=>{},{passive:!0}),window.addEventListener("touchstart",()=>{},{passive:!0}),window.addEventListener("touchmove",()=>{},{passive:!0})),document.addEventListener("touchmove",e=>{const t=e.target.closest(".modal");if(t&&t.classList.contains("active")){const t=e.target.closest(".modal > div");if(t){t.scrollHeight>t.clientHeight||e.preventDefault()}}},{passive:!1})},checkPassiveSupport(){let e=!1;try{const t={get passive(){return e=!0,!1}};window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(t){e=!1}return e},enhanceTouchExperience(){document.addEventListener("touchstart",e=>{const t=e.target.closest("button, a, .clickable");t&&!t.classList.contains("no-touch-feedback")&&(t.style.opacity="0.7",t.style.transform="scale(0.97)")},{passive:!0}),document.addEventListener("touchend",e=>{const t=e.target.closest("button, a, .clickable");t&&(t.style.opacity="",t.style.transform="")},{passive:!0}),document.addEventListener("touchcancel",e=>{const t=e.target.closest("button, a, .clickable");t&&(t.style.opacity="",t.style.transform="")},{passive:!0})},handleOrientation(){const e=()=>{if(window.innerWidth>window.innerHeight?(document.body.classList.add("landscape"),document.body.classList.remove("portrait")):(document.body.classList.add("portrait"),document.body.classList.remove("landscape")),this.isIOS()){const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`)}};window.addEventListener("orientationchange",e),window.addEventListener("resize",e),e()},preventUnwantedZoom(){if(!this.isIOS())return;let e=0;document.addEventListener("touchend",t=>{const a=Date.now();if(a-e<=300){const e=t.target;"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName&&t.preventDefault()}e=a},!1)},addSwipeGestures(){let e=0,t=0,a=0,n=0;document.addEventListener("touchstart",a=>{e=a.changedTouches[0].screenX,t=a.changedTouches[0].screenY},{passive:!0}),document.addEventListener("touchend",r=>{a=r.changedTouches[0].screenX,n=r.changedTouches[0].screenY,this.handleSwipe(e,t,a,n,50)},{passive:!0})},handleSwipe(e,t,a,n,r){const i=a-e,o=n-t;Math.abs(i)>Math.abs(o)&&Math.abs(i)>r&&(i>0?this.onSwipeRight():this.onSwipeLeft()),Math.abs(o)>Math.abs(i)&&Math.abs(o)>r&&(o>0?this.onSwipeDown():this.onSwipeUp())},onSwipeLeft(){console.log("üëÜ Swipe left detectado")},onSwipeRight(){console.log("üëÜ Swipe right detectado")},onSwipeUp(){console.log("üëÜ Swipe up detectado")},onSwipeDown(){const e=document.querySelector(".modal.active");e&&(console.log("üëÜ Cerrando modal con swipe down"),e.classList.remove("active"),document.body.style.overflow="")},fixIOSInputFocus(){if(!this.isIOS())return;document.addEventListener("focus",e=>{"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName||setTimeout(()=>{window.scrollTo(0,0)},100)},!0);const e=window.innerHeight;window.addEventListener("resize",()=>{window.innerHeight<e?document.body.classList.add("keyboard-visible"):document.body.classList.remove("keyboard-visible")})},optimizeViewport(){let e=document.querySelector('meta[name="viewport"]');e||(e=document.createElement("meta"),e.name="viewport",document.head.appendChild(e)),e.content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover",this.isIOS()&&(this.addMetaTag("apple-mobile-web-app-capable","yes"),this.addMetaTag("apple-mobile-web-app-status-bar-style","black-translucent"),this.addMetaTag("apple-mobile-web-app-title","Japan Trip")),this.isAndroid()&&this.addMetaTag("mobile-web-app-capable","yes")},addMetaTag(e,t){let a=document.querySelector(`meta[name="${e}"]`);a?a.content=t:(a=document.createElement("meta"),a.name=e,a.content=t,document.head.appendChild(a))},handlePWAInstall(){let e;window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),e=t,this.showInstallButton(e)}),window.addEventListener("appinstalled",()=>{console.log("‚úÖ PWA instalada exitosamente"),e=null,window.Notifications&&window.Notifications.success("¬°App instalada! Ahora puedes acceder desde tu pantalla de inicio üéâ")}),(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone)&&(console.log("‚úÖ App ejecut√°ndose en modo PWA"),document.body.classList.add("pwa-installed"))},showInstallButton(e){var t,a;if(!this.isMobile())return;const n=document.createElement("div");n.id="pwa-install-banner",n.className="fixed bottom-0 left-0 right-0 bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 shadow-2xl z-50 animate-slide-up",n.innerHTML='\n      <div class="max-w-6xl mx-auto flex items-center justify-between gap-4">\n        <div class="flex items-center gap-3">\n          <div class="text-3xl">üì±</div>\n          <div>\n            <div class="font-bold text-sm">Instala Japan Trip Planner</div>\n            <div class="text-xs text-white/80">Acceso r√°pido desde tu pantalla de inicio</div>\n          </div>\n        </div>\n        <div class="flex gap-2">\n          <button id="pwa-install-btn" class="bg-white text-blue-600 font-bold px-4 py-2 rounded-lg hover:bg-blue-50 transition text-sm">\n            Instalar\n          </button>\n          <button id="pwa-dismiss-btn" class="text-white/80 hover:text-white px-2 transition">\n            ‚úï\n          </button>\n        </div>\n      </div>\n    ',document.body.appendChild(n),null==(t=document.getElementById("pwa-install-btn"))||t.addEventListener("click",async()=>{if(!e)return;e.prompt();const{outcome:t}=await e.userChoice;console.log(`PWA install outcome: ${t}`),"accepted"===t&&console.log("‚úÖ Usuario acept√≥ instalar la PWA"),n.remove(),e=null}),null==(a=document.getElementById("pwa-dismiss-btn"))||a.addEventListener("click",()=>{n.remove()}),setTimeout(()=>{n.parentNode&&n.remove()},1e4)},vibrate(e=[50]){"vibrate"in navigator&&navigator.vibrate(e)},async shareTrip(e){if(!navigator.share)return console.warn("Web Share API no disponible"),!1;try{return await navigator.share({title:e.name||"Mi viaje a Jap√≥n",text:`¬°√önete a mi viaje a Jap√≥n! C√≥digo: ${e.shareCode}`,url:window.location.href}),console.log("‚úÖ Compartido exitosamente"),!0}catch(t){return"AbortError"!==t.name&&console.error("Error compartiendo:",t),!1}},detectSlowConnection(){if("connection"in navigator){const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(e){const t=e.effectiveType;if("slow-2g"===t||"2g"===t)return console.warn("‚ö†Ô∏è Conexi√≥n lenta detectada"),document.body.classList.add("slow-connection"),window.Notifications&&window.Notifications.warning("Conexi√≥n lenta detectada. Algunas funciones pueden tardar m√°s."),!0}}return!1},handleOffline(){window.addEventListener("online",()=>{console.log("‚úÖ Conexi√≥n restaurada"),document.body.classList.remove("offline"),window.Notifications&&window.Notifications.success("Conexi√≥n restaurada ‚úÖ")}),window.addEventListener("offline",()=>{console.log("‚ö†Ô∏è Sin conexi√≥n"),document.body.classList.add("offline"),window.Notifications&&window.Notifications.warning("Sin conexi√≥n a internet. Trabajando en modo offline.")}),navigator.onLine||document.body.classList.add("offline")}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{ae.init(),ae.handleOffline(),ae.detectSlowConnection()}):(ae.init(),ae.handleOffline(),ae.detectSlowConnection()),window.MobileEnhancements=ae;const ne={themes:{light:{name:"Modo Claro",icon:"fa-sun",class:""},dark:{name:"Modo Oscuro",icon:"fa-moon",class:"dark"},auto:{name:"Autom√°tico",icon:"fa-adjust",class:"auto"}},currentTheme:"auto",systemPreference:null,mediaQuery:null,init(){console.log("üé® Inicializando Theme Manager..."),this.mediaQuery=window.matchMedia("(prefers-color-scheme: dark)"),this.systemPreference=this.mediaQuery.matches?"dark":"light";const e=localStorage.getItem("theme-preference")||"auto";this.currentTheme=e,this.applyTheme(this.currentTheme),this.mediaQuery.addEventListener("change",e=>{this.systemPreference=e.matches?"dark":"light",console.log("üé® Sistema cambi√≥ a:",this.systemPreference),"auto"===this.currentTheme&&this.applyTheme("auto")}),this.setupUI(),console.log("‚úÖ Theme Manager listo:",this.currentTheme)},applyTheme(e){const t=document.documentElement;t.classList.remove("dark","light","auto");let a=e;"auto"===e&&(a=this.systemPreference,t.classList.add("auto")),"dark"===a?t.classList.add("dark"):t.classList.remove("dark"),localStorage.setItem("theme-preference",e),this.currentTheme=e,this.updateThemeColor(a),this.updateThemeIcon(e),window.dispatchEvent(new CustomEvent("themeChanged",{detail:{theme:e,effectiveTheme:a}})),console.log("üé® Tema aplicado:",e,"(efectivo:",a,")")},updateThemeColor(e){let t=document.querySelector('meta[name="theme-color"]');t||(t=document.createElement("meta"),t.name="theme-color",document.head.appendChild(t));t.content={light:"#dc2626",dark:"#111827"}[e]},updateThemeIcon(e){const t=document.getElementById("darkModeIcon");if(!t)return;t.classList.remove("fa-sun","fa-moon","fa-adjust"),t.classList.add(this.themes[e].icon);const a=document.getElementById("themeToggle");a&&(a.title=this.themes[e].name,a.setAttribute("aria-label",this.themes[e].name))},cycleTheme(){const e=["light","dark","auto"],t=e.indexOf(this.currentTheme),a=e[(t+1)%e.length];if(this.applyTheme(a),window.Notifications){const e="dark"===("auto"===a?this.systemPreference:a)?"üåô":"‚òÄÔ∏è";window.Notifications.info(`${e} ${this.themes[a].name}`)}window.MobileEnhancements&&window.MobileEnhancements.vibrate([20])},setupUI(){const e=document.getElementById("themeToggle");if(e){const t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",()=>{this.cycleTheme()})}this.addThemeSelector()},addThemeSelector(){},getEffectiveTheme(){return"auto"===this.currentTheme?this.systemPreference:this.currentTheme},isDarkMode(){return"dark"===this.getEffectiveTheme()},forceTheme(e){if(!this.themes[e])return;const t=document.documentElement;t.classList.remove("dark","light","auto"),"dark"===e&&t.classList.add("dark")},resetTheme(){this.applyTheme(this.currentTheme)}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{ne.init()}):ne.init(),window.ThemeManager=ne;const re={items:[],unsubscribe:null,defaultItems:[{category:"Documentos",name:"Pasaporte",checked:!1,icon:"üõÇ"},{category:"Documentos",name:"Visa (si aplica)",checked:!1,icon:"üìÑ"},{category:"Documentos",name:"Seguro de viaje",checked:!1,icon:"üè•"},{category:"Documentos",name:"Reservas de hotel (impresas)",checked:!1,icon:"üè®"},{category:"Documentos",name:"Boletos de avi√≥n",checked:!1,icon:"‚úàÔ∏è"},{category:"Documentos",name:"JR Pass (si compraste)",checked:!1,icon:"üé´"},{category:"Documentos",name:"Tarjetas de cr√©dito/d√©bito",checked:!1,icon:"üí≥"},{category:"Documentos",name:"Efectivo (yenes)",checked:!1,icon:"üí¥"},{category:"Electr√≥nicos",name:"Tel√©fono m√≥vil",checked:!1,icon:"üì±"},{category:"Electr√≥nicos",name:"Cargador de tel√©fono",checked:!1,icon:"üîå"},{category:"Electr√≥nicos",name:"Power bank",checked:!1,icon:"üîã"},{category:"Electr√≥nicos",name:"Adaptador de enchufe (Tipo A)",checked:!1,icon:"üîå"},{category:"Electr√≥nicos",name:"C√°mara",checked:!1,icon:"üì∑"},{category:"Electr√≥nicos",name:"Auriculares",checked:!1,icon:"üéß"},{category:"Electr√≥nicos",name:"Pocket WiFi / SIM card",checked:!1,icon:"üì°"},{category:"Ropa",name:"Ropa interior (7 d√≠as)",checked:!1,icon:"üëô"},{category:"Ropa",name:"Calcetines (7 pares)",checked:!1,icon:"üß¶"},{category:"Ropa",name:"Camisetas (5-7)",checked:!1,icon:"üëï"},{category:"Ropa",name:"Pantalones (3-4)",checked:!1,icon:"üëñ"},{category:"Ropa",name:"Chaqueta / Abrigo",checked:!1,icon:"üß•"},{category:"Ropa",name:"Zapatos c√≥modos para caminar",checked:!1,icon:"üëü"},{category:"Ropa",name:"Sandalias / Zapatos f√°ciles de quitar",checked:!1,icon:"üë°"},{category:"Ropa",name:"Pijama",checked:!1,icon:"ü©≤"},{category:"Ropa",name:"Ropa deportiva (opcional)",checked:!1,icon:"üëü"},{category:"Higiene",name:"Cepillo y pasta de dientes",checked:!1,icon:"ü™•"},{category:"Higiene",name:"Champ√∫ / Acondicionador",checked:!1,icon:"üß¥"},{category:"Higiene",name:"Jab√≥n / Gel de ducha",checked:!1,icon:"üßº"},{category:"Higiene",name:"Desodorante",checked:!1,icon:"üí®"},{category:"Higiene",name:"Protector solar",checked:!1,icon:"‚òÄÔ∏è"},{category:"Higiene",name:"Medicamentos personales",checked:!1,icon:"üíä"},{category:"Higiene",name:"Toallas sanitarias (para templos)",checked:!1,icon:"üßª"},{category:"Higiene",name:"Mascarillas (cortes√≠a japonesa)",checked:!1,icon:"üò∑"},{category:"Accesorios",name:"Mochila peque√±a / daypack",checked:!1,icon:"üéí"},{category:"Accesorios",name:"Botella de agua reutilizable",checked:!1,icon:"üíß"},{category:"Accesorios",name:"Paraguas plegable",checked:!1,icon:"‚òÇÔ∏è"},{category:"Accesorios",name:"Gafas de sol",checked:!1,icon:"üï∂Ô∏è"},{category:"Accesorios",name:"Gorro / Sombrero",checked:!1,icon:"üé©"},{category:"Accesorios",name:"Bolsas para ropa sucia",checked:!1,icon:"üëú"},{category:"Accesorios",name:"Candado para maleta",checked:!1,icon:"üîí"},{category:"Opcionales",name:"Libro / E-reader",checked:!1,icon:"üìö"},{category:"Opcionales",name:"Cuaderno de viaje",checked:!1,icon:"üìî"},{category:"Opcionales",name:"Snacks para el viaje",checked:!1,icon:"üç™"},{category:"Opcionales",name:"Almohada de viaje",checked:!1,icon:"üõèÔ∏è"},{category:"Opcionales",name:"Tapones para o√≠dos",checked:!1,icon:"üëÇ"},{category:"Opcionales",name:"Antifaz para dormir",checked:!1,icon:"üò¥"}],async init(){console.log("üéí Inicializando Packing List...");const t=localStorage.getItem("packingList");if(t)try{this.items=JSON.parse(t)}catch(a){console.error("Error parsing local packing list:",a),this.items=[...this.defaultItems]}else this.items=[...this.defaultItems];e.currentUser&&await this.initSync(),console.log("‚úÖ Packing List listo con",this.items.length,"items")},async initSync(){if(this.unsubscribe&&this.unsubscribe(),!e.currentUser)return;const t=this.getCurrentTripId(),n=e.currentUser.uid;let i;t?(i=r(a,`trips/${t}/data`,"packing"),console.log("üéí Packing List en modo colaborativo")):(i=r(a,`users/${n}/data`,"packing"),console.log("üéí Packing List en modo individual")),this.unsubscribe=l(i,e=>{if(e.exists()){const t=e.data();this.items=t.items||[...this.defaultItems]}else this.items=[...this.defaultItems];localStorage.setItem("packingList",JSON.stringify(this.items)),this.renderList(),console.log("‚úÖ Packing List sincronizado")},e=>{console.error("‚ùå Error en sync de packing list:",e)})},getCurrentTripId:()=>window.TripsManager&&window.TripsManager.currentTrip?window.TripsManager.currentTrip.id:localStorage.getItem("currentTripId"),renderList(){const e=document.getElementById("packingListContainer");if(!e)return;const t=this.items.reduce((e,t)=>(e[t.category]||(e[t.category]=[]),e[t.category].push(t),e),{}),a=this.items.length,n=this.items.filter(e=>e.checked).length,r=a>0?(n/a*100).toFixed(0):0;e.innerHTML=`\n      <div class="space-y-4">\n        \x3c!-- Progress bar --\x3e\n        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">\n          <div class="flex justify-between items-center mb-3">\n            <h3 class="text-lg font-bold dark:text-white">Progreso de Equipaje</h3>\n            <span class="text-2xl font-bold text-purple-600 dark:text-purple-400">${r}%</span>\n          </div>\n          <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4 overflow-hidden">\n            <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-4 rounded-full transition-all duration-500 flex items-center justify-center text-white text-xs font-bold" style="width: ${r}%">\n              ${n}/${a}\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Categor√≠as --\x3e\n        ${Object.entries(t).map(([e,t])=>{const a=t.filter(e=>e.checked).length,n=t.length,r=n>0?(a/n*100).toFixed(0):0;return`\n            <div class="bg-white dark:bg-gray-800 rounded-xl p-4 shadow-lg">\n              <div class="flex justify-between items-center mb-3">\n                <h4 class="text-md font-bold dark:text-white">${e}</h4>\n                <span class="text-sm font-semibold text-gray-600 dark:text-gray-400">${a}/${n}</span>\n              </div>\n              <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mb-4">\n                <div class="bg-gradient-to-r from-blue-500 to-cyan-500 h-2 rounded-full transition-all duration-300" style="width: ${r}%"></div>\n              </div>\n              <div class="space-y-2">\n                ${t.map((t,a)=>`\n                  <label class="flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer transition ${t.checked?"opacity-60":""}">\n                    <input\n                      type="checkbox"\n                      ${t.checked?"checked":""}\n                      onchange="PackingList.toggleItem('${e}', ${a})"\n                      class="w-5 h-5 text-purple-600 rounded focus:ring-2 focus:ring-purple-500"\n                    >\n                    <span class="text-2xl">${t.icon}</span>\n                    <span class="flex-1 dark:text-white ${t.checked?"line-through":""}">${t.name}</span>\n                  </label>\n                `).join("")}\n              </div>\n            </div>\n          `}).join("")}\n\n        \x3c!-- Botones de acci√≥n --\x3e\n        <div class="flex gap-3 flex-wrap">\n          <button\n            onclick="PackingList.addCustomItem()"\n            class="flex-1 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold py-3 px-6 rounded-lg hover:from-purple-600 hover:to-pink-600 transition"\n          >\n            ‚ûï Agregar Item Personalizado\n          </button>\n          <button\n            onclick="PackingList.resetToDefault()"\n            class="bg-gray-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-gray-600 transition"\n          >\n            üîÑ Restaurar Lista Predeterminada\n          </button>\n        </div>\n      </div>\n    `},async toggleItem(e,t){const a=this.items.filter(t=>t.category===e)[t];a&&(a.checked=!a.checked,await this.saveList(),window.MobileEnhancements&&window.MobileEnhancements.vibrate(a.checked?[30]:[15]))},async addCustomItem(){const e=prompt("Nombre del item:");if(!e||""===e.trim())return;const t=prompt("Categor√≠a (Documentos, Electr√≥nicos, Ropa, Higiene, Accesorios, Opcionales):","Opcionales");if(!t)return;const a=prompt("Emoji (opcional):","üì¶"),n={category:t.trim(),name:e.trim(),icon:a||"üì¶",checked:!1,custom:!0};this.items.push(n),await this.saveList(),window.Notifications&&window.Notifications.success(`‚úÖ "${e}" agregado a la lista`)},async resetToDefault(){confirm("¬øEst√°s seguro de restaurar la lista predeterminada? Se perder√°n tus items personalizados.")&&(this.items=[...this.defaultItems],await this.saveList(),window.Notifications&&window.Notifications.success("üîÑ Lista restaurada"))},async saveList(){if(localStorage.setItem("packingList",JSON.stringify(this.items)),this.renderList(),e.currentUser)try{const t=this.getCurrentTripId(),n=e.currentUser.uid;let o;o=r(a,t?`trips/${t}/data`:`users/${n}/data`,"packing"),await i(o,{items:this.items,lastUpdated:(new Date).toISOString(),updatedBy:e.currentUser.email}),console.log("‚úÖ Packing List guardado")}catch(t){console.error("‚ùå Error guardando packing list:",t)}},reinitialize(){this.initSync()}};window.PackingList=re;const ie={favorites:[],unsubscribe:null,async init(){console.log("‚≠ê Inicializando Favorites Manager...");const t=localStorage.getItem("favorites");if(t)try{this.favorites=JSON.parse(t)}catch(a){console.error("Error parsing favorites:",a),this.favorites=[]}e.currentUser&&await this.initSync(),console.log("‚úÖ Favorites Manager listo con",this.favorites.length,"favoritos")},async initSync(){if(this.unsubscribe&&this.unsubscribe(),!e.currentUser)return;const t=this.getCurrentTripId(),n=e.currentUser.uid;let i;t?(i=r(a,`trips/${t}/data`,"favorites"),console.log("‚≠ê Favoritos en modo colaborativo")):(i=r(a,`users/${n}/data`,"favorites"),console.log("‚≠ê Favoritos en modo individual")),this.unsubscribe=l(i,e=>{e.exists()?this.favorites=e.data().items||[]:this.favorites=[],localStorage.setItem("favorites",JSON.stringify(this.favorites)),this.updateFavoritesUI(),console.log("‚úÖ Favoritos sincronizados:",this.favorites.length)},e=>{console.error("‚ùå Error en sync de favoritos:",e)})},getCurrentTripId:()=>window.TripsManager&&window.TripsManager.currentTrip?window.TripsManager.currentTrip.id:localStorage.getItem("currentTripId"),async addFavorite(t){if(this.favorites.some(e=>e.name===t.name&&e.city===t.city))return void(window.Notifications&&window.Notifications.warning("Ya est√° en favoritos"));const a={id:`fav_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:t.name,city:t.city||"Jap√≥n",category:t.category||"Atracci√≥n",icon:t.icon||"üìç",description:t.description||"",lat:t.lat||null,lng:t.lng||null,addedAt:(new Date).toISOString(),addedBy:e.currentUser?e.currentUser.email:"Usuario local"};this.favorites.push(a),await this.saveFavorites(),window.Notifications&&window.Notifications.success(`‚≠ê ${t.name} agregado a favoritos`),window.MobileEnhancements&&window.MobileEnhancements.vibrate([30,50,30])},async removeFavorite(e){const t=this.favorites.findIndex(t=>t.id===e);if(-1===t)return;const a=this.favorites[t];this.favorites.splice(t,1),await this.saveFavorites(),window.Notifications&&window.Notifications.info(`Removido: ${a.name}`)},isFavorite(e,t){return this.favorites.some(a=>a.name===e&&a.city===t)},async saveFavorites(){if(localStorage.setItem("favorites",JSON.stringify(this.favorites)),this.updateFavoritesUI(),e.currentUser)try{const t=this.getCurrentTripId(),n=e.currentUser.uid;let o;o=r(a,t?`trips/${t}/data`:`users/${n}/data`,"favorites"),await i(o,{items:this.favorites,lastUpdated:(new Date).toISOString(),updatedBy:e.currentUser.email}),console.log("‚úÖ Favoritos guardados")}catch(t){console.error("‚ùå Error guardando favoritos:",t)}},updateFavoritesUI(){this.updateMapFavoriteIcons(),this.updateAttractionsFavoriteIcons();const e=document.getElementById("modal-favorites");e&&e.classList.contains("active")&&this.renderFavoritesList()},updateMapFavoriteIcons(){},updateAttractionsFavoriteIcons(){document.querySelectorAll("[data-attraction-name]").forEach(e=>{const t=e.dataset.attractionName,a=e.dataset.attractionCity;this.isFavorite(t,a)?e.classList.add("is-favorite"):e.classList.remove("is-favorite")})},renderFavoritesList(){const e=document.getElementById("favoritesListContainer");if(!e)return;if(0===this.favorites.length)return void(e.innerHTML='\n        <div class="text-center py-12">\n          <div class="text-6xl mb-4">‚≠ê</div>\n          <p class="text-gray-600 dark:text-gray-400 text-lg mb-2">\n            No tienes favoritos a√∫n\n          </p>\n          <p class="text-gray-500 dark:text-gray-500 text-sm">\n            Agrega lugares desde el mapa o la lista de atracciones\n          </p>\n        </div>\n      ');const t=this.favorites.reduce((e,t)=>(e[t.city]||(e[t.city]=[]),e[t.city].push(t),e),{});e.innerHTML=`\n      <div class="space-y-6">\n        <div class="bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl p-6 text-center">\n          <div class="text-5xl mb-2">‚≠ê</div>\n          <h3 class="text-2xl font-bold mb-1">Mis Favoritos</h3>\n          <p class="text-white/80">${this.favorites.length} lugar${1!==this.favorites.length?"es":""} guardado${1!==this.favorites.length?"s":""}</p>\n        </div>\n\n        ${Object.entries(t).map(([e,t])=>`\n          <div class="bg-white dark:bg-gray-800 rounded-xl p-4 shadow-lg">\n            <h4 class="text-lg font-bold dark:text-white mb-4 flex items-center gap-2">\n              üìç ${e}\n              <span class="text-sm font-normal text-gray-500 dark:text-gray-400">(${t.length})</span>\n            </h4>\n            <div class="space-y-3">\n              ${t.map(e=>`\n                <div class="flex items-center gap-3 p-3 rounded-lg border-2 border-purple-200 dark:border-purple-800 hover:bg-purple-50 dark:hover:bg-purple-900/20 transition group">\n                  <div class="text-3xl">${e.icon}</div>\n                  <div class="flex-1">\n                    <h5 class="font-semibold dark:text-white">${e.name}</h5>\n                    ${e.description?`<p class="text-sm text-gray-600 dark:text-gray-400">${e.description}</p>`:""}\n                    <p class="text-xs text-gray-500 dark:text-gray-500 mt-1">\n                      ${e.category} ‚Ä¢ Agregado ${new Date(e.addedAt).toLocaleDateString("es")}\n                    </p>\n                  </div>\n                  <div class="flex gap-2 opacity-0 group-hover:opacity-100 transition">\n                    ${e.lat&&e.lng?`\n                      <button\n                        onclick="FavoritesManager.showOnMap(${e.lat}, ${e.lng})"\n                        class="bg-blue-500 text-white p-2 rounded-lg hover:bg-blue-600 transition"\n                        title="Ver en mapa"\n                      >\n                        üó∫Ô∏è\n                      </button>\n                    `:""}\n                    <button\n                      onclick="FavoritesManager.addToItinerary('${e.name.replace(/'/g,"\\'")}', '${e.city}')"\n                      class="bg-green-500 text-white p-2 rounded-lg hover:bg-green-600 transition"\n                      title="Agregar al itinerario"\n                    >\n                      ‚ûï\n                    </button>\n                    <button\n                      onclick="FavoritesManager.removeFavorite('${e.id}')"\n                      class="bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition"\n                      title="Remover"\n                    >\n                      üóëÔ∏è\n                    </button>\n                  </div>\n                </div>\n              `).join("")}\n            </div>\n          </div>\n        `).join("")}\n\n        <button\n          onclick="FavoritesManager.exportFavorites()"\n          class="w-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white font-bold py-3 px-6 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition"\n        >\n          üì• Exportar Favoritos (JSON)\n        </button>\n      </div>\n    `},showOnMap(e,t){if(window.AppCore&&window.AppCore.switchTab("map"),window.MapHandler&&window.MapHandler.map){window.MapHandler.map.setView([e,t],15);const a=document.getElementById("modal-favorites");a&&(a.classList.remove("active"),document.body.style.overflow="")}},async addToItinerary(e,t){var a;try{const{ItineraryHandler:t}=await S(async()=>{const{ItineraryHandler:e}=await Promise.resolve().then(()=>J);return{ItineraryHandler:e}},void 0);if(!(null==(a=window.TripsManager)?void 0:a.currentTripId))return void(window.Notifications&&window.Notifications.warning("‚ö†Ô∏è Por favor selecciona un viaje primero"));window.Notifications&&window.Notifications.success(`‚úÖ "${e}" listo para agregar al itinerario`),window.AppCore&&window.AppCore.switchTab("itinerary")}catch(n){console.error("Error agregando al itinerario:",n),window.Notifications&&window.Notifications.error("‚ùå Error al agregar al itinerario")}},exportFavorites(){const e=JSON.stringify(this.favorites,null,2),t=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download=`favoritos-japon-${(new Date).toISOString().split("T")[0]}.json`,n.click(),URL.revokeObjectURL(a),window.Notifications&&window.Notifications.success("üì• Favoritos exportados")},reinitialize(){return this.initSync()},cleanup(){this.unsubscribe&&this.unsubscribe(),this.unsubscribe=null,this.favorites=[],localStorage.removeItem("favorites"),this.updateFavoritesUI(),console.log("[FavoritesManager] üßπ Estado de favoritos limpiado.")}};window.FavoritesManager=ie,window.addEventListener("auth:initialized",()=>ie.initSync()),window.addEventListener("auth:loggedOut",()=>ie.cleanup());const oe={THEME:"theme",CURRENT_TRIP_ID:"currentTripId",SAVED_ATTRACTIONS:"savedAttractions",CHECKED_ACTIVITIES:"checkedActivities",USER_PREFERENCES:"userPreferences",LAST_SYNC:"lastSync"},se=Object.freeze(Object.defineProperty({__proto__:null,FIREBASE_PATHS:{TRIPS:"trips",ITINERARY:e=>`trips/${e}/data/itinerary`,ACTIVITIES:e=>`trips/${e}/activities`,CHECKLIST:e=>`trips/${e}/activities/checklist`,BUDGET:e=>`trips/${e}/budget`},STORAGE_KEYS:oe},Symbol.toStringTag,{value:"Module"})),le={_format:(e,t,a)=>({timestamp:(new Date).toISOString(),level:e,emoji:{info:"‚ÑπÔ∏è",success:"‚úÖ",warn:"‚ö†Ô∏è",error:"‚ùå",debug:"üêõ"}[e]||"üìù",message:t,data:a}),info(e,t=null){const a=this._format("info",e,t);console.log(`${a.emoji} [${a.level.toUpperCase()}] ${a.message}`,t||"")},success(e,t=null){const a=this._format("success",e,t);console.log(`${a.emoji} [${a.level.toUpperCase()}] ${a.message}`,t||"")},warn(e,t=null){const a=this._format("warn",e,t);console.warn(`${a.emoji} [${a.level.toUpperCase()}] ${a.message}`,t||"")},error(e,t=null){const a=this._format("error",e,t);console.error(`${a.emoji} [${a.level.toUpperCase()}] ${a.message}`,t||""),t instanceof Error&&console.error("Stack trace:",t.stack)},debug(e,t=null){}},de={savedAttractions:JSON.parse(localStorage.getItem(oe.SAVED_ATTRACTIONS)||"[]"),currentFilter:"all",searchTerm:"",renderAttractions(){const e=document.getElementById("content-attractions");e&&(e.innerHTML=`\n            <div class="max-w-7xl mx-auto p-4 md:p-6">\n                \x3c!-- Header --\x3e\n                <div class="mb-8">\n                    <h2 class="text-4xl font-bold mb-3 text-gray-800 dark:text-white">üéØ Atracciones de Jap√≥n</h2>\n                    <p class="text-gray-600 dark:text-gray-400 mb-4">\n                        Gu√≠a completa de las mejores atracciones. Marca tus favoritas con ‚≠ê\n                    </p>\n                    \n                    \x3c!-- Stats --\x3e\n                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">\n                        <div class="bg-pink-50 dark:bg-pink-900/20 p-4 rounded-lg border-l-4 border-pink-500">\n                            <p class="text-xs text-gray-600 dark:text-gray-400 mb-1">Guardadas</p>\n                            <p class="text-2xl font-bold text-pink-600 dark:text-pink-400" id="savedCount">0</p>\n                        </div>\n                        <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border-l-4 border-blue-500">\n                            <p class="text-xs text-gray-600 dark:text-gray-400 mb-1">Total</p>\n                            <p class="text-2xl font-bold text-blue-600 dark:text-blue-400">${this.getTotalCount()}</p>\n                        </div>\n                        <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border-l-4 border-green-500">\n                            <p class="text-xs text-gray-600 dark:text-gray-400 mb-1">Gratis</p>\n                            <p class="text-2xl font-bold text-green-600 dark:text-green-400">${this.getFreeCount()}</p>\n                        </div>\n                        <div class="bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border-l-4 border-purple-500">\n                            <p class="text-xs text-gray-600 dark:text-gray-400 mb-1">Categor√≠as</p>\n                            <p class="text-2xl font-bold text-purple-600 dark:text-purple-400">${Object.keys(E).length}</p>\n                        </div>\n                    </div>\n\n                    \x3c!-- üîç Barra de B√∫squeda --\x3e\n                    <div class="mb-4">\n                        <div class="relative">\n                            <input\n                                type="text"\n                                id="attractionSearch"\n                                placeholder="üîç Buscar por nombre, ciudad, categor√≠a o descripci√≥n..."\n                                class="w-full p-3 pl-10 border-2 border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition"\n                                oninput="AttractionsHandler.searchAttractions(this.value)"\n                            >\n                            <svg class="absolute left-3 top-3.5 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>\n                            </svg>\n                        </div>\n                    </div>\n\n                    \x3c!-- Filter Buttons --\x3e\n                    <div class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide mb-6">\n                        <button onclick="AttractionsHandler.filterCategory('all')" class="filter-btn active px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg font-semibold text-sm whitespace-nowrap hover:bg-gray-200 dark:hover:bg-gray-600 transition">\n                            üéØ Todas\n                        </button>\n                        <button onclick="AttractionsHandler.filterCategory('saved')" class="filter-btn px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg font-semibold text-sm whitespace-nowrap hover:bg-gray-200 dark:hover:bg-gray-600 transition">\n                            ‚≠ê Guardadas\n                        </button>\n                        <button onclick="AttractionsHandler.filterCategory('free')" class="filter-btn px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg font-semibold text-sm whitespace-nowrap hover:bg-gray-200 dark:hover:bg-gray-600 transition">\n                            üÜì Gratis\n                        </button>\n                        <button onclick="AttractionsHandler.filterCategory('reservation')" class="filter-btn px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg font-semibold text-sm whitespace-nowrap hover:bg-gray-200 dark:hover:bg-gray-600 transition">\n                            üìÖ Requiere Reserva\n                        </button>\n                    </div>\n\n                    \x3c!-- üî• Advanced Filters --\x3e\n                    <div class="grid md:grid-cols-3 gap-4 mb-6">\n                        \x3c!-- City Filter --\x3e\n                        <div>\n                            <label class="text-xs font-semibold text-gray-600 dark:text-gray-400 mb-2 block">üìç Ciudad</label>\n                            <select\n                                id="cityFilter"\n                                onchange="AttractionsHandler.applyAdvancedFilters()"\n                                class="w-full p-2 border-2 border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-purple-500 text-sm"\n                            >\n                                <option value="all">Todas las ciudades</option>${this.getUniqueCities().map(e=>`<option value="${e}">${e}</option>`).join("")}\n                            </select>\n                        </div>\n\n                        \x3c!-- Price Filter --\x3e\n                        <div>\n                            <label class="text-xs font-semibold text-gray-600 dark:text-gray-400 mb-2 block">üí∞ Precio</label>\n                            <select\n                                id="priceFilter"\n                                onchange="AttractionsHandler.applyAdvancedFilters()"\n                                class="w-full p-2 border-2 border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-purple-500 text-sm"\n                            >\n                                <option value="all">Todos los precios</option>\n                                <option value="free">Gratis</option>\n                                <option value="0-1000">¬•0 - ¬•1,000</option>\n                                <option value="1000-3000">¬•1,000 - ¬•3,000</option>\n                                <option value="3000-plus">¬•3,000+</option>\n                            </select>\n                        </div>\n\n                        \x3c!-- Rating Filter --\x3e\n                        <div>\n                            <label class="text-xs font-semibold text-gray-600 dark:text-gray-400 mb-2 block">‚≠ê Rating m√≠nimo</label>\n                            <select\n                                id="ratingFilter"\n                                onchange="AttractionsHandler.applyAdvancedFilters()"\n                                class="w-full p-2 border-2 border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-purple-500 text-sm"\n                            >\n                                <option value="0">Todos los ratings</option>\n                                <option value="4.5">4.5+ ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>\n                                <option value="4.0">4.0+ ‚≠ê‚≠ê‚≠ê‚≠ê</option>\n                                <option value="3.5">3.5+ ‚≠ê‚≠ê‚≠ê</option>\n                            </select>\n                        </div>\n                    </div>\n\n                    \x3c!-- Clear Filters Button --\x3e\n                    <div class="mb-6">\n                        <button\n                            onclick="AttractionsHandler.clearAllFilters()"\n                            class="w-full md:w-auto px-6 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-semibold text-sm transition"\n                        >\n                            üîÑ Limpiar Filtros\n                        </button>\n                    </div>\n                </div>\n\n                \x3c!-- Categories --\x3e\n                <div class="space-y-8" id="categoriesContainer">\n                    ${this.renderAllCategories()}\n                </div>\n            </div>\n        `,this.updateSavedCount())},renderAllCategories(){return Object.entries(E).map(([e,t])=>this.renderCategory(e,t)).join("")},renderCategory(e,t){return`\n        <div class="category-section bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden" data-category="${e}">\n                \x3c!-- Category Header --\x3e\n                <div class="bg-gradient-to-r ${{pink:"from-pink-500 to-rose-500",orange:"from-orange-500 to-amber-500",purple:"from-purple-500 to-fuchsia-500",blue:"from-blue-500 to-cyan-500",green:"from-green-500 to-emerald-500",emerald:"from-emerald-500 to-teal-500",red:"from-red-500 to-pink-500",indigo:"from-indigo-500 to-purple-500"}[t.color]} p-6 text-white">\n                    <div class="flex items-center gap-3">\n                        <span class="text-4xl">${t.icon}</span>\n                        <div>\n                            <h3 class="text-2xl font-bold">${t.category}</h3>\n                            <p class="text-sm opacity-90">${t.items.length} atracciones</p>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Items Grid --\x3e\n                <div class="p-6">\n                    <div class="grid md:grid-cols-2 gap-4">\n                        ${t.items.map(t=>this.renderAttractionCard(t,e)).join("")}\n                    </div>\n                </div>\n            </div>\n        `},renderAttractionCard(e,t){const a=this.savedAttractions.includes(e.name),n=0===e.price?"GRATIS":`¬•${e.price.toLocaleString()}`,r=e.reserveDays>0;return`\n            <div class="attraction-card bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden hover:shadow-xl transition-all ${a?"border-2 border-yellow-400":"border border-gray-200 dark:border-gray-700"}" data-attraction="${e.name}" data-price="${e.price}" data-reservation="${r}" data-city="${e.city}" data-rating="${e.rating}">\n                \n                \x3c!-- Imagen --\x3e\n                <div class="relative h-40 w-full group">\n                    <img \n                        src="${window.ImageService.getActivityImage(e.id||e.name,t)}" \n                        alt="${e.name}"\n                        class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"\n                        loading="lazy"\n                    >\n                    <div class="absolute top-2 right-2">\n                        <button \n                            onclick="AttractionsHandler.toggleSave('${e.name}')" \n                            class="text-3xl text-white drop-shadow-lg hover:scale-110 transition"\n                            title="${a?"Quitar de guardados":"Guardar"}"\n                        >\n                            ${a?"‚≠ê":"‚òÜ"}\n                        </button>\n                    </div>\n                </div>\n\n                \x3c!-- Contenido --\x3e\n                <div class="p-4">\n                    <h4 class="font-bold text-lg dark:text-white mb-1">${e.name}</h4>\n                    <p class="text-xs text-gray-500 dark:text-gray-400 flex items-center gap-1 mb-3">\n                        üìç ${e.city}\n                    </p>\n\n                    <p class="text-sm text-gray-600 dark:text-gray-300 mb-4 line-clamp-2 h-10">\n                        ${e.description}\n                    </p>\n\n                    \x3c!-- Info Tags --\x3e\n                    <div class="flex flex-wrap gap-2 mb-4">\n                        <span class="text-xs px-2 py-1 rounded-full font-semibold ${0===e.price?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400"}">üí∞ ${n}\n                        </span>\n                        <span class="text-xs px-2 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400 rounded-full font-semibold">\n                            ‚è±Ô∏è ${e.duration}\n                        </span>\n                        <span class="text-xs px-2 py-1 bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400 rounded-full font-semibold">\n                            ‚≠ê ${e.rating}/5\n                        </span>\n                    </div>\n\n                    ${r?`\n                        <div class="bg-red-50 dark:bg-red-900/30 border-l-4 border-red-500 p-3 rounded mb-4">\n                            <p class="text-xs font-semibold text-red-700 dark:text-red-400">\n                                ‚ö†Ô∏è Reservar ${e.reserveDays} d√≠as antes\n                            </p>\n                        </div>\n                    `:""}\n\n                    ${e.tips?`\n                        <div class="bg-yellow-50 dark:bg-yellow-900/20 p-2 rounded mb-4">\n                            <p class="text-xs text-gray-700 dark:text-gray-300">\n                                üí° <strong>Tip:</strong> ${e.tips}\n                            </p>\n                        </div>\n                    `:""}\n\n                    \x3c!-- Actions --\x3e\n                    <div class="flex gap-2">\n                        <button \n                            onclick="AttractionsHandler.addToItinerary('${e.name.replace(/'/g,"\\'")}')"\n                            class="flex-1 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-center py-2 px-4 rounded-lg hover:from-purple-600 hover:to-pink-600 transition text-sm font-semibold"\n                            title="A√±adir al itinerario"\n                        >\n                            ‚ûï Itinerario\n                        </button>\n                        ${e.reservationUrl?`\n                            <a href="${e.reservationUrl}" target="_blank" class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white text-center py-2 px-4 rounded-lg hover:from-blue-600 hover:to-blue-700 transition text-sm font-semibold">\n                                üìÖ Reservar\n                            </a>\n                        `:""}\n                        <a href="https://www.google.com/maps/search/${encodeURIComponent(e.name+" "+e.city)}" target="_blank" class="bg-green-500 text-white py-2 px-4 rounded-lg hover:bg-green-600 transition text-sm font-semibold">\n                            üó∫Ô∏è\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `},filterCategory(e){document.querySelectorAll(".filter-btn").forEach(e=>e.classList.remove("active")),event.target.classList.add("active");const t=document.querySelectorAll(".attraction-card"),a=document.querySelectorAll(".category-section");"all"===e?(t.forEach(e=>e.style.display="block"),a.forEach(e=>e.style.display="block")):"saved"===e?a.forEach(e=>{const t=Array.from(e.querySelectorAll(".attraction-card")).filter(e=>{const t=this.savedAttractions.includes(e.dataset.attraction);return e.style.display=t?"block":"none",t});e.style.display=t.length>0?"block":"none"}):"free"===e?a.forEach(e=>{const t=Array.from(e.querySelectorAll(".attraction-card")).filter(e=>{const t="0"===e.dataset.price;return e.style.display=t?"block":"none",t});e.style.display=t.length>0?"block":"none"}):"reservation"===e&&a.forEach(e=>{const t=Array.from(e.querySelectorAll(".attraction-card")).filter(e=>{const t="true"===e.dataset.reservation;return e.style.display=t?"block":"none",t});e.style.display=t.length>0?"block":"none"})},updateSavedCount(){const e=document.getElementById("savedCount");e&&(e.textContent=this.savedAttractions.length)},getTotalCount:()=>Object.values(E).reduce((e,t)=>e+t.items.length,0),getFreeCount:()=>Object.values(E).reduce((e,t)=>e+t.items.filter(e=>0===e.price).length,0),async addToItinerary(e){let t=null;for(const a of Object.values(E))if(t=a.items.find(t=>t.name===e),t)break;t?window.ItineraryHandler?this.showDaySelectionModal(t):alert("‚ö†Ô∏è El m√≥dulo de itinerario no est√° disponible"):alert("‚ö†Ô∏è No se encontr√≥ la atracci√≥n")},async showDaySelectionModal(e){try{if(!window.ItineraryHandler)return console.error("ItineraryHandler no disponible"),void(window.Notifications?window.Notifications.warning("‚ö†Ô∏è El m√≥dulo de itinerario no est√° disponible"):alert("‚ö†Ô∏è El m√≥dulo de itinerario no est√° disponible"));let e=window.ItineraryHandler.currentItinerary;if(!e||!e.days||0===e.days.length){const t=localStorage.getItem("currentTripId");if(t&&"function"==typeof window.ItineraryHandler.loadItinerary)try{await window.ItineraryHandler.loadItinerary(t),e=window.ItineraryHandler.currentItinerary}catch(r){console.error("Error cargando itinerario:",r)}}if(!e||!e.days||!Array.isArray(e.days)||0===e.days.length)return void(window.Notifications?window.Notifications.warning("‚ö†Ô∏è Primero debes crear d√≠as en tu itinerario. Ve a la secci√≥n de Itinerario y a√±ade d√≠as a tu viaje."):alert("‚ö†Ô∏è Primero debes crear d√≠as en tu itinerario. Ve a la secci√≥n de Itinerario y a√±ade d√≠as a tu viaje."))}catch(i){return console.error("Error en showDaySelectionModal:",i),void(window.Notifications?window.Notifications.error("‚ùå Error al cargar el itinerario"):alert("‚ùå Error al cargar el itinerario"))}const t=window.ItineraryHandler.currentItinerary,a=`\n            <div id="daySelectionModal" class="modal active" style="z-index: 10000;">\n                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-md w-full p-6">\n                    <div class="mb-4">\n                        <h2 class="text-2xl font-bold dark:text-white mb-2">‚ûï A√±adir al Itinerario</h2>\n                        <p class="text-sm text-gray-600 dark:text-gray-400">\n                            <strong>${e.name}</strong><br>\n                            ${e.city} ‚Ä¢ ${0===e.price?"GRATIS":"¬•"+e.price.toLocaleString()}\n                        </p>\n                    </div>\n\n                    <div class="mb-6">\n                        <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-3">\n                            Selecciona el d√≠a:\n                        </label>\n                        <div class="grid grid-cols-3 gap-2 max-h-64 overflow-y-auto">\n                            ${t.days.map(t=>`\n                                <button \n                                    onclick="AttractionsHandler.addAttractionToDay(${t.day}, '${e.name.replace(/'/g,"\\'")}')"\n                                    class="p-3 bg-gray-100 dark:bg-gray-700 hover:bg-purple-100 dark:hover:bg-purple-900/30 rounded-lg transition text-center"\n                                >\n                                    <div class="text-xs text-gray-500 dark:text-gray-400">D√≠a</div>\n                                    <div class="text-xl font-bold dark:text-white">${t.day}</div>\n                                    <div class="text-xs text-gray-600 dark:text-gray-400">${t.title}</div>\n                                </button>\n                            `).join("")}\n                        </div>\n                    </div>\n\n                    <button \n                        onclick="AttractionsHandler.closeDaySelectionModal()"\n                        class="w-full bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-white py-2 rounded-lg hover:bg-gray-400 dark:hover:bg-gray-500 transition font-semibold"\n                    >\n                        Cancelar\n                    </button>\n                </div>\n            </div>\n        `,n=document.getElementById("daySelectionModal");n&&n.remove(),document.body.insertAdjacentHTML("beforeend",a),document.body.style.overflow="hidden"},async addAttractionToDay(e,t){let a=null;for(const r of Object.values(E))if(a=r.items.find(e=>e.name===t),a)break;if(!a)return;const n={id:`${Date.now()}_${Math.random().toString(36).substr(2,9)}`,icon:this.getCategoryIcon(a),time:"Por definir",title:a.name,desc:a.description,cost:a.price,station:a.city,rating:a.rating,duration:a.duration};if(window.ItineraryHandler){document.getElementById("activityModal")&&(document.getElementById("activityDay").value=e,document.getElementById("activityIcon").value=n.icon,document.getElementById("activityTime").value=n.time,document.getElementById("activityTitle").value=n.title,document.getElementById("activityDesc").value=n.desc,document.getElementById("activityCost").value=n.cost,document.getElementById("activityStation").value=n.station,await window.ItineraryHandler.saveActivity(),this.closeDaySelectionModal(),window.Notifications&&window.Notifications.success(`‚úÖ "${a.name}" a√±adido al D√≠a ${e}!`),setTimeout(()=>{const e=document.querySelector('[data-tab="itinerary"]');e&&e.click()},500))}},closeDaySelectionModal(){const e=document.getElementById("daySelectionModal");e&&(e.remove(),document.body.style.overflow="")},getCategoryIcon(e){const t=e.name.toLowerCase(),a=e.description.toLowerCase();return t.includes("ramen")||a.includes("ramen")?"üçú":t.includes("sushi")||a.includes("sushi")?"üç£":t.includes("cafe")||a.includes("caf√©")?"‚òï":t.includes("restaurant")||a.includes("restaurant")?"üç¥":t.includes("izakaya")||a.includes("izakaya")?"üçª":t.includes("temple")||t.includes("shrine")||a.includes("temple")?"‚õ©Ô∏è":t.includes("castle")||a.includes("castle")?"üèØ":t.includes("museum")||a.includes("museum")?"üèõÔ∏è":t.includes("park")||t.includes("garden")?"üå≥":t.includes("tower")||t.includes("sky")?"üåÜ":t.includes("market")||a.includes("market")?"üè™":t.includes("disney")||t.includes("universal")?"üé¢":t.includes("aquarium")||a.includes("aquarium")?"üêã":t.includes("arcade")||a.includes("arcade")?"üéÆ":"üéØ"},searchAttractions(e){this._searchTimeout&&clearTimeout(this._searchTimeout),this._searchTimeout=setTimeout(()=>{try{const t=e.toLowerCase().trim();de.searchTerm=t;const a=document.querySelectorAll(".attraction-card"),n=document.querySelectorAll(".category-section");if(!t)return a.forEach(e=>e.style.display="block"),n.forEach(e=>e.style.display="block"),void le.info("B√∫squeda limpiada, mostrando todas las atracciones");let r=0;const i=new Map;Object.entries(E).forEach(([e,t])=>{t.items.forEach(e=>{i.set(e.name,{name:e.name.toLowerCase(),city:e.city.toLowerCase(),description:e.description.toLowerCase(),tips:(e.tips||"").toLowerCase(),category:t.category.toLowerCase()})})}),n.forEach(e=>{const a=Array.from(e.querySelectorAll(".attraction-card")).filter(e=>{const a=e.dataset.attraction,n=i.get(a);if(!n)return e.style.display="none",!1;const r=n.name.includes(t)||n.city.includes(t)||n.description.includes(t)||n.tips.includes(t)||n.category.includes(t);return e.style.display=r?"block":"none",r});r+=a.length,e.style.display=a.length>0?"block":"none"}),le.info(`B√∫squeda completada: "${t}" - ${r} resultados`),document.querySelectorAll(".filter-btn").forEach(e=>e.classList.remove("active"));const o=document.querySelector(".filter-btn");o&&o.classList.add("active")}catch(t){le.error("Error en b√∫squeda de atracciones",t)}},300)},toggleSave(e){try{const t=this.savedAttractions.indexOf(e);t>-1?(this.savedAttractions.splice(t,1),le.info(`Atracci√≥n removida de favoritos: ${e}`)):(this.savedAttractions.push(e),le.success(`Atracci√≥n agregada a favoritos: ${e}`)),localStorage.setItem(oe.SAVED_ATTRACTIONS,JSON.stringify(this.savedAttractions)),this.renderAttractions()}catch(t){le.error("Error al guardar atracci√≥n",t),window.Notifications&&window.Notifications.error("Error al guardar la atracci√≥n")}},getUniqueCities(){const e=new Set;return Object.values(E).forEach(t=>{t.items.forEach(t=>e.add(t.city))}),Array.from(e).sort()},applyAdvancedFilters(){var e,t,a;try{const n=(null==(e=document.getElementById("cityFilter"))?void 0:e.value)||"all",r=(null==(t=document.getElementById("priceFilter"))?void 0:t.value)||"all",i=parseFloat((null==(a=document.getElementById("ratingFilter"))?void 0:a.value)||"0");document.querySelectorAll(".attraction-card");document.querySelectorAll(".category-section").forEach(e=>{const t=Array.from(e.querySelectorAll(".attraction-card")).filter(e=>{const t=e.dataset.city||"",a=parseFloat(e.dataset.price||"0"),o=parseFloat(e.dataset.rating||"0");let s=!0;"free"===r?s=0===a:"0-1000"===r?s=a>=0&&a<=1e3:"1000-3000"===r?s=a>1e3&&a<=3e3:"3000-plus"===r&&(s=a>3e3);const l=("all"===n||t===n)&&s&&o>=i;return e.style.display=l?"block":"none",l});e.style.display=t.length>0?"block":"none"}),document.querySelectorAll(".filter-btn").forEach(e=>e.classList.remove("active"));const o=document.querySelector(".filter-btn");o&&o.classList.add("active"),le.info(`Filtros aplicados - Ciudad: ${n}, Precio: ${r}, Rating: ${i}`)}catch(n){le.error("Error aplicando filtros avanzados",n)}},clearAllFilters(){try{const e=document.getElementById("cityFilter"),t=document.getElementById("priceFilter"),a=document.getElementById("ratingFilter"),n=document.getElementById("attractionSearch");e&&(e.value="all"),t&&(t.value="all"),a&&(a.value="0"),n&&(n.value=""),this.searchTerm="";const r=document.querySelectorAll(".attraction-card"),i=document.querySelectorAll(".category-section");r.forEach(e=>e.style.display="block"),i.forEach(e=>e.style.display="block"),document.querySelectorAll(".filter-btn").forEach(e=>e.classList.remove("active"));const o=document.querySelector(".filter-btn");o&&o.classList.add("active"),le.info("Todos los filtros limpiados")}catch(e){le.error("Error limpiando filtros",e)}}};window.AttractionsHandler=de;const ce={init(){this.renderPreparation(),this.initRealtimeSync()},packingList:{documents:[],clothing:[],electronics:[],health:[],money:[],misc:[]},unsubscribe:null,getCurrentTripId:()=>window.TripsManager&&window.TripsManager.currentTrip?window.TripsManager.currentTrip.id:localStorage.getItem("currentTripId"),async initRealtimeSync(){if(this.unsubscribe&&this.unsubscribe(),!e.currentUser){const e=localStorage.getItem("packingList");return e?this.packingList=JSON.parse(e):this.initializeDefaultPackingList(),void this.renderPreparation()}const t=this.getCurrentTripId(),n=e.currentUser.uid;if(!t){console.log("‚ö†Ô∏è Packing: No hay trip seleccionado, usando modo individual");const e=r(a,`users/${n}/packing`,"list");return void(this.unsubscribe=l(e,e=>{e.exists()?this.packingList=e.data().items||this.getDefaultPackingList():this.initializeDefaultPackingList(),localStorage.setItem("packingList",JSON.stringify(this.packingList)),this.renderPreparation(),console.log("‚úÖ Packing list (individual) sincronizado")},e=>{console.error("‚ùå Error en sync de packing list:",e);const t=localStorage.getItem("packingList");this.packingList=t?JSON.parse(t):this.getDefaultPackingList(),this.renderPreparation()}))}console.log("ü§ù Packing: Modo colaborativo activado para trip:",t);const i=r(a,`trips/${t}/data`,"packing");this.unsubscribe=l(i,e=>{e.exists()?this.packingList=e.data().items||this.getDefaultPackingList():this.initializeDefaultPackingList(),localStorage.setItem("packingList",JSON.stringify(this.packingList)),this.renderPreparation(),console.log("‚úÖ Packing list COMPARTIDO sincronizado")},e=>{console.error("‚ùå Error en sync de packing list compartido:",e);const t=localStorage.getItem("packingList");this.packingList=t?JSON.parse(t):this.getDefaultPackingList(),this.renderPreparation()})},initializeDefaultPackingList(){const e=this.getDefaultPackingList();Object.keys(e).forEach(t=>{this.packingList[t]&&0!==this.packingList[t].length||(this.packingList[t]=e[t])})},getDefaultPackingList(){const e={documents:["Pasaporte (v√°lido 6+ meses)","Visa (si aplica)","JR Pass voucher","Seguro de viaje","Reservas de hotel","Boletos de avi√≥n"],clothing:["Abrigo/chamarra","Su√©teres (3-4)","Camisetas (5-6)","Pantalones (3-4)","Ropa interior","Calcetines","Zapatos c√≥modos","Pijama"],electronics:["Celular + cargador","Adaptador Type A (100V)","Power bank","C√°mara (opcional)","Aud√≠fonos","Cable USB"],health:["Medicamentos personales","Analg√©sicos","Medicina para est√≥mago","Banditas","Desinfectante de manos","Mascarillas"],money:["Tarjetas de cr√©dito (2)","Efectivo (¬•20,000-30,000)","Suica/Pasmo card","Copias de tarjetas"],misc:["Mochila peque√±a","Botella de agua","Paraguas","Bolsas ziplock","Snacks","Gu√≠a de conversaci√≥n"]},t={};return Object.keys(e).forEach(a=>{t[a]=e[a].map(e=>({name:e,checked:!1,isDefault:!0}))}),t},renderPreparation(){const t=document.getElementById("content-preparation");if(!t)return;const a=this.getTotalItems(),n=this.getCheckedItems(),r=a>0?n/a*100:0,i=this.getCurrentTripId();let o;o=e.currentUser?i?'<span class="text-green-600 dark:text-green-400">ü§ù Modo Colaborativo</span>':'<span class="text-blue-600 dark:text-blue-400">‚òÅÔ∏è Sincronizado</span>':'<span class="text-yellow-600 dark:text-yellow-400">üì± Solo local</span>',t.innerHTML=`\n            <div class="max-w-6xl mx-auto p-4 md:p-6">\n                <h2 class="text-4xl font-bold mb-6 text-gray-800 dark:text-white">üì¶ Preparaci√≥n del Viaje</h2>\n\n                \x3c!-- Progress Overview --\x3e\n                <div class="bg-gradient-to-r ${100===r?"from-green-500 to-emerald-500 animate-pulse":"from-blue-500 to-purple-500"} text-white rounded-xl p-6 mb-6 shadow-lg transition-all duration-500">\n                    <div class="flex justify-between items-center mb-4">\n                        <div>\n                            <h3 class="text-2xl font-bold">${100===r?"¬°Todo Listo! üéä":"¬øListo para Jap√≥n?"}</h3>\n                            <p class="text-sm opacity-90">${n} de ${a} items completados</p>\n                            ${100===r?'<p class="text-xs mt-1 font-bold">¬°Excelente preparaci√≥n! Ya puedes viajar tranquilo.</p>':""}\n                            <p class="text-xs mt-1">${o}</p>\n                        </div>\n                        <div class="text-5xl ${100===r?"animate-bounce":""}">${100===r?"üéâ":r>75?"üõ´":r>50?"üì¶":r>25?"üìù":"‚úàÔ∏è"}</div>\n                    </div>\n                    <div class="w-full bg-white/30 rounded-full h-4 overflow-hidden">\n                        <div class="bg-white h-4 rounded-full transition-all duration-500 ${100===r?"animate-pulse":""}" style="width: ${r}%"></div>\n                    </div>\n                    <div class="flex justify-between items-center mt-2">\n                        <p class="text-sm opacity-90">${r.toFixed(0)}% completo</p>\n                        ${100===r?'<p class="text-sm font-bold">üåü ¬°Perfecto!</p>':r>75?'<p class="text-sm">¬°Casi listo! üí™</p>':r>50?'<p class="text-sm">Vas muy bien üëç</p>':""}\n                    </div>\n                </div>\n\n                <div class="grid lg:grid-cols-2 gap-6">\n                    \x3c!-- Packing Checklist --\x3e\n                    <div class="space-y-6">\n                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">\n                            <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-white">üìã Checklist de Equipaje</h3>\n                            ${this.renderPackingSection()}\n                        </div>\n                    </div>\n\n                    \x3c!-- Guides Column --\x3e\n                    <div class="space-y-6">\n                        \x3c!-- JR Pass Guide --\x3e\n                        ${this.renderJRPassGuide()}\n                        \n                        \x3c!-- Essential Apps --\x3e\n                        ${this.renderEssentialApps()}\n                        \n                        \x3c!-- Emergency Info --\x3e\n                        ${this.renderEmergencyInfo()}\n                    </div>\n                </div>\n            </div>\n        `,this.attachEventListeners()},renderPackingSection(){return`\n            <div class="space-y-4">\n                ${Object.entries({documents:{name:"Documentos üìÑ",icon:"üìÑ",color:"red"},clothing:{name:"Ropa üëî",icon:"üëî",color:"blue"},electronics:{name:"Electr√≥nica üîå",icon:"üîå",color:"yellow"},health:{name:"Salud üíä",icon:"üíä",color:"green"},money:{name:"Dinero üí∞",icon:"üí∞",color:"purple"},misc:{name:"Otros üéí",icon:"üéí",color:"gray"}}).map(([e,t])=>{const a=this.packingList[e]||[],n=a.filter(e=>e.checked).length,r=a.length,i=r>0?n/r*100:0;return`\n                        <div class="border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden">\n                            <button \n                                class="w-full p-4 bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 transition flex items-center justify-between category-toggle-btn"\n                                data-category="${e}"\n                            >\n                                <div class="flex items-center gap-3">\n                                    <span class="text-2xl">${t.icon}</span>\n                                    <div class="text-left">\n                                        <p class="font-bold dark:text-white">${t.name}</p>\n                                        <p class="text-xs text-gray-500 dark:text-gray-400">${n}/${r} completados</p>\n                                    </div>\n                                </div>\n                                <div class="flex items-center gap-2">\n                                    <div class="w-24 h-2 bg-gray-200 dark:bg-gray-600 rounded-full">\n                                        <div class="h-2 bg-${t.color}-500 rounded-full transition-all" style="width: ${i}%"></div>\n                                    </div>\n                                    <span class="text-gray-400 category-arrow" data-category="${e}">‚ñº</span>\n                                </div>\n                            </button>\n                            <div class="category-content hidden p-4 space-y-2 bg-white dark:bg-gray-800" data-category="${e}">\n                                ${a.map((a,n)=>`\n                                    <div class="flex items-center gap-2 p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded group ${a.checked?"opacity-50":""}">\n                                        <input\n                                            type="checkbox"\n                                            ${a.checked?"checked":""}\n                                            class="packing-checkbox w-5 h-5 accent-${t.color}-500 cursor-pointer"\n                                            data-category="${e}"\n                                            data-index="${n}"\n                                        >\n                                        <span class="flex-1 dark:text-gray-300 ${a.checked?"line-through":""}">${a.name}</span>\n                                        ${a.isDefault?"":`\n                                            <button\n                                                class="text-red-500 hover:text-red-700 opacity-0 group-hover:opacity-100 transition text-sm delete-item-btn"\n                                                data-category="${e}"\n                                                data-index="${n}"\n                                                title="Eliminar"\n                                            >üóëÔ∏è</button>\n                                        `}\n                                    </div>\n                                `).join("")}\n                                \x3c!-- Add Item Button --\x3e\n                                <button\n                                    class="w-full mt-2 p-2 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg text-gray-500 dark:text-gray-400 hover:border-${t.color}-500 hover:text-${t.color}-600 dark:hover:text-${t.color}-400 transition add-item-btn"\n                                    data-category="${e}"\n                                >\n                                    + Agregar item personalizado\n                                </button>\n                            </div>\n                        </div>\n                    `}).join("")}\n            </div>\n        `},renderJRPassGuide:()=>'\n            <div class="bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-xl shadow-lg p-6">\n                <h3 class="text-2xl font-bold mb-4 flex items-center gap-2">\n                    üöÜ Gu√≠a del JR Pass\n                </h3>\n                <div class="space-y-3 text-sm">\n                    <div class="bg-white/20 rounded-lg p-3 backdrop-blur-sm">\n                        <p class="font-bold mb-1">¬øQu√© es?</p>\n                        <p class="text-xs opacity-90">Pase ilimitado para todos los trenes JR (incluyendo Shinkansen) por 7, 14 o 21 d√≠as.</p>\n                    </div>\n                    <div class="bg-white/20 rounded-lg p-3 backdrop-blur-sm">\n                        <p class="font-bold mb-1">üí∞ Precio: ~$280 USD (7 d√≠as)</p>\n                        <p class="text-xs opacity-90">Tu ahorro estimado: <strong>$520+</strong></p>\n                    </div>\n                    <div class="bg-white/20 rounded-lg p-3 backdrop-blur-sm">\n                        <p class="font-bold mb-1">‚ö†Ô∏è MUY IMPORTANTE:</p>\n                        <ul class="text-xs space-y-1 opacity-90">\n                            <li>‚Ä¢ Comprar ANTES de llegar a Jap√≥n</li>\n                            <li>‚Ä¢ Activar en aeropuerto Narita</li>\n                            <li>‚Ä¢ Mostrar pass en gates, NO m√°quinas</li>\n                            <li>‚Ä¢ NO cubre metros ni trenes privados</li>\n                        </ul>\n                    </div>\n                    <a href="https://www.jrpass.com/" target="_blank" class="block w-full bg-white text-green-600 py-2 rounded-lg font-bold text-center hover:bg-gray-100 transition">\n                        üåê Comprar JR Pass\n                    </a>\n                </div>\n            </div>\n        ',renderEssentialApps:()=>`\n            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">\n                <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-white">üì± Apps Esenciales</h3>\n                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Descargar ANTES del viaje:</p>\n                <div class="space-y-2">\n                    ${[{name:"Google Maps",icon:"üó∫Ô∏è",desc:"Navegaci√≥n + offline",link:"https://maps.google.com"},{name:"Google Translate",icon:"üó£Ô∏è",desc:"C√°mara para men√∫s",link:"https://translate.google.com"},{name:"Hyperdia",icon:"üöÜ",desc:"Horarios de trenes",link:"https://www.hyperdia.com/en/"},{name:"Japan Official Travel",icon:"üáØüáµ",desc:"Gu√≠a oficial",link:"https://www.jnto.go.jp/smartapp/eng/"},{name:"XE Currency",icon:"üí±",desc:"Conversor offline",link:"https://www.xe.com/apps/"}].map(e=>`\n                        <a href="${e.link}" target="_blank" class="flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition">\n                            <span class="text-2xl">${e.icon}</span>\n                            <div class="flex-1">\n                                <p class="font-semibold dark:text-white">${e.name}</p>\n                                <p class="text-xs text-gray-500 dark:text-gray-400">${e.desc}</p>\n                            </div>\n                            <span class="text-gray-400">‚Üí</span>\n                        </a>\n                    `).join("")}\n                </div>\n            </div>\n        `,renderEmergencyInfo:()=>'\n            <div class="bg-red-50 dark:bg-red-900/20 rounded-xl shadow-lg p-6 border-l-4 border-red-500">\n                <h3 class="text-2xl font-bold mb-4 text-red-600 dark:text-red-400">üö® Info de Emergencia</h3>\n                <div class="space-y-3 text-sm">\n                    <div>\n                        <p class="font-bold text-gray-800 dark:text-white mb-1">Jap√≥n:</p>\n                        <div class="space-y-1">\n                            <a href="tel:110" class="flex justify-between items-center p-2 bg-white dark:bg-gray-800 rounded hover:bg-gray-100 dark:hover:bg-gray-700">\n                                <span class="dark:text-gray-300">üöì Polic√≠a</span>\n                                <span class="font-bold text-red-600 dark:text-red-400">110</span>\n                            </a>\n                            <a href="tel:119" class="flex justify-between items-center p-2 bg-white dark:bg-gray-800 rounded hover:bg-gray-100 dark:hover:bg-gray-700">\n                                <span class="dark:text-gray-300">üöë Ambulancia</span>\n                                <span class="font-bold text-red-600 dark:text-red-400">119</span>\n                            </a>\n                        </div>\n                    </div>\n                    <div>\n                        <p class="font-bold text-gray-800 dark:text-white mb-1">Embajada CR:</p>\n                        <a href="tel:+81-3-3486-1812" class="flex justify-between items-center p-2 bg-white dark:bg-gray-800 rounded hover:bg-gray-100 dark:hover:bg-gray-700">\n                            <span class="dark:text-gray-300">üìû Contacto</span>\n                            <span class="font-bold text-blue-600 dark:text-blue-400">+81-3-3486-1812</span>\n                        </a>\n                    </div>\n                    <div>\n                        <p class="font-bold text-gray-800 dark:text-white mb-1">üíä Farmacias 24/7:</p>\n                        <div class="text-xs text-gray-600 dark:text-gray-400 space-y-1">\n                            <p>‚Ä¢ Matsumoto Kiyoshi (grandes ciudades)</p>\n                            <p>‚Ä¢ Sundrug (m√∫ltiples ubicaciones)</p>\n                            <p>‚Ä¢ Palabra clave: "Ëñ¨Â±Ä" (Yakkyoku)</p>\n                        </div>\n                    </div>\n                    <div>\n                        <p class="font-bold text-gray-800 dark:text-white mb-1">üèß ATMs 24/7:</p>\n                        <div class="text-xs text-gray-600 dark:text-gray-400 space-y-1">\n                            <p>‚Ä¢ 7-Eleven (acepta tarjetas extranjeras)</p>\n                            <p>‚Ä¢ FamilyMart, Lawson</p>\n                            <p>‚Ä¢ Japan Post Bank</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        ',toggleCategory(e){const t=document.querySelector(`.category-content[data-category="${e}"]`),a=document.querySelector(`.category-arrow[data-category="${e}"]`);t&&a&&(t.classList.contains("hidden")?(t.classList.remove("hidden"),a.textContent="‚ñ≤"):(t.classList.add("hidden"),a.textContent="‚ñº"))},async toggleItem(t,n){if(this.packingList[t]&&this.packingList[t][n]){this.packingList[t][n].checked=!this.packingList[t][n].checked;try{if(!e.currentUser)return localStorage.setItem("packingList",JSON.stringify(this.packingList)),void this.renderPreparation();const t=this.getCurrentTripId();if(t){const n=r(a,`trips/${t}/data`,"packing");await i(n,{items:this.packingList,lastUpdated:(new Date).toISOString(),updatedBy:e.currentUser.email}),console.log("‚úÖ Packing list sincronizado (COMPARTIDO) por:",e.currentUser.email)}else{const t=e.currentUser.uid,n=r(a,`users/${t}/packing`,"list");await i(n,{items:this.packingList,lastUpdated:(new Date).toISOString(),updatedBy:e.currentUser.email}),console.log("‚úÖ Packing list sincronizado (individual)")}}catch(o){console.error("‚ùå Error guardando packing list:",o),this.packingList[t][n].checked=!this.packingList[t][n].checked,this.renderPreparation(),window.Notifications.error("Error al sincronizar. Intenta de nuevo.")}}},getTotalItems(){return Object.values(this.packingList).reduce((e,t)=>e+t.length,0)},getCheckedItems(){return Object.values(this.packingList).reduce((e,t)=>e+t.filter(e=>e.checked).length,0)},async addCustomItem(e){const t=await window.Dialogs.prompt({title:"‚ûï Agregar Item Personalizado",message:`Ingresa el nombre del item para la categor√≠a "${e}".`,placeholder:"Ej: Bater√≠a extra"});t&&(this.packingList[e]||(this.packingList[e]=[]),this.packingList[e].push({name:t.trim(),checked:!1,isDefault:!1}),await this.savePackingList("Item agregado"))},async deleteCustomItem(e,t){await window.Dialogs.confirm({title:"üóëÔ∏è ¬øEliminar Item?",message:"Esta acci√≥n no se puede deshacer. ¬øEst√°s seguro?",okText:"S√≠, eliminar",isDestructive:!0})&&this.packingList[e]&&this.packingList[e][t]&&(this.packingList[e].splice(t,1),await this.savePackingList("Item eliminado"))},async savePackingList(t="Lista guardada"){try{if(!e.currentUser)return localStorage.setItem("packingList",JSON.stringify(this.packingList)),void this.renderPreparation();const n=this.getCurrentTripId();if(n){const t=r(a,`trips/${n}/data`,"packing");await i(t,{items:this.packingList,lastUpdated:(new Date).toISOString(),updatedBy:e.currentUser.email})}else{const t=e.currentUser.uid,n=r(a,`users/${t}/packing`,"list");await i(n,{items:this.packingList,lastUpdated:(new Date).toISOString(),updatedBy:e.currentUser.email})}console.log("‚úÖ",t)}catch(n){console.error("‚ùå Error guardando packing list:",n),window.Notifications.error("Error al guardar. Intenta de nuevo.")}},attachEventListeners(){document.querySelectorAll(".category-toggle-btn").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault();const t=e.currentTarget.dataset.category;this.toggleCategory(t)})}),document.querySelectorAll(".packing-checkbox").forEach(e=>{e.addEventListener("change",e=>{const t=e.target.dataset.category,a=parseInt(e.target.dataset.index);this.toggleItem(t,a)})}),document.querySelectorAll(".add-item-btn").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault();const t=e.currentTarget.dataset.category;this.addCustomItem(t)})}),document.querySelectorAll(".delete-item-btn").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget.dataset.category,a=parseInt(e.currentTarget.dataset.index);this.deleteCustomItem(t,a)})})},reinitialize(){this.initRealtimeSync()},cleanup(){this.unsubscribe&&this.unsubscribe(),this.unsubscribe=null,this.packingList=this.getDefaultPackingList(),localStorage.removeItem("packingList"),this.renderPreparation(),console.log("[PreparationHandler] üßπ Estado de preparaci√≥n limpiado.")}};window.PreparationHandler=ce,window.addEventListener("auth:initialized",()=>ce.initRealtimeSync()),window.addEventListener("auth:loggedOut",()=>ce.cleanup());const ue={yourRoutes:[{from:"Narita Airport",to:"Tokyo (Shinjuku)",price:3070,line:"Narita Express",day:1,duration:"90 min"},{from:"Tokyo",to:"Kyoto",price:13320,line:"Tokaido Shinkansen (Hikari)",day:4,duration:"2h 20min"},{from:"Kyoto",to:"Osaka",price:570,line:"JR Kyoto Line",day:6,duration:"30 min"},{from:"Osaka",to:"Tokyo",price:13870,line:"Tokaido Shinkansen (Hikari)",day:8,duration:"2h 40min"},{from:"Tokyo",to:"Narita Airport",price:3070,line:"Narita Express",day:15,duration:"90 min"}],jrPassPrices:{7:38e3,14:62e3,21:85e3},renderTransport(){const e=document.getElementById("content-transport");if(!e)return;const t=this.yourRoutes.reduce((e,t)=>e+t.price,0),a=this.jrPassPrices[14],n=a-t;e.innerHTML=`\n            <div class="max-w-6xl mx-auto p-4 md:p-6">\n                <h2 class="text-4xl font-bold mb-6 text-gray-800 dark:text-white">üöÜ Gu√≠a de Transporte</h2>\n\n                \x3c!-- Hero Section: Tu Recomendaci√≥n --\x3e\n                ${this.renderRecommendation(t,a,n)}\n\n                \x3c!-- Tu Itinerario Espec√≠fico --\x3e\n                ${this.renderYourRoutes(t)}\n\n                <div class="grid lg:grid-cols-2 gap-6 mt-6">\n                    \x3c!-- Calculadora JR Pass --\x3e\n                    ${this.renderJRPassCalculator()}\n\n                    \x3c!-- IC Cards (Suica/Pasmo) --\x3e\n                    ${this.renderICCards()}\n                </div>\n\n                \x3c!-- Apps de Transporte --\x3e\n                ${this.renderTransportApps()}\n\n                <div class="grid lg:grid-cols-2 gap-6 mt-6">\n                    \x3c!-- Reserved vs Unreserved --\x3e\n                    ${this.renderSeatsGuide()}\n\n                    \x3c!-- D√≥nde Comprar Tickets --\x3e\n                    ${this.renderTicketPurchase()}\n                </div>\n\n                \x3c!-- Tips & Tricks --\x3e\n                ${this.renderTips()}\n            </div>\n        `,this.attachEventListeners()},renderRecommendation:(e,t,a)=>`\n            <div class="bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl p-6 mb-6 shadow-lg">\n                <div class="flex items-start gap-4">\n                    <div class="text-6xl">üí°</div>\n                    <div class="flex-1">\n                        <h3 class="text-2xl font-bold mb-2">Tu Mejor Opci√≥n: Tickets Individuales</h3>\n                        <p class="text-sm opacity-90 mb-4">Para tu viaje de 15 d√≠as con 5 rutas principales, los tickets individuales son m√°s econ√≥micos que el JR Pass.</p>\n                        \n                        <div class="grid md:grid-cols-3 gap-4">\n                            <div class="bg-white/20 rounded-lg p-4 backdrop-blur-sm">\n                                <p class="text-xs opacity-80 mb-1">Tickets Individuales</p>\n                                <p class="text-3xl font-bold">¬•${e.toLocaleString()}</p>\n                                <p class="text-xs opacity-80">~$${Math.round(e/145)} USD</p>\n                            </div>\n                            <div class="bg-white/20 rounded-lg p-4 backdrop-blur-sm">\n                                <p class="text-xs opacity-80 mb-1">JR Pass 14 d√≠as</p>\n                                <p class="text-3xl font-bold">¬•${t.toLocaleString()}</p>\n                                <p class="text-xs opacity-80">~$${Math.round(t/145)} USD</p>\n                            </div>\n                            <div class="bg-yellow-400/30 rounded-lg p-4 backdrop-blur-sm border-2 border-yellow-300">\n                                <p class="text-xs font-bold mb-1">üí∞ TU AHORRO</p>\n                                <p class="text-3xl font-bold">¬•${a.toLocaleString()}</p>\n                                <p class="text-xs font-bold">~$${Math.round(a/145)} USD</p>\n                            </div>\n                        </div>\n\n                        <div class="mt-4 p-3 bg-white/10 rounded-lg">\n                            <p class="text-xs font-semibold mb-2">‚úÖ Ventajas para ti:</p>\n                            <ul class="text-xs space-y-1 opacity-90">\n                                <li>‚Ä¢ No necesitas activar el JR Pass en el aeropuerto</li>\n                                <li>‚Ä¢ Flexibilidad total en horarios (no limitado a 7/14 d√≠as consecutivos)</li>\n                                <li>‚Ä¢ Ahorras ~$45 USD vs JR Pass 14 d√≠as</li>\n                                <li>‚Ä¢ M√°s f√°cil: compras tickets seg√∫n necesites</li>\n                            </ul>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `,renderYourRoutes(e){return`\n            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-6">\n                <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-white flex items-center gap-2">\n                    üé´ Tus 5 Rutas Principales\n                </h3>\n                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">\n                    Estas son las rutas de tren de larga distancia que necesitas para tu itinerario de 15 d√≠as.\n                </p>\n\n                <div class="space-y-3">\n                    ${this.yourRoutes.map((e,t)=>`\n                        <div class="p-4 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-lg border-l-4 border-blue-500">\n                            <div class="flex items-center justify-between mb-2">\n                                <span class="text-xs font-bold text-blue-600 dark:text-blue-400">D√çA ${e.day} ‚Ä¢ ${e.line}</span>\n                                <span class="text-lg font-bold text-green-600 dark:text-green-400">¬•${e.price.toLocaleString()}</span>\n                            </div>\n                            <div class="grid grid-cols-3 gap-2 items-center">\n                                <div>\n                                    <p class="text-xs text-gray-500 dark:text-gray-400">Desde</p>\n                                    <p class="font-semibold dark:text-white">${e.from}</p>\n                                </div>\n                                <div class="text-center">\n                                    <p class="text-2xl text-gray-400">‚Üí</p>\n                                    <p class="text-xs text-gray-500 dark:text-gray-400">${e.duration}</p>\n                                </div>\n                                <div class="text-right">\n                                    <p class="text-xs text-gray-500 dark:text-gray-400">Hacia</p>\n                                    <p class="font-semibold dark:text-white">${e.to}</p>\n                                </div>\n                            </div>\n                            <div class="mt-2">\n                                <a href="https://world.hyper dia.com/en/?dep=${encodeURIComponent(e.from)}&arr=${encodeURIComponent(e.to)}" target="_blank" class="text-xs text-blue-600 dark:text-blue-400 hover:underline">\n                                    üîç Ver horarios en Hyperdia ‚Üí\n                                </a>\n                            </div>\n                        </div>\n                    `).join("")}\n                </div>\n\n                <div class="mt-4 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border-l-4 border-green-500">\n                    <div class="flex justify-between items-center">\n                        <div>\n                            <p class="font-bold text-gray-800 dark:text-white">Total en Tickets</p>\n                            <p class="text-xs text-gray-600 dark:text-gray-400">5 rutas principales</p>\n                        </div>\n                        <div class="text-right">\n                            <p class="text-3xl font-bold text-green-600 dark:text-green-400">¬•${e.toLocaleString()}</p>\n                            <p class="text-xs text-gray-600 dark:text-gray-400">~$${Math.round(e/145)} USD</p>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg">\n                    <p class="text-xs text-gray-700 dark:text-gray-300">\n                        üí° <strong>Nota:</strong> Estos precios NO incluyen transporte local en metro/bus dentro de cada ciudad. \n                        Para eso, necesitar√°s una <strong>Suica o Pasmo card</strong> (ver abajo).\n                    </p>\n                </div>\n            </div>\n        `},renderJRPassCalculator:()=>'\n            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">\n                <h3 class="text-xl font-bold mb-4 text-gray-800 dark:text-white flex items-center gap-2">\n                    üßÆ Calculadora Interactiva JR Pass\n                </h3>\n                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">\n                    Agrega tus rutas y descubre si el JR Pass vale la pena\n                </p>\n\n                <div class="space-y-4">\n                    \x3c!-- Routes List --\x3e\n                    <div id="dynamicRoutes" class="space-y-2 max-h-64 overflow-y-auto">\n                        \x3c!-- Routes will be added here --\x3e\n                    </div>\n\n                    \x3c!-- Add Route Button --\x3e\n                    <button id="addRouteBtn" class="w-full p-3 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg text-gray-500 dark:text-gray-400 hover:border-blue-500 hover:text-blue-600 dark:hover:text-blue-400 transition">\n                        + Agregar ruta\n                    </button>\n\n                    \x3c!-- Quick Presets --\x3e\n                    <div class="grid grid-cols-2 gap-2">\n                        <button onclick="TransportHandler.addQuickRoute(\'Tokyo\', \'Kyoto\', 13320)" class="text-xs p-2 bg-gray-100 dark:bg-gray-700 rounded hover:bg-gray-200 dark:hover:bg-gray-600 transition">\n                            Tokyo ‚Üí Kyoto<br><span class="text-green-600 dark:text-green-400">¬•13,320</span>\n                        </button>\n                        <button onclick="TransportHandler.addQuickRoute(\'Tokyo\', \'Osaka\', 13870)" class="text-xs p-2 bg-gray-100 dark:bg-gray-700 rounded hover:bg-gray-200 dark:hover:bg-gray-600 transition">\n                            Tokyo ‚Üí Osaka<br><span class="text-green-600 dark:text-green-400">¬•13,870</span>\n                        </button>\n                        <button onclick="TransportHandler.addQuickRoute(\'Kyoto\', \'Hiroshima\', 11200)" class="text-xs p-2 bg-gray-100 dark:bg-gray-700 rounded hover:bg-gray-200 dark:hover:bg-gray-600 transition">\n                            Kyoto ‚Üí Hiroshima<br><span class="text-green-600 dark:text-green-400">¬•11,200</span>\n                        </button>\n                        <button onclick="TransportHandler.addQuickRoute(\'Narita\', \'Tokyo\', 3070)" class="text-xs p-2 bg-gray-100 dark:bg-gray-700 rounded hover:bg-gray-200 dark:hover:bg-gray-600 transition">\n                            Narita ‚Üí Tokyo<br><span class="text-green-600 dark:text-green-400">¬•3,070</span>\n                        </button>\n                    </div>\n\n                    <div>\n                        <label class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 block">\n                            Duraci√≥n del JR Pass:\n                        </label>\n                        <select id="jrPassDays" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white" onchange="TransportHandler.updateCalculation()">\n                            <option value="7">7 d√≠as - ¬•38,000 (~$262)</option>\n                            <option value="14" selected>14 d√≠as - ¬•62,000 (~$427)</option>\n                            <option value="21">21 d√≠as - ¬•85,000 (~$586)</option>\n                        </select>\n                    </div>\n\n                    \x3c!-- Result Display --\x3e\n                    <div id="calculatorResult" class="p-4 rounded-lg bg-gray-50 dark:bg-gray-700">\n                        <div class="text-center text-gray-500 dark:text-gray-400 py-4">\n                            <p class="text-sm">Agrega rutas para ver el an√°lisis</p>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">\n                    <p class="text-xs text-gray-700 dark:text-gray-300">\n                        üí° <strong>Tip:</strong> El JR Pass suele valer la pena con 2+ viajes Tokyo‚ÜîKyoto/Osaka\n                        o visitando ciudades lejanas (Hiroshima, Nagano, Kanazawa).\n                    </p>\n                </div>\n            </div>\n        ',renderICCards:()=>'\n            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">\n                <h3 class="text-xl font-bold mb-4 text-gray-800 dark:text-white flex items-center gap-2">\n                    üí≥ Suica & Pasmo Cards\n                </h3>\n                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">\n                    Para transporte local (metro, autobuses, konbinis)\n                </p>\n\n                <div class="space-y-4">\n                    \x3c!-- Apple Wallet (DESTACADO) --\x3e\n                    <div class="p-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg">\n                        <div class="flex items-start gap-3">\n                            <span class="text-3xl">üì±</span>\n                            <div class="flex-1">\n                                <p class="font-bold text-lg mb-2">¬°NUEVO! Suica en Apple Wallet</p>\n                                <p class="text-sm opacity-90 mb-3">\n                                    La forma m√°s f√°cil: Agrega Suica directamente a tu iPhone/Apple Watch. \n                                    No necesitas comprar tarjeta f√≠sica.\n                                </p>\n                                <div class="space-y-2 text-sm">\n                                    <div class="flex items-start gap-2">\n                                        <span>1Ô∏è‚É£</span>\n                                        <span>Abre <strong>Wallet app</strong> en iPhone</span>\n                                    </div>\n                                    <div class="flex items-start gap-2">\n                                        <span>2Ô∏è‚É£</span>\n                                        <span>Toca "+" para agregar tarjeta</span>\n                                    </div>\n                                    <div class="flex items-start gap-2">\n                                        <span>3Ô∏è‚É£</span>\n                                        <span>Selecciona "Suica"</span>\n                                    </div>\n                                    <div class="flex items-start gap-2">\n                                        <span>4Ô∏è‚É£</span>\n                                        <span>Recarga con tarjeta de cr√©dito (m√≠nimo ¬•1,000)</span>\n                                    </div>\n                                    <div class="flex items-start gap-2">\n                                        <span>5Ô∏è‚É£</span>\n                                        <span>¬°Listo! Usa tu iPhone/Watch en torniquetes</span>\n                                    </div>\n                                </div>\n                                <div class="mt-3 p-2 bg-white/20 rounded">\n                                    <p class="text-xs">\n                                        ‚úÖ <strong>Ventaja:</strong> Puedes recargar desde tu hotel sin buscar m√°quinas\n                                    </p>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- Tarjeta F√≠sica --\x3e\n                    <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">\n                        <p class="font-bold text-gray-800 dark:text-white mb-2">Tarjeta F√≠sica (alternativa)</p>\n                        <ul class="text-sm text-gray-600 dark:text-gray-300 space-y-2">\n                            <li>üí∞ Costo: ¬•500 de dep√≥sito + ¬•1,500 saldo inicial</li>\n                            <li>üìç D√≥nde comprar: M√°quinas en estaciones (Narita, Tokyo, Shinjuku)</li>\n                            <li>üîÑ Recarga: En konbinis (7-Eleven, FamilyMart) o m√°quinas</li>\n                            <li>üí≥ Funciona en: Todos los metros, buses, konbinis, vending machines</li>\n                            <li>‚ôªÔ∏è Reembolso: Puedes recuperar el dep√≥sito al final (menos ¬•220 fee)</li>\n                        </ul>\n                    </div>\n\n                    \x3c!-- Suica vs Pasmo --\x3e\n                    <div class="p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg">\n                        <p class="text-xs text-gray-700 dark:text-gray-300">\n                            üí° <strong>Suica vs Pasmo:</strong> Son iguales. Funcionan en TODO Jap√≥n (Tokyo, Kyoto, Osaka). \n                            Elige cualquiera. Apple Wallet solo tiene Suica.\n                        </p>\n                    </div>\n\n                    \x3c!-- Presupuesto recomendado --\x3e\n                    <div class="p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border-l-4 border-green-500">\n                        <p class="font-bold text-gray-800 dark:text-white mb-2">Presupuesto recomendado:</p>\n                        <div class="text-sm text-gray-700 dark:text-gray-300 space-y-1">\n                            <p>‚Ä¢ <strong>Metro diario:</strong> ¬•500-800/d√≠a</p>\n                            <p>‚Ä¢ <strong>15 d√≠as:</strong> ~¬•10,000 en transporte local</p>\n                            <p>‚Ä¢ <strong>Recarga inicial:</strong> ¬•3,000-5,000</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        ',renderTransportApps:()=>`\n            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mt-6">\n                <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-white">üì± Apps Esenciales de Transporte</h3>\n                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">\n                    Descarga ANTES del viaje. Algunas funcionan offline.\n                </p>\n\n                <div class="grid md:grid-cols-2 gap-4">\n                    ${[{name:"Hyperdia",icon:"üöÜ",desc:"LA MEJOR para buscar horarios de trenes. Funciona offline.",link:"https://www.hyperdia.com/en/",rating:"‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê"},{name:"Google Maps",icon:"üó∫Ô∏è",desc:"Navegaci√≥n en tiempo real. Incluye metros y buses.",link:"https://maps.google.com",rating:"‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê"},{name:"Japan Transit Planner",icon:"üöá",desc:"App oficial. Muy precisa pero interface menos amigable.",link:"https://www.jorudan.co.jp/english/",rating:"‚≠ê‚≠ê‚≠ê‚≠ê"},{name:"Smart EX",icon:"üé´",desc:"Compra tickets de Shinkansen online (requiere tarjeta internacional).",link:"https://smart-ex.jp/en/",rating:"‚≠ê‚≠ê‚≠ê‚≠ê"},{name:"JR East App",icon:"üöÑ",desc:"Info de trenes JR East. √ötil para Narita Express y Tokyo.",link:"https://www.jreast.co.jp/e/app/",rating:"‚≠ê‚≠ê‚≠ê‚≠ê"}].map(e=>`\n                        <a href="${e.link}" target="_blank" class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg hover:shadow-lg transition border-l-4 border-blue-500">\n                            <div class="flex items-start gap-3">\n                                <span class="text-3xl">${e.icon}</span>\n                                <div class="flex-1">\n                                    <div class="flex items-center justify-between mb-1">\n                                        <p class="font-bold dark:text-white">${e.name}</p>\n                                        <span class="text-xs">${e.rating}</span>\n                                    </div>\n                                    <p class="text-sm text-gray-600 dark:text-gray-300">${e.desc}</p>\n                                </div>\n                                <span class="text-gray-400">‚Üí</span>\n                            </div>\n                        </a>\n                    `).join("")}\n                </div>\n            </div>\n        `,renderSeatsGuide:()=>'\n            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">\n                <h3 class="text-xl font-bold mb-4 text-gray-800 dark:text-white">ü™ë Reserved vs Unreserved Seats</h3>\n                \n                <div class="space-y-4">\n                    <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border-l-4 border-blue-500">\n                        <p class="font-bold text-blue-700 dark:text-blue-400 mb-2">Reserved Seats (ÊåáÂÆöÂ∏≠)</p>\n                        <ul class="text-sm text-gray-700 dark:text-gray-300 space-y-1">\n                            <li>‚úÖ Asiento garantizado</li>\n                            <li>üí∞ Costo extra: ~¬•500-1,000</li>\n                            <li>üéØ Mejor para: Rutas largas (Tokyo-Kyoto), fines de semana</li>\n                            <li>üé´ Compra en: Taquillas o m√°quinas con "Reserved"</li>\n                        </ul>\n                    </div>\n\n                    <div class="p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border-l-4 border-green-500">\n                        <p class="font-bold text-green-700 dark:text-green-400 mb-2">Unreserved Seats (Ëá™Áî±Â∏≠)</p>\n                        <ul class="text-sm text-gray-700 dark:text-gray-300 space-y-1">\n                            <li>‚úÖ Sin reserva, llegas y subes</li>\n                            <li>üí∞ Precio est√°ndar (m√°s barato)</li>\n                            <li>‚ö†Ô∏è Puede que tengas que ir de pie si est√° lleno</li>\n                            <li>üéØ Mejor para: Entre semana, rutas cortas</li>\n                        </ul>\n                    </div>\n\n                    <div class="p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg">\n                        <p class="text-xs font-bold text-gray-800 dark:text-white mb-2">üí° Mi recomendaci√≥n para ti:</p>\n                        <ul class="text-xs text-gray-700 dark:text-gray-300 space-y-1">\n                            <li>‚úÖ <strong>Reserved:</strong> Tokyo‚ÜîKyoto, Tokyo‚ÜîOsaka (rutas largas)</li>\n                            <li>‚úÖ <strong>Unreserved:</strong> Kyoto‚ÜíOsaka (30 min, no vale la pena reserved)</li>\n                            <li>‚úÖ <strong>Narita Express:</strong> Unreserved es suficiente</li>\n                        </ul>\n                    </div>\n                </div>\n            </div>\n        ',renderTicketPurchase:()=>'\n            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">\n                <h3 class="text-xl font-bold mb-4 text-gray-800 dark:text-white">üé´ D√≥nde Comprar Tickets</h3>\n                \n                <div class="space-y-3">\n                    <div class="p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg">\n                        <p class="font-bold text-purple-700 dark:text-purple-400 mb-2">Opci√≥n 1: Taquillas (Midori no Madoguchi) ‚≠ê</p>\n                        <p class="text-sm text-gray-700 dark:text-gray-300 mb-2">LA M√ÅS F√ÅCIL para extranjeros</p>\n                        <ul class="text-xs text-gray-600 dark:text-gray-400 space-y-1">\n                            <li>‚úÖ Personal habla ingl√©s b√°sico</li>\n                            <li>‚úÖ Puedes pedir reserved o unreserved</li>\n                            <li>‚úÖ Aceptan tarjetas internacionales</li>\n                            <li>üìç Ubica la ventana con kanji "„Åø„Å©„Çä„ÅÆÁ™ìÂè£" (verde)</li>\n                        </ul>\n                    </div>\n\n                    <div class="p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">\n                        <p class="font-bold text-blue-700 dark:text-blue-400 mb-2">Opci√≥n 2: M√°quinas Autom√°ticas</p>\n                        <ul class="text-xs text-gray-600 dark:text-gray-400 space-y-1">\n                            <li>‚úÖ Tienen opci√≥n en ingl√©s</li>\n                            <li>‚úÖ M√°s r√°pido (si sabes usarlas)</li>\n                            <li>‚ö†Ô∏è Solo efectivo o IC card</li>\n                            <li>üìç Busca las grandes con pantalla touch</li>\n                        </ul>\n                    </div>\n\n                    <div class="p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">\n                        <p class="font-bold text-green-700 dark:text-green-400 mb-2">Opci√≥n 3: Smart EX (App/Web)</p>\n                        <ul class="text-xs text-gray-600 dark:text-gray-400 space-y-1">\n                            <li>‚úÖ Compra desde tu hotel</li>\n                            <li>‚úÖ Recoge ticket en m√°quina con c√≥digo QR</li>\n                            <li>‚ö†Ô∏è Requiere tarjeta de cr√©dito internacional</li>\n                            <li>üí≥ Link: smart-ex.jp/en</li>\n                        </ul>\n                    </div>\n                </div>\n\n                <div class="mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg">\n                    <p class="text-xs font-bold text-gray-800 dark:text-white mb-2">üìã Info para mostrar en taquilla:</p>\n                    <div class="text-xs text-gray-700 dark:text-gray-300 space-y-1">\n                        <p>üóìÔ∏è "February 19, Tokyo to Kyoto, two adults, unreserved"</p>\n                        <p>üé´ Escribe en papel: <strong>2Âêç Êù±‰∫¨‚Üí‰∫¨ÈÉΩ 2/19 Ëá™Áî±Â∏≠</strong></p>\n                    </div>\n                </div>\n            </div>\n        ',renderTips:()=>`\n            <div class="bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-xl shadow-lg p-6 mt-6">\n                <h3 class="text-2xl font-bold mb-4">üí° Tips & Tricks de Transporte</h3>\n                \n                <div class="grid md:grid-cols-2 gap-4">\n                    ${[{icon:"‚è∞",title:"Llega 10-15 min antes",desc:"Los trenes son S√öPER puntuales. Si dice 10:03, sale 10:03 exacto."},{icon:"üéí",title:"Equipaje en overhead",desc:"Maletas grandes van en espacios al final del vag√≥n. Overhead solo para mochilas/bolsos."},{icon:"üîá",title:"Modo silencioso",desc:"NO hables por tel√©fono en trenes. Pon tu cel en silencio. Es parte de la etiqueta."},{icon:"üç±",title:"Ekiben (lunch boxes)",desc:"Compra bento boxes en estaciones. Comer en Shinkansen es permitido y tradicional."},{icon:"üì±",title:"WiFi gratis",desc:"Shinkansen tiene WiFi gratis. Usuario: Shinkansen-Free-Wi-Fi"},{icon:"üö™",title:"Puertas NO se abren solas",desc:"En trenes locales, presiona el bot√≥n verde para abrir la puerta."}].map(e=>`\n                        <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4">\n                            <div class="flex items-start gap-3">\n                                <span class="text-3xl">${e.icon}</span>\n                                <div>\n                                    <p class="font-bold mb-1">${e.title}</p>\n                                    <p class="text-sm opacity-90">${e.desc}</p>\n                                </div>\n                            </div>\n                        </div>\n                    `).join("")}\n                </div>\n\n                <div class="mt-4 p-4 bg-white/20 rounded-lg backdrop-blur-sm">\n                    <p class="text-sm font-bold mb-2">üÜò ¬øPerdiste tu tren?</p>\n                    <p class="text-xs opacity-90">\n                        Tranquilo. Ve a la taquilla y muestra tu ticket. Te pueden cambiar al siguiente tren SIN COSTO EXTRA \n                        (si es unreserved). Si es reserved, puede que tengas que pagar diferencia.\n                    </p>\n                </div>\n            </div>\n        `,calculatorRoutes:[],attachEventListeners(){const e=document.getElementById("addRouteBtn");e&&e.addEventListener("click",()=>this.showAddRouteDialog())},addQuickRoute(e,t,a){this.calculatorRoutes.push({from:e,to:t,price:a}),this.renderCalculatorRoutes(),this.updateCalculation()},showAddRouteDialog(){const e=prompt("Ciudad de origen (ej: Tokyo, Kyoto, Osaka):");if(!e)return;const t=prompt("Ciudad de destino:");if(!t)return;const a=prompt("Precio en yenes (ej: 13320):"),n=parseInt(a);n&&!isNaN(n)?(this.calculatorRoutes.push({from:e,to:t,price:n}),this.renderCalculatorRoutes(),this.updateCalculation()):alert("Precio inv√°lido")},removeRoute(e){this.calculatorRoutes.splice(e,1),this.renderCalculatorRoutes(),this.updateCalculation()},renderCalculatorRoutes(){const e=document.getElementById("dynamicRoutes");e&&(0!==this.calculatorRoutes.length?e.innerHTML=this.calculatorRoutes.map((e,t)=>`\n            <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg group">\n                <div class="flex-1">\n                    <p class="text-sm font-semibold dark:text-white">${e.from} ‚Üí ${e.to}</p>\n                    <p class="text-xs text-gray-500 dark:text-gray-400">¬•${e.price.toLocaleString()}</p>\n                </div>\n                <button\n                    onclick="TransportHandler.removeRoute(${t})"\n                    class="text-red-500 hover:text-red-700 opacity-0 group-hover:opacity-100 transition px-2"\n                    title="Eliminar"\n                >üóëÔ∏è</button>\n            </div>\n        `).join(""):e.innerHTML='<p class="text-sm text-gray-500 dark:text-gray-400 text-center py-2">No hay rutas agregadas</p>')},updateCalculation(){var e;const t=document.getElementById("calculatorResult");if(!t)return;const a=this.calculatorRoutes.reduce((e,t)=>e+t.price,0),n=parseInt((null==(e=document.getElementById("jrPassDays"))?void 0:e.value)||"14"),r=this.jrPassPrices[n];if(0===a)return void(t.innerHTML='<div class="text-center text-gray-500 dark:text-gray-400 py-4"><p class="text-sm">Agrega rutas para ver el an√°lisis</p></div>');const i=r-a,o=(Math.abs(i)/r*100).toFixed(0),s=r>a?100:a/r*100;t.innerHTML=i>0?`\n                <div class="bg-green-50 dark:bg-green-900/20 border-2 border-green-500 rounded-lg p-4">\n                    <div class="flex items-center gap-2 mb-3">\n                        <div class="text-3xl">‚úÖ</div>\n                        <div>\n                            <p class="font-bold text-green-700 dark:text-green-400 text-lg">Tickets Individuales</p>\n                            <p class="text-xs text-gray-600 dark:text-gray-400">Mejor opci√≥n para tu viaje</p>\n                        </div>\n                    </div>\n\n                    \x3c!-- Visual Comparison --\x3e\n                    <div class="space-y-3 mb-4">\n                        <div>\n                            <div class="flex justify-between text-xs mb-1">\n                                <span class="font-semibold text-gray-700 dark:text-gray-300">Tus tickets</span>\n                                <span class="font-bold text-green-600 dark:text-green-400">¬•${a.toLocaleString()}</span>\n                            </div>\n                            <div class="h-6 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">\n                                <div class="h-full bg-gradient-to-r from-green-500 to-emerald-500 flex items-center justify-end pr-2" style="width: ${s}%">\n                                    <span class="text-xs font-bold text-white">~$${Math.round(a/145)}</span>\n                                </div>\n                            </div>\n                        </div>\n                        <div>\n                            <div class="flex justify-between text-xs mb-1">\n                                <span class="font-semibold text-gray-700 dark:text-gray-300">JR Pass ${n} d√≠as</span>\n                                <span class="font-bold text-gray-600 dark:text-gray-400">¬•${r.toLocaleString()}</span>\n                            </div>\n                            <div class="h-6 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">\n                                <div class="h-full bg-gradient-to-r from-gray-400 to-gray-500 flex items-center justify-end pr-2" style="width: 100%">\n                                    <span class="text-xs font-bold text-white">~$${Math.round(r/145)}</span>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class="p-3 bg-white dark:bg-gray-800 rounded-lg">\n                        <p class="text-sm font-bold text-gray-800 dark:text-white mb-1">\n                            üí∞ Tu ahorro: ¬•${Math.abs(i).toLocaleString()} (~$${Math.round(Math.abs(i)/145)})\n                        </p>\n                        <p class="text-xs text-gray-600 dark:text-gray-400">\n                            Ahorras ${o}% comprando tickets individuales\n                        </p>\n                    </div>\n                </div>\n            `:`\n                <div class="bg-blue-50 dark:bg-blue-900/20 border-2 border-blue-500 rounded-lg p-4">\n                    <div class="flex items-center gap-2 mb-3">\n                        <div class="text-3xl">üé´</div>\n                        <div>\n                            <p class="font-bold text-blue-700 dark:text-blue-400 text-lg">JR Pass</p>\n                            <p class="text-xs text-gray-600 dark:text-gray-400">Mejor opci√≥n para tu viaje</p>\n                        </div>\n                    </div>\n\n                    \x3c!-- Visual Comparison --\x3e\n                    <div class="space-y-3 mb-4">\n                        <div>\n                            <div class="flex justify-between text-xs mb-1">\n                                <span class="font-semibold text-gray-700 dark:text-gray-300">JR Pass ${n} d√≠as</span>\n                                <span class="font-bold text-blue-600 dark:text-blue-400">¬•${r.toLocaleString()}</span>\n                            </div>\n                            <div class="h-6 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">\n                                <div class="h-full bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-end pr-2" style="width: 100%">\n                                    <span class="text-xs font-bold text-white">~$${Math.round(r/145)}</span>\n                                </div>\n                            </div>\n                        </div>\n                        <div>\n                            <div class="flex justify-between text-xs mb-1">\n                                <span class="font-semibold text-gray-700 dark:text-gray-300">Tus tickets</span>\n                                <span class="font-bold text-gray-600 dark:text-gray-400">¬•${a.toLocaleString()}</span>\n                            </div>\n                            <div class="h-6 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">\n                                <div class="h-full bg-gradient-to-r from-gray-400 to-gray-500 flex items-center justify-end pr-2" style="width: ${s}%">\n                                    <span class="text-xs font-bold text-white">~$${Math.round(a/145)}</span>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class="p-3 bg-white dark:bg-gray-800 rounded-lg">\n                        <p class="text-sm font-bold text-gray-800 dark:text-white mb-1">\n                            üí∞ Tu ahorro: ¬•${Math.abs(i).toLocaleString()} (~$${Math.round(Math.abs(i)/145)})\n                        </p>\n                        <p class="text-xs text-gray-600 dark:text-gray-400">\n                            Ahorras ${o}% con el JR Pass de ${n} d√≠as\n                        </p>\n                    </div>\n\n                    <div class="mt-3 p-2 bg-yellow-50 dark:bg-yellow-900/20 rounded">\n                        <p class="text-xs text-gray-700 dark:text-gray-300">\n                            üí° Recuerda: El JR Pass debe comprarse ANTES de llegar a Jap√≥n\n                        </p>\n                    </div>\n                </div>\n            `}};window.TransportHandler=ue;const pe={currentTripId:null,myFlights:[],airlineBaggage:{AM:{name:"Aerom√©xico",personalItem:{dimensions:"45 x 35 x 20 cm",weight:"Incluido en carry-on"},carryOn:{dimensions:"56 x 36 x 23 cm",weight:"10 kg"},checked:{dimensions:"158 cm lineales (suma)",weight:"23 kg",quantity:"1 maleta gratis"},notes:"Segunda maleta: $50 USD. Exceso de peso (23-32kg): $75 USD"},UA:{name:"United Airlines",personalItem:{dimensions:"43 x 25 x 22 cm",weight:"Incluido"},carryOn:{dimensions:"56 x 35 x 22 cm",weight:"Sin l√≠mite"},checked:{dimensions:"157 cm lineales",weight:"23 kg",quantity:"1 maleta gratis (internacional)"},notes:"Segunda maleta: $100 USD. Exceso de peso: $100 USD"},AA:{name:"American Airlines",personalItem:{dimensions:"45 x 35 x 20 cm",weight:"Incluido"},carryOn:{dimensions:"56 x 36 x 23 cm",weight:"Sin l√≠mite"},checked:{dimensions:"158 cm lineales",weight:"23 kg",quantity:"1 maleta gratis (internacional)"},notes:"Segunda maleta: $100 USD. Exceso: $100-200 USD"},NH:{name:"ANA (All Nippon Airways)",personalItem:{dimensions:"40 x 30 x 10 cm",weight:"2 piezas total 10kg"},carryOn:{dimensions:"55 x 40 x 25 cm",weight:"10 kg (2 piezas)"},checked:{dimensions:"158 cm lineales",weight:"23 kg",quantity:"2 maletas gratis"},notes:"¬°2 maletas gratis en internacional! Tercera maleta: 15,000 JPY"},JL:{name:"Japan Airlines (JAL)",personalItem:{dimensions:"40 x 30 x 10 cm",weight:"Incluido en 10kg total"},carryOn:{dimensions:"55 x 40 x 25 cm",weight:"10 kg total"},checked:{dimensions:"203 cm lineales",weight:"23 kg",quantity:"2 maletas gratis"},notes:"¬°2 maletas gratis! Exceso: 15,000-30,000 JPY"},DEFAULT:{name:"Aerol√≠nea General",personalItem:{dimensions:"40 x 30 x 15 cm",weight:"Var√≠a"},carryOn:{dimensions:"55 x 40 x 23 cm",weight:"7-10 kg"},checked:{dimensions:"158 cm lineales",weight:"23 kg",quantity:"1 maleta t√≠picamente"},notes:"Consulta las pol√≠ticas espec√≠ficas de tu aerol√≠nea"}},async init(t){this.currentTripId=t,this.render(),e.currentUser&&t&&(await this.loadWizardFlights(),await this.listenToFlights())},async loadWizardFlights(){var e;try{const e=r(a,"trips",this.currentTripId),t=await o(e);if(!t.exists())return;const n=t.data().flights||{},s=r(a,"trips",this.currentTripId,"modules","flights"),l=await o(s);let d=[];l.exists()&&(d=l.data().flights||[]);const c=[];if(n.outbound&&n.outbound.flightNumber){d.some(e=>e.flightNumber===n.outbound.flightNumber&&"outbound"===e.type)||c.push({type:"outbound",date:n.outbound.date||"",airline:n.outbound.airline||"",flightNumber:n.outbound.flightNumber||"",from:n.outbound.from||"",to:n.outbound.to||"",departureTime:"",arrivalTime:"",duration:"",notes:"üéØ A√±adido desde el wizard de viaje",addedAt:(new Date).toISOString(),fromWizard:!0})}if(n.return&&n.return.flightNumber){d.some(e=>e.flightNumber===n.return.flightNumber&&"return"===e.type)||c.push({type:"return",date:n.return.date||"",airline:n.return.airline||"",flightNumber:n.return.flightNumber||"",from:n.return.from||"",to:n.return.to||"",departureTime:"",arrivalTime:"",duration:"",notes:"üéØ A√±adido desde el wizard de viaje",addedAt:(new Date).toISOString(),fromWizard:!0})}if(c.length>0){const e=[...d,...c];await i(s,{flights:e,updatedAt:(new Date).toISOString()}),console.log("‚úÖ Vuelos del wizard cargados autom√°ticamente:",c.length)}}catch(t){if("unavailable"===t.code||(null==(e=t.message)?void 0:e.includes("client is offline")))return void console.log("‚ö†Ô∏è Firestore offline, skipping wizard flights load");console.error("‚ùå Error cargando vuelos del wizard:",t)}},async listenToFlights(){const e=r(a,"trips",this.currentTripId,"modules","flights");l(e,e=>{e.exists()&&(this.myFlights=e.data().flights||[],this.renderMyFlights(),this.renderBaggageInfoDynamic())})},render(){const e=document.getElementById("content-flights");e&&(e.innerHTML=`\n      <div class="max-w-6xl mx-auto p-4 md:p-6">\n        <h2 class="text-4xl font-bold mb-6 text-gray-800 dark:text-white">‚úàÔ∏è Gesti√≥n de Vuelos</h2>\n\n        \x3c!-- Mis Vuelos Registrados --\x3e\n        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-6">\n          <div class="flex justify-between items-center mb-4 flex-wrap gap-3">\n            <h3 class="text-2xl font-bold dark:text-white flex items-center gap-2">\n              üé´ Mis Vuelos\n            </h3>\n            <button \n              id="addFlightBtn"\n              class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold transition"\n            >\n              ‚ûï Agregar Vuelo\n            </button>\n          </div>\n          \n          <div id="myFlightsList">\n            ${this.renderMyFlightsInitial()}\n          </div>\n        </div>\n\n        \x3c!-- Formulario de Agregar Vuelo (Hidden) --\x3e\n        <div id="addFlightForm" class="hidden bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-6">\n          ${this.renderAddFlightForm()}\n        </div>\n\n        <div class="grid lg:grid-cols-2 gap-6 mb-6">\n          \x3c!-- Flight Tracker Links --\x3e\n          <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl shadow-lg p-6">\n            <h3 class="text-2xl font-bold mb-4 flex items-center gap-2">\n              üì° Track de Vuelo en Tiempo Real\n            </h3>\n            <p class="text-sm opacity-90 mb-4">\n              Rastrea tu vuelo en las mejores plataformas\n            </p>\n\n            <div class="space-y-3">\n              ${this.renderFlightTrackingLinks()}\n            </div>\n          </div>\n\n          \x3c!-- B√∫squeda de Vuelos Baratos --\x3e\n          <div class="bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl shadow-lg p-6">\n            <h3 class="text-2xl font-bold mb-4 flex items-center gap-2">\n              üí∞ Encuentra Vuelos Baratos\n            </h3>\n            <p class="text-sm opacity-90 mb-4">\n              Compara precios en las mejores plataformas\n            </p>\n\n            <div class="space-y-3">\n              ${this.renderFlightSearchLinks()}\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Informaci√≥n de Equipaje --\x3e\n        <div id="baggageInfo" class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">\n          ${this.renderBaggageInfo()}\n        </div>\n\n        \x3c!-- Tips de Vuelos --\x3e\n        ${this.renderFlightTips()}\n      </div>\n    `,this.attachEventListeners())},renderMyFlightsInitial(){return 0===this.myFlights.length?'\n        <div class="text-center py-12 text-gray-500 dark:text-gray-400">\n          <div class="text-6xl mb-4">‚úàÔ∏è</div>\n          <p class="text-lg font-semibold">No hay vuelos registrados</p>\n          <p class="text-sm">Agrega tus vuelos para tener toda la informaci√≥n en un solo lugar</p>\n        </div>\n      ':'<div id="flightsListContainer"></div>'},renderMyFlights(){const e=document.getElementById("flightsListContainer");if(!e){const e=document.getElementById("myFlightsList");return void(e&&this.myFlights.length>0&&(e.innerHTML='<div id="flightsListContainer"></div>',this.renderMyFlights()))}0!==this.myFlights.length?e.innerHTML=this.myFlights.map((e,t)=>`\n      <div class="p-4 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-lg mb-4 border-l-4 border-blue-500">\n        <div class="flex justify-between items-start mb-3 flex-wrap gap-2">\n          <div class="flex-1">\n            <span class="text-xs font-bold text-blue-600 dark:text-blue-400">${"outbound"===e.type?"üõ´ IDA":"üõ¨ VUELTA"}</span>\n            <h4 class="text-lg font-bold dark:text-white">${e.airline} ${e.flightNumber}</h4>\n            ${e.date?`<p class="text-xs text-gray-500 dark:text-gray-400">üìÖ ${new Date(e.date).toLocaleDateString("es")}</p>`:""}\n          </div>\n          <div class="flex gap-2">\n            ${e.flightNumber?`\n              <a\n                href="https://www.flightradar24.com/data/flights/${e.flightNumber.toLowerCase()}"\n                target="_blank"\n                class="text-xs bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 inline-flex items-center gap-1"\n                title="Rastrear en FlightRadar24"\n              >\n                üì° Track\n              </a>\n            `:""}\n            <button\n              onclick="FlightsHandler.deleteFlight(${t})"\n              class="text-red-500 hover:text-red-700 p-2"\n              title="Eliminar vuelo"\n            >\n              üóëÔ∏è\n            </button>\n          </div>\n        </div>\n        \n        ${e.from&&e.to?`\n          <div class="grid grid-cols-3 gap-2 items-center mb-3">\n            <div>\n              <p class="text-xs text-gray-500 dark:text-gray-400">Salida</p>\n              <p class="font-bold dark:text-white">${e.from}</p>\n              ${e.departureTime?`<p class="text-sm text-gray-600 dark:text-gray-300">${e.departureTime}</p>`:""}\n            </div>\n            <div class="text-center">\n              <p class="text-2xl text-gray-400">‚Üí</p>\n              ${e.duration?`<p class="text-xs text-gray-500 dark:text-gray-400">${e.duration}</p>`:""}\n            </div>\n            <div class="text-right">\n              <p class="text-xs text-gray-500 dark:text-gray-400">Llegada</p>\n              <p class="font-bold dark:text-white">${e.to}</p>\n              ${e.arrivalTime?`<p class="text-sm text-gray-600 dark:text-gray-300">${e.arrivalTime}</p>`:""}\n            </div>\n          </div>\n        `:""}\n\n        ${e.notes?`\n          <div class="mt-2 p-2 bg-yellow-50 dark:bg-yellow-900/20 rounded text-xs">\n            üìù ${e.notes}\n          </div>\n        `:""}\n      </div>\n    `).join(""):document.getElementById("myFlightsList").innerHTML=this.renderMyFlightsInitial()},renderAddFlightForm:()=>'\n      <div class="flex justify-between items-center mb-4">\n        <h3 class="text-xl font-bold dark:text-white">‚ûï Agregar Vuelo</h3>\n        <button \n          id="cancelAddFlight"\n          class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"\n        >\n          ‚úï Cancelar\n        </button>\n      </div>\n\n      <form id="flightForm">\n        <div class="grid md:grid-cols-2 gap-4">\n          <div>\n            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n              Tipo de Vuelo\n            </label>\n            <select \n              id="flightType"\n              class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n              required\n            >\n              <option value="outbound">üõ´ Ida</option>\n              <option value="return">üõ¨ Vuelta</option>\n            </select>\n          </div>\n\n          <div>\n            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n              Fecha del Vuelo\n            </label>\n            <input \n              type="date"\n              id="flightDate"\n              class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n              required\n            >\n          </div>\n\n          <div>\n            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n              Aerol√≠nea\n            </label>\n            <input \n              type="text"\n              id="flightAirline"\n              placeholder="Ej: Aerom√©xico"\n              class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n              required\n            >\n          </div>\n\n          <div>\n            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n              N√∫mero de Vuelo\n            </label>\n            <input \n              type="text"\n              id="flightNumber"\n              placeholder="Ej: AM58"\n              class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n              required\n            >\n          </div>\n\n          <div>\n            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n              Desde (C√≥digo)\n            </label>\n            <input \n              type="text"\n              id="flightFrom"\n              placeholder="Ej: MTY, MEX"\n              maxlength="3"\n              class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white uppercase"\n              required\n            >\n          </div>\n\n          <div>\n            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n              Hacia (C√≥digo)\n            </label>\n            <input \n              type="text"\n              id="flightTo"\n              placeholder="Ej: NRT, HND"\n              maxlength="3"\n              class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white uppercase"\n              required\n            >\n          </div>\n\n          <div>\n            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n              Hora de Salida\n            </label>\n            <input \n              type="time"\n              id="flightDepartureTime"\n              class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n            >\n          </div>\n\n          <div>\n            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n              Hora de Llegada\n            </label>\n            <input \n              type="time"\n              id="flightArrivalTime"\n              class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n            >\n          </div>\n\n          <div class="md:col-span-2">\n            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n              Duraci√≥n (opcional)\n            </label>\n            <input \n              type="text"\n              id="flightDuration"\n              placeholder="Ej: 14h 30m"\n              class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n            >\n          </div>\n\n          <div class="md:col-span-2">\n            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n              Notas (opcional)\n            </label>\n            <textarea \n              id="flightNotes"\n              rows="2"\n              placeholder="Confirmaci√≥n #12345, Asiento 24A, etc."\n              class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n            ></textarea>\n          </div>\n        </div>\n\n        <div class="mt-6 flex justify-end gap-4">\n          <button \n            type="button"\n            id="cancelAddFlightBtn"\n            class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-6 rounded-lg transition"\n          >\n            Cancelar\n          </button>\n          <button \n            type="submit"\n            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition"\n          >\n            üíæ Guardar Vuelo\n          </button>\n        </div>\n      </form>\n    ',renderFlightTrackingLinks:()=>[{name:"FlightRadar24",url:"https://www.flightradar24.com",icon:"üì°",desc:"Tracking en vivo con mapa"},{name:"FlightAware",url:"https://flightaware.com",icon:"‚úàÔ∏è",desc:"Estado y horarios"},{name:"FlightStats",url:"https://www.flightstats.com",icon:"üìä",desc:"Estad√≠sticas de vuelo"},{name:"Google Flights",url:"https://www.google.com/travel/flights",icon:"üîç",desc:"Buscar y rastrear"}].map(e=>`\n      <a\n        href="${e.url}"\n        target="_blank"\n        class="bg-white/20 hover:bg-white/30 p-4 rounded-lg flex items-center justify-between transition border-2 border-white/30"\n      >\n        <div class="flex items-center gap-3">\n          <span class="text-2xl">${e.icon}</span>\n          <div>\n            <p class="font-bold">${e.name}</p>\n            <p class="text-xs opacity-80">${e.desc}</p>\n          </div>\n        </div>\n        <span class="text-2xl">‚Üí</span>\n      </a>\n    `).join(""),renderFlightSearchLinks:()=>[{name:"Skyscanner",url:"https://www.skyscanner.com",icon:"üîç",color:"bg-blue-500"},{name:"Google Flights",url:"https://www.google.com/flights",icon:"üõ´",color:"bg-red-500"},{name:"Kayak",url:"https://www.kayak.com",icon:"üö§",color:"bg-orange-500"},{name:"Momondo",url:"https://www.momondo.com",icon:"üåç",color:"bg-purple-500"}].map(e=>`\n      <a\n        href="${e.url}"\n        target="_blank"\n        class="${e.color} bg-opacity-20 hover:bg-opacity-30 p-4 rounded-lg flex items-center justify-between transition border-2 border-white/30"\n      >\n        <div class="flex items-center gap-3">\n          <span class="text-2xl">${e.icon}</span>\n          <span class="font-bold">${e.name}</span>\n        </div>\n        <span class="text-2xl">‚Üí</span>\n      </a>\n    `).join(""),renderBaggageInfo(){const e=this.myFlights.map(e=>{var t;return null==(t=e.flightNumber.match(/^[A-Z]{2}/))?void 0:t[0]}).filter(Boolean),t=[...new Set(e)];return 0===t.length?'\n        <h3 class="text-2xl font-bold mb-4 dark:text-white">üì¶ Informaci√≥n de Equipaje</h3>\n        <p class="text-gray-600 dark:text-gray-400">\n          Agrega tus vuelos para ver las pol√≠ticas de equipaje espec√≠ficas de tu aerol√≠nea.\n        </p>\n      ':`\n      <h3 class="text-2xl font-bold mb-4 dark:text-white">üì¶ Pol√≠ticas de Equipaje</h3>\n      <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">\n        Informaci√≥n espec√≠fica para ${t.length>1?"tus aerol√≠neas":"tu aerol√≠nea"}\n      </p>\n\n      <div class="space-y-6">\n        ${t.map(e=>{const t=this.airlineBaggage[e]||this.airlineBaggage.DEFAULT;return`\n            <div class="p-6 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-lg">\n              <h4 class="text-xl font-bold mb-4 dark:text-white">${t.name}</h4>\n              \n              <div class="grid md:grid-cols-3 gap-4 mb-4">\n                <div class="p-4 bg-white dark:bg-gray-700 rounded-lg">\n                  <p class="text-xs text-gray-500 dark:text-gray-400 mb-2 font-semibold">üëú OBJETO PERSONAL</p>\n                  <p class="text-sm font-bold dark:text-white mb-1">${t.personalItem.dimensions}</p>\n                  <p class="text-xs text-gray-600 dark:text-gray-300">${t.personalItem.weight}</p>\n                  <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">\n                    Mochila, cartera, laptop\n                  </p>\n                </div>\n\n                <div class="p-4 bg-white dark:bg-gray-700 rounded-lg">\n                  <p class="text-xs text-gray-500 dark:text-gray-400 mb-2 font-semibold">üéí CARRY-ON</p>\n                  <p class="text-sm font-bold dark:text-white mb-1">${t.carryOn.dimensions}</p>\n                  <p class="text-xs text-gray-600 dark:text-gray-300">${t.carryOn.weight}</p>\n                  <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">\n                    Va en compartimento superior\n                  </p>\n                </div>\n\n                <div class="p-4 bg-white dark:bg-gray-700 rounded-lg">\n                  <p class="text-xs text-gray-500 dark:text-gray-400 mb-2 font-semibold">üíº MALETA FACTURADA</p>\n                  <p class="text-sm font-bold dark:text-white mb-1">${t.checked.dimensions}</p>\n                  <p class="text-xs text-gray-600 dark:text-gray-300 mb-1">${t.checked.weight}</p>\n                  <p class="text-xs font-semibold text-green-600 dark:text-green-400">${t.checked.quantity}</p>\n                </div>\n              </div>\n\n              <div class="p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg">\n                <p class="text-xs font-semibold text-gray-800 dark:text-white mb-1">üí° Informaci√≥n Adicional:</p>\n                <p class="text-xs text-gray-700 dark:text-gray-300">${t.notes}</p>\n              </div>\n            </div>\n          `}).join("")}\n      </div>\n\n      <div class="mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">\n        <p class="text-sm font-bold text-gray-800 dark:text-white mb-2">üìè ¬øC√≥mo medir correctamente?</p>\n        <ul class="text-xs text-gray-700 dark:text-gray-300 space-y-1">\n          <li>‚Ä¢ <strong>Dimensiones:</strong> Largo x Ancho x Alto (incluye ruedas y manijas)</li>\n          <li>‚Ä¢ <strong>Lineales:</strong> Suma de las 3 medidas (ej: 70+50+30 = 150cm)</li>\n          <li>‚Ä¢ <strong>Peso:</strong> Incluye todo lo que va dentro de la maleta</li>\n        </ul>\n      </div>\n    `},renderBaggageInfoDynamic(){const e=document.getElementById("baggageInfo");e&&(e.innerHTML=this.renderBaggageInfo())},renderFlightTips:()=>'\n      <div class="bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-xl shadow-lg p-6 mt-6">\n        <h3 class="text-2xl font-bold mb-4">üí° Tips para Vuelos Internacionales</h3>\n        \n        <div class="grid md:grid-cols-2 gap-4">\n          <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4">\n            <p class="font-bold mb-2">‚è∞ Llega 3 horas antes</p>\n            <p class="text-sm opacity-90">Para vuelos internacionales, especialmente si facturas maletas.</p>\n          </div>\n\n          <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4">\n            <p class="font-bold mb-2">üì± Descarga tu boarding pass</p>\n            <p class="text-sm opacity-90">Muchas aerol√≠neas permiten check-in online 24hrs antes.</p>\n          </div>\n\n          <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4">\n            <p class="font-bold mb-2">üé´ Imprime confirmaci√≥n</p>\n            <p class="text-sm opacity-90">Lleva impreso el itinerario por si pierdes bater√≠a.</p>\n          </div>\n\n          <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4">\n            <p class="font-bold mb-2">üíä Medicamentos en carry-on</p>\n            <p class="text-sm opacity-90">Nunca pongas medicamentos importantes en maleta facturada.</p>\n          </div>\n\n          <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4">\n            <p class="font-bold mb-2">üîã Power bank < 27,000 mAh</p>\n            <p class="text-sm opacity-90">Bater√≠as externas solo en carry-on, m√°x 100Wh.</p>\n          </div>\n\n          <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4">\n            <p class="font-bold mb-2">üß¥ L√≠quidos 100ml m√°x</p>\n            <p class="text-sm opacity-90">Bolsa transparente de 1L para l√≠quidos en carry-on.</p>\n          </div>\n        </div>\n      </div>\n    ',attachEventListeners(){const e=document.getElementById("addFlightBtn");e&&e.addEventListener("click",()=>this.showAddFlightForm());document.querySelectorAll("#cancelAddFlight, #cancelAddFlightBtn").forEach(e=>{e.addEventListener("click",()=>this.hideAddFlightForm())});const t=document.getElementById("flightForm");t&&t.addEventListener("submit",e=>{e.preventDefault(),this.saveFlight()})},showAddFlightForm(){document.getElementById("addFlightForm").classList.remove("hidden"),document.getElementById("addFlightForm").scrollIntoView({behavior:"smooth"})},hideAddFlightForm(){document.getElementById("addFlightForm").classList.add("hidden"),document.getElementById("flightForm").reset()},async saveFlight(){const e={type:document.getElementById("flightType").value,date:document.getElementById("flightDate").value,airline:document.getElementById("flightAirline").value,flightNumber:document.getElementById("flightNumber").value.toUpperCase(),from:document.getElementById("flightFrom").value.toUpperCase(),to:document.getElementById("flightTo").value.toUpperCase(),departureTime:document.getElementById("flightDepartureTime").value||"",arrivalTime:document.getElementById("flightArrivalTime").value||"",duration:document.getElementById("flightDuration").value||"",notes:document.getElementById("flightNotes").value||"",addedAt:(new Date).toISOString()};try{this.myFlights.push(e);const n=r(a,"trips",this.currentTripId,"modules","flights");await i(n,{flights:this.myFlights,updatedAt:(new Date).toISOString()},{merge:!0}),t.success("‚úÖ Vuelo guardado correctamente"),this.hideAddFlightForm()}catch(n){console.error("Error guardando vuelo:",n),t.error("‚ùå Error al guardar el vuelo")}},async deleteFlight(e){if(confirm("¬øEliminar este vuelo?"))try{this.myFlights.splice(e,1);const n=r(a,"trips",this.currentTripId,"modules","flights");await i(n,{flights:this.myFlights,updatedAt:(new Date).toISOString()},{merge:!0}),t.success("‚úÖ Vuelo eliminado")}catch(n){console.error("Error eliminando vuelo:",n),t.error("‚ùå Error al eliminar")}}};window.FlightsHandler=pe;const ge="undefined"!=typeof window&&window.RUNTIME_API_KEYS?window.RUNTIME_API_KEYS:{},me={flights:{search:e=>{var t,a;return`${(null==(t=ge.aviationStack)?void 0:t.endpoint)||"http://api.aviationstack.com/v1"}/flights?access_key=${(null==(a=ge.aviationStack)?void 0:a.apiKey)||""}&${new URLSearchParams(e).toString()}`},airlines:()=>{var e,t;return`${(null==(e=ge.aviationStack)?void 0:e.endpoint)||"http://api.aviationstack.com/v1"}/airlines?access_key=${(null==(t=ge.aviationStack)?void 0:t.apiKey)||""}`},airports:e=>{var t,a;return`${(null==(t=ge.aviationStack)?void 0:t.endpoint)||"http://api.aviationstack.com/v1"}/airports?access_key=${(null==(a=ge.aviationStack)?void 0:a.apiKey)||""}&search=${e}`}},hotels:{search:()=>{var e;return`${(null==(e=ge.liteAPI)?void 0:e.searchEndpoint)||"https://api.liteapi.travel/v3.0"}/hotels/search`},list:e=>{var t;return`${(null==(t=ge.liteAPI)?void 0:t.dataEndpoint)||"https://api.liteapi.travel/v3.0/data"}/hotels?${new URLSearchParams(e).toString()}`},details:e=>{var t;return`${(null==(t=ge.liteAPI)?void 0:t.dataEndpoint)||"https://api.liteapi.travel/v3.0/data"}/hotel?hotelId=${e}`},reviews:e=>{var t;return`${(null==(t=ge.liteAPI)?void 0:t.dataEndpoint)||"https://api.liteapi.travel/v3.0/data"}/reviews?hotelId=${e}`},cities:e=>{var t;return`${(null==(t=ge.liteAPI)?void 0:t.dataEndpoint)||"https://api.liteapi.travel/v3.0/data"}/cities?countryCode=${e}`},countries:()=>{var e;return`${(null==(e=ge.liteAPI)?void 0:e.dataEndpoint)||"https://api.liteapi.travel/v3.0/data"}/countries`},prebook:()=>{var e;return`${(null==(e=ge.liteAPI)?void 0:e.bookingEndpoint)||"https://book.liteapi.travel/v3.0"}/rates/prebook`},book:()=>{var e;return`${(null==(e=ge.liteAPI)?void 0:e.bookingEndpoint)||"https://book.liteapi.travel/v3.0"}/rates/book`},bookings:()=>{var e;return`${(null==(e=ge.liteAPI)?void 0:e.bookingEndpoint)||"https://book.liteapi.travel.v3.0"}/bookings`},bookingDetails:e=>{var t;return`${(null==(t=ge.liteAPI)?void 0:t.bookingEndpoint)||"https://book.liteapi.travel/v3.0"}/bookings/${e}`}},places:{search:(e,t,a,n=5e3)=>{var r;return`${(null==(r=ge.foursquare)?void 0:r.endpoint)||"https://api.foursquare.com/v3"}/places/search?ll=${e},${t}&query=${a}&radius=${n}`},nearby:(e,t,a,n=5e3)=>{var r;return`${(null==(r=ge.foursquare)?void 0:r.endpoint)||"https://api.foursquare.com/v3"}/places/nearby?ll=${e},${t}&categories=${a}&radius=${n}`},details:e=>{var t;return`${(null==(t=ge.foursquare)?void 0:t.endpoint)||"https://api.foursquare.com/v3"}/places/${e}`},photos:e=>{var t;return`${(null==(t=ge.foursquare)?void 0:t.endpoint)||"https://api.foursquare.com/v3"}/places/${e}/photos`}},geocoding:{forward:e=>{var t,a;return`${(null==(t=ge.locationIQ)?void 0:t.endpoint)||"https://us1.locationiq.com/v1"}/search?key=${(null==(a=ge.locationIQ)?void 0:a.apiKey)||""}&q=${encodeURIComponent(e)}&format=json`},reverse:(e,t)=>{var a,n;return`${(null==(a=ge.locationIQ)?void 0:a.endpoint)||"https://us1.locationiq.com/v1"}/reverse?key=${(null==(n=ge.locationIQ)?void 0:n.apiKey)||""}&lat=${e}&lon=${t}&format=json`},autocomplete:e=>{var t,a;return`${(null==(t=ge.locationIQ)?void 0:t.endpoint)||"https://us1.locationiq.com/v1"}/autocomplete?key=${(null==(a=ge.locationIQ)?void 0:a.apiKey)||""}&q=${encodeURIComponent(e)}&format=json`}},nominatimGeocode:{forward:e=>{var t;return`${(null==(t=ge.nominatim)?void 0:t.endpoint)||"https://nominatim.openstreetmap.org"}/search?q=${encodeURIComponent(e)}&format=json&limit=1`},reverse:(e,t)=>{var a;return`${(null==(a=ge.nominatim)?void 0:a.endpoint)||"https://nominatim.openstreetmap.org"}/reverse?lat=${e}&lon=${t}&format=json`}},maps:{staticMap:(e,t,a=14)=>{var n,r;return`${(null==(n=ge.geoapify)?void 0:n.endpoint)||"https://api.geoapify.com/v1"}/staticmap?style=osm-bright&width=600&height=400&center=lonlat:${t},${e}&zoom=${a}&apiKey=${(null==(r=ge.geoapify)?void 0:r.apiKey)||""}`},routing:(e,t)=>{var a,n;return`${(null==(a=ge.geoapify)?void 0:a.endpoint)||"https://api.geoapify.com/v1"}/routing?waypoints=${e}|${t}&mode=walk&apiKey=${(null==(n=ge.geoapify)?void 0:n.apiKey)||""}`},places:(e,t,a,n=5e3)=>{var r,i;return`${(null==(r=ge.geoapify)?void 0:r.endpoint)||"https://api.geoapify.com/v1"}/places?categories=${a}&filter=circle:${t},${e},${n}&limit=20&apiKey=${(null==(i=ge.geoapify)?void 0:i.apiKey)||""}`}}};async function ye(e,t={}){var a,n;try{const r={"Content-Type":"application/json",...t.headers};e.includes("liteapi.travel")&&(null==(a=ge.liteAPI)?void 0:a.apiKey)&&(r["X-API-Key"]=ge.liteAPI.apiKey),e.includes("foursquare.com")&&(null==(n=ge.foursquare)?void 0:n.apiKey)&&(r.Authorization=ge.foursquare.apiKey,r.Accept="application/json"),e.includes("nominatim.openstreetmap.org")&&(r["User-Agent"]="JapanTripPlanner/1.0");const i=await fetch(e,{...t,headers:r});if(!i.ok){const e=await i.text();throw new Error(`API Error ${i.status}: ${e}`)}return await i.json()}catch(r){throw console.error("‚ùå API Request failed:",r),r}}function he(){var e,t,a,n,r;return console.log("üîë Verificando APIs configuradas:"),console.log("‚úÖ AviationStack (Vuelos):",(null==(e=ge.aviationStack)?void 0:e.apiKey)?"Configurado":"No configurado"),console.log("‚úÖ LiteAPI (Hoteles):",(null==(t=ge.liteAPI)?void 0:t.apiKey)?"Configurado":"No configurado"),console.log("‚úÖ Geoapify (Mapas):",(null==(a=ge.geoapify)?void 0:a.apiKey)?"Configurado":"No configurado"),console.log("‚úÖ Foursquare (Lugares):",(null==(n=ge.foursquare)?void 0:n.apiKey)?"Configurado":"No configurado"),console.log("‚úÖ LocationIQ (Geocoding):",(null==(r=ge.locationIQ)?void 0:r.apiKey)?"Configurado":"No configurado"),console.log("‚úÖ Nominatim (Backup):","Siempre disponible (gratis)"),!0}window.API_KEYS=ge,window.API_ENDPOINTS=me,window.apiRequest=ye,window.checkAPIConfiguration=he,window.testAPIs=async function(){var e,t;console.log("üß™ Probando APIs...");try{const t=await ye(me.places.nearby(35.6762,139.6503,"16000",1e3));console.log("‚úÖ Foursquare funciona:",(null==(e=t.results)?void 0:e.length)||0,"lugares encontrados")}catch(a){console.log("‚ùå Foursquare fall√≥:",a.message)}try{const e=await ye(me.hotels.countries());console.log("‚úÖ LiteAPI funciona:",(null==(t=e.data)?void 0:t.length)||0,"pa√≠ses disponibles")}catch(a){console.log("‚ùå LiteAPI fall√≥:",a.message)}try{const e=await ye(me.geocoding.forward("Tokyo, Japan"));console.log("‚úÖ LocationIQ funciona:",e.length>0?"Geocoding OK":"Sin resultados")}catch(a){console.log("‚ùå LocationIQ fall√≥:",a.message)}},he();const be={async handleLocalApi(e){var t,a,n,r;const i=new URL(e.url,window.location.origin).pathname,o=e.method.toUpperCase();try{const s=window.ItineraryHandler,l=i.match(/^\/api\/itinerary\/(.+)$/);if("GET"===o&&l){const e=l[1],t=await s.ensureLoaded(),a=((null==t?void 0:t.days)||[]).map(t=>({id:`day-${t.day}`,tripId:e,day:t.day,date:t.date,city:t.city||"",heroImage:t.heroImage||"",activities:t.activities||[]}));return new Response(JSON.stringify(a),{status:200,headers:{"Content-Type":"application/json"}})}const d=i.match(/^\/api\/itinerary\/([^/]+)\/day$/);if("POST"===o&&d){const t=d[1],a=await e.json();await s.ensureLoaded();const n=s.currentItinerary,r={id:`day-${a.day}`,day:a.day,date:a.date,city:a.city||"",heroImage:a.heroImage||"",activities:[]},i=n.days.findIndex(e=>e.day===a.day);return i>=0?n.days[i]=r:n.days.push(r),await(async()=>{const{doc:e,setDoc:a}=await S(async()=>{const{doc:e,setDoc:t}=await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");return{doc:e,setDoc:t}},[]),{db:r}=await S(async()=>{const{db:e}=await import("./notifications-UIywheBc.js").then(e=>e.f);return{db:e}},__vite__mapDeps([1,2])),{FIREBASE_PATHS:i}=await S(async()=>{const{FIREBASE_PATHS:e}=await Promise.resolve().then(()=>se);return{FIREBASE_PATHS:e}},void 0),o=e(r,i.ITINERARY(t));await a(o,n)})(),new Response(JSON.stringify(r),{status:201,headers:{"Content-Type":"application/json"}})}const c=i.match(/^\/api\/activities\/([^/]+)$/);if("GET"===o&&c){const e=c[1];await s.ensureLoaded();const n=parseInt(e.replace("day-","")),r=null==(a=null==(t=s.currentItinerary)?void 0:t.days)?void 0:a.find(e=>e.day===n),i=((null==r?void 0:r.activities)||[]).map(t=>({id:t.id,dayId:e,time:t.time||"",title:t.title||t.name||"",location:t.station||t.location||"",type:t.category||"activity",weather:t.weather||null}));return new Response(JSON.stringify(i),{status:200,headers:{"Content-Type":"application/json"}})}if("POST"===o&&c){const t=c[1],a=await e.json();await s.ensureLoaded();const i=parseInt(t.replace("day-","")),o=s.currentItinerary,l=o.days.find(e=>e.day===i);if(!l)return new Response(JSON.stringify({error:"Day not found"}),{status:404,headers:{"Content-Type":"application/json"}});const d={id:`act-${Date.now()}`,time:a.time||"",title:a.title||"",desc:a.description||"",station:a.location||"",cost:"number"==typeof a.cost?a.cost:0,type:a.type||"activity"};l.activities.push(d);const u=(null==(r=null==(n=window.TripsManager)?void 0:n.currentTrip)?void 0:r.id)||localStorage.getItem("currentTripId");return await(async()=>{const{doc:e,setDoc:t}=await S(async()=>{const{doc:e,setDoc:t}=await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");return{doc:e,setDoc:t}},[]),{db:a}=await S(async()=>{const{db:e}=await import("./notifications-UIywheBc.js").then(e=>e.f);return{db:e}},__vite__mapDeps([1,2])),n=e(a,`trips/${u}/data`,"itinerary");await t(n,o)})(),new Response(JSON.stringify(d),{status:201,headers:{"Content-Type":"application/json"}})}return null}catch(s){return console.error("Local API error:",s),new Response(JSON.stringify({error:String(s)}),{status:500,headers:{"Content-Type":"application/json"}})}},async searchFlights(e,t=null){try{console.log("üîç === SEARCH FLIGHTS (FlightRadar24) ==="),console.log("üìã Par√°metros:",{flightNumber:e,date:t});const a=`/flightsProxy?flight_number=${encodeURIComponent(e)}`;console.log("üîó URL:",a);const n=await fetch(a),r=await n.json();return console.log("üìä Respuesta completa:",r),r.success&&r.data&&r.data.length>0?(console.log(`‚úàÔ∏è ${r.data.length} vuelo(s) encontrado(s)`),{success:!0,data:r.data}):{success:!1,message:"No se encontr√≥ informaci√≥n para ese n√∫mero de vuelo."}}catch(a){return console.error("‚ùå Error buscando vuelo:",a),{success:!1,error:a.message||"Error al buscar el vuelo"}}},async getAirportInfo(e){try{const t=me.flights.airports(e);return{success:!0,data:(await ye(t)).data}}catch(t){return console.error("‚ùå Error obteniendo info de aeropuerto:",t),{success:!1,error:t.message}}},async getFlightStatus(e,t){try{const a=await this.searchFlights(e,t);if(a.success&&a.data.length>0){const e=a.data[0];return{success:!0,status:e.flight_status,departure:e.departure,arrival:e.arrival,airline:e.airline,aircraft:e.aircraft}}return{success:!1,message:"No se pudo obtener el estado del vuelo"}}catch(a){return console.error("‚ùå Error obteniendo estado de vuelo:",a),{success:!1,error:a.message}}},async searchHotels(e,t,a,n=2){var r;try{console.log("üîç Iniciando b√∫squeda de hoteles..."),console.log("üìã Par√°metros:",{cityCode:e,checkIn:t,checkOut:a,guests:n});const i={checkin:t,checkout:a,currency:"USD",guestNationality:"MX",occupancies:[{rooms:1,adults:n,children:[]}],iataCode:e};console.log("üì¶ Datos de b√∫squeda:",i);const o=me.hotels.search();console.log("üîó URL:",o),console.log("üîë API Key presente:",(null==(r=null==ge?void 0:ge.liteAPI)?void 0:r.apiKey)?"S√≠ (***"+ge.liteAPI.apiKey.slice(-4)+")":"No");const s=await ye(o,{method:"POST",body:JSON.stringify(i)});return console.log("üìä Respuesta de API:",s),s.data&&Array.isArray(s.data)&&s.data.length>0?(console.log(`üè® ${s.data.length} hoteles encontrados en ${e}`),{success:!0,hotels:s.data,searchId:s.searchId}):s.data&&Array.isArray(s.data)&&0===s.data.length?(console.log("üòï B√∫squeda exitosa pero sin resultados"),{success:!1,message:"No se encontraron hoteles para las fechas y ciudad seleccionadas"}):s.error?(console.error("‚ùå Error en respuesta de API:",s.error),{success:!1,message:s.error.message||s.error.toString(),error:s.error}):(console.log("‚ö†Ô∏è Respuesta inesperada de la API"),{success:!1,message:"Respuesta inesperada del servidor"})}catch(i){console.error("‚ùå Error buscando hoteles:",i);let e=i.message;return i.message.includes("API Error 401")?e="Error de autenticaci√≥n con la API (401). La clave API es inv√°lida.":i.message.includes("API Error 403")?e="Acceso denegado (403). La API key no tiene permisos.":i.message.includes("API Error 429")?e="L√≠mite de solicitudes excedido (429). Intenta en unos minutos.":i.message.includes("API Error 404")?e="Endpoint no encontrado (404). Verifica la configuraci√≥n de la API.":i.message.includes("API Error 500")?e="Error del servidor (500). Intenta m√°s tarde.":i.message.includes("Failed to fetch")&&(e="Error de red. Verifica tu conexi√≥n a internet."),{success:!1,error:e,originalError:i.message}}},async getHotelDetails(e){try{const t=me.hotels.details(e);return{success:!0,hotel:(await ye(t)).data}}catch(t){return console.error("‚ùå Error obteniendo detalles del hotel:",t),{success:!1,error:t.message}}},async getCitiesByCountry(e="JP"){try{const t=me.hotels.cities(e);return{success:!0,cities:(await ye(t)).data}}catch(t){return console.error("‚ùå Error obteniendo ciudades:",t),{success:!1,error:t.message}}},async searchNearbyPlaces(e,t,a,n=5e3){try{const r={restaurant:"13065",cafe:"13032",bar:"13003",attraction:"16000",temple:"12101",museum:"10027",park:"16032",shopping:"17069",entertainment:"10000"}[a.toLowerCase()]||a,i=me.places.nearby(e,t,r,n),o=await ye(i);return o.results?(console.log(`üìç ${o.results.length} lugares encontrados cerca de (${e}, ${t})`),{success:!0,places:o.results.map(e=>{var t,a,n,r,i,o,s;return{id:e.fsq_id,name:e.name,category:(null==(a=null==(t=e.categories)?void 0:t[0])?void 0:a.name)||"N/A",address:(null==(n=e.location)?void 0:n.formatted_address)||"N/A",distance:e.distance,lat:null==(i=null==(r=e.geocodes)?void 0:r.main)?void 0:i.latitude,lng:null==(s=null==(o=e.geocodes)?void 0:o.main)?void 0:s.longitude,rating:e.rating,photos:e.photos}})}):{success:!1,message:"No se encontraron lugares"}}catch(r){return console.error("‚ùå Error buscando lugares:",r),{success:!1,error:r.message}}},async searchPlacesByQuery(e,t,a,n=5e3){try{const r=me.places.search(e,t,a,n),i=await ye(r);return i.results?{success:!0,places:i.results.map(e=>{var t,a,n,r,i,o,s;return{id:e.fsq_id,name:e.name,category:(null==(a=null==(t=e.categories)?void 0:t[0])?void 0:a.name)||"N/A",address:(null==(n=e.location)?void 0:n.formatted_address)||"N/A",distance:e.distance,lat:null==(i=null==(r=e.geocodes)?void 0:r.main)?void 0:i.latitude,lng:null==(s=null==(o=e.geocodes)?void 0:o.main)?void 0:s.longitude}})}:{success:!1,message:"No se encontraron lugares"}}catch(r){return console.error("‚ùå Error buscando lugares:",r),{success:!1,error:r.message}}},async getPlaceDetails(e){try{const t=me.places.details(e);return{success:!0,place:await ye(t)}}catch(t){return console.error("‚ùå Error obteniendo detalles del lugar:",t),{success:!1,error:t.message}}},async geocodeAddress(e){try{const t=me.geocoding.forward(e),a=await ye(t);if(a&&a.length>0){const e=a[0];return{success:!0,lat:parseFloat(e.lat),lng:parseFloat(e.lon),displayName:e.display_name,boundingBox:e.boundingbox}}return{success:!1,message:"Direcci√≥n no encontrada"}}catch(t){console.error("‚ùå Error en geocoding:",t);try{const t=me.nominatimGeocode.forward(e),a=await ye(t);if(a&&a.length>0){const e=a[0];return{success:!0,lat:parseFloat(e.lat),lng:parseFloat(e.lon),displayName:e.display_name,source:"nominatim"}}}catch(a){console.error("‚ùå Backup geocoding tambi√©n fall√≥:",a)}return{success:!1,error:t.message}}},async reverseGeocode(e,t){try{const a=me.geocoding.reverse(e,t),n=await ye(a);return n?{success:!0,address:n.display_name,details:n.address}:{success:!1,message:"No se pudo obtener la direcci√≥n"}}catch(a){return console.error("‚ùå Error en reverse geocoding:",a),{success:!1,error:a.message}}},async autocompleteAddress(e){try{const t=me.geocoding.autocomplete(e),a=await ye(t);return a&&a.length>0?{success:!0,suggestions:a.map(e=>({displayName:e.display_name,lat:parseFloat(e.lat),lng:parseFloat(e.lon)}))}:{success:!1,message:"No se encontraron sugerencias"}}catch(t){return console.error("‚ùå Error en autocomplete:",t),{success:!1,error:t.message}}},getStaticMapUrl:(e,t,a=14)=>me.maps.staticMap(e,t,a),async calculateRoute(e,t,a="walk"){var n,r;try{const a=`${e.lat},${e.lng}`,i=`${t.lat},${t.lng}`,o=me.maps.routing(a,i),s=await ye(o);if(s.features&&s.features.length>0){const e=s.features[0];return{success:!0,distance:e.properties.distance,duration:e.properties.time,geometry:e.geometry,steps:(null==(r=null==(n=e.properties.legs)?void 0:n[0])?void 0:r.steps)||[]}}return{success:!1,message:"No se pudo calcular la ruta"}}catch(i){return console.error("‚ùå Error calculando ruta:",i),{success:!1,error:i.message}}},async findNearbyPlacesGeoapify(e,t,a,n=5e3){try{const r=me.maps.places(e,t,a,n),i=await ye(r);return i.features?{success:!0,places:i.features.map(e=>({name:e.properties.name,category:e.properties.categories,address:e.properties.formatted,lat:e.properties.lat,lng:e.properties.lon,distance:e.properties.distance}))}:{success:!1,message:"No se encontraron lugares"}}catch(r){return console.error("‚ùå Error buscando lugares:",r),{success:!1,error:r.message}}},async testAllAPIs(){console.log("üß™ Probando todas las APIs...");const e={flights:!1,hotels:!1,places:!1,geocoding:!1,maps:!1};try{const t=await this.getAirportInfo("NRT");e.flights=t.success,console.log("‚úàÔ∏è Vuelos:",e.flights?"‚úÖ":"‚ùå")}catch(t){console.log("‚úàÔ∏è Vuelos: ‚ùå",t.message)}try{const t=await this.getCitiesByCountry("JP");e.hotels=t.success,console.log("üè® Hoteles:",e.hotels?"‚úÖ":"‚ùå")}catch(t){console.log("üè® Hoteles: ‚ùå",t.message)}try{const t=await this.searchNearbyPlaces(35.6762,139.6503,"restaurant",1e3);e.places=t.success,console.log("üìç Lugares:",e.places?"‚úÖ":"‚ùå")}catch(t){console.log("üìç Lugares: ‚ùå",t.message)}try{const t=await this.geocodeAddress("Tokyo Tower, Japan");e.geocoding=t.success,console.log("üó∫Ô∏è Geocoding:",e.geocoding?"‚úÖ":"‚ùå")}catch(t){console.log("üó∫Ô∏è Geocoding: ‚ùå",t.message)}try{const t=this.getStaticMapUrl(35.6762,139.6503,14);e.maps=t.includes("geoapify"),console.log("üó∫Ô∏è Mapas:",e.maps?"‚úÖ":"‚ùå")}catch(t){console.log("üó∫Ô∏è Mapas: ‚ùå",t.message)}return e},notify(e,a){e?t.success(a):t.error(a)},getJapanCityCoordinates:()=>({tokyo:{lat:35.6762,lng:139.6503},kyoto:{lat:35.0116,lng:135.7681},osaka:{lat:34.6937,lng:135.5023},hakone:{lat:35.2324,lng:139.1069},nara:{lat:34.6851,lng:135.8048},hiroshima:{lat:34.3853,lng:132.4553},yokohama:{lat:35.4437,lng:139.638},kamakura:{lat:35.3194,lng:139.5467}})};window.APIsIntegration=be,console.log("üîå APIs Integration module loaded");const ve={currentTripId:null,myHotels:[],recommendations:[],japanCities:{TYO:{name:"Tokyo",lat:35.6762,lng:139.6503},KYO:{name:"Kyoto",lat:35.0116,lng:135.7681},OSA:{name:"Osaka",lat:34.6937,lng:135.5023},NAG:{name:"Nagoya",lat:35.1815,lng:136.9066},FUK:{name:"Fukuoka",lat:33.5904,lng:130.4017},SPK:{name:"Sapporo",lat:43.0642,lng:141.3469},HKD:{name:"Hakone",lat:35.2324,lng:139.1069},HIR:{name:"Hiroshima",lat:34.3853,lng:132.4553}},init(t){this.currentTripId=t,this.render(),e.currentUser&&t&&this.listenToHotels()},async listenToHotels(){const e=r(a,"trips",this.currentTripId,"modules","hotels");l(e,e=>{e.exists()&&(this.myHotels=e.data().hotels||[],this.renderMyHotels())})},render(){const e=document.getElementById("content-hotels");e&&(e.innerHTML=`\n      <div class="max-w-6xl mx-auto p-4 md:p-6">\n        <h2 class="text-4xl font-bold mb-6 text-gray-800 dark:text-white">üè® Gesti√≥n de Hoteles</h2>\n\n        \x3c!-- Mis Reservas --\x3e\n        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-6">\n          <div class="flex justify-between items-center mb-4">\n            <h3 class="text-2xl font-bold dark:text-white flex items-center gap-2">\n              üõèÔ∏è Mis Reservas\n            </h3>\n            <button \n              id="addHotelBtn"\n              class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold transition"\n            >\n              ‚ûï Agregar Hotel\n            </button>\n          </div>\n          \n          <div id="myHotelsList">\n            ${this.renderMyHotelsInitial()}\n          </div>\n        </div>\n\n        \x3c!-- Formulario de Agregar Hotel (Hidden) --\x3e\n        <div id="addHotelForm" class="hidden bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-6">\n          ${this.renderAddHotelForm()}\n        </div>\n\n        \x3c!-- Buscar Hoteles - Disabled (API key invalid) --\x3e\n        <div class="bg-gradient-to-r from-gray-400 to-gray-500 text-white rounded-xl shadow-lg p-6 mb-6 relative overflow-hidden">\n          <div class="absolute top-0 right-0 bg-yellow-500 text-black text-xs font-bold px-3 py-1 rounded-bl-lg">\n            ‚ö†Ô∏è No disponible\n          </div>\n          <h3 class="text-2xl font-bold mb-4 flex items-center gap-2 opacity-60">\n            üîç Buscar Hoteles Disponibles\n          </h3>\n          <p class="text-sm opacity-70 mb-4">\n            La API de b√∫squeda de hoteles requiere una clave v√°lida\n          </p>\n\n          <div class="opacity-50 pointer-events-none">\n            ${this.renderHotelSearchForm()}\n          </div>\n\n          <div class="mt-4 p-4 bg-white/20 rounded-lg backdrop-blur-sm">\n            <p class="text-sm">\n              üí° <strong>Tip:</strong> Usa la secci√≥n "Mis Reservas" arriba para agregar manualmente tus hoteles, o visita las plataformas de reserva abajo para buscar y comparar precios.\n            </p>\n          </div>\n        </div>\n\n        \x3c!-- Plataformas de Reserva --\x3e\n        ${this.renderBookingPlatforms()}\n\n        \x3c!-- Tips de Hoteles --\x3e\n        ${this.renderHotelTips()}\n      </div>\n    `,this.attachEventListeners())},renderMyHotelsInitial(){return 0===this.myHotels.length?'\n        <div class="text-center py-12 text-gray-500 dark:text-gray-400">\n          <div class="text-6xl mb-4">üè®</div>\n          <p class="text-lg font-semibold">No hay hoteles registrados</p>\n          <p class="text-sm">Agrega tus reservas para tener toda la informaci√≥n organizada</p>\n        </div>\n      ':'<div id="hotelsListContainer"></div>'},renderMyHotels(){const e=document.getElementById("hotelsListContainer");e&&(0!==this.myHotels.length?e.innerHTML=this.myHotels.map((e,t)=>`\n      <div class="p-5 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-lg mb-4 border-l-4 border-purple-500">\n        <div class="flex justify-between items-start mb-3">\n          <div class="flex-1">\n            <h4 class="text-lg font-bold dark:text-white">${e.name}</h4>\n            <p class="text-sm text-gray-600 dark:text-gray-300">üìç ${e.city}</p>\n          </div>\n          <div class="flex gap-2">\n            ${e.bookingUrl?`\n              <a \n                href="${e.bookingUrl}" \n                target="_blank"\n                class="text-xs bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600"\n              >\n                üîó Ver\n              </a>\n            `:""}\n            <button \n              onclick="HotelsHandler.deleteHotel(${t})"\n              class="text-red-500 hover:text-red-700"\n            >\n              üóëÔ∏è\n            </button>\n          </div>\n        </div>\n        \n        <div class="grid md:grid-cols-2 gap-4 mb-3">\n          <div class="p-3 bg-white dark:bg-gray-700 rounded-lg">\n            <p class="text-xs text-gray-500 dark:text-gray-400 mb-1">Check-in</p>\n            <p class="font-semibold dark:text-white">${new Date(e.checkIn).toLocaleDateString("es-MX",{weekday:"short",day:"numeric",month:"short"})}</p>\n          </div>\n          <div class="p-3 bg-white dark:bg-gray-700 rounded-lg">\n            <p class="text-xs text-gray-500 dark:text-gray-400 mb-1">Check-out</p>\n            <p class="font-semibold dark:text-white">${new Date(e.checkOut).toLocaleDateString("es-MX",{weekday:"short",day:"numeric",month:"short"})}</p>\n          </div>\n        </div>\n\n        ${e.price?`\n          <div class="mb-3 p-2 bg-green-50 dark:bg-green-900/20 rounded">\n            <p class="text-sm font-semibold text-green-700 dark:text-green-400">\n              üí∞ ${e.price} ${e.currency||"USD"}\n              ${e.nights?` (${e.nights} noches)`:""}\n            </p>\n          </div>\n        `:""}\n\n        ${e.address?`\n          <p class="text-xs text-gray-600 dark:text-gray-400 mb-2">\n            üìß ${e.address}\n          </p>\n        `:""}\n\n        ${e.confirmationCode?`\n          <div class="p-2 bg-yellow-50 dark:bg-yellow-900/20 rounded">\n            <p class="text-xs font-semibold text-gray-800 dark:text-white">\n              üé´ Confirmaci√≥n: ${e.confirmationCode}\n            </p>\n          </div>\n        `:""}\n\n        ${e.notes?`\n          <div class="mt-2 p-2 bg-blue-50 dark:bg-blue-900/20 rounded text-xs">\n            üìù ${e.notes}\n          </div>\n        `:""}\n      </div>\n    `).join(""):document.getElementById("myHotelsList").innerHTML=this.renderMyHotelsInitial())},renderAddHotelForm(){return`\n      <div class="flex justify-between items-center mb-4">\n        <h3 class="text-xl font-bold dark:text-white">‚ûï Agregar Reserva de Hotel</h3>\n        <button \n          id="cancelAddHotel"\n          class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"\n        >\n          ‚úï Cancelar\n        </button>\n      </div>\n\n      <form id="hotelForm">\n        <div class="grid md:grid-cols-2 gap-4">\n          <div>\n            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n              Nombre del Hotel *\n            </label>\n            <input \n              type="text"\n              id="hotelName"\n              placeholder="Ej: APA Hotel Shinjuku"\n              class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n              required\n            >\n          </div>\n\n          <div>\n            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n              Ciudad *\n            </label>\n            <select \n              id="hotelCity"\n              class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n              required\n            >\n              <option value="">Selecciona ciudad</option>\n              ${Object.entries(this.japanCities).map(([e,t])=>`\n                <option value="${t.name}">${t.name}</option>\n              `).join("")}\n              <option value="Otra">Otra ciudad</option>\n            </select>\n          </div>\n\n          <div>\n            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n              Check-in *\n            </label>\n            <input \n              type="date"\n              id="hotelCheckIn"\n              class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n              required\n            >\n          </div>\n\n          <div>\n            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n              Check-out *\n            </label>\n            <input \n              type="date"\n              id="hotelCheckOut"\n              class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n              required\n            >\n          </div>\n\n          <div>\n            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n              Precio Total (opcional)\n            </label>\n            <input \n              type="number"\n              id="hotelPrice"\n              placeholder="15000"\n              class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n            >\n          </div>\n\n          <div>\n            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n              Moneda\n            </label>\n            <select \n              id="hotelCurrency"\n              class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n            >\n              <option value="JPY">JPY (Yen)</option>\n              <option value="USD" selected>USD (D√≥lares)</option>\n              <option value="MXN">MXN (Pesos)</option>\n            </select>\n          </div>\n\n          <div class="md:col-span-2">\n            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n              Direcci√≥n (opcional)\n            </label>\n            <input \n              type="text"\n              id="hotelAddress"\n              placeholder="3-10-3 Shinjuku, Tokyo"\n              class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n            >\n          </div>\n\n          <div>\n            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n              C√≥digo de Confirmaci√≥n (opcional)\n            </label>\n            <input \n              type="text"\n              id="hotelConfirmation"\n              placeholder="ABC123456"\n              class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n            >\n          </div>\n\n          <div>\n            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n              URL de Reserva (opcional)\n            </label>\n            <input \n              type="url"\n              id="hotelUrl"\n              placeholder="https://booking.com/..."\n              class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n            >\n          </div>\n\n          <div class="md:col-span-2">\n            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">\n              Notas (opcional)\n            </label>\n            <textarea \n              id="hotelNotes"\n              rows="2"\n              placeholder="Desayuno incluido, cerca del metro, etc."\n              class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n            ></textarea>\n          </div>\n        </div>\n\n        <div class="mt-6 flex justify-end gap-4">\n          <button \n            type="button"\n            id="cancelAddHotelBtn"\n            class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-6 rounded-lg transition"\n          >\n            Cancelar\n          </button>\n          <button \n            type="submit"\n            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition"\n          >\n            üíæ Guardar Hotel\n          </button>\n        </div>\n      </form>\n    `},renderHotelSearchForm(){return`\n      <div class="grid md:grid-cols-2 gap-4">\n        <div>\n          <label class="block text-sm font-semibold mb-2 opacity-90">\n            Ciudad\n          </label>\n          <select \n            id="searchCity"\n            class="w-full p-3 border-2 border-white/30 rounded-lg bg-white/20 font-semibold backdrop-blur-sm text-gray-900"\n          >\n            <option value="" class="text-gray-900 bg-white">Selecciona ciudad</option>\n            ${Object.entries(this.japanCities).map(([e,t])=>`\n              <option value="${e}" class="text-gray-900 bg-white">${t.name}</option>\n            `).join("")}\n          </select>\n        </div>\n\n        <div>\n          <label class="block text-sm font-semibold mb-2 opacity-90">\n            Hu√©spedes\n          </label>\n          <input \n            type="number"\n            id="searchGuests"\n            value="2"\n            min="1"\n            max="10"\n            class="w-full p-3 border-2 border-white/30 rounded-lg bg-white/20 font-semibold backdrop-blur-sm text-gray-900"\n          >\n        </div>\n\n        <div>\n          <label class="block text-sm font-semibold mb-2 opacity-90">\n            Check-in\n          </label>\n          <input \n            type="date"\n            id="searchCheckIn"\n            class="w-full p-3 border-2 border-white/30 rounded-lg bg-white/20 font-semibold backdrop-blur-sm text-gray-900"\n          >\n        </div>\n\n        <div>\n          <label class="block text-sm font-semibold mb-2 opacity-90">\n            Check-out\n          </label>\n          <input \n            type="date"\n            id="searchCheckOut"\n            class="w-full p-3 border-2 border-white/30 rounded-lg bg-white/20 font-semibold backdrop-blur-sm text-gray-900"\n          >\n        </div>\n\n        <div class="md:col-span-2">\n          <button \n            id="searchHotelsBtn"\n            class="w-full bg-white text-purple-600 py-3 rounded-lg hover:bg-purple-50 transition font-bold text-lg"\n          >\n            üîç Buscar Hoteles Disponibles\n          </button>\n        </div>\n      </div>\n\n      <div id="searchLoading" class="hidden mt-4 p-4 bg-white/10 rounded-lg backdrop-blur-sm text-center">\n        <p class="font-semibold">üîÑ Buscando hoteles...</p>\n        <p class="text-sm opacity-80 mt-1">Esto puede tomar unos segundos</p>\n      </div>\n    `},renderEmptyRecommendations:()=>'\n      <div class="text-center py-8 text-gray-500 dark:text-gray-400">\n        <div class="text-5xl mb-3">üè®</div>\n        <p class="font-semibold">Sin recomendaciones a√∫n</p>\n        <p class="text-sm">Usa el buscador arriba para ver hoteles disponibles</p>\n      </div>\n    ',renderRecommendations(){const e=document.getElementById("recommendationsList");e&&(0!==this.recommendations.length?e.innerHTML=`\n      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">\n        ${this.recommendations.map(e=>`\n          <div class="p-4 bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-lg border border-purple-200 dark:border-purple-800">\n            <div class="flex justify-between items-start mb-2">\n              <h4 class="font-bold dark:text-white text-sm">${e.name}</h4>\n              <span class="text-yellow-500 text-xs">‚≠ê ${e.rating||"N/A"}</span>\n            </div>\n            \n            <p class="text-xs text-gray-600 dark:text-gray-400 mb-3">\n              üìç ${e.address||"Direcci√≥n no disponible"}\n            </p>\n\n            ${e.price?`\n              <div class="mb-3 p-2 bg-green-100 dark:bg-green-900/30 rounded">\n                <p class="text-sm font-bold text-green-700 dark:text-green-400">\n                  üí∞ ${e.price} ${e.currency||"USD"}\n                </p>\n                <p class="text-xs text-gray-600 dark:text-gray-400">\n                  ${e.nights?`${e.nights} noches`:"Precio total"}\n                </p>\n              </div>\n            `:""}\n\n            ${e.amenities&&e.amenities.length>0?`\n              <div class="mb-3">\n                <p class="text-xs font-semibold text-gray-700 dark:text-gray-300 mb-1">Amenidades:</p>\n                <div class="flex flex-wrap gap-1">\n                  ${e.amenities.slice(0,3).map(e=>`\n                    <span class="text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 px-2 py-1 rounded">\n                      ${e}\n                    </span>\n                  `).join("")}\n                </div>\n              </div>\n            `:""}\n\n            <button \n              onclick="HotelsHandler.addRecommendationToMyHotels(${this.recommendations.indexOf(e)})"\n              class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 rounded-lg text-sm font-semibold transition"\n            >\n              ‚ûï Agregar a Mis Hoteles\n            </button>\n          </div>\n        `).join("")}\n      </div>\n\n      <div class="mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">\n        <p class="text-sm text-gray-700 dark:text-gray-300">\n          üí° <strong>Tip:</strong> Los precios son aproximados. Visita las plataformas de reserva para ver precios actuales y ofertas.\n        </p>\n      </div>\n    `:e.innerHTML=this.renderEmptyRecommendations())},renderBookingPlatforms:()=>`\n      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-6">\n        <h3 class="text-2xl font-bold mb-4 dark:text-white">üîó Plataformas de Reserva</h3>\n        <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">\n          Compara precios en diferentes plataformas para encontrar las mejores ofertas\n        </p>\n\n        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">\n          ${[{name:"Booking.com",url:"https://www.booking.com",icon:"üè®",color:"from-blue-500 to-blue-600"},{name:"Agoda",url:"https://www.agoda.com",icon:"üåè",color:"from-red-500 to-pink-600"},{name:"Hotels.com",url:"https://www.hotels.com",icon:"üõèÔ∏è",color:"from-purple-500 to-indigo-600"},{name:"Expedia",url:"https://www.expedia.com",icon:"‚úàÔ∏è",color:"from-yellow-500 to-orange-600"},{name:"Airbnb",url:"https://www.airbnb.com",icon:"üè†",color:"from-pink-500 to-red-600"}].map(e=>`\n            <a \n              href="${e.url}" \n              target="_blank"\n              class="p-4 bg-gradient-to-r ${e.color} text-white rounded-lg hover:shadow-lg transition transform hover:scale-105"\n            >\n              <div class="flex items-center justify-between">\n                <div class="flex items-center gap-3">\n                  <span class="text-3xl">${e.icon}</span>\n                  <span class="font-bold">${e.name}</span>\n                </div>\n                <span class="text-xl">‚Üí</span>\n              </div>\n            </a>\n          `).join("")}\n        </div>\n      </div>\n    `,renderHotelTips:()=>'\n      <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl shadow-lg p-6">\n        <h3 class="text-2xl font-bold mb-4">üí° Tips para Hoteles en Jap√≥n</h3>\n        \n        <div class="grid md:grid-cols-2 gap-4">\n          <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4">\n            <p class="font-bold mb-2">üè® Tipos de Alojamiento</p>\n            <p class="text-sm opacity-90">Business hotels (b√°sicos), Ryokan (tradicional), Capsule hotels (econ√≥micos), APA/Toyoko Inn (cadenas).</p>\n          </div>\n\n          <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4">\n            <p class="font-bold mb-2">üïê Check-in/out</p>\n            <p class="text-sm opacity-90">Check-in t√≠picamente 15:00-16:00. Check-out 10:00-11:00. ¬°S√© puntual!</p>\n          </div>\n\n          <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4">\n            <p class="font-bold mb-2">üëû Sin zapatos</p>\n            <p class="text-sm opacity-90">En Ryokan y algunos hoteles, dejas zapatos en entrada. Usan pantuflas internas.</p>\n          </div>\n\n          <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4">\n            <p class="font-bold mb-2">üõÅ Onsen privado</p>\n            <p class="text-sm opacity-90">Muchos hoteles tienen ba√±os onsen. D√∫chate ANTES de entrar al onsen.</p>\n          </div>\n\n          <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4">\n            <p class="font-bold mb-2">üì¶ Env√≠a tu maleta</p>\n            <p class="text-sm opacity-90">Usa Takkyubin (¬•2000-3000) para enviar maletas entre hoteles. ¬°Muy c√≥modo!</p>\n          </div>\n\n          <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4">\n            <p class="font-bold mb-2">üó£Ô∏è Ingl√©s limitado</p>\n            <p class="text-sm opacity-90">Muchos hoteles tienen poco ingl√©s. Usa Google Translate o tarjetas con frases.</p>\n          </div>\n        </div>\n      </div>\n    ',attachEventListeners(){const e=document.getElementById("addHotelBtn");e&&e.addEventListener("click",()=>this.showAddHotelForm());document.querySelectorAll("#cancelAddHotel, #cancelAddHotelBtn").forEach(e=>{e.addEventListener("click",()=>this.hideAddHotelForm())});const t=document.getElementById("hotelForm");t&&t.addEventListener("submit",e=>{e.preventDefault(),this.saveHotel()});const a=document.getElementById("searchHotelsBtn");a&&a.addEventListener("click",()=>this.searchHotels())},showAddHotelForm(){document.getElementById("addHotelForm").classList.remove("hidden"),document.getElementById("addHotelForm").scrollIntoView({behavior:"smooth"})},hideAddHotelForm(){document.getElementById("addHotelForm").classList.add("hidden"),document.getElementById("hotelForm").reset()},async saveHotel(){const e=document.getElementById("hotelCheckIn").value,n=document.getElementById("hotelCheckOut").value,o=Math.ceil((new Date(n)-new Date(e))/864e5),s={name:document.getElementById("hotelName").value,city:document.getElementById("hotelCity").value,checkIn:e,checkOut:n,nights:o,price:document.getElementById("hotelPrice").value||"",currency:document.getElementById("hotelCurrency").value,address:document.getElementById("hotelAddress").value||"",confirmationCode:document.getElementById("hotelConfirmation").value||"",bookingUrl:document.getElementById("hotelUrl").value||"",notes:document.getElementById("hotelNotes").value||"",addedAt:(new Date).toISOString()};try{this.myHotels.push(s);const e=r(a,"trips",this.currentTripId,"modules","hotels");await i(e,{hotels:this.myHotels,updatedAt:(new Date).toISOString()},{merge:!0}),t.success("‚úÖ Hotel guardado correctamente"),this.hideAddHotelForm()}catch(l){console.error("Error guardando hotel:",l),t.error("‚ùå Error al guardar el hotel")}},async deleteHotel(e){if(confirm("¬øEliminar esta reserva?"))try{this.myHotels.splice(e,1);const n=r(a,"trips",this.currentTripId,"modules","hotels");await i(n,{hotels:this.myHotels,updatedAt:(new Date).toISOString()},{merge:!0}),t.success("‚úÖ Hotel eliminado")}catch(n){console.error("Error eliminando hotel:",n),t.error("‚ùå Error al eliminar")}},async searchHotels(){var e,a;const n=document.getElementById("searchCity").value,r=document.getElementById("searchCheckIn").value,i=document.getElementById("searchCheckOut").value,o=parseInt(document.getElementById("searchGuests").value);if(!n||!r||!i)return void t.error("‚ö†Ô∏è Completa todos los campos");const s=document.getElementById("searchLoading"),l=document.getElementById("recommendationsList");s.classList.remove("hidden"),l.innerHTML="";try{if(console.log("üîç Buscando hoteles:",{cityCode:n,checkIn:r,checkOut:i,guests:o}),console.log("üîë API Keys disponibles:",window.API_KEYS?"S√≠":"No"),console.log("üîë LiteAPI configurada:",(null==(a=null==(e=window.API_KEYS)?void 0:e.liteAPI)?void 0:a.apiKey)?"S√≠":"No"),!window.API_KEYS||!window.API_KEYS.liteAPI||!window.API_KEYS.liteAPI.apiKey)throw new Error("La API de hoteles no est√° configurada. Por favor contacta al administrador.");const s=await be.searchHotels(n,r,i,o);if(console.log("üìä Resultado de b√∫squeda:",s),s.success&&s.hotels&&s.hotels.length>0){const e=Math.ceil((new Date(i)-new Date(r))/864e5);this.recommendations=s.hotels.slice(0,9).map(t=>{var a,r;return{name:t.hotelName||t.name||"Hotel",address:t.address||"Direcci√≥n no disponible",price:(null==(a=t.rate)?void 0:a.totalAmount)||null,currency:(null==(r=t.rate)?void 0:r.currency)||"USD",rating:t.starRating||null,nights:e,amenities:t.amenities||[],city:this.japanCities[n].name}}),this.renderRecommendations(),t.success(`‚úÖ ${s.hotels.length} hoteles encontrados`)}else{const e=s.message||s.error||"No se encontraron hoteles disponibles";l.innerHTML=`\n          <div class="text-center py-8 text-gray-500 dark:text-gray-400">\n            <div class="text-5xl mb-3">üòï</div>\n            <p class="font-semibold">No se encontraron hoteles</p>\n            <p class="text-sm">${e}</p>\n            <p class="text-xs mt-4 text-gray-400">Intenta con otras fechas o ciudad</p>\n          </div>\n        `,t.error("‚ùå "+e)}}catch(d){console.error("‚ùå Error buscando hoteles:",d);let e=d.message,a="";d.message.includes("API de hoteles no est√° configurada")?a="Las claves de API no est√°n disponibles en este entorno.":d.message.includes("401")||d.message.includes("Unauthorized")?(e="Error de autenticaci√≥n con la API de hoteles",a="La clave API es inv√°lida o ha expirado."):d.message.includes("403")||d.message.includes("Forbidden")?(e="Acceso denegado a la API de hoteles",a="La API key no tiene permisos suficientes."):d.message.includes("429")||d.message.includes("Too Many Requests")?(e="L√≠mite de b√∫squedas excedido",a="Has realizado demasiadas b√∫squedas. Intenta en unos minutos."):(d.message.includes("Failed to fetch")||d.message.includes("Network"))&&(e="Error de conexi√≥n",a="No se pudo conectar con el servidor. Verifica tu conexi√≥n a internet."),l.innerHTML=`\n        <div class="text-center py-8 text-gray-500 dark:text-gray-400">\n          <div class="text-5xl mb-3">‚ö†Ô∏è</div>\n          <p class="font-semibold text-lg mb-2">${e}</p>\n          <p class="text-sm mb-4">${a}</p>\n          <details class="mt-4 text-left max-w-md mx-auto">\n            <summary class="cursor-pointer text-xs text-gray-400 hover:text-gray-600">Detalles t√©cnicos</summary>\n            <pre class="mt-2 p-3 bg-gray-100 dark:bg-gray-900 rounded text-xs overflow-auto">${d.stack||d.message}</pre>\n          </details>\n        </div>\n      `,t.error("‚ùå "+e)}finally{s.classList.add("hidden")}},addRecommendationToMyHotels(e){const a=this.recommendations[e];a&&(this.showAddHotelForm(),setTimeout(()=>{document.getElementById("hotelName").value=a.name,document.getElementById("hotelCity").value=a.city,document.getElementById("hotelAddress").value=a.address,a.price&&(document.getElementById("hotelPrice").value=a.price,document.getElementById("hotelCurrency").value=a.currency)},100),t.success("‚úÖ Datos pre-cargados. Completa fechas y guarda."))}};window.HotelsHandler=ve;const xe=[{id:"culture",name:"Cultura",icon:"üèõÔ∏è",color:"purple",description:"Templos, museos, historia y tradiciones"},{id:"food",name:"Gastronom√≠a",icon:"üçú",color:"red",description:"Restaurantes, mercados y experiencias culinarias"},{id:"nature",name:"Naturaleza",icon:"üåø",color:"green",description:"Parques, jardines y paisajes naturales"},{id:"shopping",name:"Compras",icon:"üõçÔ∏è",color:"pink",description:"Tiendas, centros comerciales y mercados"},{id:"nightlife",name:"Vida Nocturna",icon:"üåÉ",color:"indigo",description:"Bares, clubs y entretenimiento nocturno"},{id:"adventure",name:"Aventura",icon:"üèîÔ∏è",color:"orange",description:"Deportes extremos y actividades al aire libre"},{id:"relaxation",name:"Relajaci√≥n",icon:"üßò",color:"blue",description:"Spas, onsens y actividades tranquilas"},{id:"photography",name:"Fotograf√≠a",icon:"üì∏",color:"yellow",description:"Lugares instagrameables y vistas panor√°micas"},{id:"anime",name:"Anime/Manga",icon:"üéÆ",color:"violet",description:"Tiendas, caf√©s tem√°ticos y cultura otaku"},{id:"family",name:"Familia",icon:"üë®‚Äçüë©‚Äçüëß‚Äçüë¶",color:"cyan",description:"Actividades para todas las edades"}],fe=[{id:"cultural",name:"Inmersi√≥n Cultural",description:"Enfocado en templos, museos y experiencias tradicionales",categories:["culture","food","photography"],icon:"üèõÔ∏è",color:"purple",pace:"moderate"},{id:"foodie",name:"Tour Gastron√≥mico",description:"Los mejores restaurantes, mercados y experiencias culinarias",categories:["food","culture"],icon:"üçú",color:"red",pace:"relaxed"},{id:"adventure",name:"Aventura Extrema",description:"Actividades al aire libre, deportes y naturaleza",categories:["adventure","nature","photography"],icon:"üèîÔ∏è",color:"orange",pace:"intense"},{id:"relaxed",name:"Viaje Relajado",description:"Ritmo tranquilo con spas, caf√©s y paseos",categories:["relaxation","food","shopping"],icon:"üßò",color:"blue",pace:"relaxed"},{id:"otaku",name:"Para√≠so Otaku",description:"Anime, manga, caf√©s tem√°ticos y cultura pop japonesa",categories:["anime","shopping","food"],icon:"üéÆ",color:"violet",pace:"moderate"},{id:"complete",name:"Experiencia Completa",description:"Un balance perfecto de todo tipo de actividades",categories:["culture","food","nature","shopping","photography"],icon:"‚ú®",color:"gradient",pace:"moderate"},{id:"family",name:"Viaje Familiar",description:"Actividades para todas las edades con ritmo flexible",categories:["family","nature","culture","food"],icon:"üë®‚Äçüë©‚Äçüëß‚Äçüë¶",color:"cyan",pace:"relaxed"},{id:"photographer",name:"Safari Fotogr√°fico",description:"Los mejores spots para fotos en Jap√≥n",categories:["photography","nature","culture"],icon:"üì∏",color:"yellow",pace:"moderate"}],ke={tokyo:{city:"Tokyo",cityImage:"https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?w=1200&q=80",activities:[{id:"tokyo-sensoji",name:"Templo Senso-ji",category:"culture",duration:120,cost:0,description:"El templo m√°s antiguo de Tokyo con la famosa calle Nakamise",location:{lat:35.7148,lng:139.7967},station:"Asakusa Station",rating:4.8,timeOfDay:["morning","afternoon"],bestSeason:"all",image:"https://images.unsplash.com/photo-1528164344705-47542687000d?w=800&q=80"},{id:"tokyo-meiji",name:"Santuario Meiji",category:"culture",duration:90,cost:0,description:"Santuario sinto√≠sta en un bosque urbano",location:{lat:35.6764,lng:139.6993},station:"Harajuku Station",rating:4.7,timeOfDay:["morning","afternoon"],bestSeason:"all",image:"https://images.unsplash.com/photo-1590559899731-a382839e5549?w=800&q=80"},{id:"tokyo-tsukiji",name:"Mercado Tsukiji Outer Market",category:"food",duration:180,cost:3e3,description:"Mejor mercado de pescado y street food",location:{lat:35.6654,lng:139.7707},station:"Tsukijishijo Station",rating:4.6,timeOfDay:["morning"],bestSeason:"all"},{id:"tokyo-ichiran",name:"Ichiran Ramen Shibuya",category:"food",duration:60,cost:1e3,description:"Famoso ramen en cabinas individuales",location:{lat:35.6595,lng:139.7004},station:"Shibuya Station",rating:4.5,timeOfDay:["lunch","dinner"],bestSeason:"all",image:"https://images.unsplash.com/photo-1569718212165-3a8278d5f624?w=800&q=80"},{id:"tokyo-robot-restaurant",name:"Robot Restaurant",category:"nightlife",duration:120,cost:8e3,description:"Show espectacular con robots gigantes",location:{lat:35.6938,lng:139.7035},station:"Shinjuku Station",rating:4.3,timeOfDay:["evening"],bestSeason:"all"},{id:"tokyo-shibuya-crossing",name:"Shibuya Crossing",category:"photography",duration:60,cost:0,description:"El cruce peatonal m√°s famoso del mundo",location:{lat:35.6595,lng:139.7004},station:"Shibuya Station",rating:4.7,timeOfDay:["afternoon","evening"],bestSeason:"all"},{id:"tokyo-skytree",name:"Tokyo Skytree",category:"photography",duration:120,cost:2100,description:"Torre m√°s alta de Jap√≥n con vistas 360¬∞",location:{lat:35.7101,lng:139.8107},station:"Tokyo Skytree Station",rating:4.5,timeOfDay:["afternoon","evening"],bestSeason:"all"},{id:"tokyo-tower",name:"Torre de Tokyo",category:"photography",duration:90,cost:1200,description:"Torre ic√≥nica inspirada en la Torre Eiffel",location:{lat:35.6586,lng:139.7454},station:"Akabanebashi Station",rating:4.4,timeOfDay:["afternoon","evening"],bestSeason:"all"},{id:"tokyo-shinjuku-gyoen",name:"Jard√≠n Shinjuku Gyoen",category:"nature",duration:120,cost:500,description:"Jard√≠n tradicional japon√©s con cerezos",location:{lat:35.6852,lng:139.71},station:"Shinjuku-Gyoemmae Station",rating:4.7,timeOfDay:["morning","afternoon"],bestSeason:"spring"},{id:"tokyo-harajuku",name:"Takeshita Street Harajuku",category:"shopping",duration:120,cost:5e3,description:"Calle de moda kawaii y cultura juvenil",location:{lat:35.6702,lng:139.7026},station:"Harajuku Station",rating:4.6,timeOfDay:["afternoon"],bestSeason:"all"},{id:"tokyo-akihabara",name:"Akihabara Electric Town",category:"anime",duration:180,cost:0,description:"Para√≠so de la electr√≥nica, anime y manga",location:{lat:35.7022,lng:139.7744},station:"Akihabara Station",rating:4.7,timeOfDay:["afternoon","evening"],bestSeason:"all"},{id:"tokyo-pokemon-cafe",name:"Pokemon Cafe",category:"anime",duration:90,cost:2e3,description:"Caf√© tem√°tico de Pokemon (requiere reserva)",location:{lat:35.6812,lng:139.7671},station:"Nihonbashi Station",rating:4.8,timeOfDay:["lunch","afternoon"],bestSeason:"all",requiresReservation:!0},{id:"tokyo-kirby-cafe",name:"Kirby Cafe",category:"anime",duration:90,cost:1500,description:"Caf√© adorable de Kirby",location:{lat:35.6812,lng:139.7671},station:"Tokyo Station",rating:4.7,timeOfDay:["lunch","afternoon"],bestSeason:"all",requiresReservation:!0},{id:"tokyo-oedo-onsen",name:"Oedo Onsen Monogatari",category:"relaxation",duration:180,cost:2900,description:"Complejo de ba√±os termales estilo Edo",location:{lat:35.6269,lng:139.7864},station:"Telecom Center Station",rating:4.4,timeOfDay:["evening"],bestSeason:"all"}]},kyoto:{city:"Kyoto",activities:[{id:"kyoto-fushimi-inari",name:"Fushimi Inari Shrine",category:"culture",duration:180,cost:0,description:"Miles de puertas torii rojas en la monta√±a",location:{lat:34.9671,lng:135.7727},station:"Inari Station",rating:4.8,timeOfDay:["morning","afternoon"],bestSeason:"all"},{id:"kyoto-kinkakuji",name:"Templo Kinkaku-ji (Pabell√≥n Dorado)",category:"culture",duration:90,cost:400,description:"Templo cubierto en pan de oro",location:{lat:35.0394,lng:135.7292},station:"Kinkakuji-michi Bus Stop",rating:4.7,timeOfDay:["morning","afternoon"],bestSeason:"all"},{id:"kyoto-kiyomizu",name:"Kiyomizu-dera Temple",category:"culture",duration:120,cost:400,description:"Templo con terraza de madera y vistas panor√°micas",location:{lat:34.9949,lng:135.785},station:"Gojo Station",rating:4.6,timeOfDay:["morning","afternoon"],bestSeason:"spring"},{id:"kyoto-gion",name:"Distrito Gion",category:"culture",duration:120,cost:0,description:"Barrio de geishas con arquitectura tradicional",location:{lat:35.0036,lng:135.7753},station:"Gion-Shijo Station",rating:4.7,timeOfDay:["afternoon","evening"],bestSeason:"all"},{id:"kyoto-tea-ceremony",name:"Ceremonia del T√©",category:"culture",duration:90,cost:3500,description:"Experiencia aut√©ntica de ceremonia del t√©",location:{lat:35.0116,lng:135.7681},station:"Arashiyama Station",rating:4.8,timeOfDay:["morning","afternoon"],bestSeason:"all",requiresReservation:!0},{id:"kyoto-arashiyama",name:"Bosque de Bamb√∫ Arashiyama",category:"nature",duration:60,cost:0,description:"Sendero m√°gico entre bamb√∫es gigantes",location:{lat:35.017,lng:135.6726},station:"Saga-Arashiyama Station",rating:4.7,timeOfDay:["morning"],bestSeason:"all"},{id:"kyoto-philosopher-path",name:"Camino del Fil√≥sofo",category:"nature",duration:90,cost:0,description:"Sendero junto al canal con cerezos",location:{lat:35.0262,lng:135.7946},station:"Ginkakuji-michi Bus Stop",rating:4.6,timeOfDay:["morning","afternoon"],bestSeason:"spring"},{id:"kyoto-torii-gates",name:"Puertas Torii de Fushimi Inari",category:"photography",duration:180,cost:0,description:"Spot fotogr√°fico m√°s ic√≥nico de Kyoto",location:{lat:34.9671,lng:135.7727},station:"Inari Station",rating:4.9,timeOfDay:["morning","afternoon"],bestSeason:"all"}]},osaka:{city:"Osaka",activities:[{id:"osaka-castle",name:"Castillo de Osaka",category:"culture",duration:120,cost:600,description:"Castillo hist√≥rico con museo y jardines",location:{lat:34.6873,lng:135.5262},station:"Osakajokoen Station",rating:4.5,timeOfDay:["morning","afternoon"],bestSeason:"spring"},{id:"osaka-dotonbori",name:"Dotonbori",category:"food",duration:180,cost:4e3,description:"Calle de comida con el famoso Glico Man",location:{lat:34.6686,lng:135.5004},station:"Namba Station",rating:4.7,timeOfDay:["evening"],bestSeason:"all"},{id:"osaka-takoyaki",name:"Takoyaki en Wanaka",category:"food",duration:60,cost:600,description:"Mejor takoyaki de Osaka",location:{lat:34.6686,lng:135.5004},station:"Namba Station",rating:4.5,timeOfDay:["lunch","dinner"],bestSeason:"all"},{id:"osaka-okonomiyaki",name:"Okonomiyaki en Chibo",category:"food",duration:90,cost:1e3,description:"Okonomiyaki tradicional de Osaka",location:{lat:34.6686,lng:135.5004},station:"Namba Station",rating:4.5,timeOfDay:["lunch","dinner"],bestSeason:"all"},{id:"osaka-kuromon",name:"Kuromon Ichiba Market",category:"food",duration:120,cost:2500,description:"Mercado de comida fresca y street food",location:{lat:34.6666,lng:135.5064},station:"Nippombashi Station",rating:4.6,timeOfDay:["morning","lunch"],bestSeason:"all"},{id:"osaka-usj",name:"Universal Studios Japan",category:"family",duration:480,cost:8200,description:"Parque tem√°tico con mundo de Harry Potter",location:{lat:34.6658,lng:135.4321},station:"Universal City Station",rating:4.7,timeOfDay:["morning"],bestSeason:"all",requiresReservation:!0},{id:"osaka-aquarium",name:"Osaka Aquarium Kaiyukan",category:"family",duration:180,cost:2700,description:"Uno de los acuarios m√°s grandes del mundo",location:{lat:34.6547,lng:135.4293},station:"Osakako Station",rating:4.6,timeOfDay:["morning","afternoon"],bestSeason:"all"}]},nara:{city:"Nara",activities:[{id:"nara-park",name:"Nara Park (Ciervos)",category:"nature",duration:150,cost:150,description:"Parque con m√°s de 1000 ciervos amigables",location:{lat:34.6851,lng:135.8431},station:"Nara Station",rating:4.8,timeOfDay:["morning","afternoon"],bestSeason:"all"},{id:"nara-todaiji",name:"Todai-ji Temple",category:"culture",duration:120,cost:600,description:"Templo con el Gran Buda de bronce",location:{lat:34.689,lng:135.8398},station:"Nara Station",rating:4.7,timeOfDay:["morning","afternoon"],bestSeason:"all"},{id:"nara-mochi",name:"Mochi Pounding Show",category:"food",duration:30,cost:150,description:"Show de preparaci√≥n r√°pida de mochi",location:{lat:34.6825,lng:135.8311},station:"Kintetsu Nara Station",rating:4.7,timeOfDay:["afternoon"],bestSeason:"all"}]},kamakura:{city:"Kamakura",activities:[{id:"kamakura-daibutsu",name:"Gran Buda de Kamakura",category:"culture",duration:90,cost:300,description:"Estatua monumental de bronce al aire libre",location:{lat:35.3167,lng:139.5361},station:"Hase Station",rating:4.6,timeOfDay:["morning","afternoon"],bestSeason:"all"},{id:"kamakura-hasedera",name:"Templo Hase-dera",category:"culture",duration:90,cost:400,description:"Templo con vistas al mar y cuevas",location:{lat:35.3125,lng:139.5347},station:"Hase Station",rating:4.7,timeOfDay:["morning","afternoon"],bestSeason:"all"}]},hakone:{city:"Hakone",activities:[{id:"hakone-lake-ashi",name:"Lake Ashi Cruise",category:"nature",duration:120,cost:1e3,description:"Crucero en lago con vistas al Monte Fuji",location:{lat:35.2047,lng:139.0252},station:"Hakone-machi Port",rating:4.6,timeOfDay:["morning","afternoon"],bestSeason:"all"},{id:"hakone-onsen",name:"Onsen Tradicional",category:"relaxation",duration:120,cost:1500,description:"Ba√±os termales con vistas al Monte Fuji",location:{lat:35.2325,lng:139.1072},station:"Gora Station",rating:4.8,timeOfDay:["afternoon","evening"],bestSeason:"all"}]},hiroshima:{city:"Hiroshima",activities:[{id:"hiroshima-peace-park",name:"Parque Memorial de la Paz",category:"culture",duration:180,cost:0,description:"Parque conmemorativo con el Domo de la Bomba At√≥mica",location:{lat:34.3953,lng:132.4536},station:"Genbaku Dome-mae Station",rating:4.7,timeOfDay:["morning","afternoon"],bestSeason:"all"},{id:"hiroshima-museum",name:"Museo Memorial de la Paz",category:"culture",duration:120,cost:200,description:"Museo sobre la historia de Hiroshima",location:{lat:34.3916,lng:132.453},station:"Genbaku Dome-mae Station",rating:4.8,timeOfDay:["morning","afternoon"],bestSeason:"all"},{id:"hiroshima-miyajima",name:"Isla Miyajima (Itsukushima)",category:"nature",duration:300,cost:360,description:"Isla sagrada con torii flotante ic√≥nico",location:{lat:34.2959,lng:132.3197},station:"Miyajima-guchi Station + Ferry",rating:4.9,timeOfDay:["morning","afternoon"],bestSeason:"all"},{id:"hiroshima-okonomiyaki",name:"Okonomimura (Torre de Okonomiyaki)",category:"food",duration:90,cost:1200,description:"Edificio dedicado al okonomiyaki estilo Hiroshima",location:{lat:34.3925,lng:132.4587},station:"Hatchobori Station",rating:4.5,timeOfDay:["lunch","dinner"],bestSeason:"all"}]},takayama:{city:"Takayama",activities:[{id:"takayama-old-town",name:"San-machi (Ciudad Antigua)",category:"culture",duration:180,cost:0,description:"Barrio hist√≥rico con casas tradicionales de madera",location:{lat:36.1456,lng:137.2518},station:"Takayama Station",rating:4.7,timeOfDay:["morning","afternoon"],bestSeason:"all"},{id:"takayama-morning-market",name:"Mercado Matutino Miyagawa",category:"shopping",duration:90,cost:1e3,description:"Mercado tradicional con artesan√≠as y comida local",location:{lat:36.1463,lng:137.2513},station:"Takayama Station",rating:4.6,timeOfDay:["morning"],bestSeason:"all"},{id:"takayama-hida-beef",name:"Hida Beef",category:"food",duration:60,cost:3e3,description:"Carne de Hida famosa, similar al Wagyu de Kobe",location:{lat:36.1462,lng:137.2521},station:"Takayama Station",rating:4.8,timeOfDay:["lunch","dinner"],bestSeason:"all"},{id:"takayama-festival-floats",name:"Yatai Kaikan (Museo de Carrozas)",category:"culture",duration:60,cost:1e3,description:"Museo con las carrozas del festival de Takayama",location:{lat:36.1472,lng:137.2535},station:"Takayama Station",rating:4.5,timeOfDay:["morning","afternoon"],bestSeason:"all"}]},kanazawa:{city:"Kanazawa",activities:[{id:"kanazawa-kenrokuen",name:"Jard√≠n Kenrokuen",category:"nature",duration:120,cost:320,description:"Uno de los 3 jardines m√°s hermosos de Jap√≥n",location:{lat:36.5616,lng:136.6623},station:"Kanazawa Station",rating:4.8,timeOfDay:["morning","afternoon"],bestSeason:"all"},{id:"kanazawa-castle",name:"Castillo de Kanazawa",category:"culture",duration:90,cost:320,description:"Castillo hist√≥rico con arquitectura √∫nica",location:{lat:36.5652,lng:136.6589},station:"Kanazawa Station",rating:4.5,timeOfDay:["morning","afternoon"],bestSeason:"all"},{id:"kanazawa-geisha-district",name:"Distrito Higashi Chaya",category:"culture",duration:120,cost:0,description:"Barrio de casas de t√© tradicionales y geishas",location:{lat:36.5698,lng:136.6612},station:"Kanazawa Station",rating:4.7,timeOfDay:["afternoon","evening"],bestSeason:"all"},{id:"kanazawa-gold-leaf",name:"Taller de Hoja de Oro",category:"shopping",duration:60,cost:1e3,description:"Kanazawa produce el 99% de la hoja de oro de Jap√≥n",location:{lat:36.5694,lng:136.6616},station:"Kanazawa Station",rating:4.6,timeOfDay:["morning","afternoon"],bestSeason:"all"},{id:"kanazawa-omicho-market",name:"Mercado Omicho",category:"food",duration:90,cost:2500,description:"Mercado de mariscos frescos y street food",location:{lat:36.5693,lng:136.6576},station:"Kanazawa Station",rating:4.7,timeOfDay:["morning","lunch"],bestSeason:"all"}]},nagoya:{city:"Nagoya",activities:[{id:"nagoya-castle",name:"Castillo de Nagoya",category:"culture",duration:120,cost:500,description:"Castillo hist√≥rico con delfines dorados en el techo",location:{lat:35.1854,lng:136.8991},station:"Shiyakusho Station",rating:4.5,timeOfDay:["morning","afternoon"],bestSeason:"spring"},{id:"nagoya-atsuta-shrine",name:"Santuario Atsuta",category:"culture",duration:90,cost:0,description:"Santuario sinto√≠sta con la espada sagrada de Jap√≥n",location:{lat:35.1277,lng:136.9086},station:"Jingu-Mae Station",rating:4.6,timeOfDay:["morning","afternoon"],bestSeason:"all"},{id:"nagoya-miso-katsu",name:"Miso Katsu",category:"food",duration:60,cost:1e3,description:"Especialidad de Nagoya: tonkatsu con salsa miso",location:{lat:35.1709,lng:136.8816},station:"Nagoya Station",rating:4.5,timeOfDay:["lunch","dinner"],bestSeason:"all"},{id:"nagoya-osu",name:"Osu Shopping District",category:"shopping",duration:120,cost:3e3,description:"Distrito de compras con cultura otaku",location:{lat:35.1598,lng:136.9023},station:"Osu Kannon Station",rating:4.4,timeOfDay:["afternoon"],bestSeason:"all"}]},yokohama:{city:"Yokohama",activities:[{id:"yokohama-chinatown",name:"Yokohama Chinatown",category:"food",duration:180,cost:2500,description:"El barrio chino m√°s grande de Jap√≥n",location:{lat:35.4434,lng:139.6452},station:"Motomachi-Chukagai Station",rating:4.6,timeOfDay:["lunch","afternoon"],bestSeason:"all"},{id:"yokohama-minato-mirai",name:"Minato Mirai 21",category:"photography",duration:120,cost:0,description:"Distrito moderno con rascacielos y vistas al mar",location:{lat:35.4556,lng:139.6347},station:"Minatomirai Station",rating:4.7,timeOfDay:["afternoon","evening"],bestSeason:"all"},{id:"yokohama-ramen-museum",name:"Shin-Yokohama Ramen Museum",category:"food",duration:120,cost:800,description:"Museo con 9 tiendas de ramen de diferentes regiones",location:{lat:35.5085,lng:139.6175},station:"Shin-Yokohama Station",rating:4.5,timeOfDay:["lunch","dinner"],bestSeason:"all"},{id:"yokohama-cup-noodle-museum",name:"Cup Noodles Museum",category:"family",duration:120,cost:500,description:"Museo interactivo sobre la historia del ramen instant√°neo",location:{lat:35.4556,lng:139.6349},station:"Minatomirai Station",rating:4.7,timeOfDay:["morning","afternoon"],bestSeason:"all"}]},nikko:{city:"Nikko",activities:[{id:"nikko-toshogu",name:"Santuario Toshogu",category:"culture",duration:180,cost:1300,description:"Santuario lujoso y patrimonio de la humanidad",location:{lat:36.758,lng:139.5994},station:"Nikko Station",rating:4.8,timeOfDay:["morning","afternoon"],bestSeason:"all"},{id:"nikko-lake-chuzenji",name:"Lago Chuzenji",category:"nature",duration:150,cost:0,description:"Lago de monta√±a con cascadas espectaculares",location:{lat:36.7388,lng:139.4837},station:"Nikko Station + Bus",rating:4.7,timeOfDay:["morning","afternoon"],bestSeason:"autumn"},{id:"nikko-kegon-falls",name:"Cascada Kegon",category:"nature",duration:60,cost:570,description:"Cascada de 97 metros, una de las m√°s hermosas de Jap√≥n",location:{lat:36.7385,lng:139.4956},station:"Nikko Station + Bus",rating:4.6,timeOfDay:["morning","afternoon"],bestSeason:"all"}]},sapporo:{city:"Sapporo",activities:[{id:"sapporo-beer-museum",name:"Museo de la Cerveza Sapporo",category:"food",duration:90,cost:500,description:"Historia de la cerveza con degustaci√≥n gratuita",location:{lat:43.0784,lng:141.3639},station:"Sapporo Station",rating:4.5,timeOfDay:["afternoon"],bestSeason:"all"},{id:"sapporo-ramen-yokocho",name:"Ramen Yokocho",category:"food",duration:60,cost:1e3,description:"Callej√≥n con 17 tiendas de ramen de Sapporo",location:{lat:43.0552,lng:141.3497},station:"Susukino Station",rating:4.6,timeOfDay:["lunch","dinner"],bestSeason:"all"},{id:"sapporo-odori-park",name:"Parque Odori",category:"nature",duration:120,cost:0,description:"Parque central donde se celebra el Festival de Nieve",location:{lat:43.0596,lng:141.3478},station:"Odori Station",rating:4.5,timeOfDay:["morning","afternoon"],bestSeason:"winter"},{id:"sapporo-clock-tower",name:"Torre del Reloj",category:"photography",duration:30,cost:200,description:"Edificio hist√≥rico s√≠mbolo de Sapporo",location:{lat:43.0633,lng:141.3537},station:"Sapporo Station",rating:4,timeOfDay:["morning","afternoon"],bestSeason:"all"}]},fukuoka:{city:"Fukuoka",activities:[{id:"fukuoka-yatai",name:"Yatai (Puestos Callejeros)",category:"food",duration:120,cost:2e3,description:"Famosos puestos de comida callejera",location:{lat:33.5927,lng:130.4017},station:"Nakasu-Kawabata Station",rating:4.7,timeOfDay:["evening"],bestSeason:"all"},{id:"fukuoka-hakata-ramen",name:"Ichiran Ramen Original",category:"food",duration:60,cost:980,description:"Tonkotsu ramen original de Fukuoka",location:{lat:33.5902,lng:130.4012},station:"Tenjin Station",rating:4.6,timeOfDay:["lunch","dinner"],bestSeason:"all"},{id:"fukuoka-canal-city",name:"Canal City Hakata",category:"shopping",duration:180,cost:3e3,description:"Centro comercial con canal y espect√°culos",location:{lat:33.5899,lng:130.4069},station:"Nakasu-Kawabata Station",rating:4.5,timeOfDay:["afternoon","evening"],bestSeason:"all"},{id:"fukuoka-dazaifu",name:"Santuario Dazaifu Tenmangu",category:"culture",duration:150,cost:0,description:"Santuario dedicado al dios del aprendizaje",location:{lat:33.5204,lng:130.5339},station:"Dazaifu Station",rating:4.7,timeOfDay:["morning","afternoon"],bestSeason:"all"}]}};const we=[{id:"AM",name:"Aerom√©xico",logo:"üá≤üáΩ",country:"M√©xico",color:"#C11033",website:"https://aeromexico.com"},{id:"Y4",name:"Volaris",logo:"üá≤üáΩ",country:"M√©xico",color:"#A61F69",website:"https://volaris.com"},{id:"VB",name:"VivaAerobus",logo:"üá≤üáΩ",country:"M√©xico",color:"#00B140",website:"https://vivaaerobus.com"},{id:"AA",name:"American Airlines",logo:"üá∫üá∏",country:"Estados Unidos",color:"#0078D2",website:"https://aa.com"},{id:"UA",name:"United Airlines",logo:"üá∫üá∏",country:"Estados Unidos",color:"#004EA2",website:"https://united.com"},{id:"DL",name:"Delta Airlines",logo:"üá∫üá∏",country:"Estados Unidos",color:"#003366",website:"https://delta.com"},{id:"AC",name:"Air Canada",logo:"üá®üá¶",country:"Canad√°",color:"#E01D24",website:"https://aircanada.com"},{id:"BA",name:"British Airways",logo:"üá¨üáß",country:"Reino Unido",color:"#CC0033",website:"https://britishairways.com"},{id:"AF",name:"Air France",logo:"üá´üá∑",country:"Francia",color:"#002157",website:"https://airfrance.com"},{id:"LH",name:"Lufthansa",logo:"üá©üá™",country:"Alemania",color:"#FFD800",website:"https://lufthansa.com"},{id:"IB",name:"Iberia",logo:"üá™üá∏",country:"Espa√±a",color:"#EC0033",website:"https://iberia.com"},{id:"KL",name:"KLM",logo:"üá≥üá±",country:"Pa√≠ses Bajos",color:"#00A1E4",website:"https://klm.com"},{id:"NH",name:"All Nippon Airways (ANA)",logo:"üáØüáµ",country:"Jap√≥n",color:"#00479D",website:"https://ana.co.jp"},{id:"JL",name:"Japan Airlines (JAL)",logo:"üáØüáµ",country:"Jap√≥n",color:"#CC0033",website:"https://jal.co.jp"},{id:"KE",name:"Korean Air",logo:"üá∞üá∑",country:"Corea del Sur",color:"#004EA2",website:"https://koreanair.com"},{id:"CX",name:"Cathay Pacific",logo:"üá≠üá∞",country:"Hong Kong",color:"#006564",website:"https://cathaypacific.com"},{id:"SQ",name:"Singapore Airlines",logo:"üá∏üá¨",country:"Singapur",color:"#003366",website:"https://singaporeair.com"},{id:"TG",name:"Thai Airways",logo:"üáπüá≠",country:"Tailandia",color:"#47137A",website:"https://thaiairways.com"},{id:"Z0",name:"Peach Aviation",logo:"üáØüáµ",country:"Jap√≥n (Low-Cost)",color:"#F94092",website:"https://flypeach.com"},{id:"JW",name:"Vanilla Air",logo:"üáØüáµ",country:"Jap√≥n (Low-Cost)",color:"#FFD700",website:"https://vanilla-air.com"},{id:"MM",name:"Skymark Airlines",logo:"üáØüáµ",country:"Jap√≥n (Low-Cost)",color:"#003366",website:"https://skymark.co.jp"},{id:"QR",name:"Qatar Airways",logo:"üá∂üá¶",country:"Qatar",color:"#5C0A2E",website:"https://qatarairways.com"},{id:"EK",name:"Emirates",logo:"üá¶üá™",country:"Emiratos √Årabes",color:"#D71921",website:"https://emirates.com"},{id:"AZ",name:"Alitalia",logo:"üáÆüáπ",country:"Italia",color:"#006643",website:"https://alitalia.com"}],Se={currentItinerary:null,selectedCategories:[],selectedTemplate:null,cities:[],flights:[],activities:[],draggedItem:null,optimizationEnabled:!1,init(){console.log("üé® Inicializando Itinerary Builder..."),this.setupEventListeners()},setupEventListeners(){document.addEventListener("click",e=>{if(e.target.closest(".add-activity-btn")&&this.showAddActivityModal(),e.target.closest(".edit-activity-btn")){const t=e.target.closest(".edit-activity-btn").dataset.activityId;this.editActivity(t)}if(e.target.closest(".delete-activity-btn")){const t=e.target.closest(".delete-activity-btn").dataset.activityId;this.deleteActivity(t)}e.target.closest(".optimize-route-btn")&&this.toggleOptimization(),e.target.closest(".add-flight-btn")&&this.showAddFlightModal()})},shouldCreateTrip:!1,async showCreateItineraryWizard(e=!1){this.shouldCreateTrip=e,console.log("üé® Opening wizard with createTripFlag:",e);const t=`\n      <div id="createItineraryWizard" class="modal active" style="z-index: 10001;">\n        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">\n          \x3c!-- Header --\x3e\n          <div class="sticky top-0 bg-gradient-to-r from-purple-500 to-pink-500 text-white p-6 rounded-t-xl z-10">\n            <h2 class="text-3xl font-bold flex items-center gap-3">\n              ‚úàÔ∏è Crear Nuevo Itinerario\n            </h2>\n            <p class="text-sm text-white/80 mt-2">Paso a paso para planear tu viaje perfecto</p>\n          </div>\n\n          \x3c!-- Steps Container --\x3e\n          <div class="p-6">\n            \x3c!-- Step Indicator --\x3e\n            <div class="flex items-center justify-center mb-8">\n              <div class="flex items-center gap-2">\n                <div class="wizard-step active" data-step="1">\n                  <div class="w-10 h-10 rounded-full bg-purple-500 text-white flex items-center justify-center font-bold">1</div>\n                  <span class="text-xs mt-1">B√°sico</span>\n                </div>\n                <div class="w-8 h-1 bg-gray-300"></div>\n                <div class="wizard-step" data-step="2">\n                  <div class="w-10 h-10 rounded-full bg-gray-300 text-white flex items-center justify-center font-bold">2</div>\n                  <span class="text-xs mt-1">Ciudades</span>\n                </div>\n                <div class="w-8 h-1 bg-gray-300"></div>\n                <div class="wizard-step" data-step="3">\n                  <div class="w-10 h-10 rounded-full bg-gray-300 text-white flex items-center justify-center font-bold">3</div>\n                  <span class="text-xs mt-1">Vuelos</span>\n                </div>\n                <div class="w-8 h-1 bg-gray-300"></div>\n                <div class="wizard-step" data-step="4">\n                  <div class="w-10 h-10 rounded-full bg-gray-300 text-white flex items-center justify-center font-bold">4</div>\n                  <span class="text-xs mt-1">Intereses</span>\n                </div>\n                <div class="w-8 h-1 bg-gray-300"></div>\n                <div class="wizard-step" data-step="5">\n                  <div class="w-10 h-10 rounded-full bg-gray-300 text-white flex items-center justify-center font-bold">5</div>\n                  <span class="text-xs mt-1">Plantilla</span>\n                </div>\n              </div>\n            </div>\n\n            \x3c!-- Step 1: Informaci√≥n B√°sica --\x3e\n            <div id="wizardStep1" class="wizard-content">\n              <h3 class="text-xl font-bold mb-4 dark:text-white">üìã Informaci√≥n B√°sica</h3>\n              <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">\n                Comienza con la informaci√≥n fundamental de tu viaje\n              </p>\n              <div class="space-y-4">\n                <div>\n                  <label class="block text-sm font-semibold mb-2 dark:text-gray-300">Nombre del Viaje *</label>\n                  <input\n                    type="text"\n                    id="itineraryName"\n                    placeholder="ej: Viaje a Jap√≥n 2026"\n                    class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white"\n                    required\n                  />\n                </div>\n\n                <div class="grid grid-cols-2 gap-4">\n                  <div>\n                    <label class="block text-sm font-semibold mb-2 dark:text-gray-300">Fecha Inicio *</label>\n                    <input\n                      type="date"\n                      id="itineraryStartDate"\n                      class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white"\n                      required\n                    />\n                  </div>\n                  <div>\n                    <label class="block text-sm font-semibold mb-2 dark:text-gray-300">Fecha Fin *</label>\n                    <input\n                      type="date"\n                      id="itineraryEndDate"\n                      class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white"\n                      required\n                    />\n                  </div>\n                </div>\n\n                <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg">\n                  <p class="text-sm text-blue-800 dark:text-blue-300">\n                    üí° <strong>Siguiente paso:</strong> Seleccionar√°s las ciudades que visitar√°s y asignar√°s cu√°ntos d√≠as pasar√°s en cada una\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            \x3c!-- Step 2: Itinerario por Fechas (DATE PICKER) --\x3e\n            <div id="wizardStep2" class="wizard-content hidden">\n              <h3 class="text-xl font-bold mb-4 dark:text-white">üìÖ Asigna Ciudades por Fechas</h3>\n              <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">\n                Selecciona visualmente las fechas en el calendario para cada ciudad. ¬°Mucho m√°s f√°cil!\n              </p>\n\n              \x3c!-- City Selection with Date Picker --\x3e\n              <div class="bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 p-5 rounded-lg border-2 border-blue-200 dark:border-blue-800 mb-6">\n                <h4 class="font-bold text-blue-900 dark:text-blue-300 mb-4 flex items-center gap-2">\n                  <span>üìç</span> Selecciona Ciudad\n                </h4>\n\n                <div class="mb-4">\n                  <label class="block text-xs font-semibold mb-2 dark:text-gray-300">¬øA qu√© ciudad vas? *</label>\n                  <select\n                    id="datePickerCitySelect"\n                    class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white text-base font-semibold"\n                    onchange="ItineraryBuilder.onCitySelectForDatePicker()"\n                  >\n                    <option value="">Seleccionar ciudad...</option>\n                  </select>\n                </div>\n\n                \x3c!-- Calendar Date Picker --\x3e\n                <div id="datePickerCalendar" class="hidden">\n                  <h4 class="font-bold text-blue-900 dark:text-blue-300 mb-3 flex items-center gap-2">\n                    <span>üìÖ</span> Selecciona las fechas en el calendario\n                  </h4>\n\n                  <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-lg">\n                    \x3c!-- Calendar Header --\x3e\n                    <div class="flex items-center justify-between mb-4">\n                      <button type="button" onclick="ItineraryBuilder.changeCalendarMonth(-1)" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition">\n                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>\n                        </svg>\n                      </button>\n                      <h5 id="calendarMonthYear" class="text-lg font-bold dark:text-white"></h5>\n                      <button type="button" onclick="ItineraryBuilder.changeCalendarMonth(1)" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition">\n                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>\n                        </svg>\n                      </button>\n                    </div>\n\n                    \x3c!-- Calendar Grid --\x3e\n                    <div class="grid grid-cols-7 gap-1">\n                      \x3c!-- Days of week header --\x3e\n                      <div class="text-center text-xs font-semibold text-gray-600 dark:text-gray-400 py-2">Dom</div>\n                      <div class="text-center text-xs font-semibold text-gray-600 dark:text-gray-400 py-2">Lun</div>\n                      <div class="text-center text-xs font-semibold text-gray-600 dark:text-gray-400 py-2">Mar</div>\n                      <div class="text-center text-xs font-semibold text-gray-600 dark:text-gray-400 py-2">Mi√©</div>\n                      <div class="text-center text-xs font-semibold text-gray-600 dark:text-gray-400 py-2">Jue</div>\n                      <div class="text-center text-xs font-semibold text-gray-600 dark:text-gray-400 py-2">Vie</div>\n                      <div class="text-center text-xs font-semibold text-gray-600 dark:text-gray-400 py-2">S√°b</div>\n\n                      \x3c!-- Calendar days will be rendered here --\x3e\n                      <div id="calendarDaysGrid" class="col-span-7 grid grid-cols-7 gap-1"></div>\n                    </div>\n\n                    \x3c!-- Selected Range Info --\x3e\n                    <div id="selectedRangeInfo" class="mt-4 hidden">\n                      <div class="bg-purple-50 dark:bg-purple-900/20 p-3 rounded-lg border border-purple-200 dark:border-purple-800">\n                        <p class="text-sm font-semibold text-purple-900 dark:text-purple-300 mb-2">\n                          Rango seleccionado:\n                        </p>\n                        <p id="selectedRangeText" class="text-base font-bold text-purple-700 dark:text-purple-400"></p>\n                        <button\n                          type="button"\n                          onclick="ItineraryBuilder.confirmDateRange()"\n                          class="mt-3 w-full bg-gradient-to-r from-purple-500 to-blue-500 text-white py-2.5 rounded-lg hover:from-purple-600 hover:to-blue-600 transition font-semibold flex items-center justify-center gap-2"\n                        >\n                          <span>‚ú®</span> Confirmar Fechas para <span id="selectedCityName"></span>\n                        </button>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div class="mt-3 text-xs text-blue-800 dark:text-blue-300">\n                    <strong>üí° Tip:</strong> Haz click en la fecha de inicio y luego en la fecha final para seleccionar un rango.\n                  </div>\n                </div>\n              </div>\n\n              \x3c!-- Visual Calendar Timeline --\x3e\n              <div class="bg-white dark:bg-gray-800 p-5 rounded-lg border border-gray-300 dark:border-gray-600 mb-4">\n                <h4 class="font-bold mb-3 dark:text-white flex items-center gap-2">\n                  <span>üìä</span> Vista del Itinerario\n                </h4>\n                <div id="cityTimelineView" class="space-y-2">\n                  <div class="text-center py-8 text-gray-400 dark:text-gray-500 text-sm">\n                    <i class="fas fa-calendar-alt text-3xl mb-2"></i>\n                    <p>La distribuci√≥n de ciudades aparecer√° aqu√≠</p>\n                  </div>\n                </div>\n              </div>\n\n              \x3c!-- Detailed Day-by-Day View (Collapsible) --\x3e\n              <div class="border-t border-gray-300 dark:border-gray-600 pt-4">\n                <button\n                  type="button"\n                  onclick="document.getElementById('detailedDayView').classList.toggle('hidden')"\n                  class="w-full text-left font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center justify-between hover:text-blue-600 dark:hover:text-blue-400 transition"\n                >\n                  <span>üìã Vista Detallada D√≠a por D√≠a (opcional)</span>\n                  <span class="text-sm">‚ñº</span>\n                </button>\n\n                <div id="detailedDayView" class="hidden">\n                  <p class="text-xs text-gray-600 dark:text-gray-400 mb-3">\n                    Aqu√≠ puedes ajustar cada d√≠a individualmente si necesitas m√°s control.\n                  </p>\n                  <div id="cityByDateContainer" class="space-y-3 max-h-[400px] overflow-y-auto">\n                    \x3c!-- Este contenedor se llenar√° din√°micamente --\x3e\n                  </div>\n                </div>\n              </div>\n\n              <div class="mt-4 space-y-2">\n                <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg">\n                  <p class="text-sm text-green-800 dark:text-green-300">\n                    ‚ú® <strong>Nuevo:</strong> Asigna ciudades por rangos de d√≠as - ¬°mucho m√°s r√°pido!\n                  </p>\n                </div>\n                <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg">\n                  <p class="text-sm text-blue-800 dark:text-blue-300">\n                    üí° <strong>Tip:</strong> Para visitas cortas a varias ciudades en un d√≠a, usa la vista detallada.\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            \x3c!-- Step 3: Vuelos --\x3e\n            <div id="wizardStep3" class="wizard-content hidden">\n              <h3 class="text-xl font-bold mb-4 dark:text-white">‚úàÔ∏è Informaci√≥n de Vuelos (Opcional)</h3>\n              <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">\n                Puedes agregar tus vuelos ahora o hacerlo m√°s tarde desde la secci√≥n de vuelos\n              </p>\n              <div class="space-y-6">\n                \x3c!-- Vuelo de Ida --\x3e\n                <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg">\n                  <h4 class="font-bold mb-3 dark:text-white flex items-center gap-2">\n                    <span>üõ´</span> Vuelo de Ida\n                  </h4>\n                  <div class="space-y-3">\n                    <div class="grid grid-cols-2 gap-3">\n                      <div>\n                        <label class="block text-sm font-semibold mb-1 dark:text-gray-300">Aerol√≠nea</label>\n                        <select id="outboundAirline" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white text-sm">\n                          <option value="">Seleccionar...</option>\n                          ${we.map(e=>`\n                            <option value="${e.id}">${e.logo} ${e.name}</option>\n                          `).join("")}\n                        </select>\n                      </div>\n                      <div>\n                        <label class="block text-sm font-semibold mb-1 dark:text-gray-300">N√∫mero de Vuelo</label>\n                        <input type="text" id="outboundFlightNumber" placeholder="ej: AM58" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white text-sm" />\n                      </div>\n                    </div>\n                    <div class="grid grid-cols-3 gap-3">\n                      <div>\n                        <label class="block text-sm font-semibold mb-1 dark:text-gray-300">Origen</label>\n                        <input type="text" id="outboundOrigin" placeholder="ej: MEX" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white text-sm" />\n                      </div>\n                      <div>\n                        <label class="block text-sm font-semibold mb-1 dark:text-gray-300">Destino</label>\n                        <input type="text" id="outboundDestination" placeholder="ej: NRT" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white text-sm" />\n                      </div>\n                      <div>\n                        <label class="block text-sm font-semibold mb-1 dark:text-gray-300">Fecha/Hora</label>\n                        <input type="datetime-local" id="outboundDateTime" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white text-sm" />\n                      </div>\n                    </div>\n                    \n                    \x3c!-- Vuelos de Conexi√≥n (Ida) --\x3e\n                    <div id="outboundConnections" class="space-y-2"></div>\n                    <button type="button" onclick="ItineraryBuilder.addConnectionFlight('outbound')" class="text-sm text-blue-600 dark:text-blue-400 hover:underline">\n                      + Agregar Conexi√≥n\n                    </button>\n                  </div>\n                </div>\n\n                \x3c!-- Vuelo de Regreso --\x3e\n                <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg">\n                  <h4 class="font-bold mb-3 dark:text-white flex items-center gap-2">\n                    <span>üõ¨</span> Vuelo de Regreso\n                  </h4>\n                  <div class="space-y-3">\n                    <div class="grid grid-cols-2 gap-3">\n                      <div>\n                        <label class="block text-sm font-semibold mb-1 dark:text-gray-300">Aerol√≠nea</label>\n                        <select id="returnAirline" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white text-sm">\n                          <option value="">Seleccionar...</option>\n                          ${we.map(e=>`\n                            <option value="${e.id}">${e.logo} ${e.name}</option>\n                          `).join("")}\n                        </select>\n                      </div>\n                      <div>\n                        <label class="block text-sm font-semibold mb-1 dark:text-gray-300">N√∫mero de Vuelo</label>\n                        <input type="text" id="returnFlightNumber" placeholder="ej: AM57" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white text-sm" />\n                      </div>\n                    </div>\n                    <div class="grid grid-cols-3 gap-3">\n                      <div>\n                        <label class="block text-sm font-semibold mb-1 dark:text-gray-300">Origen</label>\n                        <input type="text" id="returnOrigin" placeholder="ej: NRT" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white text-sm" />\n                      </div>\n                      <div>\n                        <label class="block text-sm font-semibold mb-1 dark:text-gray-300">Destino</label>\n                        <input type="text" id="returnDestination" placeholder="ej: MEX" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white text-sm" />\n                      </div>\n                      <div>\n                        <label class="block text-sm font-semibold mb-1 dark:text-gray-300">Fecha/Hora</label>\n                        <input type="datetime-local" id="returnDateTime" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white text-sm" />\n                      </div>\n                    </div>\n                    \n                    \x3c!-- Vuelos de Conexi√≥n (Regreso) --\x3e\n                    <div id="returnConnections" class="space-y-2"></div>\n                    <button type="button" onclick="ItineraryBuilder.addConnectionFlight('return')" class="text-sm text-blue-600 dark:text-blue-400 hover:underline">\n                      + Agregar Conexi√≥n\n                    </button>\n                  </div>\n                </div>\n\n                <div class="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg">\n                  <p class="text-sm text-yellow-800 dark:text-yellow-300">\n                    üí° <strong>Tip:</strong> Puedes agregar vuelos de conexi√≥n si tu viaje incluye escalas\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            \x3c!-- Step 4: Categor√≠as de Inter√©s --\x3e\n            <div id="wizardStep4" class="wizard-content hidden">\n              <h3 class="text-xl font-bold mb-4 dark:text-white">üéØ ¬øQu√© te interesa hacer?</h3>\n              <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">\n                Selecciona tus intereses para recibir sugerencias personalizadas\n              </p>\n              <div class="grid grid-cols-2 md:grid-cols-3 gap-3">\n                ${xe.map(e=>`\n                  <label class="category-card cursor-pointer border-2 border-gray-300 dark:border-gray-600 rounded-lg p-4 hover:border-${e.color}-500 hover:bg-${e.color}-50 dark:hover:bg-${e.color}-900/20 transition">\n                    <input type="checkbox" name="categories" value="${e.id}" class="hidden category-checkbox" />\n                    <div class="text-center">\n                      <div class="text-4xl mb-2">${e.icon}</div>\n                      <div class="font-bold text-sm dark:text-white">${e.name}</div>\n                      <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">${e.description}</div>\n                    </div>\n                  </label>\n                `).join("")}\n              </div>\n            </div>\n\n            \x3c!-- Step 5: Plantillas --\x3e\n            <div id="wizardStep5" class="wizard-content hidden">\n              <h3 class="text-xl font-bold mb-4 dark:text-white">üìã Elige una Plantilla</h3>\n              <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">\n                O comienza desde cero y agrega actividades manualmente\n              </p>\n              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">\n                \x3c!-- Opci√≥n: Desde Cero --\x3e\n                <label class="template-card cursor-pointer border-2 border-gray-300 dark:border-gray-600 rounded-lg p-6 hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition">\n                  <input type="radio" name="template" value="blank" class="hidden template-radio" />\n                  <div class="text-center">\n                    <div class="text-5xl mb-3">üìù</div>\n                    <div class="font-bold text-lg dark:text-white">Desde Cero</div>\n                    <div class="text-sm text-gray-600 dark:text-gray-400 mt-2">\n                      Crea tu itinerario personalizado desde el inicio\n                    </div>\n                  </div>\n                </label>\n\n                \x3c!-- Plantillas Predefinidas --\x3e\n                ${fe.map(e=>`\n                  <label class="template-card cursor-pointer border-2 border-gray-300 dark:border-gray-600 rounded-lg p-6 hover:border-${e.color}-500 hover:bg-${e.color}-50 dark:hover:bg-${e.color}-900/20 transition">\n                    <input type="radio" name="template" value="${e.id}" class="hidden template-radio" />\n                    <div class="text-center">\n                      <div class="text-5xl mb-3">${e.icon}</div>\n                      <div class="font-bold text-lg dark:text-white">${e.name}</div>\n                      <div class="text-sm text-gray-600 dark:text-gray-400 mt-2">${e.description}</div>\n                      <div class="flex flex-wrap gap-1 justify-center mt-3">\n                        ${e.categories.map(e=>{const t=xe.find(t=>t.id===e);return`<span class="text-xs bg-gray-200 dark:bg-gray-700 px-2 py-1 rounded">${null==t?void 0:t.icon} ${null==t?void 0:t.name}</span>`}).join("")}\n                      </div>\n                      <div class="mt-2 text-xs text-gray-500 dark:text-gray-400">\n                        Ritmo: <strong>${"relaxed"===e.pace?"üê¢ Relajado":"moderate"===e.pace?"üö∂ Moderado":"üèÉ Intenso"}</strong>\n                      </div>\n                    </div>\n                  </label>\n                `).join("")}\n              </div>\n            </div>\n\n            \x3c!-- Navigation Buttons --\x3e\n            <div class="flex justify-between mt-8 pt-6 border-t border-gray-200 dark:border-gray-700">\n              <button \n                type="button"\n                id="wizardPrevBtn"\n                onclick="ItineraryBuilder.previousWizardStep()"\n                class="px-6 py-3 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-white rounded-lg hover:bg-gray-400 dark:hover:bg-gray-500 transition font-semibold hidden"\n              >\n                ‚Üê Anterior\n              </button>\n              <div class="flex gap-3 ml-auto">\n                <button\n                  type="button"\n                  onclick="ItineraryBuilder.closeCreateItineraryWizard()"\n                  class="px-6 py-3 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-white rounded-lg hover:bg-gray-400 dark:hover:bg-gray-500 transition font-semibold"\n                >\n                  Cancelar\n                </button>\n                <button\n                  type="button"\n                  id="skipFlightsBtn"\n                  onclick="ItineraryBuilder.nextWizardStep()"\n                  class="px-6 py-3 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition font-semibold hidden"\n                >\n                  Omitir (agregar despu√©s) ‚Üí\n                </button>\n                <button\n                  type="button"\n                  id="wizardNextBtn"\n                  onclick="ItineraryBuilder.nextWizardStep()"\n                  class="px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:from-purple-600 hover:to-pink-600 transition font-semibold"\n                >\n                  Siguiente ‚Üí\n                </button>\n                <button\n                  type="button"\n                  id="wizardFinishBtn"\n                  onclick="ItineraryBuilder.finishWizard()"\n                  class="px-6 py-3 bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-lg hover:from-green-600 hover:to-blue-600 transition font-semibold hidden"\n                >\n                  ‚ú® Crear Itinerario\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    `;document.body.insertAdjacentHTML("beforeend",t),document.body.style.overflow="hidden",this.setupCategorySelection(),this.setupTemplateSelection()},setupCategorySelection(){document.querySelectorAll(".category-card").forEach(e=>{e.addEventListener("click",function(){const e=this.querySelector(".category-checkbox");e.checked=!e.checked,e.checked?(this.classList.add("selected"),this.style.borderColor="rgb(168, 85, 247)",this.style.backgroundColor="rgb(250, 245, 255)"):(this.classList.remove("selected"),this.style.borderColor="",this.style.backgroundColor="")})})},setupTemplateSelection(){document.querySelectorAll(".template-card").forEach(e=>{e.addEventListener("click",function(){document.querySelectorAll(".template-card").forEach(e=>{e.classList.remove("selected"),e.style.borderColor="",e.style.backgroundColor=""});this.querySelector(".template-radio").checked=!0,this.classList.add("selected"),this.style.borderColor="rgb(59, 130, 246)",this.style.backgroundColor="rgb(239, 246, 255)"})})},addConnectionFlight(e){const t=document.getElementById(`${e}Connections`),a=`${e}-connection-${Date.now()}`,n=`\n      <div id="${a}" class="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg space-y-2">\n        <div class="flex items-center justify-between mb-2">\n          <span class="text-sm font-semibold dark:text-white">Conexi√≥n</span>\n          <button onclick="document.getElementById('${a}').remove()" class="text-red-500 hover:text-red-700 text-xs">\n            ‚úï Eliminar\n          </button>\n        </div>\n        <div class="grid grid-cols-2 gap-2">\n          <div>\n            <label class="block text-xs font-semibold mb-1 dark:text-gray-300">Aerol√≠nea</label>\n            <select class="connection-airline w-full p-2 border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-600 dark:text-white text-xs">\n              <option value="">Seleccionar...</option>\n              ${we.map(e=>`\n                <option value="${e.id}">${e.logo} ${e.name}</option>\n              `).join("")}\n            </select>\n          </div>\n          <div>\n            <label class="block text-xs font-semibold mb-1 dark:text-gray-300">N√∫mero de Vuelo</label>\n            <input type="text" class="connection-flight-number w-full p-2 border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-600 dark:text-white text-xs" placeholder="ej: AA123" />\n          </div>\n        </div>\n        <div class="grid grid-cols-3 gap-2">\n          <div>\n            <label class="block text-xs font-semibold mb-1 dark:text-gray-300">Origen</label>\n            <input type="text" class="connection-origin w-full p-2 border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-600 dark:text-white text-xs" placeholder="LAX" />\n          </div>\n          <div>\n            <label class="block text-xs font-semibold mb-1 dark:text-gray-300">Destino</label>\n            <input type="text" class="connection-destination w-full p-2 border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-600 dark:text-white text-xs" placeholder="NRT" />\n          </div>\n          <div>\n            <label class="block text-xs font-semibold mb-1 dark:text-gray-300">Fecha/Hora</label>\n            <input type="datetime-local" class="connection-datetime w-full p-2 border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-600 dark:text-white text-xs" />\n          </div>\n        </div>\n      </div>\n    `;t.insertAdjacentHTML("beforeend",n)},datePickerState:{currentMonth:new Date,selectedCity:null,selectedStartDate:null,selectedEndDate:null,tripStartDate:null,tripEndDate:null},onCitySelectForDatePicker(){const e=document.getElementById("datePickerCitySelect"),t=document.getElementById("datePickerCalendar");if(e.value){this.datePickerState.selectedCity=e.value,t.classList.remove("hidden");const a=document.getElementById("itineraryStartDate").value,n=document.getElementById("itineraryEndDate").value;if(a&&n){const e=a.split("-"),t=n.split("-");this.datePickerState.tripStartDate=new Date(parseInt(e[0]),parseInt(e[1])-1,parseInt(e[2])),this.datePickerState.tripEndDate=new Date(parseInt(t[0]),parseInt(t[1])-1,parseInt(t[2])),this.datePickerState.currentMonth=new Date(this.datePickerState.tripStartDate),this.renderCalendar()}}else t.classList.add("hidden"),this.datePickerState.selectedCity=null},changeCalendarMonth(e){this.datePickerState.currentMonth.setMonth(this.datePickerState.currentMonth.getMonth()+e),this.renderCalendar()},renderCalendar(){const e=this.datePickerState;document.getElementById("calendarMonthYear").textContent=`${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][e.currentMonth.getMonth()]} ${e.currentMonth.getFullYear()}`;const t=new Date(e.currentMonth.getFullYear(),e.currentMonth.getMonth(),1),a=new Date(e.currentMonth.getFullYear(),e.currentMonth.getMonth()+1,0),n=t.getDay(),r=a.getDate(),i=document.getElementById("calendarDaysGrid");i.innerHTML="";for(let o=0;o<n;o++){const e=document.createElement("div");e.className="h-10",i.appendChild(e)}for(let o=1;o<=r;o++){const t=new Date(e.currentMonth.getFullYear(),e.currentMonth.getMonth(),o),a=t.toISOString().split("T")[0],n=document.createElement("button");n.type="button",n.className="h-10 rounded-lg flex items-center justify-center text-sm font-medium transition-all",n.textContent=o;const r=new Date(t.getFullYear(),t.getMonth(),t.getDate()),s=e.tripStartDate?new Date(e.tripStartDate.getFullYear(),e.tripStartDate.getMonth(),e.tripStartDate.getDate()):null,l=e.tripEndDate?new Date(e.tripEndDate.getFullYear(),e.tripEndDate.getMonth(),e.tripEndDate.getDate()):null,d=s&&l&&r>=s&&r<=l,c=e.selectedStartDate&&a===e.selectedStartDate.toISOString().split("T")[0],u=e.selectedEndDate&&a===e.selectedEndDate.toISOString().split("T")[0],p=e.selectedStartDate&&e.selectedEndDate&&t>=e.selectedStartDate&&t<=e.selectedEndDate;d?n.className+=c||u?" bg-purple-600 text-white font-bold hover:bg-purple-700":p?" bg-purple-200 dark:bg-purple-900/40 text-purple-900 dark:text-purple-200":" hover:bg-blue-100 dark:hover:bg-blue-900/30 text-gray-700 dark:text-gray-300":(n.className+=" text-gray-300 dark:text-gray-600 cursor-not-allowed",n.disabled=!0),n.onclick=()=>this.onDateClick(t),i.appendChild(n)}},onDateClick(e){const t=this.datePickerState;!t.selectedStartDate||t.selectedStartDate&&t.selectedEndDate?(t.selectedStartDate=e,t.selectedEndDate=null):e<t.selectedStartDate?(t.selectedEndDate=t.selectedStartDate,t.selectedStartDate=e):t.selectedEndDate=e,this.renderCalendar(),this.updateSelectedRangeInfo()},updateSelectedRangeInfo(){const e=this.datePickerState,t=document.getElementById("selectedRangeInfo"),a=document.getElementById("selectedRangeText"),n=document.getElementById("selectedCityName");if(e.selectedStartDate&&e.selectedEndDate){const r=e.selectedStartDate.toLocaleDateString("es-ES",{day:"numeric",month:"short"}),i=e.selectedEndDate.toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"}),o=Math.ceil((e.selectedEndDate-e.selectedStartDate)/864e5)+1;a.textContent=`${r} - ${i} (${o} ${1===o?"d√≠a":"d√≠as"})`;const s=ke[e.selectedCity];n.textContent=s.city,t.classList.remove("hidden")}else t.classList.add("hidden")},confirmDateRange(){const e=this.datePickerState;if(!e.selectedCity||!e.selectedStartDate||!e.selectedEndDate)return void t.warning("Por favor selecciona una ciudad y un rango de fechas");const a=ke[e.selectedCity],n=e.tripStartDate,r=Math.ceil((e.selectedStartDate-n)/864e5)+1,i=Math.ceil((e.selectedEndDate-n)/864e5)+1;for(let t=r;t<=i;t++){const a=document.getElementById(`city-blocks-day-${t}`);if(a){const r=a.querySelectorAll(".city-block");let i=!1;if(r.forEach(t=>{const a=t.querySelector(".city-block-city");a&&a.value===e.selectedCity&&(i=!0)}),!i){const r=new Date(n.getTime()+24*(t-1)*60*60*1e3).toISOString().split("T")[0];this.addCityBlock(t,r),setTimeout(()=>{const t=a.querySelectorAll(".city-block"),n=t[t.length-1];if(n){const t=n.querySelector(".city-block-city");t&&(t.value=e.selectedCity)}},50)}}}this.renderCityTimeline(),t.success(`‚úÖ ${a.city} asignada a d√≠as ${r}-${i}`),e.selectedStartDate=null,e.selectedEndDate=null,this.renderCalendar(),document.getElementById("selectedRangeInfo").classList.add("hidden")},renderCityTimeline(){const e=document.getElementById("cityTimelineView");if(!e)return;const t=document.getElementById("itineraryStartDate").value,a=document.getElementById("itineraryEndDate").value,[n,r,i]=t.split("-").map(Number),[o,s,l]=a.split("-").map(Number),d=new Date(n,r-1,i),c=new Date(o,s-1,l),u=Math.ceil((c-d)/864e5)+1,p=[];for(let h=1;h<=u;h++){const e=document.getElementById(`city-blocks-day-${h}`);if(e){const t=e.querySelectorAll(".city-block"),a=[];t.forEach(e=>{const t=e.querySelector(".city-block-city");if(t&&t.value){const e=t.value,n=ke[e];n&&a.push(n.city)}}),a.length>0&&p.push({day:h,cities:a,date:new Date(d.getTime()+24*(h-1)*60*60*1e3)})}}if(0===p.length)return void(e.innerHTML='\n        <div class="text-center py-8 text-gray-400 dark:text-gray-500 text-sm">\n          <i class="fas fa-calendar-alt text-3xl mb-2"></i>\n          <p>Agrega ciudades para ver la distribuci√≥n aqu√≠</p>\n        </div>\n      ');const g=[];let m=null;p.forEach((e,t)=>{const a=e.cities.join(", ");m&&m.cityStr===a?m.dayTo=e.day:(m&&g.push(m),m={cityStr:a,cities:e.cities,dayFrom:e.day,dayTo:e.day,dateFrom:e.date}),t===p.length-1&&g.push(m)});const y=["blue","green","purple","pink","indigo","yellow","red","orange"];e.innerHTML=g.map((e,t)=>{const a=y[t%y.length],n=e.dayTo-e.dayFrom+1,r=e.dateFrom.toLocaleDateString("es-ES",{day:"numeric",month:"short"});return`\n        <div class="flex items-center gap-3 p-3 bg-${a}-50 dark:bg-${a}-900/20 border border-${a}-200 dark:border-${a}-800 rounded-lg">\n          <div class="flex-shrink-0 w-16 text-center">\n            <div class="text-xs font-semibold text-${a}-900 dark:text-${a}-300">\n              ${e.dayFrom===e.dayTo?`D√≠a ${e.dayFrom}`:`D√≠as ${e.dayFrom}-${e.dayTo}`}\n            </div>\n            <div class="text-xs text-${a}-600 dark:text-${a}-400">${r}</div>\n          </div>\n          <div class="flex-1">\n            <div class="font-bold text-${a}-900 dark:text-${a}-300">${e.cityStr}</div>\n            <div class="text-xs text-${a}-700 dark:text-${a}-400">\n              ${n} ${1===n?"d√≠a":"d√≠as"} ‚Ä¢ ${e.cities.length>1?"M√∫ltiples ciudades":"Estancia completa"}\n            </div>\n          </div>\n          <button\n            onclick="ItineraryBuilder.removeCityRange(${e.dayFrom}, ${e.dayTo})"\n            class="flex-shrink-0 p-2 text-${a}-600 dark:text-${a}-400 hover:bg-${a}-100 dark:hover:bg-${a}-800 rounded transition"\n            title="Eliminar"\n          >\n            <i class="fas fa-times"></i>\n          </button>\n        </div>\n      `}).join("")},removeCityRange(e,a){if(confirm(`¬øEliminar asignaciones de ciudades para los d√≠as ${e}-${a}?`)){for(let t=e;t<=a;t++){const e=document.getElementById(`city-blocks-day-${t}`);if(e){e.querySelectorAll(".city-block").forEach(e=>{e.remove()}),e.innerHTML=`\n          <div class="text-center py-6 text-gray-400 dark:text-gray-500 text-sm" id="empty-state-day-${t}">\n            <i class="fas fa-map-marked-alt text-2xl mb-2"></i>\n            <p>Haz clic en "Agregar Ciudad" para empezar</p>\n          </div>\n        `,this.updateCityCount(t)}}this.renderCityTimeline(),t.success("‚úÖ Ciudades eliminadas")}},populateQuickCitySelector(){const e=document.getElementById("datePickerCitySelect");if(e){const t=Object.keys(ke).map(e=>`<option value="${e}">${ke[e].city}</option>`).join("");e.innerHTML='<option value="">Seleccionar ciudad...</option>'+t}},generateDateCitySelector(){const e=document.getElementById("itineraryStartDate").value,t=document.getElementById("itineraryEndDate").value;if(!e||!t)return void console.error("Start or end date missing");const[a,n,r]=e.split("-").map(Number),[i,o,s]=t.split("-").map(Number),l=new Date(a,n-1,r),d=new Date(i,o-1,s),c=[];let u=new Date(l);for(;u<=d;)c.push(new Date(u)),u.setDate(u.getDate()+1);this.populateQuickCitySelector(),Object.keys(ke).map(e=>`<option value="${e}">${ke[e].city}</option>`).join("");document.getElementById("cityByDateContainer").innerHTML=c.map((e,t)=>{const a=e.toISOString().split("T")[0],n=t+1;return`\n        <div class="bg-white dark:bg-gray-700 rounded-lg border border-gray-300 dark:border-gray-600 p-4 hover:shadow-md transition">\n          \x3c!-- Day Header --\x3e\n          <div class="flex items-center justify-between mb-3 pb-3 border-b border-gray-200 dark:border-gray-600">\n            <div class="flex items-center gap-3">\n              <div class="text-center">\n                <div class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase">${e.toLocaleDateString("es-ES",{weekday:"short"})}</div>\n                <div class="text-lg font-bold dark:text-white">D√≠a ${n}</div>\n                <div class="text-xs text-gray-600 dark:text-gray-400">${e.toLocaleDateString("es-ES",{day:"numeric",month:"short"})}</div>\n              </div>\n              <div class="h-8 w-px bg-gray-300 dark:bg-gray-600"></div>\n              <div>\n                <div class="text-sm font-semibold dark:text-white">Ciudades a visitar</div>\n                <div class="text-xs text-gray-500 dark:text-gray-400" id="city-count-day-${n}">Sin ciudades</div>\n              </div>\n            </div>\n            <button\n              type="button"\n              onclick="ItineraryBuilder.addCityBlock(${n}, '${a}')"\n              class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg transition text-sm font-semibold flex items-center gap-2"\n            >\n              <i class="fas fa-plus"></i> Agregar Ciudad\n            </button>\n          </div>\n          \n          \x3c!-- City Blocks Container --\x3e\n          <div id="city-blocks-day-${n}" class="space-y-2" data-date="${a}" data-day="${n}">\n            \x3c!-- City blocks will be added dynamically --\x3e\n            <div class="text-center py-6 text-gray-400 dark:text-gray-500 text-sm" id="empty-state-day-${n}">\n              <i class="fas fa-map-marked-alt text-2xl mb-2"></i>\n              <p>Haz clic en "Agregar Ciudad" para empezar</p>\n            </div>\n          </div>\n        </div>\n      `}).join(""),console.log(`‚úÖ Generated ${c.length} flexible date containers`)},addCityBlock(e,t){const a=document.getElementById(`city-blocks-day-${e}`),n=document.getElementById(`empty-state-day-${e}`);n&&n.remove();const r=`city-block-${e}-${Date.now()}`,i=`\n      <div id="${r}" class="city-block bg-gray-50 dark:bg-gray-800 p-3 rounded-lg border border-gray-200 dark:border-gray-600" data-day="${e}">\n        <div class="flex items-start gap-2">\n          <div class="flex-1 grid grid-cols-1 md:grid-cols-3 gap-3">\n            \x3c!-- City Selection --\x3e\n            <div>\n              <label class="block text-xs font-semibold mb-1 dark:text-gray-300">Ciudad *</label>\n              <select\n                class="city-block-city w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white text-sm"\n                required\n              >\n                <option value="">Seleccionar...</option>\n                ${Object.keys(ke).map(e=>`<option value="${e}">${ke[e].city}</option>`).join("")}\n              </select>\n            </div>\n            \n            \x3c!-- Time Start (Optional) --\x3e\n            <div>\n              <label class="block text-xs font-semibold mb-1 dark:text-gray-300">\n                Hora inicio <span class="text-gray-400">(opcional)</span>\n              </label>\n              <input\n                type="time"\n                class="city-block-time-start w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white text-sm"\n                placeholder="09:00"\n              />\n            </div>\n            \n            \x3c!-- Time End (Optional) --\x3e\n            <div>\n              <label class="block text-xs font-semibold mb-1 dark:text-gray-300">\n                Hora fin <span class="text-gray-400">(opcional)</span>\n              </label>\n              <input\n                type="time"\n                class="city-block-time-end w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white text-sm"\n                placeholder="18:00"\n              />\n            </div>\n          </div>\n          \n          \x3c!-- Remove Button --\x3e\n          <button\n            type="button"\n            onclick="ItineraryBuilder.removeCityBlock('${r}', ${e})"\n            class="flex-shrink-0 mt-6 p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition"\n            title="Eliminar"\n          >\n            <i class="fas fa-trash-alt"></i>\n          </button>\n        </div>\n        \n        \x3c!-- Duration Indicator --\x3e\n        <div class="mt-2 text-xs text-gray-500 dark:text-gray-400 italic">\n          üí° Deja los horarios vac√≠os para indicar que pasar√°s todo el d√≠a en esta ciudad\n        </div>\n      </div>\n    `;a.insertAdjacentHTML("beforeend",i),this.updateCityCount(e);const o=document.getElementById(r);if(o){const e=o.querySelector(".city-block-city");e&&e.addEventListener("change",()=>{this.renderCityTimeline()})}},removeCityBlock(e,t){const a=document.getElementById(e);if(a){a.remove(),this.updateCityCount(t);const e=document.getElementById(`city-blocks-day-${t}`);e&&0===e.querySelectorAll(".city-block").length&&(e.innerHTML=`\n          <div class="text-center py-6 text-gray-400 dark:text-gray-500 text-sm" id="empty-state-day-${t}">\n            <i class="fas fa-map-marked-alt text-2xl mb-2"></i>\n            <p>Haz clic en "Agregar Ciudad" para empezar</p>\n          </div>\n        `),this.renderCityTimeline()}},updateCityCount(e){const t=document.getElementById(`city-blocks-day-${e}`),a=document.getElementById(`city-count-day-${e}`);if(t&&a){const e=t.querySelectorAll(".city-block").length;a.textContent=0===e?"Sin ciudades":1===e?"1 ciudad":`${e} ciudades`}},toggleCityDayAssignment(e){const t=document.getElementById(`city-${e}`),a=document.getElementById(`days-${e}`);if(t.checked)a.classList.remove("hidden");else{a.classList.add("hidden");const t=a.querySelector(".one-day-checkbox");t&&(t.checked=!1),a.querySelectorAll('input[type="number"]').forEach(e=>e.value=""),document.getElementById(`multiday-${e}`).classList.remove("hidden"),document.getElementById(`oneday-${e}`).classList.add("hidden")}},toggleOneDayVisit(e){const t=document.querySelector(`#days-${e} .one-day-checkbox`),a=document.getElementById(`multiday-${e}`),n=document.getElementById(`oneday-${e}`);t.checked?(a.classList.add("hidden"),n.classList.remove("hidden"),a.querySelectorAll("input").forEach(e=>e.value="")):(a.classList.remove("hidden"),n.classList.add("hidden"),n.querySelector("input").value="")},updateDayRange(e){const t=document.querySelector(`#multiday-${e} .city-days-count`).value,a=document.querySelector(`#multiday-${e} .city-day-start`);if(t&&a.value){const n=parseInt(a.value)+parseInt(t)-1;document.querySelector(`#multiday-${e} .city-day-end`).value=n}},validateDayAssignment(e){console.log(`Validating day assignment for ${e}`)},currentStep:1,nextWizardStep(){this.validateCurrentStep()&&this.currentStep<5&&(this.currentStep++,2===this.currentStep&&this.generateDateCitySelector(),this.renderQuickCityBlocksUI&&this.renderQuickCityBlocksUI(),this.updateWizardView())},previousWizardStep(){this.currentStep>1&&(this.currentStep--,this.updateWizardView())},validateCurrentStep(){if(1===this.currentStep){const e=document.getElementById("itineraryName").value,a=document.getElementById("itineraryStartDate").value,n=document.getElementById("itineraryEndDate").value;if(!e||!a||!n)return t.warning("Por favor completa todos los campos obligatorios"),!1;if(new Date(n)<=new Date(a))return t.warning("La fecha de fin debe ser posterior a la fecha de inicio"),!1}if(2===this.currentStep){const e=document.getElementById("itineraryStartDate").value,a=document.getElementById("itineraryEndDate").value,[n,r,i]=e.split("-").map(Number),[o,s,l]=a.split("-").map(Number),d=new Date(n,r-1,i),c=new Date(o,s-1,l),u=Math.ceil((c-d)/864e5)+1,p=[];for(let t=1;t<=u;t++){const e=document.getElementById(`city-blocks-day-${t}`);if(e){const a=e.querySelectorAll(".city-block");if(0===a.length){p.push(t);continue}let n=!1;a.forEach(e=>{const t=e.querySelector(".city-block-city");t&&t.value||(n=!0)}),n&&p.push(t)}}if(p.length>0)return t.warning(`Por favor agrega al menos una ciudad para los siguientes d√≠as: ${p.join(", ")}`),!1}return!0},updateWizardView(){document.querySelectorAll(".wizard-content").forEach(e=>{e.classList.add("hidden")}),document.getElementById(`wizardStep${this.currentStep}`).classList.remove("hidden"),document.querySelectorAll(".wizard-step").forEach((e,t)=>{const a=t+1,n=e.querySelector("div");a<this.currentStep?(n.classList.remove("bg-gray-300","bg-purple-500"),n.classList.add("bg-green-500"),n.innerHTML="‚úì"):a===this.currentStep?(n.classList.remove("bg-gray-300","bg-green-500"),n.classList.add("bg-purple-500"),n.innerHTML=a):(n.classList.remove("bg-purple-500","bg-green-500"),n.classList.add("bg-gray-300"),n.innerHTML=a)});const e=document.getElementById("wizardPrevBtn"),t=document.getElementById("wizardNextBtn"),a=document.getElementById("wizardFinishBtn");1===this.currentStep?e.classList.add("hidden"):e.classList.remove("hidden"),5===this.currentStep?(t.classList.add("hidden"),a.classList.remove("hidden")):(t.classList.remove("hidden"),a.classList.add("hidden"));const n=document.getElementById("skipFlightsBtn");n&&(3===this.currentStep?n.classList.remove("hidden"):n.classList.add("hidden"))},async finishWizard(){var e,a,n,r,i,o,s,l,d,c,u;const p={name:document.getElementById("itineraryName").value,startDate:document.getElementById("itineraryStartDate").value,endDate:document.getElementById("itineraryEndDate").value,cityDayAssignments:this.getCityDayAssignments(),categories:Array.from(document.querySelectorAll('input[name="categories"]:checked')).map(e=>e.value),template:(null==(e=document.querySelector('input[name="template"]:checked'))?void 0:e.value)||"blank",outboundFlight:{airline:(null==(a=document.getElementById("outboundAirline"))?void 0:a.value)||"",flightNumber:(null==(n=document.getElementById("outboundFlightNumber"))?void 0:n.value)||"",origin:(null==(r=document.getElementById("outboundOrigin"))?void 0:r.value)||"",destination:(null==(i=document.getElementById("outboundDestination"))?void 0:i.value)||"",datetime:(null==(o=document.getElementById("outboundDateTime"))?void 0:o.value)||"",connections:this.getConnectionFlights("outbound")},returnFlight:{airline:(null==(s=document.getElementById("returnAirline"))?void 0:s.value)||"",flightNumber:(null==(l=document.getElementById("returnFlightNumber"))?void 0:l.value)||"",origin:(null==(d=document.getElementById("returnOrigin"))?void 0:d.value)||"",destination:(null==(c=document.getElementById("returnDestination"))?void 0:c.value)||"",datetime:(null==(u=document.getElementById("returnDateTime"))?void 0:u.value)||"",connections:this.getConnectionFlights("return")}};if(console.log("üìã Datos del Itinerario:",p),this.shouldCreateTrip){if(console.log("üéØ Creating trip first..."),!window.TripsManager)return void t.error("Error: TripsManager no est√° disponible");try{const e={name:p.name,destination:"Jap√≥n",dateStart:p.startDate,dateEnd:p.endDate,useTemplate:!0};console.log("üîç Trip data being sent:",e);const t=await window.TripsManager.createTrip(e);if(!t)throw new Error("Trip creation did not return tripId");console.log("‚úÖ Trip created successfully:",t),await new Promise(e=>setTimeout(e,800))}catch(g){return console.error("‚ùå Error creating trip:",g),void t.error("Error al crear el viaje. Int√©ntalo de nuevo.")}}await this.createItinerary(p),this.closeCreateItineraryWizard()},getCityDayAssignments(){const e=document.getElementById("itineraryStartDate").value,t=document.getElementById("itineraryEndDate").value,[a,n,r]=e.split("-").map(Number),[i,o,s]=t.split("-").map(Number),l=new Date(a,n-1,r),d=new Date(i,o-1,s),c=Math.ceil((d-l)/864e5)+1,u=[];for(let p=1;p<=c;p++){const e=document.getElementById(`city-blocks-day-${p}`);if(!e)continue;const t=e.querySelectorAll(".city-block"),a=[];t.forEach((e,t)=>{const n=e.querySelector(".city-block-city"),r=e.querySelector(".city-block-time-start"),i=e.querySelector(".city-block-time-end");if(n&&n.value){const e=n.value,o=ke[e];a.push({cityId:e,cityName:o.city,timeStart:r.value||null,timeEnd:i.value||null,order:t+1,isFullDay:!r.value&&!i.value})}}),a.length>0&&u.push({day:p,date:new Date(l.getTime()+24*(p-1)*60*60*1e3).toISOString().split("T")[0],cities:a,cityCount:a.length,isMultiCity:a.length>1})}return console.log("üìã New flexible city day assignments:",u),u},getConnectionFlights(e){const t=document.getElementById(`${e}Connections`),a=[];return t.querySelectorAll(".bg-gray-100").forEach(e=>{a.push({airline:e.querySelector(".connection-airline").value,flightNumber:e.querySelector(".connection-flight-number").value,origin:e.querySelector(".connection-origin").value,destination:e.querySelector(".connection-destination").value,datetime:e.querySelector(".connection-datetime").value})}),a},closeCreateItineraryWizard(){const e=document.getElementById("createItineraryWizard");e&&(e.remove(),document.body.style.overflow=""),this.currentStep=1},async createItinerary(n){if(e.currentUser)if(window.TripsManager&&window.TripsManager.currentTrip)try{const o=window.TripsManager.currentTrip.id,s=this.generateDays(n.startDate,n.endDate);let l=[];"blank"!==n.template&&n.cityDayAssignments&&n.cityDayAssignments.length>0&&(l=await this.generateActivitiesFromTemplate(n.template,n.cityDayAssignments,n.categories,s.length));const d=s.map(e=>{const t=l.filter(t=>t.day===e.day),a=n.cityDayAssignments.find(t=>t.day===e.day);let r="D√≠a libre",i="";if(a&&a.cities)if(a.isMultiCity)r=`Visitando ${a.cities.map(e=>e.cityName).join(" y ")}`,i=a.cities.map(e=>e.timeStart&&e.timeEnd?`${e.cityName} (${e.timeStart}-${e.timeEnd})`:e.cityName).join(" ‚Üí ");else{const e=a.cities[0];r=`Explorando ${e.cityName}`,i=e.cityName,e.timeStart&&e.timeEnd&&(r+=` (${e.timeStart}-${e.timeEnd})`)}return{...e,title:r,location:i,cities:(null==a?void 0:a.cities)||[],isMultiCity:(null==a?void 0:a.isMultiCity)||!1,activities:t}}),c=new Set;n.cityDayAssignments.forEach(e=>{e.cities.forEach(e=>{c.add(e.cityId)})});const u=Array.from(c),p=r(a,`trips/${o}/data`,"itinerary");await i(p,{name:n.name,startDate:n.startDate,endDate:n.endDate,cities:u,cityDayAssignments:n.cityDayAssignments,categories:n.categories,template:n.template,days:d,flights:{outbound:n.outboundFlight,return:n.returnFlight},createdAt:(new Date).toISOString(),createdBy:e.currentUser.email}),t.success(`‚ú® Itinerario "${n.name}" creado exitosamente con ${l.length} actividades!`),window.ItineraryHandler&&window.ItineraryHandler.reinitialize&&window.ItineraryHandler.reinitialize(),console.log("‚úÖ Itinerario creado:",o,`con ${l.length} actividades`)}catch(o){console.error("‚ùå Error creando itinerario:",o),t.error("Error al crear itinerario. Int√©ntalo de nuevo.")}else t.warning("Primero debes crear o seleccionar un viaje");else t.warning("Debes iniciar sesi√≥n para crear un itinerario")},generateDays(e,t){const a=[],[n,r,i]=e.split("-").map(Number),[o,s,l]=t.split("-").map(Number),d=new Date(n,r-1,i),c=new Date(o,s-1,l);let u=new Date(d),p=1;for(;u<=c;)a.push({day:p,date:u.toISOString().split("T")[0],activities:[]}),u.setDate(u.getDate()+1),p++;return a},async generateActivitiesFromTemplate(e,t,a,n){console.log("üéØ Generating smart itinerary with flexible city visits:",{templateId:e,cityDayAssignments:t,selectedCategories:a,totalDays:n}),console.log("üìã Using template-based generation");const r={relaxed:{min:2,max:3},moderate:{min:3,max:4},intense:{min:4,max:6}}[template.pace]||{min:3,max:4},i=[...new Set([...template.categories,...a])],o=[];let s=1;return t.forEach(e=>{const t=e.day,a=e.cities,n=a.length;let l;if(1===n&&a[0].isFullDay)l=r.min+Math.floor(Math.random()*(r.max-r.min+1));else if(1===n)l=Math.max(1,Math.floor(r.min/1.5));else{const e=r.min+Math.floor(Math.random()*(r.max-r.min+1));l=Math.max(1,Math.floor(e/n))}a.forEach((e,a)=>{const n=e.cityId,r=ke[n];if(!r||!r.activities)return void console.warn(`No activities found for city: ${n}`);let d=r.activities.filter(e=>i.includes(e.category));0===d.length&&(d=r.activities),d=this.shuffleArray([...d]);const c=Math.min(l,d.length);let u=e.timeStart||"09:00";for(let i=0;i<c;i++)if(i<d.length){const r=d[i];o.push({id:"activity-"+s++,day:t,city:n,cityName:e.cityName,...r,time:e.timeStart?this.calculateActivityTime(u,i):r.time||9+2*i+":00",cityVisitInfo:{timeStart:e.timeStart,timeEnd:e.timeEnd,isFullDay:e.isFullDay,order:e.order},order:10*a+i+1,isGenerated:!0})}})}),o.sort((e,t)=>e.day!==t.day?e.day-t.day:e.order-t.order),console.log(`‚úÖ Generated ${o.length} activities across ${t.length} days with flexible city visits`),o},async showAIRecommendationsForCurrent(){var e;if(window.AIIntegration)if(window.ItineraryHandler&&window.ItineraryHandler.currentItinerary){t.info("ü§ñ Analizando tu itinerario con AI...");try{const a=window.ItineraryHandler.currentItinerary,n=null==(e=window.TripsManager)?void 0:e.currentTrip,r=(null==n?void 0:n.categories)||[],i=await window.AIIntegration.getPersonalizedSuggestions(a,r);i.success&&i.analysis?this.displayAIAnalysis(i.analysis):t.error("No se pudo generar an√°lisis AI")}catch(a){console.error("Error getting AI recommendations:",a),t.error("Error al obtener recomendaciones AI")}}else t.warning("No hay itinerario para analizar");else t.error("AI Integration no est√° disponible")},displayAIAnalysis(e){const t=`\n      <div id="aiAnalysisModal" class="modal active" style="z-index: 10002;">\n        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">\n          \x3c!-- Header --\x3e\n          <div class="sticky top-0 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 text-white p-6 rounded-t-xl z-10">\n            <div class="flex items-center justify-between">\n              <div class="flex items-center gap-3">\n                <div class="text-4xl">üîç</div>\n                <div>\n                  <h2 class="text-2xl font-bold">An√°lisis AI de tu Itinerario</h2>\n                  <p class="text-sm text-white/80 mt-1">Mejora tu viaje con sugerencias personalizadas</p>\n                </div>\n              </div>\n              <button \n                onclick="ItineraryBuilder.closeAIAnalysisModal()"\n                class="text-white/80 hover:text-white text-2xl"\n              >\n                ‚úï\n              </button>\n            </div>\n          </div>\n\n          <div class="p-6 space-y-6">\n            \x3c!-- Overall Analysis --\x3e\n            ${e.overallAnalysis?`\n              <div class="bg-gradient-to-br from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 p-5 rounded-lg border border-indigo-200 dark:border-indigo-800">\n                <h3 class="text-lg font-bold text-indigo-900 dark:text-indigo-300 mb-2 flex items-center gap-2">\n                  <span>üìä</span> An√°lisis General\n                </h3>\n                <p class="text-gray-700 dark:text-gray-300 leading-relaxed">${e.overallAnalysis}</p>\n              </div>\n            `:""}\n\n            \x3c!-- Strengths --\x3e\n            ${e.strengths&&e.strengths.length>0?`\n              <div class="bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 p-5 rounded-lg border border-green-200 dark:border-green-800">\n                <h3 class="text-lg font-bold text-green-900 dark:text-green-300 mb-3 flex items-center gap-2">\n                  <span>‚úÖ</span> Puntos Fuertes\n                </h3>\n                <ul class="space-y-2">\n                  ${e.strengths.map(e=>`\n                    <li class="flex items-start gap-2 text-gray-700 dark:text-gray-300">\n                      <span class="text-green-500 mt-0.5">‚úì</span>\n                      <span>${e}</span>\n                    </li>\n                  `).join("")}\n                </ul>\n              </div>\n            `:""}\n\n            \x3c!-- Improvements --\x3e\n            ${e.improvements&&e.improvements.length>0?`\n              <div class="bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 p-5 rounded-lg border border-yellow-200 dark:border-yellow-800">\n                <h3 class="text-lg font-bold text-yellow-900 dark:text-yellow-300 mb-3 flex items-center gap-2">\n                  <span>üí°</span> Sugerencias de Mejora\n                </h3>\n                <div class="space-y-4">\n                  ${e.improvements.map(e=>`\n                    <div class="bg-white/50 dark:bg-gray-800/50 p-4 rounded-lg">\n                      <div class="font-semibold text-gray-900 dark:text-white mb-1">\n                        D√≠a ${e.day}\n                      </div>\n                      <div class="text-gray-700 dark:text-gray-300 text-sm mb-1">\n                        ${e.suggestion}\n                      </div>\n                      <div class="text-xs text-gray-600 dark:text-gray-400 italic">\n                        ${e.reasoning}\n                      </div>\n                    </div>\n                  `).join("")}\n                </div>\n              </div>\n            `:""}\n\n            \x3c!-- Hidden Gems --\x3e\n            ${e.hiddenGems&&e.hiddenGems.length>0?`\n              <div class="bg-gradient-to-br from-pink-50 to-rose-50 dark:from-pink-900/20 dark:to-rose-900/20 p-5 rounded-lg border border-pink-200 dark:border-pink-800">\n                <h3 class="text-lg font-bold text-pink-900 dark:text-pink-300 mb-3 flex items-center gap-2">\n                  <span>üíé</span> Joyas Escondidas\n                </h3>\n                <div class="space-y-3">\n                  ${e.hiddenGems.map(e=>`\n                    <div class="bg-white/50 dark:bg-gray-800/50 p-4 rounded-lg">\n                      <div class="font-bold text-gray-900 dark:text-white mb-1">\n                        ${e.title}\n                      </div>\n                      <div class="text-sm text-gray-700 dark:text-gray-300 mb-2">\n                        ${e.description}\n                      </div>\n                      <div class="text-xs text-pink-600 dark:text-pink-400 italic">\n                        ‚ú® ${e.whySpecial}\n                      </div>\n                    </div>\n                  `).join("")}\n                </div>\n              </div>\n            `:""}\n\n            \x3c!-- Optimization Tips --\x3e\n            ${e.optimizationTips&&e.optimizationTips.length>0?`\n              <div class="bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 p-5 rounded-lg border border-blue-200 dark:border-blue-800">\n                <h3 class="text-lg font-bold text-blue-900 dark:text-blue-300 mb-3 flex items-center gap-2">\n                  <span>üéØ</span> Consejos de Optimizaci√≥n\n                </h3>\n                <ul class="space-y-2">\n                  ${e.optimizationTips.map(e=>`\n                    <li class="flex items-start gap-2 text-gray-700 dark:text-gray-300">\n                      <span class="text-blue-500 mt-0.5">‚Üí</span>\n                      <span>${e}</span>\n                    </li>\n                  `).join("")}\n                </ul>\n              </div>\n            `:""}\n          </div>\n\n          \x3c!-- Footer --\x3e\n          <div class="sticky bottom-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 p-6">\n            <button \n              onclick="ItineraryBuilder.closeAIAnalysisModal()"\n              class="w-full bg-gradient-to-r from-indigo-500 to-purple-500 text-white py-3 rounded-lg hover:from-indigo-600 hover:to-purple-600 transition font-semibold"\n            >\n              Cerrar\n            </button>\n          </div>\n        </div>\n      </div>\n    `;document.body.insertAdjacentHTML("beforeend",t),document.body.style.overflow="hidden"},closeAIAnalysisModal(){const e=document.getElementById("aiAnalysisModal");e&&(e.remove(),document.body.style.overflow="")}};window.ItineraryBuilder=Se;const Te={showAddActivityModal(e=null){if(!window.TripsManager||!window.TripsManager.currentTrip)return void t.warning("Primero debes crear o seleccionar un viaje");window.TripsManager.currentTrip.cities;(()=>{try{const e=Array.from(document.querySelectorAll('input[name="categories"]:checked')).map(e=>e.value);return e.length?e:xe.map(e=>e.id)}catch(e){return xe.map(e=>e.id)}})();const a=Object.keys(ke).map(e=>`\n      <option value="${e}">${ke[e].city}</option>\n    `).join(""),n=xe.map(e=>`\n      <option value="${e.id}">${e.icon} ${e.name}</option>\n    `).join(""),r=`\n      <div id="addActivityModal" class="modal active" style="z-index:10050;">\n        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-3xl w-full p-0 overflow-hidden">\n          <div class="flex items-center justify-between px-6 py-4 bg-gradient-to-r from-green-600 to-emerald-500 text-white">\n            <h3 class="text-xl font-bold">‚ûï Agregar Actividad</h3>\n            <button class="modal-close text-white" onclick="ItineraryBuilderExtensions.closeAddActivityModal()">√ó</button>\n          </div>\n\n          <div class="p-6">\n            <div class="flex items-center gap-2 mb-4 border-b">\n              <button id="searchActivityTab" class="border-b-2 border-green-500 text-green-600 px-3 py-2 text-sm"\n                      onclick="ItineraryBuilderExtensions.switchActivityTab('search')">üîé Buscar</button>\n              <button id="customActivityTab" class="border-b-2 border-transparent text-gray-500 hover:text-gray-700 px-3 py-2 text-sm"\n                      onclick="ItineraryBuilderExtensions.switchActivityTab('custom')">‚úèÔ∏è Personalizada</button>\n            </div>\n\n            \x3c!-- Buscar actividades --\x3e\n            <div id="searchActivityContent">\n              <div class="grid md:grid-cols-3 gap-3 mb-3">\n                <div>\n                  <label class="text-xs">Ciudad</label>\n                  <select id="activityCityFilter" class="w-full p-2 border rounded">\n                    <option value="all">Todas</option>\n                    ${a}\n                  </select>\n                </div>\n                <div>\n                  <label class="text-xs">Categor√≠a</label>\n                  <select id="activityCategoryFilter" class="w-full p-2 border rounded">\n                    <option value="all">Todas</option>\n                    ${n}\n                  </select>\n                </div>\n                <div>\n                  <label class="text-xs">Buscar</label>\n                  <input id="activitySearchInput" class="w-full p-2 border rounded" placeholder="Ej. templo, ramen, mirador" />\n                </div>\n              </div>\n              <div id="activitySearchResults" class="space-y-2 text-sm">\n                \x3c!-- resultados --\x3e\n              </div>\n            </div>\n\n            \x3c!-- Crear personalizada --\x3e\n            <div id="customActivityContent" class="hidden">\n              <form id="customActivityForm" class="space-y-3">\n                <div class="grid md:grid-cols-2 gap-3">\n                  <div>\n                    <label class="text-xs">Nombre *</label>\n                    <input id="customActivityName" class="w-full p-2 border rounded" required />\n                  </div>\n                  <div>\n                    <label class="text-xs">Categor√≠a *</label>\n                    <select id="customActivityCategory" class="w-full p-2 border rounded" required>\n                      <option value="">Seleccionar...</option>\n                      ${n}\n                    </select>\n                  </div>\n                </div>\n                <div>\n                  <label class="text-xs">Descripci√≥n</label>\n                  <textarea id="customActivityDescription" class="w-full p-2 border rounded" rows="2"></textarea>\n                </div>\n                <div class="grid md:grid-cols-4 gap-3">\n                  <div>\n                    <label class="text-xs">Hora *</label>\n                    <input id="customActivityTime" type="time" class="w-full p-2 border rounded" required />\n                  </div>\n                  <div>\n                    <label class="text-xs">Duraci√≥n (min)</label>\n                    <input id="customActivityDuration" type="number" class="w-full p-2 border rounded" value="60" />\n                  </div>\n                  <div>\n                    <label class="text-xs">Costo (¬•)</label>\n                    <input id="customActivityCost" type="number" class="w-full p-2 border rounded" value="0" />\n                  </div>\n                  <div>\n                    <label class="text-xs">Ciudad</label>\n                    <select id="customActivityCity" class="w-full p-2 border rounded">\n                      <option value="">Seleccionar...</option>\n                      ${a}\n                    </select>\n                  </div>\n                </div>\n                <div>\n                  <label class="text-xs">Ubicaci√≥n/Estaci√≥n</label>\n                  <input id="customActivityLocation" class="w-full p-2 border rounded" placeholder="Ej. Gion-Shijo / Shinjuku" />\n                </div>\n                <div>\n                  <label class="text-xs">Notas</label>\n                  <textarea id="customActivityNotes" class="w-full p-2 border rounded" rows="2"></textarea>\n                </div>\n                <div class="flex justify-end gap-2 mt-2">\n                  <button type="button" class="px-4 py-2 bg-gray-200 rounded" onclick="ItineraryBuilderExtensions.closeAddActivityModal()">Cerrar</button>\n                  <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded">‚ûï Agregar Actividad</button>\n                </div>\n              </form>\n            </div>\n          </div>\n        </div>\n      </div>`,i=document.getElementById("addActivityModal");i&&i.remove(),document.body.insertAdjacentHTML("beforeend",r),document.body.style.overflow="hidden",this.loadInitialActivities();const o=document.getElementById("activitySearchInput");o&&o.addEventListener("input",()=>this.searchActivitiesLive());const s=document.getElementById("activityCityFilter"),l=document.getElementById("activityCategoryFilter");s&&s.addEventListener("change",()=>this.filterActivities()),l&&l.addEventListener("change",()=>this.filterActivities());const d=document.getElementById("customActivityForm");d&&d.addEventListener("submit",t=>{t.preventDefault(),this.addCustomActivity(e)})},switchActivityTab(e){const t=document.getElementById("searchActivityTab"),a=document.getElementById("customActivityTab"),n=document.getElementById("searchActivityContent"),r=document.getElementById("customActivityContent");"search"===e?(t.classList.add("border-green-500","text-green-600"),t.classList.remove("text-gray-500"),a.classList.remove("border-green-500","text-green-600"),a.classList.add("text-gray-500"),n.classList.remove("hidden"),r.classList.add("hidden")):(a.classList.add("border-green-500","text-green-600"),a.classList.remove("text-gray-500"),t.classList.remove("border-green-500","text-green-600"),t.classList.add("text-gray-500"),r.classList.remove("hidden"),n.classList.add("hidden"))},loadInitialActivities(){var e,t,a,n;const r=(null==(e=document.getElementById("activityCityFilter"))?void 0:e.value)||"all",i=(null==(t=document.getElementById("activityCategoryFilter"))?void 0:t.value)||"all";let o=[];if("all"===r)for(const s in ke)o.push(...(null==(a=ke[s])?void 0:a.activities)||[]);else o=(null==(n=ke[r])?void 0:n.activities)||[];"all"!==i&&(o=o.filter(e=>e.category===i)),this.renderActivityResults(o)},searchActivitiesLive(){var e;const t=(null==(e=document.getElementById("activitySearchInput"))?void 0:e.value)||"";if(t.trim().length<2)return void this.loadInitialActivities();const a=function(e){const t=[];for(const a in ke){const n=ke[a].activities.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())||t.description.toLowerCase().includes(e.toLowerCase()));t.push(...n)}return t}(t.trim());this.renderActivityResults(a)},filterActivities(){var e;((null==(e=document.getElementById("activitySearchInput"))?void 0:e.value)||"").trim().length>=2?this.searchActivitiesLive():this.loadInitialActivities()},renderActivityResults(e){const t=document.getElementById("activitySearchResults");t&&(e&&0!==e.length?t.innerHTML=e.slice(0,30).map(e=>{const t=xe.find(t=>t.id===e.category);return`\n        <div class="p-3 rounded border dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition">\n          <div class="flex items-start justify-between gap-3">\n            <div class="flex-1">\n              <div class="text-sm text-gray-500 mb-1">${(null==t?void 0:t.icon)||"üìç"} ${(null==t?void 0:t.name)||"Sin categor√≠a"}${e.duration?` ¬∑ ‚è±Ô∏è ${e.duration}`:""}${e.cost>0?` ¬∑ ¬•${Number(e.cost).toLocaleString()}`:" ¬∑ Gratis"}${e.station?` ¬∑ üöâ ${e.station}`:""}</div>\n              <h5 class="font-semibold">${e.name||e.title}</h5>\n              <p class="text-xs text-gray-600 dark:text-gray-400">${e.description||e.desc||""}</p>\n            </div>\n            <button class="px-3 py-1 text-sm bg-green-600 text-white rounded"\n                    onclick="ItineraryBuilderExtensions.addQuickActivity('${e.id||""}')">A√±adir</button>\n          </div>\n        </div>`}).join(""):t.innerHTML='\n        <div class="p-3 text-gray-500">üîé No se encontraron actividades</div>\n      ')},addQuickActivity(e){var a,n,r,i,o,s;try{if(!(null==(n=null==(a=window.TripsManager)?void 0:a.currentTrip)?void 0:n.id))return void t.warning("Selecciona un viaje");const l=window.ItineraryHandler?null==(i=null==(r=window.ItineraryHandler)?void 0:r.__getCurrentDay)?void 0:i.call(r):null;if(!l)return void t.warning("Abre el d√≠a en el itinerario para a√±adir");let d=null,c=null;for(const t in ke){const a=((null==(o=ke[t])?void 0:o.activities)||[]).find(t=>t.id===e);if(a){d=a,c=t;break}}if(!d)return void t.error("Actividad no encontrada");const u={id:`custom-${Date.now()}`,icon:"üìç",time:d.time||"09:00",title:d.name||d.title||"Actividad",desc:d.description||d.desc||"",cost:d.cost||0,station:d.station||"",city:c||"",category:d.category||"general"};(null==(s=window.ItineraryHandler)?void 0:s.__appendActivityToDay)&&window.ItineraryHandler.__appendActivityToDay(l.day,u),t.success("Actividad a√±adida")}catch(l){console.error(l),t.error("No se pudo a√±adir")}},async addCustomActivity(e){const a=document.getElementById("customActivityName").value;document.getElementById("customActivityCategory").value,document.getElementById("customActivityDescription").value,document.getElementById("customActivityTime").value,parseInt(document.getElementById("customActivityDuration").value||"60",10),parseInt(document.getElementById("customActivityCost").value||"0",10),document.getElementById("customActivityLocation").value,document.getElementById("customActivityCity").value,document.getElementById("customActivityNotes").value,(new Date).toISOString();t.success(`Actividad personalizada "${a}" creada`),this.closeAddActivityModal()},closeAddActivityModal(){const e=document.getElementById("addActivityModal");e&&(e.remove(),document.body.style.overflow="")},setupDragAndDrop(){console.log("üéØ Drag & Drop configurado")},async optimizeRoute(e){t.info("üó∫Ô∏è Optimizando ruta..."),setTimeout(()=>{t.success("‚úÖ Ruta optimizada")},1200)},toggleOptimization(){window.ItineraryBuilder=window.ItineraryBuilder||{},window.ItineraryBuilder.optimizationEnabled=!window.ItineraryBuilder.optimizationEnabled,window.ItineraryBuilder.optimizationEnabled?t.success("üéØ Optimizaci√≥n autom√°tica activada"):t.info("Optimizaci√≥n autom√°tica desactivada")},async exportToPDF(){t.info("üìÑ Generando PDF..."),setTimeout(()=>t.success("‚úÖ PDF generado"),1e3)},async shareItinerary(){if(navigator.share)try{await navigator.share({title:"Mi Itinerario de Viaje",text:"Mira mi itinerario de viaje a Jap√≥n!",url:window.location.href})}catch(e){console.warn("Share cancel/err",e)}else navigator.clipboard.writeText(window.location.href),t.success("üîó Link copiado al portapapeles")}};window.ItineraryBuilderExtensions=Te;const Ie={confirm({title:e,message:t,okText:a="Aceptar",cancelText:n="Cancelar",isDestructive:r=!1}){return new Promise(i=>{this.removeExisting();const o=`\n        <div id="customDialog" class="modal active" style="z-index: 10002;">\n          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-md w-full p-6 animate__animated animate__fadeInUp animate__faster">\n            <h3 class="text-xl font-bold dark:text-white mb-3">${e}</h3>\n            <p class="text-gray-600 dark:text-gray-300 mb-6">${t}</p>\n            <div class="flex justify-end gap-3">\n              <button id="dialogCancelBtn" class="px-6 py-2 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-white rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500 transition font-semibold">\n                ${n}\n              </button>\n              <button id="dialogOkBtn" class="px-6 py-2 ${r?"bg-red-600 hover:bg-red-700 text-white":"bg-blue-600 hover:bg-blue-700 text-white"} rounded-lg transition font-semibold">\n                ${a}\n              </button>\n            </div>\n          </div>\n        </div>\n      `;document.body.insertAdjacentHTML("beforeend",o),document.body.style.overflow="hidden";const s=document.getElementById("dialogOkBtn"),l=document.getElementById("dialogCancelBtn"),d=document.getElementById("customDialog"),c=e=>{this.removeExisting(),i(e)};s.onclick=()=>c(!0),l.onclick=()=>c(!1),d.onclick=e=>{"customDialog"===e.target.id&&c(!1)}})},prompt({title:e,message:t,placeholder:a="",inputType:n="text",okText:r="Aceptar",cancelText:i="Cancelar"}){return new Promise(o=>{this.removeExisting();const s=`\n        <div id="customDialog" class="modal active" style="z-index: 10002;">\n          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-md w-full p-6 animate__animated animate__fadeInUp animate__faster">\n            <h3 class="text-xl font-bold dark:text-white mb-3">${e}</h3>\n            <p class="text-gray-600 dark:text-gray-300 mb-4">${t}</p>\n            <input\n              id="dialogInput"\n              type="${n}"\n              placeholder="${a}"\n              class="w-full p-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-blue-500 focus:outline-none mb-6"\n            />\n            <div class="flex justify-end gap-3">\n              <button id="dialogCancelBtn" class="px-6 py-2 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-white rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500 transition font-semibold">\n                ${i}\n              </button>\n              <button id="dialogOkBtn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition font-semibold">\n                ${r}\n              </button>\n            </div>\n          </div>\n        </div>\n      `;document.body.insertAdjacentHTML("beforeend",s),document.body.style.overflow="hidden";const l=document.getElementById("dialogOkBtn"),d=document.getElementById("dialogCancelBtn"),c=document.getElementById("dialogInput"),u=document.getElementById("customDialog");c.focus();const p=e=>{this.removeExisting(),o(e)};l.onclick=()=>{""!==c.value.trim()&&p(c.value.trim())},c.onkeydown=e=>{"Enter"===e.key?l.click():"Escape"===e.key&&p(null)},d.onclick=()=>p(null),u.onclick=e=>{"customDialog"===e.target.id&&p(null)}})},removeExisting(){const e=document.getElementById("customDialog");e&&e.remove(),document.body.style.overflow=""}};window.Dialogs=Ie;const Ee={currentTrip:null,userTrips:[],unsubscribe:null,generateTripCode(){const e="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";let t="";for(let a=0;a<6;a++)t+=e.charAt(Math.floor(32*Math.random()));return t},async initUserTrips(){if(!e.currentUser)return void console.log("‚ö†Ô∏è Usuario no autenticado");const t=e.currentUser.uid,n=c(a,"trips"),r=u(n,p("members","array-contains",t));this.unsubscribe=l(r,e=>{this.userTrips=[],e.forEach(e=>{this.userTrips.push({id:e.id,...e.data()})}),console.log("‚úÖ Trips cargados:",this.userTrips.length),this.renderTripsList(),!this.currentTrip&&this.userTrips.length>0?this.selectTrip(this.userTrips[0].id):this.currentTrip||0!==this.userTrips.length||(console.log("‚ö†Ô∏è No hay trips, mostrar mensaje de bienvenida"),this.updateTripHeaderEmpty())})},async createTrip(n){if(e.currentUser)try{const o=e.currentUser.uid,s=`trip_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,l=this.generateTripCode(),d={info:{name:n.name,destination:n.destination||"Jap√≥n",dateStart:n.dateStart,dateEnd:n.dateEnd,createdBy:o,createdAt:(new Date).toISOString(),shareCode:l,creatorEmail:e.currentUser.email},members:[o],memberEmails:[e.currentUser.email],flights:{outbound:n.outboundFlight||null,return:n.returnFlight||null},accommodations:n.accommodations||[],cities:n.cities||[],activities:{checklist:{}},expenses:[]};return await i(r(a,"trips",s),d),t.success(`üéâ Viaje "${n.name}" creado exitosamente!\nüîó C√≥digo: ${l}`,6e3),console.log("‚úÖ Viaje creado:",s,"C√≥digo:",l),setTimeout(()=>{this.selectTrip(s)},500),s}catch(o){throw console.error("‚ùå Error creando viaje:",o),t.error("Error al crear el viaje. Int√©ntalo de nuevo."),o}else alert("‚ö†Ô∏è Debes iniciar sesi√≥n para crear un viaje")},async selectTrip(e){try{const t=r(a,"trips",e),n=await o(t);n.exists()&&(this.currentTrip={id:e,...n.data()},localStorage.setItem("currentTripId",e),console.log("‚úÖ Trip seleccionado:",this.currentTrip.info.name),this.updateTripHeader(),window.ItineraryHandler&&window.ItineraryHandler.reinitialize&&window.ItineraryHandler.reinitialize(),window.BudgetTracker&&window.BudgetTracker.reinitialize&&window.BudgetTracker.reinitialize(),window.PreparationHandler&&window.PreparationHandler.reinitialize&&window.PreparationHandler.reinitialize(),window.FlightsHandler&&window.FlightsHandler.init&&window.FlightsHandler.init(e),window.HotelsHandler&&window.HotelsHandler.init&&window.HotelsHandler.init(e),window.AppCore&&window.AppCore.reinitialize&&window.AppCore.reinitialize(),window.ChatHandler&&window.ChatHandler.reinitialize&&window.ChatHandler.reinitialize(e),this.closeTripsListModal(),console.log("üîÑ Todos los m√≥dulos re-inicializados para el trip:",e))}catch(t){console.error("‚ùå Error seleccionando trip:",t)}},async inviteMemberByEmail(){if(!this.currentTrip)return void window.Notifications.warning("Debes seleccionar un viaje primero");const e=await window.Dialogs.prompt({title:"üìß Invitar por Email",message:"Ingresa el email de la persona que quieres invitar. Recibir√° el c√≥digo para unirse."});if(e&&""!==e.trim())try{const n=r(a,"trips",this.currentTrip.id);await s(n,{pendingInvites:m(e.trim().toLowerCase())}),t.success(`‚úÖ Invitaci√≥n enviada a ${e}.`),console.log("‚úÖ Invitaci√≥n por email enviada a:",e)}catch(n){console.error("‚ùå Error invitando por email:",n),t.error("Error al enviar invitaci√≥n. Int√©ntalo de nuevo.")}},async showShareCode(){var e,t;if(!this.currentTrip)return void alert("‚ö†Ô∏è Debes seleccionar un viaje primero");let n=null==(e=this.currentTrip.info)?void 0:e.shareCode;if(!n){console.log("‚ö†Ô∏è No hay shareCode, generando uno nuevo..."),n=this.generateTripCode();try{const e=r(a,"trips",this.currentTrip.id);await s(e,{"info.shareCode":n}),this.currentTrip.info||(this.currentTrip.info={}),this.currentTrip.info.shareCode=n,console.log("‚úÖ ShareCode generado y guardado:",n)}catch(l){return console.error("‚ùå Error guardando shareCode:",l),void alert("Error al generar c√≥digo. Intenta de nuevo.")}}const i=`\n      <div id="shareCodeModal" class="modal active" style="z-index: 9999;">\n        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-md w-full p-6">\n          <div class="text-center">\n            <div class="text-6xl mb-4">üîó</div>\n            <h2 class="text-2xl font-bold dark:text-white mb-2">C√≥digo del viaje</h2>\n            <div class="bg-blue-50 dark:bg-blue-900/30 rounded-lg p-6 mb-4">\n              <p class="text-4xl font-mono font-bold text-blue-600 dark:text-blue-400 tracking-wider">${n}</p>\n            </div>\n            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">\n              <strong>Viaje:</strong> ${(null==(t=this.currentTrip.info)?void 0:t.name)||"Viaje"}\n            </p>\n            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4 text-left">\n              <p class="text-sm font-semibold dark:text-white mb-2">üëâ Para unirse:</p>\n              <ol class="text-sm text-gray-600 dark:text-gray-400 space-y-1 list-decimal list-inside">\n                <li>Abre la app</li>\n                <li>Click en "Unirse a un Viaje"</li>\n                <li>Ingresa este c√≥digo: <strong>${n}</strong></li>\n              </ol>\n            </div>\n            <button \n              onclick="TripsManager.copyShareCode('${n}')"\n              class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition font-semibold mb-2"\n            >\n              üìã Copiar C√≥digo\n            </button>\n            <button \n              onclick="TripsManager.closeShareCodeModal()"\n              class="w-full bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-white py-2 rounded-lg hover:bg-gray-400 dark:hover:bg-gray-500 transition"\n            >\n              Cerrar\n            </button>\n          </div>\n        </div>\n      </div>\n    `,o=document.getElementById("shareCodeModal");o&&o.remove(),document.body.insertAdjacentHTML("beforeend",i),document.body.style.overflow="hidden"},copyShareCode(e){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select();try{const a=document.execCommand("copy");if(t.remove(),a){const e=event.target,t=e.textContent;e.textContent="‚úÖ ¬°Copiado!",e.classList.add("bg-green-600","hover:bg-green-700"),e.classList.remove("bg-blue-600","hover:bg-blue-700"),setTimeout(()=>{e.textContent=t,e.classList.remove("bg-green-600","hover:bg-green-700"),e.classList.add("bg-blue-600","hover:bg-blue-700")},2e3)}else alert("Copia este c√≥digo manualmente: "+e)}catch(a){t.remove(),alert("Copia este c√≥digo manualmente: "+e)}},closeShareCodeModal(){const e=document.getElementById("shareCodeModal");e&&(e.remove(),document.body.style.overflow="")},async joinTripWithCode(){const n=await window.Dialogs.prompt({title:"üîó Unirse a un Viaje",message:"Ingresa el c√≥digo de 6 caracteres que te compartieron."});if(n)try{const i=c(a,"trips"),o=u(i,p("info.shareCode","==",n.trim().toUpperCase())),l=await g(o);if(l.empty)return void t.warning("No se encontr√≥ ning√∫n viaje con ese c√≥digo.");const d=l.docs[0],y=d.id,h=d.data(),b=e.currentUser.uid,v=e.currentUser.email;if(h.members.includes(b))return t.info("Ya eres miembro de este viaje."),void this.selectTrip(y);const x=r(a,"trips",y);await s(x,{members:m(b),memberEmails:m(v)}),t.success(`üéâ Te uniste a "${h.info.name}"!`),this.selectTrip(y),console.log("‚úÖ Usuario se uni√≥ al trip:",y)}catch(i){console.error("‚ùå Error uni√©ndose al trip:",i),t.error("Error al unirse al viaje. Int√©ntalo de nuevo.")}},renderTripsList(){const e=document.getElementById("tripsListContainer");e&&(0!==this.userTrips.length?e.innerHTML=`\n      <div class="space-y-3">\n        ${this.userTrips.map(e=>`\n          <div \n            class="p-4 bg-white dark:bg-gray-700 rounded-lg border-2 ${this.currentTrip&&this.currentTrip.id===e.id?"border-blue-500":"border-gray-200 dark:border-gray-600"} hover:shadow-lg transition cursor-pointer"\n            onclick="TripsManager.selectTrip('${e.id}')"\n          >\n            <div class="flex justify-between items-start">\n              <div class="flex-1">\n                <h3 class="font-bold text-lg dark:text-white">${e.info.name}</h3>\n                <p class="text-sm text-gray-600 dark:text-gray-400">\n                  ${new Date(e.info.dateStart).toLocaleDateString("es")} - \n                  ${new Date(e.info.dateEnd).toLocaleDateString("es")}\n                </p>\n                <p class="text-xs text-gray-500 dark:text-gray-500 mt-1">\n                  üë• ${e.members.length} miembro${e.members.length>1?"s":""}\n                  ${e.info.shareCode?`‚Ä¢ üîó ${e.info.shareCode}`:""}\n                </p>\n              </div>\n              <div class="flex items-center gap-2">\n                ${this.currentTrip&&this.currentTrip.id===e.id?'<span class="text-blue-500 text-2xl">‚úì</span>':""}\n                <button onclick="event.stopPropagation(); TripsManager.deleteTrip('${e.id}')" class="p-2 rounded-full hover:bg-red-100 dark:hover:bg-red-900/30 transition" title="Eliminar Viaje">\n                    <svg class="w-5 h-5 text-red-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd"></path></svg>\n                </button>\n              </div>\n            </div>\n          </div>\n        `).join("")}\n        \n        <button \n          onclick="TripsManager.showCreateTripModal()" \n          class="w-full p-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition"\n        >\n          <span class="text-gray-600 dark:text-gray-400 font-semibold">‚ûï Crear Nuevo Viaje</span>\n        </button>\n\n        <button \n          onclick="TripsManager.joinTripWithCode()" \n          class="w-full p-4 border-2 border-dashed border-green-300 dark:border-green-600 rounded-lg hover:bg-green-50 dark:hover:bg-green-900/20 transition"\n        >\n          <span class="text-green-600 dark:text-green-400 font-semibold">üîó Unirse con C√≥digo</span>\n        </button>\n      </div>\n    `:e.innerHTML='\n        <div class="text-center py-8">\n          <p class="text-gray-500 dark:text-gray-400 mb-4">No tienes viajes creados</p>\n          <button \n            onclick="TripsManager.showCreateTripModal()" \n            class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition font-semibold"\n          >\n            ‚ûï Crear Primer Viaje\n          </button>\n          <button \n            onclick="TripsManager.joinTripWithCode()" \n            class="mt-3 bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition font-semibold block w-full"\n          >\n            üîó Unirse con C√≥digo\n          </button>\n        </div>\n      ')},showCreateTripModal(){const e=document.getElementById("modal-create-trip");e&&(e.classList.add("active"),document.body.style.overflow="hidden",document.getElementById("tripTypeSelection").classList.remove("hidden"),document.getElementById("simpleTripForm").classList.add("hidden"))},showSimpleTripForm(){document.getElementById("tripTypeSelection").classList.add("hidden"),document.getElementById("simpleTripForm").classList.remove("hidden"),setTimeout(()=>{const e=document.getElementById("createTripFormSimple");e&&e.addEventListener("submit",async e=>{e.preventDefault();const t={name:document.getElementById("simpleTripName").value,destination:"Jap√≥n",dateStart:document.getElementById("simpleTripDateStart").value,dateEnd:document.getElementById("simpleTripDateEnd").value,useTemplate:!1};t.name&&t.dateStart&&t.dateEnd?new Date(t.dateEnd)<=new Date(t.dateStart)?alert("‚ö†Ô∏è La fecha de fin debe ser posterior a la fecha de inicio"):(await this.createTrip(t),this.closeCreateTripModal()):alert("‚ö†Ô∏è Por favor completa todos los campos")})},100)},showFullTripWizard(){this.closeCreateTripModal(),setTimeout(()=>{window.ItineraryBuilder&&window.ItineraryBuilder.showCreateItineraryWizard?window.ItineraryBuilder.showCreateItineraryWizard(!0):(console.error("ItineraryBuilder no est√° disponible"),t.error("Error: El wizard de itinerario no est√° disponible"))},300)},closeCreateTripModal(){const e=document.getElementById("modal-create-trip");if(e){e.classList.remove("active"),document.body.style.overflow="";const t=document.getElementById("createTripForm");t&&t.reset()}},async handleCreateTripForm(e){var t;e.preventDefault();const a="template15"===(null==(t=document.querySelector('input[name="templateOption"]:checked'))?void 0:t.value),n={name:document.getElementById("tripName").value,destination:document.getElementById("tripDestination").value||"Jap√≥n",dateStart:document.getElementById("tripDateStart").value,dateEnd:document.getElementById("tripDateEnd").value,useTemplate:a,outboundFlight:{flightNumber:document.getElementById("outboundFlightNumber").value,airline:document.getElementById("outboundAirline").value,date:document.getElementById("outboundDate").value,from:document.getElementById("outboundFrom").value,to:document.getElementById("outboundTo").value},returnFlight:{flightNumber:document.getElementById("returnFlightNumber").value,airline:document.getElementById("returnAirline").value,date:document.getElementById("returnDate").value,from:document.getElementById("returnFrom").value,to:document.getElementById("returnTo").value},accommodations:[]};n.name&&n.dateStart&&n.dateEnd?new Date(n.dateEnd)<=new Date(n.dateStart)?alert("‚ö†Ô∏è La fecha de fin debe ser posterior a la fecha de inicio"):(await this.createTrip(n),this.closeCreateTripModal()):alert("‚ö†Ô∏è Por favor completa los campos obligatorios (Nombre y Fechas)")},updateTripHeader(){const e=document.getElementById("currentTripHeader");if(!e||!this.currentTrip)return;const t=new Date(this.currentTrip.info.dateStart),a=new Date(this.currentTrip.info.dateEnd),n=new Date,r=Math.ceil((t-n)/864e5),i=Math.ceil((a-t)/864e5)+1,o=Math.max(0,Math.ceil((n-t)/864e5)),s=r<=0?Math.min(100,o/i*100):0,l=this.currentTrip.members.length>1?`ü§ù Viaje colaborativo ‚Ä¢ üîó ${this.currentTrip.info.shareCode}`:"üë§ Viaje individual";e.innerHTML=`\n      <div class="space-y-4">\n        \x3c!-- Fila 1: T√≠tulo y acciones --\x3e\n        <div class="flex justify-between items-center w-full flex-wrap gap-4">\n          \x3c!-- T√≠tulo principal y detalles del viaje --\x3e\n          <div class="flex-1">\n              <h2 class="text-2xl md:text-3xl font-bold text-white animate__animated animate__fadeInDown">${this.currentTrip.info.name}</h2>\n              <div class="flex items-center gap-4 text-white/80 text-xs mt-2 flex-wrap">\n                  <span>üìÖ ${t.toLocaleDateString("es",{day:"numeric",month:"short"})} - ${a.toLocaleDateString("es",{day:"numeric",month:"short",year:"numeric"})}</span>\n                  <span class="hidden md:inline">|</span>\n                  <span>${l}</span>\n              </div>\n          </div>\n\n          \x3c!-- Acciones y Countdown --\x3e\n          <div class="flex items-center gap-3 flex-wrap">\n              <div class="text-right hidden sm:block bg-white/10 backdrop-blur-sm px-4 py-2 rounded-lg">\n                  <div class="text-2xl font-bold text-white">${r>0?`${r}`:s<100?`D√≠a ${o}`:"‚úÖ"}</div>\n                  <div class="text-xs text-white/70">${r>0?"d√≠as restantes":s<100?"en progreso":"Completado"}</div>\n              </div>\n              <button\n                onclick="TripsManager.showTripsListModal()"\n                class="bg-white/10 hover:bg-white/20 text-white font-semibold py-2 px-4 rounded-lg transition backdrop-blur-sm hover-lift"\n              >\n                Mis Viajes\n              </button>\n              <button\n                onclick="TripsManager.showCreateTripModal()"\n                class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition backdrop-blur-sm flex items-center gap-2 hover-lift"\n              >\n                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"></path></svg>\n                  <span class="hidden md:inline">Agregar Viaje</span>\n              </button>\n               <button\n                onclick="TripsManager.showShareCode()"\n                class="bg-green-500/90 hover:bg-green-500 text-white font-bold py-2 px-4 rounded-lg transition backdrop-blur-sm flex items-center gap-2 hover-lift"\n                title="Compartir c√≥digo del viaje"\n              >\n                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6zM16 4a1 1 0 10-2 0v1h-1a1 1 0 100 2h1v1a1 1 0 102 0v-1h1a1 1 0 100-2h-1V4z"></path></svg>\n                <span class="hidden md:inline">Compartir</span>\n              </button>\n              <button\n                onclick="TripsManager.inviteMemberByEmail()"\n                class="bg-purple-500/90 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg transition backdrop-blur-sm flex items-center gap-2 hover-lift"\n                title="Invitar por email"\n              >\n                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path></svg>\n                  <span class="hidden md:inline">Invitar</span>\n              </button>\n          </div>\n        </div>\n\n        \x3c!-- Fila 2: Dashboard de Estad√≠sticas Visuales --\x3e\n        <div id="tripStatsDashboard" class="grid grid-cols-1 md:grid-cols-4 gap-4 animate-fade-in">\n          \x3c!-- Loading placeholder --\x3e\n          <div class="col-span-full text-center text-white/60 text-sm py-2">\n            <i class="fas fa-spinner animate-spin mr-2"></i>Cargando estad√≠sticas...\n          </div>\n        </div>\n      </div>\n    `,this.loadTripStatistics()},async loadTripStatistics(){var e,t,n,i,s,l,d;if(!this.currentTrip)return;const c=document.getElementById("tripStatsDashboard");if(c)try{const u=r(a,`trips/${this.currentTrip.id}/data`,"itinerary"),p=await o(u),g=p.exists()?p.data():null,m=(null==(e=null==g?void 0:g.days)?void 0:e.reduce((e,t)=>{var a;return e+((null==(a=t.activities)?void 0:a.length)||0)},0))||0,y=(null==(t=null==g?void 0:g.days)?void 0:t.reduce((e,t)=>{var a,n;return e+((null==(n=null==(a=t.activities)?void 0:a.filter(e=>e.completed))?void 0:n.length)||0)},0))||0,h=m>0?y/m*100:0,b=(this.currentTrip.expenses||[]).reduce((e,t)=>e+(t.amount||0),0),v=new Date(this.currentTrip.info.dateStart),x=new Date(this.currentTrip.info.dateEnd),f=Math.ceil((x-v)/864e5)+1,k=15e3*f*this.currentTrip.members.length,w=k>0?b/k*100:0,S=null==(i=null==(n=this.currentTrip.flights)?void 0:n.outbound)?void 0:i.flightNumber,T=(S?1:0)+((null==(l=null==(s=this.currentTrip.flights)?void 0:s.return)?void 0:l.flightNumber)?1:0),I=(null==(d=this.currentTrip.accommodations)?void 0:d.length)||0,E=new Date,C=Math.ceil((v-E)/864e5),A=Math.max(0,Math.ceil((E-v)/864e5)),D=f,M=C<=0?Math.min(100,A/D*100):0;c.innerHTML=`\n        \x3c!-- Card 1: Progreso del Viaje --\x3e\n        <div class="stat-card bg-gradient-to-br from-blue-500/90 to-cyan-500/90 backdrop-blur-sm rounded-xl p-4 shadow-lg hover-lift">\n          <div class="flex items-center justify-between mb-2">\n            <div class="text-white/90 text-sm font-semibold">Progreso del Viaje</div>\n            <div class="text-2xl">üóìÔ∏è</div>\n          </div>\n          <div class="text-3xl font-bold text-white mb-2">${D} d√≠as</div>\n          <div class="text-white/80 text-xs mb-3">\n            ${C>0?`Comienza en ${C} d√≠as`:M<100?`D√≠a ${A} de ${D}`:"Viaje completado"}\n          </div>\n          <div class="w-full bg-white/20 rounded-full h-2">\n            <div class="bg-white h-2 rounded-full transition-all duration-500" style="width: ${M}%"></div>\n          </div>\n        </div>\n\n        \x3c!-- Card 2: Actividades del Itinerario --\x3e\n        <div class="stat-card bg-gradient-to-br from-purple-500/90 to-pink-500/90 backdrop-blur-sm rounded-xl p-4 shadow-lg hover-lift">\n          <div class="flex items-center justify-between mb-2">\n            <div class="text-white/90 text-sm font-semibold">Actividades</div>\n            <div class="text-2xl">üìç</div>\n          </div>\n          <div class="text-3xl font-bold text-white mb-2">${m}</div>\n          <div class="text-white/80 text-xs mb-3">\n            ${y>0?`${y} completadas`:"Planificadas"}\n          </div>\n          <div class="w-full bg-white/20 rounded-full h-2">\n            <div class="bg-white h-2 rounded-full transition-all duration-500" style="width: ${h}%"></div>\n          </div>\n        </div>\n\n        \x3c!-- Card 3: Presupuesto --\x3e\n        <div class="stat-card bg-gradient-to-br from-green-500/90 to-emerald-500/90 backdrop-blur-sm rounded-xl p-4 shadow-lg hover-lift">\n          <div class="flex items-center justify-between mb-2">\n            <div class="text-white/90 text-sm font-semibold">Presupuesto</div>\n            <div class="text-2xl">üí∞</div>\n          </div>\n          <div class="text-3xl font-bold text-white mb-2">¬•${b.toLocaleString()}</div>\n          <div class="text-white/80 text-xs mb-3">\n            ${w>0?`${w.toFixed(0)}% del estimado`:"Sin gastos registrados"}\n          </div>\n          <div class="w-full bg-white/20 rounded-full h-2">\n            <div class="bg-white h-2 rounded-full transition-all duration-500" style="width: ${Math.min(100,w)}%"></div>\n          </div>\n        </div>\n\n        \x3c!-- Card 4: Reservas --\x3e\n        <div class="stat-card bg-gradient-to-br from-orange-500/90 to-red-500/90 backdrop-blur-sm rounded-xl p-4 shadow-lg hover-lift">\n          <div class="flex items-center justify-between mb-2">\n            <div class="text-white/90 text-sm font-semibold">Reservas</div>\n            <div class="text-2xl">‚úàÔ∏è</div>\n          </div>\n          <div class="flex gap-4 items-center mb-2">\n            <div>\n              <div class="text-2xl font-bold text-white">${T}/2</div>\n              <div class="text-white/80 text-xs">Vuelos</div>\n            </div>\n            <div class="w-px h-10 bg-white/30"></div>\n            <div>\n              <div class="text-2xl font-bold text-white">${I}</div>\n              <div class="text-white/80 text-xs">Hoteles</div>\n            </div>\n          </div>\n          <div class="text-white/80 text-xs">\n            ${2===T&&I>0?"‚úÖ Todo listo":"‚ö†Ô∏è Pendiente"}\n          </div>\n        </div>\n      `}catch(u){console.error("‚ùå Error cargando estad√≠sticas:",u),c.innerHTML='\n        <div class="col-span-full text-center text-white/60 text-sm py-2">\n          ‚ö†Ô∏è No se pudieron cargar las estad√≠sticas\n        </div>\n      '}},updateTripHeaderEmpty(){const e=document.getElementById("currentTripHeader");e&&(e.innerHTML='\n      <div class="flex items-center gap-3">\n        <div class="flex-1">\n          <h2 class="text-xl font-bold text-white">üëã ¬°Bienvenido!</h2>\n          <p class="text-sm text-white/80">\n            Crea tu primer viaje o √∫nete a uno existente\n          </p>\n        </div>\n        <div class="flex gap-2">\n          <button \n            onclick="TripsManager.showCreateTripModal()"\n            class="text-xs bg-white/20 hover:bg-white/30 px-4 py-2 rounded transition font-semibold"\n          >\n            ‚ûï Crear Viaje\n          </button>\n          <button \n            onclick="TripsManager.joinTripWithCode()"\n            class="text-xs bg-green-500/80 hover:bg-green-500 px-4 py-2 rounded transition font-semibold"\n          >\n            üîó Unirse\n          </button>\n        </div>\n      </div>\n    ')},showTripsListModal(){const e=document.getElementById("modal-trips-list");e&&(e.classList.add("active"),document.body.style.overflow="hidden",this.renderTripsList())},closeTripsListModal(){const e=document.getElementById("modal-trips-list");e&&(e.classList.remove("active"),document.body.style.overflow="")},async deleteTrip(e){const n=this.userTrips.find(t=>t.id===e);if(!n)return void t.error("No se encontr√≥ el viaje a eliminar.");if(!(await window.Dialogs.confirm({title:`üóëÔ∏è ¬øEliminar "${n.info.name}"?`,message:"¬øEst√°s seguro de que quieres eliminar este viaje?",okText:"S√≠, continuar",isDestructive:!0})))return;if(await window.Dialogs.confirm({title:"‚ö†Ô∏è ¬°Acci√≥n Permanente!",message:"Se borrar√°n todos los datos asociados (itinerario, gastos, etc.) y no se podr√° recuperar. ¬øREALMENTE quieres continuar?",okText:"S√≠, eliminar permanentemente",isDestructive:!0}))try{await d(r(a,"trips",e)),t.success(`Viaje "${n.info.name}" eliminado.`),this.currentTrip&&this.currentTrip.id===e&&(this.currentTrip=null,localStorage.removeItem("currentTripId"),this.userTrips.length>0?this.selectTrip(this.userTrips[0].id):this.updateTripHeaderEmpty())}catch(i){console.error("‚ùå Error eliminando el viaje:",i),t.error("Ocurri√≥ un error al eliminar el viaje.")}},cleanup(){this.unsubscribe&&(console.log("[TripsManager] üõë Deteniendo listener de viajes."),this.unsubscribe(),this.unsubscribe=null),this.currentTrip=null,this.userTrips=[],localStorage.removeItem("currentTripId"),this.updateTripHeaderEmpty(),this.renderTripsList(),console.log("[TripsManager] üßπ Estado de viajes limpiado.")}};window.TripsManager=Ee,window.addEventListener("auth:initialized",e=>{console.log("[TripsManager] ‚ú® Evento auth:initialized recibido. Inicializando viajes..."),Ee.initUserTrips()}),window.addEventListener("auth:loggedOut",()=>{console.log("[TripsManager] üö´ Evento auth:loggedOut recibido. Limpiando..."),Ee.cleanup()});const Ce={messaging:null,vapidKey:"BDSm_gI_3g8L-yC0G8zPz_...YOUR_VAPID_KEY_HERE...",async init(){console.log("üîî Inicializando Firebase Cloud Messaging...");try{this.messaging=f(),k(this.messaging,e=>{console.log("‚úâÔ∏è Mensaje recibido en primer plano: ",e),t.info(e.notification.body,8e3,e.notification.title)})}catch(e){console.error("‚ùå No se pudo inicializar FCM:",e)}},async requestPermissionAndToken(){if(this.messaging&&e.currentUser){console.log("üôè Solicitando permiso para notificaciones...");try{if("granted"===await Notification.requestPermission()){console.log("‚úÖ Permiso de notificaci√≥n concedido.");const e=await x(this.messaging,{vapidKey:this.vapidKey});e?(console.log("üîë Token FCM obtenido:",e),await this.saveTokenToServer(e)):console.warn("‚ö†Ô∏è No se pudo obtener el token de registro. Solicita permiso de nuevo.")}else console.warn("üö´ Permiso de notificaci√≥n denegado.")}catch(t){console.error("‚ùå Error al obtener el token FCM:",t)}}else console.warn("‚ö†Ô∏è FCM no inicializado o usuario no autenticado.")},async saveTokenToServer(t){if(!e.currentUser)return;const n=e.currentUser.uid,s=r(a,"users",n);try{const e=await o(s),a=(e.exists()?e.data():{}).fcmTokens||[];a.includes(t)?console.log("‚ÑπÔ∏è El token FCM ya existe para este usuario."):(a.push(t),await i(s,{fcmTokens:a},{merge:!0}),console.log("‚úÖ Token FCM guardado en el perfil del usuario."))}catch(l){console.error("‚ùå Error al guardar el token en Firestore:",l)}}};window.FCMManager=Ce,window.addEventListener("auth:initialized",async()=>{await Ce.init(),setTimeout(()=>{Ce.requestPermissionAndToken()},5e3)});const Ae={currentTripId:null,unsubscribe:null,isModalOpen:!1,init(e){this.currentTripId=e,this.renderChatButton()},renderChatButton(){if(!document.querySelector(".floating-btn-container")){const e=document.createElement("div");e.className="z-40 fixed bottom-8 right-8 flex flex-col gap-3 stagger-fade-in floating-btn-container",document.body.appendChild(e)}document.querySelector(".floating-btn-container").insertAdjacentHTML("beforeend",'\n      <button id="chatBtn" data-tooltip="üí¨ Chat del Viaje" class="floating-btn ripple bounce-click gpu-accelerated tooltip-success" aria-label="Abrir chat del viaje" style="animation-delay: 0.6s">\n        <i class="fas fa-comments"></i>\n      </button>\n    '),document.getElementById("chatBtn").addEventListener("click",()=>this.showChatModal())},showChatModal(){if(!this.currentTripId)return void t.warning("Selecciona un viaje para usar el chat.");this.isModalOpen=!0;const e=document.getElementById("chatModal");e&&e.remove(),document.body.insertAdjacentHTML("beforeend",'\n      <div id="chatModal" class="modal active" style="z-index: 10001;">\n        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-lg w-full h-[80vh] flex flex-col">\n          \x3c!-- Header --\x3e\n          <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center flex-shrink-0">\n            <h3 class="text-lg font-bold dark:text-white flex items-center gap-2">\n              <i class="fas fa-comments text-blue-500"></i> Chat del Viaje\n            </h3>\n            <button onclick="ChatHandler.closeChatModal()" class="text-gray-500 hover:text-red-500 transition">‚úï</button>\n          </div>\n\n          \x3c!-- Messages --\x3e\n          <div id="chatMessages" class="flex-1 p-4 overflow-y-auto flex flex-col-reverse">\n            \x3c!-- Mensajes se renderizan aqu√≠ --\x3e\n            <p class="text-center text-sm text-gray-400">Cargando mensajes...</p>\n          </div>\n\n          \x3c!-- Input --\x3e\n          <div class="p-4 border-t border-gray-200 dark:border-gray-700 flex-shrink-0">\n            <div class="flex items-center gap-2">\n              <input\n                id="chatInput"\n                type="text"\n                placeholder="Escribe un mensaje..."\n                class="w-full p-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-blue-500"\n              />\n              <button id="sendChatBtn" class="bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 transition">\n                <i class="fas fa-paper-plane"></i>\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    '),this.listenForMessages(),this.attachInputListeners()},closeChatModal(){this.isModalOpen=!1;const e=document.getElementById("chatModal");e&&e.remove(),this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null)},listenForMessages(){this.unsubscribe&&this.unsubscribe();const e=c(a,`trips/${this.currentTripId}/chat`),n=u(e,b("createdAt","desc"),v(50));this.unsubscribe=l(n,e=>{const t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),this.renderMessages(t)},e=>{console.error("Error escuchando mensajes:",e),t.error("No se pudo cargar el chat.")})},renderMessages(t){var a;const n=document.getElementById("chatMessages");if(!n)return;if(0===t.length)return void(n.innerHTML='<p class="text-center text-sm text-gray-400 my-auto">S√© el primero en enviar un mensaje. ¬°Hola! üëã</p>');const r=null==(a=e.currentUser)?void 0:a.uid;n.innerHTML=t.map(e=>{var t;const a=e.uid===r,n=(null==(t=e.createdAt)?void 0:t.toDate().toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}))||"";return`\n        <div class="flex ${a?"justify-end":"justify-start"} mb-3">\n          <div class="max-w-xs lg:max-w-md">\n            <div class="text-xs text-gray-500 dark:text-gray-400 mb-1 ${a?"text-right":"text-left"}">\n              ${e.author.split("@")[0]} <span class="ml-1">${n}</span>\n            </div>\n            <div class="${a?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 dark:text-white"} p-3 rounded-lg">\n              <p class="text-sm">${this.escapeHtml(e.text)}</p>\n            </div>\n          </div>\n        </div>\n      `}).join("")},attachInputListeners(){const e=document.getElementById("chatInput"),t=document.getElementById("sendChatBtn");e&&t&&(e.addEventListener("keypress",e=>{"Enter"===e.key&&this.sendMessage()}),t.addEventListener("click",()=>this.sendMessage()))},async sendMessage(){const n=document.getElementById("chatInput"),r=n.value.trim();if(!r)return;const{uid:i,email:o}=e.currentUser;try{const e=c(a,`trips/${this.currentTripId}/chat`);await y(e,{text:r,createdAt:h(),uid:i,author:o}),n.value="",n.focus()}catch(s){console.error("Error enviando mensaje:",s),t.error("No se pudo enviar el mensaje.")}},escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML},reinitialize(e){this.currentTripId=e,this.isModalOpen&&this.listenForMessages()}};window.ChatHandler=Ae,window.addEventListener("auth:initialized",()=>{const e=localStorage.getItem("currentTripId");e&&Ae.init(e)}),window.addEventListener("auth:loggedOut",()=>{Ae.unsubscribe&&Ae.unsubscribe();const e=document.getElementById("chatBtn");e&&e.remove()});const De={tokyo:"https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?auto=format&fit=crop&w=1200&q=80",kyoto:"https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?auto=format&fit=crop&w=1200&q=80",osaka:"https://unsplash.com/photos/OwbvX2iahvw/download?force=true&w=1200",dotonbori:"https://unsplash.com/photos/OwbvX2iahvw/download?force=true&w=1200","osaka-aquarium":"https://unsplash.com/photos/e8k-qnfxIe0/download?force=true&w=1200",nara:"https://unsplash.com/photos/OugwfKxatME/download?force=true&w=1200",hiroshima:"https://images.unsplash.com/photo-1617878223826-5a93d60fe046?auto=format&fit=crop&w=1200&q=80",hakone:"https://images.unsplash.com/photo-1578469645742-27e04af3a6b5?auto=format&fit=crop&w=1200&q=80",nikko:"https://images.unsplash.com/photo-1528164344705-47542687000d?auto=format&fit=crop&w=1200&q=80",kamakura:"https://images.unsplash.com/photo-1545569341-9eb8b30979d9?auto=format&fit=crop&w=1200&q=80",yokohama:"https://images.unsplash.com/photo-1583952804606-92c8b72b42e5?auto=format&fit=crop&w=1200&q=80",kanazawa:"https://images.unsplash.com/photo-1590559899731-a382839e5549?auto=format&fit=crop&w=1200&q=80",nagoya:"https://images.unsplash.com/photo-1554797589-7241bb691973?auto=format&fit=crop&w=1200&q=80",sapporo:"https://images.unsplash.com/photo-1624994960824-6e2e2f2a28a5?auto=format&fit=crop&w=1200&q=80",fukuoka:"https://images.unsplash.com/photo-1590559707-6aebfb4e4069?auto=format&fit=crop&w=1200&q=80",takayama:"https://images.unsplash.com/photo-1576834123088-2cfb2c7e3f35?auto=format&fit=crop&w=1200&q=80"},Me={culture:["https://images.unsplash.com/photo-1528164344705-47542687000d?w=800&q=80","https://images.unsplash.com/photo-1478436127897-769e1b3f0f36?w=800&q=80","https://images.unsplash.com/photo-1545569341-9eb8b30979d9?w=800&q=80","https://images.unsplash.com/photo-1590559899731-a382839e5549?w=800&q=80","https://images.unsplash.com/photo-1480796927426-f609979314bd?w=800&q=80"],food:["https://images.unsplash.com/photo-1579584425555-c3ce17fd4351?w=800&q=80","https://images.unsplash.com/photo-1569718212165-3a8278d5f624?w=800&q=80","https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=800&q=80","https://images.unsplash.com/photo-1581299894007-aaa50297cf16?w=800&q=80","https://images.unsplash.com/photo-1617093727343-374698b1b08d?w=800&q=80"],nature:["https://images.unsplash.com/photo-1490806843957-31f4c9a91c65?w=800&q=80","https://images.unsplash.com/photo-1522383225653-ed111181a951?w=800&q=80","https://images.unsplash.com/photo-1583778819769-09a7b49cc69e?w=800&q=80","https://images.unsplash.com/photo-1612832021773-b28c7aed8853?w=800&q=80","https://images.unsplash.com/photo-1515001635423-45e4f18f9267?w=800&q=80"],photography:["https://images.unsplash.com/photo-1542051841857-5f90071e7989?w=800&q=80","https://images.unsplash.com/photo-1513407030348-c983a97b98d8?w=800&q=80","https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?w=800&q=80","https://images.unsplash.com/photo-1604568992515-7eb40e279dd3?w=800&q=80","https://images.unsplash.com/photo-1490806843957-31f4c9a91c65?w=800&q=80"],shopping:["https://images.unsplash.com/photo-1555400038-63f5ba517a47?w=800&q=80","https://images.unsplash.com/photo-1534274988757-a28bf1a57c17?w=800&q=80","https://images.unsplash.com/photo-1573883430060-3e16bc2a0ba3?w=800&q=80","https://images.unsplash.com/photo-1567958451986-2de427a4a0be?w=800&q=80","https://images.unsplash.com/photo-1480796927426-f609979314bd?w=800&q=80"],nightlife:["https://images.unsplash.com/photo-1547981609-4b6bfe67ca0b?w=800&q=80","https://images.unsplash.com/photo-1563492065599-3520f775eeed?w=800&q=80","https://images.unsplash.com/photo-1542051841857-5f90071e7989?w=800&q=80","https://images.unsplash.com/photo-1524413840807-0c3cb6fa808d?w=800&q=80","https://images.unsplash.com/photo-1536098561742-ca998e48cbcc?w=800&q=80"],anime:["https://images.unsplash.com/photo-1613376023733-0a73315d9b06?w=800&q=80","https://images.unsplash.com/photo-1542779283-429940ce8336?w=800&q=80","https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=800&q=80","https://images.unsplash.com/photo-1627894483800-5bb82dcc1fe4?w=800&q=80","https://images.unsplash.com/photo-1628599946011-bb6e02748c0e?w=800&q=80"],relaxation:["https://images.unsplash.com/photo-1581579438747-1dc8d17bbce4?w=800&q=80","https://images.unsplash.com/photo-1573883430060-3e16bc2a0ba3?w=800&q=80","https://images.unsplash.com/photo-1544161515-4ab6ce6db874?w=800&q=80","https://images.unsplash.com/photo-1609137144813-7d9921338f24?w=800&q=80","https://images.unsplash.com/photo-1600334089648-b0d9d3028eb2?w=800&q=80"],family:["https://images.unsplash.com/photo-1564245303448-86b1c7b8e3cb?w=800&q=80","https://images.unsplash.com/photo-1542779283-429940ce8336?w=800&q=80","https://images.unsplash.com/photo-1524413840807-0c3cb6fa808d?w=800&q=80","https://images.unsplash.com/photo-1499856871958-5b9627545d1a?w=800&q=80","https://images.unsplash.com/photo-1471623432079-b009d30b6729?w=800&q=80"]},$e={hero:"https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?w=1920&q=80",features:["https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?w=600&q=80","https://images.unsplash.com/photo-1528164344705-47542687000d?w=600&q=80","https://images.unsplash.com/photo-1490806843957-31f4c9a91c65?w=600&q=80"]};function Pe(e){return De[e.toLowerCase()]||De.tokyo}function je(e){(new Image).src=e}window.ImageService={getActivityImage:function(e,t){const a=Me[t]||Me.culture,n=e.split("").reduce((e,t)=>t.charCodeAt(0)+((e<<5)-e),0);return a[Math.abs(n)%a.length]},getCityImage:Pe,getDayImage:function(e){if(!e||0===e.length)return $e.hero;const t=e[0];return Pe(t.cityId||t)},preloadImage:je,preloadImages:function(e){e.forEach(e=>je(e))},CITY_IMAGES:De,CATEGORY_IMAGES:Me,LANDING_IMAGES:$e};class Le{constructor(){this.isInitialized=!1,this.init()}async init(){try{if(console.log("üöÄ Iniciando dashboard..."),!this.checkAuthentication())return void this.redirectToLogin();t.init(),console.log("‚è≥ Esperando a que la autenticaci√≥n est√© lista...");try{await n.init(),console.log("‚úÖ Autenticaci√≥n lista, continuando con la inicializaci√≥n...")}catch(e){console.error("‚ùå Error cr√≠tico en autenticaci√≥n:",e),console.warn("‚ö†Ô∏è Continuando sin autenticaci√≥n (modo offline)")}await this.initializeApp(),this.setupDashboardEvents(),this.isInitialized=!0,console.log("‚úÖ Dashboard inicializado correctamente")}catch(a){console.error("üí• Error cr√≠tico al inicializar dashboard:",a),this.showErrorPage(a)}}checkAuthentication(){const e="true"===sessionStorage.getItem("authenticated"),t=n.getCurrentUser();return e||t}redirectToLogin(){console.log("üîê Usuario no autenticado, redirigiendo al login..."),window.location.href="/login.html"}async initializeApp(){try{await te.init(),await this.initializeDashboardComponents(),console.log("‚úÖ Aplicaci√≥n inicializada correctamente")}catch(e){throw console.error("‚ùå Error al inicializar aplicaci√≥n:",e),e}}async initializeDashboardComponents(){try{const e=[this.initUserInfo(),this.initTabs(),this.initModals(),this.initNotifications()];await Promise.all(e),console.log("‚úÖ Componentes del dashboard inicializados")}catch(e){throw console.error("‚ùå Error al inicializar componentes del dashboard:",e),e}}async initUserInfo(){try{const e=n.getCurrentUser();if(e){const t=document.getElementById("userEmailDisplay");t&&(t.textContent=e.email)}}catch(e){console.error("‚ùå Error al inicializar informaci√≥n del usuario:",e)}}async initTabs(){try{window.TabsHandler&&(window.tabsHandler=new ee)}catch(e){console.error("‚ùå Error al inicializar tabs:",e)}}async initModals(){try{window.ModalRenderer&&(window.modalRenderer=new I)}catch(e){console.error("‚ùå Error al inicializar modales:",e)}}async initNotifications(){try{if(window.FCMManager){const e=new Ce;await e.init()}}catch(e){console.error("‚ùå Error al inicializar notificaciones:",e)}}setupDashboardEvents(){const e=document.getElementById("logoutBtn");e&&e.addEventListener("click",()=>this.handleLogout());const t=document.getElementById("themeToggle");t&&t.addEventListener("click",()=>this.handleThemeToggle()),window.addEventListener("beforeunload",e=>{this.isInitialized||(e.preventDefault(),e.returnValue="")})}async handleLogout(){try{if(!confirm("¬øEst√°s seguro de que quieres cerrar sesi√≥n?"))return;this.showLoading("Cerrando sesi√≥n..."),await n.signOut(),sessionStorage.removeItem("authenticated"),localStorage.removeItem("currentTrip"),setTimeout(()=>{window.location.href="/login.html"},1e3)}catch(e){console.error("‚ùå Error al cerrar sesi√≥n:",e),this.showError("Error al cerrar sesi√≥n. Int√©ntalo de nuevo.")}}handleThemeToggle(){const e=document.body,t=e.classList.contains("dark");t?(e.classList.remove("dark"),localStorage.setItem("theme","light")):(e.classList.add("dark"),localStorage.setItem("theme","dark"));const a=document.getElementById("darkModeIcon");a&&(a.className=t?"fas fa-moon text-xl":"fas fa-sun text-xl")}showLoading(e){const t=document.createElement("div");t.id="loadingOverlay",t.className="fixed inset-0 bg-black/50 flex items-center justify-center z-50",t.innerHTML=`\n            <div class="bg-white dark:bg-gray-800 rounded-lg p-6 text-center">\n                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>\n                <p class="text-gray-700 dark:text-gray-300">${e}</p>\n            </div>\n        `,document.body.appendChild(t)}hideLoading(){const e=document.getElementById("loadingOverlay");e&&e.remove()}showError(e){this.hideLoading(),t.show(e,"error")}showErrorPage(e){console.error("üí• Critical initialization error:",e);(document.getElementById("appDashboard")||document.body).innerHTML=`\n            <div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-red-50 to-red-100 dark:from-gray-900 dark:to-gray-800 px-4">\n                <div class="max-w-2xl w-full bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 text-center">\n                    <div class="text-6xl mb-6">‚ö†Ô∏è</div>\n                    <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-4">\n                        Error al iniciar la aplicaci√≥n\n                    </h1>\n                    <p class="text-lg text-gray-600 dark:text-gray-400 mb-6">\n                        Lo sentimos, hubo un problema al cargar la aplicaci√≥n. Por favor, intenta recargar la p√°gina.\n                    </p>\n                    <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-6 text-left">\n                        <p class="text-sm font-mono text-red-800 dark:text-red-400 break-all">\n                            ${e.message||e.toString()}\n                        </p>\n                    </div>\n                    <div class="flex gap-4 justify-center flex-wrap">\n                        <button\n                            onclick="location.reload()"\n                            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition shadow-md"\n                        >\n                            üîÑ Recargar P√°gina\n                        </button>\n                        <button\n                            onclick="localStorage.clear(); location.reload();"\n                            class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition shadow-md"\n                        >\n                            üóëÔ∏è Limpiar Cache y Recargar\n                        </button>\n                        <button\n                            onclick="window.location.href='/login.html'"\n                            class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition shadow-md"\n                        >\n                            üîê Volver al Login\n                        </button>\n                    </div>\n                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-6">\n                        Si el problema persiste, contacta al soporte t√©cnico.\n                    </p>\n                </div>\n            </div>\n        `}}document.addEventListener("DOMContentLoaded",()=>{new Le});
